{"type":"file-history-snapshot","messageId":"e434e1c3-80d1-4915-b98d-97d59bc63d17","snapshot":{"messageId":"e434e1c3-80d1-4915-b98d-97d59bc63d17","trackedFileBackups":{},"timestamp":"2026-02-21T14:32:12.415Z"},"isSnapshotUpdate":false}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","type":"progress","data":{"type":"hook_progress","hookEvent":"SessionStart","hookName":"SessionStart:clear","command":"entire hooks claude-code session-start"},"parentToolUseID":"9179d9cd-7031-4cdc-9f1e-3019f7ddbc9c","toolUseID":"9179d9cd-7031-4cdc-9f1e-3019f7ddbc9c","timestamp":"2026-02-21T14:32:10.933Z","uuid":"32ee0e84-67f7-4631-8b87-0e6dcc734142"}
{"parentUuid":"32ee0e84-67f7-4631-8b87-0e6dcc734142","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","type":"user","message":{"role":"user","content":"<local-command-caveat>Caveat: The messages below were generated by the user while running local commands. DO NOT respond to these messages or otherwise consider them in your response unless the user explicitly asks you to.</local-command-caveat>"},"isMeta":true,"uuid":"e63ecf4c-5fb1-43d6-a8b5-5e853038b048","timestamp":"2026-02-21T14:32:12.415Z"}
{"parentUuid":"e63ecf4c-5fb1-43d6-a8b5-5e853038b048","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","type":"user","message":{"role":"user","content":"<command-name>/clear</command-name>\n            <command-message>clear</command-message>\n            <command-args></command-args>"},"uuid":"e434e1c3-80d1-4915-b98d-97d59bc63d17","timestamp":"2026-02-21T14:32:10.587Z"}
{"parentUuid":"e434e1c3-80d1-4915-b98d-97d59bc63d17","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","type":"user","message":{"role":"user","content":"<local-command-stdout></local-command-stdout>"},"uuid":"0828c27a-4287-4054-9540-faa9f74d3a36","timestamp":"2026-02-21T14:32:12.415Z"}
{"type":"file-history-snapshot","messageId":"475eedbe-041a-4296-9cbb-7313506e184a","snapshot":{"messageId":"475eedbe-041a-4296-9cbb-7313506e184a","trackedFileBackups":{},"timestamp":"2026-02-21T14:32:16.817Z"},"isSnapshotUpdate":false}
{"parentUuid":"0828c27a-4287-4054-9540-faa9f74d3a36","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","type":"user","message":{"role":"user","content":"<command-message>ln:codereview</command-message>\n<command-name>/ln:codereview</command-name>"},"uuid":"475eedbe-041a-4296-9cbb-7313506e184a","timestamp":"2026-02-21T14:32:14.269Z"}
{"parentUuid":"475eedbe-041a-4296-9cbb-7313506e184a","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","type":"user","message":{"role":"user","content":[{"type":"text","text":"Conduct a thorough, line-by-line code review with a critical perspective.\n\n**Usage:**\n```bash\n/ln:codereview           # Review all uncommitted changes (default)\n/ln:codereview all       # Review all uncommitted changes (staged + unstaged)\n/ln:codereview unstaged  # Review only unstaged changes\n```\n\n## Review Scope\n\n**Mode 1: All uncommitted changes (default)**\n- Command: `git diff HEAD` (staged + unstaged)\n- Reviews everything not yet committed\n\n**Mode 2: Unstaged only**\n- Command: `git diff` (working directory changes only)\n- Reviews only files not yet staged\n\nAll modes include:\n1. **Critical examination**: Line-by-line inspection with skeptical mindset\n2. **Pattern validation**: Verify adherence to project conventions and guides\n\n## Review Categories\n\n### Code Quality\n- **Clean code**: No TODO comments, no unused code\n- **Naming conventions**: Consistent with project standards\n- **File organization**: Proper separation of concerns\n- **Documentation**: Adequate comments where necessary\n\n### Technical Validation\n- **Build verification**: Zero warnings, all tests pass\n- **Type safety**: No type errors or unsafe operations\n- **Performance**: No memory leaks, efficient algorithms\n- **Security**: No hardcoded secrets or vulnerabilities\n\n### Architecture Review\n- **Design patterns**: Appropriate use of patterns\n- **Dependency management**: Minimal coupling\n- **Error handling**: Comprehensive error coverage\n- **Concurrency**: Thread safety and race conditions\n\n### Design Principles (OCP/SRP)\n\n**OCP (Open-Closed Principle) violations to catch:**\n- Adding `else if` / `switch case` to extend existing behavior\n- Modifying stable code instead of creating new modules\n- Missing extension points (strategy, registry, plugin patterns)\n\n**SRP (Single Responsibility Principle) violations to catch:**\n- One file handling multiple unrelated concerns\n- Functions/classes that change for multiple reasons\n- God objects or utility dumps\n\n**When found, suggest:**\n- Extract new behavior into separate file/class\n- Use strategy/registry pattern for extensibility\n- Split multi-responsibility files into focused modules\n\n## Review Process\n\n### Step 0: Understand Project Context (MANDATORY)\n\nBefore reviewing any code, you MUST understand the project environment:\n\n1. **Read CLAUDE.md** - Check project root and user's `~/.claude/CLAUDE.md` for project-specific conventions\n2. **Identify app type** - Read entry points, config files, or main modules to determine:\n   - **Platform**: Desktop (Electron) / Mobile (React Native, Flutter, iOS, Android) / Web server / CLI / Library\n   - **User model**: Single-user vs Multi-user\n   - **Network exposure**: Local-only vs Network-exposed API\n3. **Understand architecture** - Scan key files to grasp the overall structure\n\n**Why this matters:**\n- Security concerns differ drastically between local desktop app and public API server\n- \"Memory leak\" in a short-lived CLI is irrelevant; in a long-running server it's critical\n- Path traversal in local-only app with file dialog is low-risk; in server accepting arbitrary input it's critical\n\n**DO NOT skip this step.** Reviewing without context leads to false positives and wastes everyone's time.\n\n### Step 1: Analyze Changes\n\nDetermine review mode from command argument (default: `all`):\n\n**Mode: all (default)**\n```bash\ngit diff HEAD  # All uncommitted changes (staged + unstaged)\n```\n\n**Mode: unstaged**\n```bash\ngit diff  # Only unstaged changes\n```\n\n### Step 2: Validate Build\n- TypeScript: `npx tsc --noEmit`\n- Linting: `npm run lint`\n- Testing: `npm run test`\n- Language-specific checks per development guides\n\n### Step 3: Generate Report\n\nI will provide a structured report with:\n\n#### Critical Issues ðŸš¨\n- **ONLY** issues that will cause runtime crashes, data loss, or security breaches\n- Must be reproducible with concrete steps\n- Example: SQL injection, unhandled null causing crash, infinite loop\n\n#### Major Issues âš ï¸\n- Issues that cause incorrect behavior users will notice\n- Must demonstrate actual failure scenario\n- Example: Wrong calculation result, UI not updating, API returning wrong data\n\n#### Minor Issues ðŸ’¡\n- Style violations or optimization opportunities\n- Suggestions for improvement\n- Example: Inconsistent naming, missing error message\n\n**DO NOT mark as Critical/Major:**\n- Theoretical concerns without concrete failure scenario\n- \"Could potentially cause...\" without proof\n- Design preferences or \"I would do it differently\"\n\n#### Positive Highlights âœ…\n- Well-implemented patterns\n- Good practices observed\n\n## Review Principles\n\n- **No temporary solutions**: Reject workarounds or hacks\n- **Complete implementation**: No partial features with TODOs\n- **Performance first**: Consider memory, CPU, and I/O impact\n- **Build cleanliness**: Zero warnings tolerance\n- **Guide compliance**: Follow all development guides in docs/\n\n## â›” Anti-Hallucination Rules\n\nBefore reporting ANY issue, you MUST:\n\n1. **READ the actual code** - Don't guess based on patterns. Read the exact lines.\n2. **TRACE the execution flow** - Follow the code path. If you claim race condition, prove it step by step.\n3. **VERIFY the issue exists** - Can you reproduce it? Show concrete scenario.\n4. **CHECK context** - What's the runtime environment? Desktop vs server, single-user vs multi-user?\n5. **CONFIRM it's not intentional** - fire-and-forget, placeholder values updated later, etc. may be by design.\n\n### Issue Validation Checklist\n\nFor each issue you want to report, answer:\n1. Did I read the ACTUAL code, not just the diff snippet?\n2. Can I show the EXACT line numbers where this fails?\n3. Is this a REAL bug or theoretical concern that can't happen in practice?\n4. Does the surrounding code already handle this case?\n\n### What NOT to report as issues:\n- Singleton with placeholder that gets updated in init/start method\n- \"Memory leak\" in single-user desktop app with bounded data\n- \"Race condition\" when there's already a guard (e.g., `if (this.running) return`)\n- Intentional fire-and-forget patterns with error logging\n- \"Missing cleanup\" when cleanup exists in useEffect return or stop() method\n\n## Exclusions (Do NOT Review)\n\n- **Git submodule reference changes only**: Skip dirty submodule states, submodule commit hash changes in the main repo. Source code inside submodules CAN and SHOULD be reviewed when requested.\n\n## Output Format\n\nThe review will be delivered as a comprehensive report with:\n- Severity-based issue categorization\n- Specific line references for each issue\n- Concrete suggestions for fixes\n- Overall code health assessment"}]},"isMeta":true,"uuid":"97f10781-6d88-442a-92ab-8500ea9f9237","timestamp":"2026-02-21T14:32:14.269Z"}
{"parentUuid":"97f10781-6d88-442a-92ab-8500ea9f9237","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","message":{"model":"claude-sonnet-4-6","id":"msg_01B8qy9duquCpwgBowqPrHap","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user has invoked the `ln:codereview` skill. Let me follow the skill's instructions to conduct a thorough code review of all uncommitted changes.\n\nFirst, I need to:\n1. Understand the project context (read CLAUDE.md - already done via system context)\n2. Analyze changes using `git diff HEAD`\n3. Validate build\n4. Generate report\n\nFrom the system context, I can see:\n- The project is a macOS Tauri v2 + Rust + Svelte 4 + SQLite app\n- There's one modified file: `src/App.svelte`\n- Some untracked files: `doc/app_v2.pen`, `doc/image.png`, `doc/images/`, `doc/untitled.pen`\n\n\nNow I'll pull the diff to see what's changed in the App.svelte file and examine any other uncommitted modifications.","signature":"EqIGCkYICxgCKkBNDHraPDD7ArwRIaAc/ISoWbS+g5BEh8VOiGHCLiFIztAGztj/LaZ6s3yD+DrgQVA1SYKSJ85RrG8aQmLHfKNFEgyM8fzvZYAUYJm5QnEaDG91BdETSdCXk5CSySIwRjUAptq4CLSGzvRtWkRxSI8QQzYcDqoDv2uh9ZsbP2NTmXr5t65Eh02NrKtGqqpTKokFvf8EeviqM0Q6UsIee3g1kwBHNMFyTzTuUmFzMWUp3f15Oc+fSagh8jR1NzIBTPjUT4iGG2Vzl5lpqcpkP888VE5ShcAa4aRF5iLFZKD5L+yez+2Cz1NHbVBidDaKQTMTuair590+ftgoOK5WOljPhhpYNKTd6saJTMCm1TqxfAQ+g574XjKfd8zM+NEnouDDsGwZyXXeeebLvhjf6eBKrQ941F//Q1G14vdvaqLNhAbVG0hhylcfqQcGWyUNbImZ6PWK5vhY6MnZxVdVoscX/t/xaM5VQfEkz729gHN2WIkvcqdV7GvpTc8R/I4jyhPyYqQ6m91RfhP8nAqKepwJpf3XksjF5OCBFkLbSmh0uQWCLCgJStTDdF3/xEl5iDK4bwUxg4MN3Zvr9sab+F/7KaRRbGjFmZNGT++BQ3ooHCuFUo3VU51VAwH5FoHIhUyk8z+ZNVW/oG0jL1twvfW2jFesoZYAkWcEhfItUOtKWiPHFlX94Nmj/5g7jbTkSRbYg0b3mz5YyRjvjOlWpHOoGYLNuye6Z0BzvgLBaT3bnAhvIeML0B421Z6fo+x2x+WgH/E29KR2BBbKKNAGvTqxHhLzyfQ5qvEyau/ubS6hYwmHLfO3h3dJiP+7yJtwpaYIKgdWEZQcPzlnBEbTXfjJdKaK+fDMm6moYhLjbaEgdUyh4GUP+RaiyWRIKk2fzm8yjOguwxrD5p1SGbHVzZGKxF9wurV3rGB+6LmA7YE44uVUrckv7Of25AKMMgQetjU11XmLE0OT4+y6HDxcW5cBT0C55Gvn8Ao37GNAo7kbtcdL0n74SoHWgA7qRzl4jXD/pEC/PreR70AZnf5HbGIi8eMXeO5q6SManhgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":9582,"cache_read_input_tokens":25541,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":9582},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMNpq2AnZgb5UHWqktTM","type":"assistant","uuid":"44e7ef18-19f9-464e-872e-5f9a8fd8462b","timestamp":"2026-02-21T14:32:22.711Z"}
{"parentUuid":"44e7ef18-19f9-464e-872e-5f9a8fd8462b","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","message":{"model":"claude-sonnet-4-6","id":"msg_01B8qy9duquCpwgBowqPrHap","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_016zvqi7c6x9qLRy4LCdKDmC","name":"Bash","input":{"command":"git diff HEAD","description":"Get all uncommitted changes"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":9582,"cache_read_input_tokens":25541,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":9582},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMNpq2AnZgb5UHWqktTM","type":"assistant","uuid":"30124323-4ff4-4393-98f1-977724da9b72","timestamp":"2026-02-21T14:32:22.807Z"}
{"parentUuid":"30124323-4ff4-4393-98f1-977724da9b72","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_016zvqi7c6x9qLRy4LCdKDmC","type":"tool_result","content":"diff --git a/src/App.svelte b/src/App.svelte\nindex db9259a..86159ae 100644\n--- a/src/App.svelte\n+++ b/src/App.svelte\n@@ -5,16 +5,17 @@\n   import { getCurrentWindow } from '@tauri-apps/api/window';\n   import { startDrag } from '@crabnebula/tauri-plugin-drag';\n \n-  const rowHeight = 28;\n+  const rowHeight = 30;\n   const PAGE_SIZE = 500;\n   let homePrefix = '';\n   const COL_WIDTHS_KEY = 'REDACTED';\n+  const THEME_KEY = 'everything-theme';\n   const columnKeys = ['name', 'path', 'size', 'modified'];\n   const minColumnWidth = {\n     name: 180,\n     path: 240,\n     size: 75,\n-    modified: 120\n+    modified: 150\n   };\n   const defaultColumnRatios = {\n     name: 0.3,\n@@ -22,6 +23,12 @@\n     size: 0.1\n   };\n \n+  let theme = (() => { try { return localStorage.getItem(THEME_KEY) || 'dark'; } catch { return 'dark'; } })();\n+  function cycleTheme() {\n+    theme = theme === 'dark' ? 'light' : 'dark';\n+    try { localStorage.setItem(THEME_KEY, theme); } catch {}\n+  }\n+\n   let query = '';\n   let results = [];\n   let totalResults = 0;\n@@ -40,6 +47,8 @@\n     draftName: ''\n   };\n \n+  let renameOverlay = { top: 0, left: 0, width: 0 };\n+\n   let indexStatus = {\n     state: 'Indexing',\n     entriesCount: 0,\n@@ -61,13 +70,13 @@\n   let searchGeneration = 0;\n \n   let scanned = 0;\n-  let indexed = 0;\n-  let currentPath = '';\n \n   let searchInputEl;\n   let renameInputEl;\n   let tableAreaEl;\n   let tableContainer;\n+  let tableResizeObserver = null;\n+  let viewportResizeRaf = null;\n   let scrollTop = 0;\n   let headerScrollLeft = 0;\n   let viewportHeight = 520;\n@@ -78,7 +87,7 @@\n     name: 250,\n     path: 350,\n     size: 75,\n-    modified: 120\n+    modified: 150\n   };\n \n   let contextMenu = {\n@@ -295,6 +304,16 @@\n     syncColumnWidthsToContainer();\n   }\n \n+  function scheduleViewportHeightUpdate() {\n+    if (viewportResizeRaf !== null) {\n+      return;\n+    }\n+    viewportResizeRaf = requestAnimationFrame(() => {\n+      viewportResizeRaf = null;\n+      updateViewportHeight();\n+    });\n+  }\n+\n   function startColumnResize(event, leftKey) {\n     event.preventDefault();\n     event.stopPropagation();\n@@ -420,12 +439,6 @@\n       if (typeof status.scanned === 'number') {\n         scanned = status.scanned;\n       }\n-      if (typeof status.indexed === 'number') {\n-        indexed = status.indexed;\n-      }\n-      if (typeof status.currentPath === 'string') {\n-        currentPath = status.currentPath;\n-      }\n       if (status.state === 'Ready' && prevState !== 'Ready') {\n         scheduleSearch();\n       }\n@@ -900,8 +913,6 @@\n     totalResultsKnown = false;\n     clearSelection();\n     scanned = 0;\n-    indexed = 0;\n-    currentPath = '';\n     dbLatencyMs = null;\n     dbLastQuery = '';\n     indexStatus = { ...indexStatus, state: 'Indexing', entriesCount: 0, message: null };\n@@ -921,6 +932,12 @@\n     return selectedIndices.size > 1;\n   }\n \n+  function autoResizeRenameInput() {\n+    if (!renameInputEl) return;\n+    renameInputEl.style.height = '0';\n+    renameInputEl.style.height = renameInputEl.scrollHeight + 'px';\n+  }\n+\n   async function startRename() {\n     if (isMultiSelected()) {\n       return;\n@@ -932,6 +949,23 @@\n     }\n \n     const entry = results[idx];\n+\n+    // Calculate overlay position mathematically.\n+    // Name cell text starts at: padding-left(16) + icon(16) + gap(6) = 38px from cell left.\n+    // Textarea has padding-left: 0 and border: 1.5px, so text starts ~2px from overlay left.\n+    if (tableContainer) {\n+      const rect = tableContainer.getBoundingClientRect();\n+      const cellLeft = rect.left - tableContainer.scrollLeft;\n+      const textLeft = cellLeft + 38;\n+      const cellRight = cellLeft + colWidths.name;\n+      const rowTop = rect.top + idx * rowHeight - tableContainer.scrollTop;\n+      renameOverlay = {\n+        top: rowTop,\n+        left: textLeft - 2,\n+        width: cellRight - textLeft + 2 - 4\n+      };\n+    }\n+\n     editing = {\n       active: true,\n       path: entry.path,\n@@ -942,6 +976,7 @@\n     await tick();\n \n     if (renameInputEl) {\n+      autoResizeRenameInput();\n       renameInputEl.focus();\n       const extPos = !entry.isDir ? entry.name.lastIndexOf('.') : -1;\n       const selectionEnd = extPos > 0 ? extPos : entry.name.length;\n@@ -984,6 +1019,17 @@\n     closeContextMenu();\n   }\n \n+  function onTitleBarMouseDown(event) {\n+    if (event.button !== 0) {\n+      return;\n+    }\n+\n+    const activeElement = document.activeElement;\n+    if (activeElement instanceof HTMLElement && isTextInputTarget(activeElement)) {\n+      activeElement.blur();\n+    }\n+  }\n+\n   async function focusSearch() {\n     await getCurrentWindow().show();\n     await getCurrentWindow().setFocus();\n@@ -1029,6 +1075,7 @@\n       if (event.key === 'Escape') {\n         event.preventDefault();\n         cancelRename();\n+        searchInputEl?.focus();\n         return;\n       }\n       return;\n@@ -1227,8 +1274,6 @@\n \n     const unlistenProgress = await listen('index_progress', (event) => {\n       scanned = event.payload.scanned;\n-      indexed = event.payload.indexed;\n-      currentPath = event.payload.currentPath;\n       if (indexStatus.state !== 'Indexing') {\n         indexStatus = {\n           ...indexStatus,\n@@ -1325,7 +1370,18 @@\n     await runSearch();\n     flog(`[startup/fe] +${ms()}ms runSearch done`);\n \n-    window.addEventListener('resize', updateViewportHeight);\n+    if (typeof ResizeObserver !== 'undefined') {\n+      tableResizeObserver = new ResizeObserver(() => {\n+        scheduleViewportHeightUpdate();\n+      });\n+      if (tableContainer) {\n+        tableResizeObserver.observe(tableContainer);\n+      } else if (tableAreaEl) {\n+        tableResizeObserver.observe(tableAreaEl);\n+      }\n+    }\n+\n+    window.addEventListener('resize', scheduleViewportHeightUpdate);\n     window.addEventListener('click', onGlobalClick);\n     statusRefreshTimer = setInterval(() => {\n       if (indexStatus.state === 'Indexing') {\n@@ -1346,14 +1402,31 @@\n       unlisten();\n     }\n \n-    window.removeEventListener('resize', updateViewportHeight);\n+    tableResizeObserver?.disconnect();\n+    tableResizeObserver = null;\n+    if (viewportResizeRaf !== null) {\n+      cancelAnimationFrame(viewportResizeRaf);\n+      viewportResizeRaf = null;\n+    }\n+    window.removeEventListener('resize', scheduleViewportHeightUpdate);\n     window.removeEventListener('click', onGlobalClick);\n   });\n </script>\n \n <svelte:window on:keydown={handleKeydown} />\n \n-<div class=\"app-shell\">\n+<div class=\"app-shell\" data-theme={theme}>\n+  <div class=\"title-bar\" role=\"presentation\" data-tauri-drag-region on:mousedown={onTitleBarMouseDown}>\n+    <div class=\"title-left\"></div>\n+    <div class=\"title-center\">\n+      <svg class=\"title-icon\" viewBox=\"0 0 215 205\" fill-rule=\"evenodd\" aria-hidden=\"true\">\n+        <path d=\"M85 0c46.9 0 85 38.1 85 85 0 20.1-7.2 38.5-19.2 52.7l40.7 40.8c5.8 5.8 5.8 15.2 0 21-5.8 5.8-15.2 5.8-21 0l-40.7-40.7c-13.6 9.7-30.4 15.2-44.8 15.2-46.9 0-85-42.1-85-89 0-46.9 38.1-85 85-85z m0 32c-29.3 0-53 23.7-53 53 0 29.3 23.7 53 53 53 29.3 0 53-23.7 53-53 0-29.3-23.7-53-53-53z\"/>\n+      </svg>\n+      <span class=\"title-text\">Everything</span>\n+    </div>\n+    <div class=\"title-right\"></div>\n+  </div>\n+\n   <header class=\"search-bar\">\n     <input\n       bind:this={searchInputEl}\n@@ -1373,7 +1446,7 @@\n       <div class=\"table-header-track\">\n         <div class=\"col name\">\n           <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('name')}>\n-            Name{#if sortBy === 'name'}{sortDir === 'asc' ? ' â–²' : ' â–¼'}{/if}\n+            Name{#if sortBy === 'name'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n           </button>\n           <button\n             type=\"button\"\n@@ -1386,7 +1459,7 @@\n \n         <div class=\"col path\">\n           <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('dir')}>\n-            Path{#if sortBy === 'dir'}{sortDir === 'asc' ? ' â–²' : ' â–¼'}{/if}\n+            Path{#if sortBy === 'dir'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n           </button>\n           <button\n             type=\"button\"\n@@ -1399,13 +1472,13 @@\n \n         <div class=\"col size\">\n           <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('size')}>\n-            Size{#if sortBy === 'size'}{sortDir === 'asc' ? ' â–²' : ' â–¼'}{/if}\n+            Size{#if sortBy === 'size'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n           </button>\n         </div>\n \n         <div class=\"col modified\">\n           <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('mtime')}>\n-            Modified{#if sortBy === 'mtime'}{sortDir === 'asc' ? ' â–²' : ' â–¼'}{/if}\n+            Modified{#if sortBy === 'mtime'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n           </button>\n         </div>\n       </div>\n@@ -1417,6 +1490,7 @@\n       on:scroll={() => {\n         scrollTop = tableContainer.scrollTop;\n         headerScrollLeft = tableContainer.scrollLeft;\n+        if (editing.active) cancelRename();\n         const scrollBottom = scrollTop + tableContainer.clientHeight;\n         if (scrollBottom >= totalHeight - rowHeight * 10) {\n           void loadMore();\n@@ -1439,17 +1513,7 @@\n             >\n               <div class=\"cell name\">\n                 <img class=\"file-icon\" src={iconFor(entry)} alt=\"\" />\n-\n-                {#if editing.active && editing.index === index}\n-                  <input\n-                    bind:this={renameInputEl}\n-                    class=\"rename-input\"\n-                    bind:value={editing.draftName}\n-                    on:click|stopPropagation\n-                  />\n-                {:else}\n-                  <span class=\"ellipsis\">{#each highlightSegments(entry.name, query) as seg}{#if seg.hl}<mark class=\"hl\">{seg.text}</mark>{:else}{seg.text}{/if}{/each}</span>\n-                {/if}\n+                <span class=\"ellipsis\" class:name-editing={editing.active && editing.index === index}>{#each highlightSegments(entry.name, query) as seg}{#if seg.hl}<mark class=\"hl\">{seg.text}</mark>{:else}{seg.text}{/if}{/each}</span>\n               </div>\n               <div class=\"cell path\"><span class=\"ellipsis\">{displayPath(entry.dir)}</span></div>\n               <div class=\"cell size\">{formatSize(entry)}</div>\n@@ -1462,45 +1526,71 @@\n   </section>\n \n   <footer class=\"status-bar\">\n-    {#if indexStatus.state === 'Indexing'}\n-        {#if indexStatus.entriesCount > 0}\n-          <span>Indexing{#if lastReadyCount > 0} ({Math.min(99, Math.round((scanned / lastReadyCount) * 100))}%){/if}{#if indexingElapsed} Â· {indexingElapsed}{/if} Â· {indexStatus.entriesCount.toLocaleString()} entries</span>\n+    <div class=\"status-left\">\n+      <span class=\"status-state\">\n+        <span class=\"state-dot {indexStatus.state === 'Indexing' ? 'indexing' : indexStatus.state === 'Error' ? 'error' : 'ready'}\"></span>\n+        {#if indexStatus.state === 'Indexing'}\n+          Indexing{#if lastReadyCount > 0} ({Math.min(99, Math.round((scanned / lastReadyCount) * 100))}%){/if}{#if indexingElapsed} Â· {indexingElapsed}{/if}\n+          {#if !indexStatus.isCatchup}\n+            Â· {scanned.toLocaleString()} scanned\n+          {/if}\n         {:else}\n-          <span>Starting indexing...{#if indexingElapsed} ({indexingElapsed}){/if}</span>\n-        {/if}\n-      {:else}\n-        <span>Index: {indexStatus.state}</span>\n-        <span>Entries: {indexStatus.entriesCount.toLocaleString()}</span>\n-        {#if indexingFinishedAt}\n-          <span>Indexed in {indexingFinishedAt}</span>\n+          Index: {indexStatus.state}\n         {/if}\n+      </span>\n+      <span>{indexStatus.entriesCount.toLocaleString()} entries</span>\n+      {#if indexingFinishedAt && indexStatus.state !== 'Indexing'}\n+        <span>in {indexingFinishedAt}</span>\n+      {/if}\n+      {#if dbLatencyMs !== null && dbLastQuery}\n+        <span>\"{dbLastQuery}\" {dbLatencyMs}ms Â· {totalResults} results</span>\n       {/if}\n       {#if searchModeLabel === 'spotlight' || searchModeLabel === 'spotlight_timeout'}\n-        <span class=\"status-spotlight\">Spotlight fallback{#if searchModeLabel === 'spotlight_timeout'} (partial results){/if}</span>\n+        <span class=\"status-spotlight\">Spotlight fallback{#if searchModeLabel === 'spotlight_timeout'} (partial){/if}</span>\n       {/if}\n-      {#if dbLatencyMs !== null && dbLastQuery}\n-        <span>\"{dbLastQuery}\" {dbLatencyMs} ms Â· {totalResults} results</span>\n+      {#if indexStatus.permissionErrors > 0}\n+        <span class=\"status-warning\">{indexStatus.permissionErrors.toLocaleString()} permission errors</span>\n       {/if}\n-    <button\n-      class=\"status-btn\"\n-      on:click={resetIndex}\n-      disabled={indexStatus.state === 'Indexing'}\n-      title={indexStatus.state === 'Indexing' ? 'Cannot reset while indexing is in progress.' : 'Reset and rebuild the index.'}\n-    >\n-      Reset Index\n-    </button>\n-    {#if indexStatus.state === 'Indexing' && !indexStatus.isCatchup}\n-      <span class=\"index-progress\">Scanned {scanned.toLocaleString()} / Indexed {indexed.toLocaleString()}</span>\n-      <span class=\"path-preview\">{displayPath(currentPath)}</span>\n-    {/if}\n-    {#if indexStatus.permissionErrors > 0}\n-      <span class=\"status-warning\">Permission errors: {indexStatus.permissionErrors.toLocaleString()}</span>\n-    {/if}\n-    {#if indexStatus.message}\n-      <span class={indexStatus.isCatchup ? 'index-progress' : 'status-error'}>{indexStatus.message}</span>\n-    {/if}\n+      {#if indexStatus.message}\n+        <span class={indexStatus.isCatchup ? 'index-progress' : 'status-error'}>{indexStatus.message}</span>\n+      {/if}\n+    </div>\n+    <div class=\"status-right\">\n+      <button class=\"status-btn theme-btn\" on:click={cycleTheme} title=\"Switch theme\">\n+        {theme === 'dark' ? 'â˜€ Light' : 'â—‘ Dark'}\n+      </button>\n+      <button\n+        class=\"status-btn rebuild-btn\"\n+        on:click={resetIndex}\n+        disabled={indexStatus.state === 'Indexing'}\n+        title={indexStatus.state === 'Indexing' ? 'Cannot reset while indexing is in progress.' : 'Reset and rebuild the index.'}\n+      >\n+        <svg class=\"rebuild-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n+          <path d=\"M23 4v6h-6\"/><path d=\"M20.49 15a9 9 0 1 1-2.12-9.36L23 10\"/>\n+        </svg>\n+        Rebuild Index\n+      </button>\n+    </div>\n   </footer>\n \n+  {#if editing.active}\n+    <div\n+      class=\"rename-overlay\"\n+      style=\"top:{renameOverlay.top}px; left:{renameOverlay.left}px; width:{renameOverlay.width}px;\"\n+      role=\"presentation\"\n+      on:mousedown|stopPropagation\n+    >\n+      <textarea\n+        bind:this={renameInputEl}\n+        class=\"rename-textarea\"\n+        bind:value={editing.draftName}\n+        on:input={autoResizeRenameInput}\n+        on:click|stopPropagation\n+        on:blur={commitRename}\n+      />\n+    </div>\n+  {/if}\n+\n   {#if contextMenu.visible}\n     <div class=\"context-menu\" style={`left:${contextMenu.x}px;top:${contextMenu.y}px;`}>\n       <button on:click={() => (closeContextMenu(), openSelected())}>Open</button>\n@@ -1578,6 +1668,144 @@\n     }\n   }\n \n+  /* â”€â”€ Theme: Dark â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n+  :global([data-theme=\"dark\"]) {\n+    color-scheme: dark;\n+    --bg-app: #1E1E21;\n+    --text-primary: #E2E8F0;\n+    --text-muted: #94A3B8;\n+    --bar-grad-top: #1E1E21;\n+    --bar-grad-bottom: #1E1E21;\n+    --surface-header: #1E1E21;\n+    --surface: #1E1E21;\n+    --bg-input: #161618;\n+    --border-soft: #2A2A2D;\n+    --border-input: rgba(255, 255, 255, 0.06);\n+    --focus-ring: #4DA8FF;\n+    --accent: #4DA8FF;\n+    --row-border: rgba(255, 255, 255, 0.02);\n+    --row-hover: #282828;\n+    --row-selected: rgba(77, 168, 255, 0.10);\n+    --button-bg: rgba(255, 255, 255, 0.05);\n+    --button-border: #2A2A2D;\n+    --button-text: #94A3B8;\n+    --menu-bg: #252528;\n+    --menu-border: #2A2A2D;\n+    --menu-hover: rgba(255, 255, 255, 0.04);\n+    --menu-text: #E2E8F0;\n+    --error-text: #ff9d9d;\n+    --warning-text: #e0c670;\n+    --toast-bg: rgba(10, 10, 16, 0.93);\n+    --toast-text: #f2f2f6;\n+  }\n+\n+  /* â”€â”€ Theme: Light â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n+  :global([data-theme=\"light\"]) {\n+    color-scheme: light;\n+    --bg-app: #F5F5F7;\n+    --text-primary: #1C1C1E;\n+    --text-muted: #6E6E7A;\n+    --bar-grad-top: #F5F5F7;\n+    --bar-grad-bottom: #F5F5F7;\n+    --surface-header: #F5F5F7;\n+    --surface: #F5F5F7;\n+    --bg-input: #FFFFFF;\n+    --border-soft: #D1D1D6;\n+    --border-input: rgba(0, 0, 0, 0.10);\n+    --focus-ring: #3A8BF5;\n+    --accent: #3A8BF5;\n+    --row-border: rgba(0, 0, 0, 0.04);\n+    --row-hover: rgba(0, 0, 0, 0.04);\n+    --row-selected: rgba(58, 139, 245, 0.10);\n+    --button-bg: #FFFFFF;\n+    --button-border: #D1D1D6;\n+    --button-text: #3C3C43;\n+    --menu-bg: #FFFFFF;\n+    --menu-border: #D1D1D6;\n+    --menu-hover: rgba(0, 0, 0, 0.05);\n+    --menu-text: #1C1C1E;\n+    --error-text: #D93025;\n+    --warning-text: #B45309;\n+    --toast-bg: rgba(255, 255, 255, 0.95);\n+    --toast-text: #1C1C1E;\n+  }\n+\n+  /* â”€â”€ Themed element overrides â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n+  :global([data-theme]) {\n+    background: var(--bg-app);\n+  }\n+\n+  /* Search bar: flat, no gradient, no separator */\n+  :global([data-theme]) .search-bar {\n+    height: 44px;\n+    padding: 0 16px;\n+    background: var(--bg-app);\n+    border-bottom: none;\n+  }\n+\n+  :global([data-theme]) .search-input {\n+    backdrop-filter: none;\n+    -webkit-backdrop-filter: none;\n+    font-family: 'JetBrains Mono', 'SF Mono', monospace;\n+    font-size: 12px;\n+    height: 34px;\n+    border-radius: 8px;\n+  }\n+\n+  /* Table header: flat bg, 16px edge padding */\n+  :global([data-theme]) .table-header {\n+    background: var(--bg-app);\n+  }\n+\n+  :global([data-theme]) .col-button {\n+    padding: 0 8px;\n+  }\n+\n+  :global([data-theme]) .col.name .col-button {\n+    padding-left: 16px;\n+  }\n+\n+  /* Row cells: JetBrains Mono, 16px outer edges */\n+  :global([data-theme]) .cell {\n+    font-family: 'JetBrains Mono', monospace;\n+  }\n+\n+  :global([data-theme]) .cell.name {\n+    font-family: Inter, 'SF Pro Text', sans-serif;\n+    padding-left: 16px;\n+    font-size: 12px;\n+    color: var(--text-primary);\n+  }\n+\n+  :global([data-theme]) .cell.path {\n+    font-size: 11px;\n+  }\n+\n+  :global([data-theme]) .cell.size {\n+    font-size: 11px;\n+  }\n+\n+  :global([data-theme]) .cell.modified {\n+    padding-right: 16px;\n+    font-size: 11px;\n+    white-space: nowrap;\n+  }\n+\n+  :global([data-theme]) .row.selected {\n+    box-shadow: inset 3px 0 0 var(--accent);\n+  }\n+\n+  /* Dim path/size/date cells in themed mode */\n+  :global([data-theme]) .cell.path,\n+  :global([data-theme]) .cell.size,\n+  :global([data-theme]) .cell.modified {\n+    color: var(--text-muted);\n+  }\n+\n+  :global(:root) {\n+    background: transparent;\n+  }\n+\n   :global(html, body) {\n     margin: 0;\n     width: 100%;\n@@ -1585,7 +1813,7 @@\n     overflow: hidden;\n     background: transparent;\n     color: var(--text-primary);\n-    font-family: 'SF Pro Text', 'Segoe UI', Helvetica, Arial, sans-serif;\n+    font-family: Inter, 'SF Pro Text', 'Segoe UI', Helvetica, Arial, sans-serif;\n   }\n \n   :global(#app) {\n@@ -1595,11 +1823,62 @@\n \n   .app-shell {\n     display: grid;\n-    grid-template-rows: auto 1fr auto;\n+    grid-template-rows: auto auto 1fr auto;\n     height: 100%;\n     min-width: 0;\n   }\n \n+  .title-bar {\n+    display: flex;\n+    align-items: center;\n+    justify-content: space-between;\n+    height: 44px;\n+    padding: 0 16px;\n+    background: var(--surface-header);\n+    cursor: default;\n+    flex-shrink: 0;\n+    user-select: none;\n+    -webkit-user-select: none;\n+  }\n+\n+  .title-left {\n+    width: 72px;\n+    pointer-events: none;\n+    user-select: none;\n+    -webkit-user-select: none;\n+  }\n+\n+  .title-center {\n+    display: flex;\n+    align-items: center;\n+    gap: 8px;\n+    pointer-events: none;\n+    user-select: none;\n+    -webkit-user-select: none;\n+  }\n+\n+  .title-right {\n+    width: 72px;\n+    pointer-events: none;\n+    user-select: none;\n+    -webkit-user-select: none;\n+  }\n+\n+  .title-icon {\n+    width: 14px;\n+    height: 14px;\n+    fill: var(--accent);\n+    flex-shrink: 0;\n+  }\n+\n+  .title-text {\n+    font-family: Inter, 'SF Pro Text', sans-serif;\n+    font-size: 13px;\n+    font-weight: 500;\n+    color: var(--text-primary);\n+    letter-spacing: -0.01em;\n+  }\n+\n   .search-bar {\n     display: flex;\n     align-items: center;\n@@ -1608,6 +1887,7 @@\n     background: linear-gradient(180deg, var(--bar-grad-top) 0%, var(--bar-grad-bottom) 100%);\n     border-bottom: 1px solid var(--border-soft);\n     min-width: 0;\n+    flex-shrink: 0;\n   }\n \n   .search-input {\n@@ -1616,12 +1896,12 @@\n     width: 100%;\n     min-width: 0;\n     flex: 1 1 auto;\n-    height: 32px;\n+    height: 36px;\n     border: 1px solid var(--border-input);\n-    border-radius: 8px;\n+    border-radius: 14px;\n     padding: 0 10px;\n     font-size: 14px;\n-    background: var(--surface);\n+    background: var(--bg-input, var(--surface));\n     color: var(--text-primary);\n     backdrop-filter: blur(12px) saturate(160%);\n     -webkit-backdrop-filter: blur(12px) saturate(160%);\n@@ -1655,11 +1935,12 @@\n   }\n \n   .table-header {\n-    height: 30px;\n+    height: 32px;\n     border-bottom: 1px solid var(--border-soft);\n     background: var(--surface-header);\n     user-select: none;\n     overflow: hidden;\n+    flex-shrink: 0;\n   }\n \n   .table-header-track {\n@@ -1680,9 +1961,11 @@\n     display: flex;\n     align-items: center;\n     justify-content: flex-start;\n+    gap: 4px;\n     box-sizing: border-box;\n     padding: 0 8px;\n-    font-size: 12px;\n+    font-family: Inter, 'SF Pro Text', sans-serif;\n+    font-size: 11px;\n     font-weight: 600;\n     line-height: 1;\n     color: var(--text-muted);\n@@ -1693,6 +1976,13 @@\n     cursor: pointer;\n   }\n \n+  .sort-icon {\n+    width: 10px;\n+    height: 10px;\n+    flex-shrink: 0;\n+    color: var(--accent);\n+  }\n+\n   .col-resizer {\n     position: absolute;\n     top: 0;\n@@ -1744,7 +2034,7 @@\n   }\n \n   .row {\n-    height: 28px;\n+    height: 30px;\n     border-bottom: 1px solid var(--row-border);\n     cursor: default;\n     -webkit-user-select: none;\n@@ -1766,21 +2056,11 @@\n     display: flex;\n     align-items: center;\n     gap: 6px;\n-  }\n-\n-  .cell.name {\n-    min-width: 0;\n-  }\n-\n-  .cell.path,\n-  .cell.size,\n-  .cell.modified {\n     min-width: 0;\n   }\n \n   .cell.size {\n     text-align: right;\n-    padding-right: 8px;\n     font-variant-numeric: tabular-nums;\n   }\n \n@@ -1802,29 +2082,64 @@\n     flex: 0 0 auto;\n   }\n \n-  .rename-input {\n+  .name-editing {\n+    opacity: 0.25;\n+  }\n+\n+  .rename-overlay {\n+    position: fixed;\n+    z-index: 100;\n+    min-width: 120px;\n+  }\n+\n+  .rename-textarea {\n+    display: block;\n     width: 100%;\n-    height: 20px;\n+    box-sizing: border-box;\n+    font-family: Inter, 'SF Pro Text', sans-serif;\n     font-size: 12px;\n-    border: 1px solid var(--focus-ring);\n+    line-height: 18px;\n+    padding: 5px 4px 5px 0;\n+    border: 1.5px solid var(--focus-ring);\n     border-radius: 4px;\n-    padding: 0 4px;\n-    background: var(--surface);\n+    background: var(--bg-input, var(--surface));\n     color: var(--text-primary);\n+    outline: none;\n+    resize: none;\n+    overflow: hidden;\n+    box-shadow: 0 2px 14px rgba(0, 0, 0, 0.22), 0 0 0 3px rgba(77, 168, 255, 0.13);\n   }\n \n   .status-bar {\n     display: flex;\n     align-items: center;\n-    gap: 14px;\n-    padding: 6px 8px;\n+    justify-content: space-between;\n+    height: 32px;\n+    padding: 0 16px;\n     background: var(--surface-header);\n     border-top: 1px solid var(--border-soft);\n+    font-family: 'JetBrains Mono', monospace;\n     font-size: 11px;\n     color: var(--text-muted);\n     white-space: nowrap;\n     overflow: hidden;\n     min-width: 0;\n+    flex-shrink: 0;\n+  }\n+\n+  .status-left {\n+    display: flex;\n+    align-items: center;\n+    gap: 16px;\n+    overflow: hidden;\n+    min-width: 0;\n+  }\n+\n+  .status-right {\n+    display: flex;\n+    align-items: center;\n+    gap: 8px;\n+    flex-shrink: 0;\n   }\n \n   .status-btn {\n@@ -1848,9 +2163,54 @@\n     filter: none;\n   }\n \n-  .path-preview {\n-    overflow: hidden;\n-    text-overflow: ellipsis;\n+  .status-state {\n+    display: flex;\n+    align-items: center;\n+    gap: 6px;\n+  }\n+\n+  .state-dot {\n+    width: 6px;\n+    height: 6px;\n+    border-radius: 50%;\n+    flex-shrink: 0;\n+  }\n+\n+  .state-dot.ready { background: #28C840; }\n+  .state-dot.indexing { background: #FEBC2E; }\n+  .state-dot.error { background: #FF5F57; }\n+\n+  .rebuild-btn {\n+    display: flex;\n+    align-items: center;\n+    gap: 6px;\n+    font-family: Inter, 'SF Pro Text', sans-serif;\n+    font-size: 10px;\n+    font-weight: 500;\n+    background: var(--button-bg);\n+    border: 1px solid var(--button-border);\n+    border-radius: 4px;\n+    color: var(--button-text);\n+    height: 22px;\n+    padding: 0 10px;\n+    cursor: pointer;\n+  }\n+\n+  .rebuild-btn:hover {\n+    filter: brightness(1.1);\n+  }\n+\n+  .rebuild-btn:disabled {\n+    opacity: 0.5;\n+    cursor: not-allowed;\n+    filter: none;\n+  }\n+\n+  .rebuild-icon {\n+    width: 11px;\n+    height: 11px;\n+    color: var(--accent);\n+    flex-shrink: 0;\n   }\n \n   .status-error {","is_error":false}]},"uuid":"bf8b4c47-975f-4c23-9a9e-905be5fc1178","timestamp":"2026-02-21T14:32:22.931Z","toolUseResult":{"stdout":"diff --git a/src/App.svelte b/src/App.svelte\nindex db9259a..86159ae 100644\n--- a/src/App.svelte\n+++ b/src/App.svelte\n@@ -5,16 +5,17 @@\n   import { getCurrentWindow } from '@tauri-apps/api/window';\n   import { startDrag } from '@crabnebula/tauri-plugin-drag';\n \n-  const rowHeight = 28;\n+  const rowHeight = 30;\n   const PAGE_SIZE = 500;\n   let homePrefix = '';\n   const COL_WIDTHS_KEY = 'REDACTED';\n+  const THEME_KEY = 'everything-theme';\n   const columnKeys = ['name', 'path', 'size', 'modified'];\n   const minColumnWidth = {\n     name: 180,\n     path: 240,\n     size: 75,\n-    modified: 120\n+    modified: 150\n   };\n   const defaultColumnRatios = {\n     name: 0.3,\n@@ -22,6 +23,12 @@\n     size: 0.1\n   };\n \n+  let theme = (() => { try { return localStorage.getItem(THEME_KEY) || 'dark'; } catch { return 'dark'; } })();\n+  function cycleTheme() {\n+    theme = theme === 'dark' ? 'light' : 'dark';\n+    try { localStorage.setItem(THEME_KEY, theme); } catch {}\n+  }\n+\n   let query = '';\n   let results = [];\n   let totalResults = 0;\n@@ -40,6 +47,8 @@\n     draftName: ''\n   };\n \n+  let renameOverlay = { top: 0, left: 0, width: 0 };\n+\n   let indexStatus = {\n     state: 'Indexing',\n     entriesCount: 0,\n@@ -61,13 +70,13 @@\n   let searchGeneration = 0;\n \n   let scanned = 0;\n-  let indexed = 0;\n-  let currentPath = '';\n \n   let searchInputEl;\n   let renameInputEl;\n   let tableAreaEl;\n   let tableContainer;\n+  let tableResizeObserver = null;\n+  let viewportResizeRaf = null;\n   let scrollTop = 0;\n   let headerScrollLeft = 0;\n   let viewportHeight = 520;\n@@ -78,7 +87,7 @@\n     name: 250,\n     path: 350,\n     size: 75,\n-    modified: 120\n+    modified: 150\n   };\n \n   let contextMenu = {\n@@ -295,6 +304,16 @@\n     syncColumnWidthsToContainer();\n   }\n \n+  function scheduleViewportHeightUpdate() {\n+    if (viewportResizeRaf !== null) {\n+      return;\n+    }\n+    viewportResizeRaf = requestAnimationFrame(() => {\n+      viewportResizeRaf = null;\n+      updateViewportHeight();\n+    });\n+  }\n+\n   function startColumnResize(event, leftKey) {\n     event.preventDefault();\n     event.stopPropagation();\n@@ -420,12 +439,6 @@\n       if (typeof status.scanned === 'number') {\n         scanned = status.scanned;\n       }\n-      if (typeof status.indexed === 'number') {\n-        indexed = status.indexed;\n-      }\n-      if (typeof status.currentPath === 'string') {\n-        currentPath = status.currentPath;\n-      }\n       if (status.state === 'Ready' && prevState !== 'Ready') {\n         scheduleSearch();\n       }\n@@ -900,8 +913,6 @@\n     totalResultsKnown = false;\n     clearSelection();\n     scanned = 0;\n-    indexed = 0;\n-    currentPath = '';\n     dbLatencyMs = null;\n     dbLastQuery = '';\n     indexStatus = { ...indexStatus, state: 'Indexing', entriesCount: 0, message: null };\n@@ -921,6 +932,12 @@\n     return selectedIndices.size > 1;\n   }\n \n+  function autoResizeRenameInput() {\n+    if (!renameInputEl) return;\n+    renameInputEl.style.height = '0';\n+    renameInputEl.style.height = renameInputEl.scrollHeight + 'px';\n+  }\n+\n   async function startRename() {\n     if (isMultiSelected()) {\n       return;\n@@ -932,6 +949,23 @@\n     }\n \n     const entry = results[idx];\n+\n+    // Calculate overlay position mathematically.\n+    // Name cell text starts at: padding-left(16) + icon(16) + gap(6) = 38px from cell left.\n+    // Textarea has padding-left: 0 and border: 1.5px, so text starts ~2px from overlay left.\n+    if (tableContainer) {\n+      const rect = tableContainer.getBoundingClientRect();\n+      const cellLeft = rect.left - tableContainer.scrollLeft;\n+      const textLeft = cellLeft + 38;\n+      const cellRight = cellLeft + colWidths.name;\n+      const rowTop = rect.top + idx * rowHeight - tableContainer.scrollTop;\n+      renameOverlay = {\n+        top: rowTop,\n+        left: textLeft - 2,\n+        width: cellRight - textLeft + 2 - 4\n+      };\n+    }\n+\n     editing = {\n       active: true,\n       path: entry.path,\n@@ -942,6 +976,7 @@\n     await tick();\n \n     if (renameInputEl) {\n+      autoResizeRenameInput();\n       renameInputEl.focus();\n       const extPos = !entry.isDir ? entry.name.lastIndexOf('.') : -1;\n       const selectionEnd = extPos > 0 ? extPos : entry.name.length;\n@@ -984,6 +1019,17 @@\n     closeContextMenu();\n   }\n \n+  function onTitleBarMouseDown(event) {\n+    if (event.button !== 0) {\n+      return;\n+    }\n+\n+    const activeElement = document.activeElement;\n+    if (activeElement instanceof HTMLElement && isTextInputTarget(activeElement)) {\n+      activeElement.blur();\n+    }\n+  }\n+\n   async function focusSearch() {\n     await getCurrentWindow().show();\n     await getCurrentWindow().setFocus();\n@@ -1029,6 +1075,7 @@\n       if (event.key === 'Escape') {\n         event.preventDefault();\n         cancelRename();\n+        searchInputEl?.focus();\n         return;\n       }\n       return;\n@@ -1227,8 +1274,6 @@\n \n     const unlistenProgress = await listen('index_progress', (event) => {\n       scanned = event.payload.scanned;\n-      indexed = event.payload.indexed;\n-      currentPath = event.payload.currentPath;\n       if (indexStatus.state !== 'Indexing') {\n         indexStatus = {\n           ...indexStatus,\n@@ -1325,7 +1370,18 @@\n     await runSearch();\n     flog(`[startup/fe] +${ms()}ms runSearch done`);\n \n-    window.addEventListener('resize', updateViewportHeight);\n+    if (typeof ResizeObserver !== 'undefined') {\n+      tableResizeObserver = new ResizeObserver(() => {\n+        scheduleViewportHeightUpdate();\n+      });\n+      if (tableContainer) {\n+        tableResizeObserver.observe(tableContainer);\n+      } else if (tableAreaEl) {\n+        tableResizeObserver.observe(tableAreaEl);\n+      }\n+    }\n+\n+    window.addEventListener('resize', scheduleViewportHeightUpdate);\n     window.addEventListener('click', onGlobalClick);\n     statusRefreshTimer = setInterval(() => {\n       if (indexStatus.state === 'Indexing') {\n@@ -1346,14 +1402,31 @@\n       unlisten();\n     }\n \n-    window.removeEventListener('resize', updateViewportHeight);\n+    tableResizeObserver?.disconnect();\n+    tableResizeObserver = null;\n+    if (viewportResizeRaf !== null) {\n+      cancelAnimationFrame(viewportResizeRaf);\n+      viewportResizeRaf = null;\n+    }\n+    window.removeEventListener('resize', scheduleViewportHeightUpdate);\n     window.removeEventListener('click', onGlobalClick);\n   });\n </script>\n \n <svelte:window on:keydown={handleKeydown} />\n \n-<div class=\"app-shell\">\n+<div class=\"app-shell\" data-theme={theme}>\n+  <div class=\"title-bar\" role=\"presentation\" data-tauri-drag-region on:mousedown={onTitleBarMouseDown}>\n+    <div class=\"title-left\"></div>\n+    <div class=\"title-center\">\n+      <svg class=\"title-icon\" viewBox=\"0 0 215 205\" fill-rule=\"evenodd\" aria-hidden=\"true\">\n+        <path d=\"M85 0c46.9 0 85 38.1 85 85 0 20.1-7.2 38.5-19.2 52.7l40.7 40.8c5.8 5.8 5.8 15.2 0 21-5.8 5.8-15.2 5.8-21 0l-40.7-40.7c-13.6 9.7-30.4 15.2-44.8 15.2-46.9 0-85-42.1-85-89 0-46.9 38.1-85 85-85z m0 32c-29.3 0-53 23.7-53 53 0 29.3 23.7 53 53 53 29.3 0 53-23.7 53-53 0-29.3-23.7-53-53-53z\"/>\n+      </svg>\n+      <span class=\"title-text\">Everything</span>\n+    </div>\n+    <div class=\"title-right\"></div>\n+  </div>\n+\n   <header class=\"search-bar\">\n     <input\n       bind:this={searchInputEl}\n@@ -1373,7 +1446,7 @@\n       <div class=\"table-header-track\">\n         <div class=\"col name\">\n           <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('name')}>\n-            Name{#if sortBy === 'name'}{sortDir === 'asc' ? ' â–²' : ' â–¼'}{/if}\n+            Name{#if sortBy === 'name'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n           </button>\n           <button\n             type=\"button\"\n@@ -1386,7 +1459,7 @@\n \n         <div class=\"col path\">\n           <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('dir')}>\n-            Path{#if sortBy === 'dir'}{sortDir === 'asc' ? ' â–²' : ' â–¼'}{/if}\n+            Path{#if sortBy === 'dir'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n           </button>\n           <button\n             type=\"button\"\n@@ -1399,13 +1472,13 @@\n \n         <div class=\"col size\">\n           <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('size')}>\n-            Size{#if sortBy === 'size'}{sortDir === 'asc' ? ' â–²' : ' â–¼'}{/if}\n+            Size{#if sortBy === 'size'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n           </button>\n         </div>\n \n         <div class=\"col modified\">\n           <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('mtime')}>\n-            Modified{#if sortBy === 'mtime'}{sortDir === 'asc' ? ' â–²' : ' â–¼'}{/if}\n+            Modified{#if sortBy === 'mtime'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n           </button>\n         </div>\n       </div>\n@@ -1417,6 +1490,7 @@\n       on:scroll={() => {\n         scrollTop = tableContainer.scrollTop;\n         headerScrollLeft = tableContainer.scrollLeft;\n+        if (editing.active) cancelRename();\n         const scrollBottom = scrollTop + tableContainer.clientHeight;\n         if (scrollBottom >= totalHeight - rowHeight * 10) {\n           void loadMore();\n@@ -1439,17 +1513,7 @@\n             >\n               <div class=\"cell name\">\n                 <img class=\"file-icon\" src={iconFor(entry)} alt=\"\" />\n-\n-                {#if editing.active && editing.index === index}\n-                  <input\n-                    bind:this={renameInputEl}\n-                    class=\"rename-input\"\n-                    bind:value={editing.draftName}\n-                    on:click|stopPropagation\n-                  />\n-                {:else}\n-                  <span class=\"ellipsis\">{#each highlightSegments(entry.name, query) as seg}{#if seg.hl}<mark class=\"hl\">{seg.text}</mark>{:else}{seg.text}{/if}{/each}</span>\n-                {/if}\n+                <span class=\"ellipsis\" class:name-editing={editing.active && editing.index === index}>{#each highlightSegments(entry.name, query) as seg}{#if seg.hl}<mark class=\"hl\">{seg.text}</mark>{:else}{seg.text}{/if}{/each}</span>\n               </div>\n               <div class=\"cell path\"><span class=\"ellipsis\">{displayPath(entry.dir)}</span></div>\n               <div class=\"cell size\">{formatSize(entry)}</div>\n@@ -1462,45 +1526,71 @@\n   </section>\n \n   <footer class=\"status-bar\">\n-    {#if indexStatus.state === 'Indexing'}\n-        {#if indexStatus.entriesCount > 0}\n-          <span>Indexing{#if lastReadyCount > 0} ({Math.min(99, Math.round((scanned / lastReadyCount) * 100))}%){/if}{#if indexingElapsed} Â· {indexingElapsed}{/if} Â· {indexStatus.entriesCount.toLocaleString()} entries</span>\n+    <div class=\"status-left\">\n+      <span class=\"status-state\">\n+        <span class=\"state-dot {indexStatus.state === 'Indexing' ? 'indexing' : indexStatus.state === 'Error' ? 'error' : 'ready'}\"></span>\n+        {#if indexStatus.state === 'Indexing'}\n+          Indexing{#if lastReadyCount > 0} ({Math.min(99, Math.round((scanned / lastReadyCount) * 100))}%){/if}{#if indexingElapsed} Â· {indexingElapsed}{/if}\n+          {#if !indexStatus.isCatchup}\n+            Â· {scanned.toLocaleString()} scanned\n+          {/if}\n         {:else}\n-          <span>Starting indexing...{#if indexingElapsed} ({indexingElapsed}){/if}</span>\n-        {/if}\n-      {:else}\n-        <span>Index: {indexStatus.state}</span>\n-        <span>Entries: {indexStatus.entriesCount.toLocaleString()}</span>\n-        {#if indexingFinishedAt}\n-          <span>Indexed in {indexingFinishedAt}</span>\n+          Index: {indexStatus.state}\n         {/if}\n+      </span>\n+      <span>{indexStatus.entriesCount.toLocaleString()} entries</span>\n+      {#if indexingFinishedAt && indexStatus.state !== 'Indexing'}\n+        <span>in {indexingFinishedAt}</span>\n+      {/if}\n+      {#if dbLatencyMs !== null && dbLastQuery}\n+        <span>\"{dbLastQuery}\" {dbLatencyMs}ms Â· {totalResults} results</span>\n       {/if}\n       {#if searchModeLabel === 'spotlight' || searchModeLabel === 'spotlight_timeout'}\n-        <span class=\"status-spotlight\">Spotlight fallback{#if searchModeLabel === 'spotlight_timeout'} (partial results){/if}</span>\n+        <span class=\"status-spotlight\">Spotlight fallback{#if searchModeLabel === 'spotlight_timeout'} (partial){/if}</span>\n       {/if}\n-      {#if dbLatencyMs !== null && dbLastQuery}\n-        <span>\"{dbLastQuery}\" {dbLatencyMs} ms Â· {totalResults} results</span>\n+      {#if indexStatus.permissionErrors > 0}\n+        <span class=\"status-warning\">{indexStatus.permissionErrors.toLocaleString()} permission errors</span>\n       {/if}\n-    <button\n-      class=\"status-btn\"\n-      on:click={resetIndex}\n-      disabled={indexStatus.state === 'Indexing'}\n-      title={indexStatus.state === 'Indexing' ? 'Cannot reset while indexing is in progress.' : 'Reset and rebuild the index.'}\n-    >\n-      Reset Index\n-    </button>\n-    {#if indexStatus.state === 'Indexing' && !indexStatus.isCatchup}\n-      <span class=\"index-progress\">Scanned {scanned.toLocaleString()} / Indexed {indexed.toLocaleString()}</span>\n-      <span class=\"path-preview\">{displayPath(currentPath)}</span>\n-    {/if}\n-    {#if indexStatus.permissionErrors > 0}\n-      <span class=\"status-warning\">Permission errors: {indexStatus.permissionErrors.toLocaleString()}</span>\n-    {/if}\n-    {#if indexStatus.message}\n-      <span class={indexStatus.isCatchup ? 'index-progress' : 'status-error'}>{indexStatus.message}</span>\n-    {/if}\n+      {#if indexStatus.message}\n+        <span class={indexStatus.isCatchup ? 'index-progress' : 'status-error'}>{indexStatus.message}</span>\n+      {/if}\n+    </div>\n+    <div class=\"status-right\">\n+      <button class=\"status-btn theme-btn\" on:click={cycleTheme} title=\"Switch theme\">\n+        {theme === 'dark' ? 'â˜€ Light' : 'â—‘ Dark'}\n+      </button>\n+      <button\n+        class=\"status-btn rebuild-btn\"\n+        on:click={resetIndex}\n+        disabled={indexStatus.state === 'Indexing'}\n+        title={indexStatus.state === 'Indexing' ? 'Cannot reset while indexing is in progress.' : 'Reset and rebuild the index.'}\n+      >\n+        <svg class=\"rebuild-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n+          <path d=\"M23 4v6h-6\"/><path d=\"M20.49 15a9 9 0 1 1-2.12-9.36L23 10\"/>\n+        </svg>\n+        Rebuild Index\n+      </button>\n+    </div>\n   </footer>\n \n+  {#if editing.active}\n+    <div\n+      class=\"rename-overlay\"\n+      style=\"top:{renameOverlay.top}px; left:{renameOverlay.left}px; width:{renameOverlay.width}px;\"\n+      role=\"presentation\"\n+      on:mousedown|stopPropagation\n+    >\n+      <textarea\n+        bind:this={renameInputEl}\n+        class=\"rename-textarea\"\n+        bind:value={editing.draftName}\n+        on:input={autoResizeRenameInput}\n+        on:click|stopPropagation\n+        on:blur={commitRename}\n+      />\n+    </div>\n+  {/if}\n+\n   {#if contextMenu.visible}\n     <div class=\"context-menu\" style={`left:${contextMenu.x}px;top:${contextMenu.y}px;`}>\n       <button on:click={() => (closeContextMenu(), openSelected())}>Open</button>\n@@ -1578,6 +1668,144 @@\n     }\n   }\n \n+  /* â”€â”€ Theme: Dark â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n+  :global([data-theme=\"dark\"]) {\n+    color-scheme: dark;\n+    --bg-app: #1E1E21;\n+    --text-primary: #E2E8F0;\n+    --text-muted: #94A3B8;\n+    --bar-grad-top: #1E1E21;\n+    --bar-grad-bottom: #1E1E21;\n+    --surface-header: #1E1E21;\n+    --surface: #1E1E21;\n+    --bg-input: #161618;\n+    --border-soft: #2A2A2D;\n+    --border-input: rgba(255, 255, 255, 0.06);\n+    --focus-ring: #4DA8FF;\n+    --accent: #4DA8FF;\n+    --row-border: rgba(255, 255, 255, 0.02);\n+    --row-hover: #282828;\n+    --row-selected: rgba(77, 168, 255, 0.10);\n+    --button-bg: rgba(255, 255, 255, 0.05);\n+    --button-border: #2A2A2D;\n+    --button-text: #94A3B8;\n+    --menu-bg: #252528;\n+    --menu-border: #2A2A2D;\n+    --menu-hover: rgba(255, 255, 255, 0.04);\n+    --menu-text: #E2E8F0;\n+    --error-text: #ff9d9d;\n+    --warning-text: #e0c670;\n+    --toast-bg: rgba(10, 10, 16, 0.93);\n+    --toast-text: #f2f2f6;\n+  }\n+\n+  /* â”€â”€ Theme: Light â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n+  :global([data-theme=\"light\"]) {\n+    color-scheme: light;\n+    --bg-app: #F5F5F7;\n+    --text-primary: #1C1C1E;\n+    --text-muted: #6E6E7A;\n+    --bar-grad-top: #F5F5F7;\n+    --bar-grad-bottom: #F5F5F7;\n+    --surface-header: #F5F5F7;\n+    --surface: #F5F5F7;\n+    --bg-input: #FFFFFF;\n+    --border-soft: #D1D1D6;\n+    --border-input: rgba(0, 0, 0, 0.10);\n+    --focus-ring: #3A8BF5;\n+    --accent: #3A8BF5;\n+    --row-border: rgba(0, 0, 0, 0.04);\n+    --row-hover: rgba(0, 0, 0, 0.04);\n+    --row-selected: rgba(58, 139, 245, 0.10);\n+    --button-bg: #FFFFFF;\n+    --button-border: #D1D1D6;\n+    --button-text: #3C3C43;\n+    --menu-bg: #FFFFFF;\n+    --menu-border: #D1D1D6;\n+    --menu-hover: rgba(0, 0, 0, 0.05);\n+    --menu-text: #1C1C1E;\n+    --error-text: #D93025;\n+    --warning-text: #B45309;\n+    --toast-bg: rgba(255, 255, 255, 0.95);\n+    --toast-text: #1C1C1E;\n+  }\n+\n+  /* â”€â”€ Themed element overrides â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n+  :global([data-theme]) {\n+    background: var(--bg-app);\n+  }\n+\n+  /* Search bar: flat, no gradient, no separator */\n+  :global([data-theme]) .search-bar {\n+    height: 44px;\n+    padding: 0 16px;\n+    background: var(--bg-app);\n+    border-bottom: none;\n+  }\n+\n+  :global([data-theme]) .search-input {\n+    backdrop-filter: none;\n+    -webkit-backdrop-filter: none;\n+    font-family: 'JetBrains Mono', 'SF Mono', monospace;\n+    font-size: 12px;\n+    height: 34px;\n+    border-radius: 8px;\n+  }\n+\n+  /* Table header: flat bg, 16px edge padding */\n+  :global([data-theme]) .table-header {\n+    background: var(--bg-app);\n+  }\n+\n+  :global([data-theme]) .col-button {\n+    padding: 0 8px;\n+  }\n+\n+  :global([data-theme]) .col.name .col-button {\n+    padding-left: 16px;\n+  }\n+\n+  /* Row cells: JetBrains Mono, 16px outer edges */\n+  :global([data-theme]) .cell {\n+    font-family: 'JetBrains Mono', monospace;\n+  }\n+\n+  :global([data-theme]) .cell.name {\n+    font-family: Inter, 'SF Pro Text', sans-serif;\n+    padding-left: 16px;\n+    font-size: 12px;\n+    color: var(--text-primary);\n+  }\n+\n+  :global([data-theme]) .cell.path {\n+    font-size: 11px;\n+  }\n+\n+  :global([data-theme]) .cell.size {\n+    font-size: 11px;\n+  }\n+\n+  :global([data-theme]) .cell.modified {\n+    padding-right: 16px;\n+    font-size: 11px;\n+    white-space: nowrap;\n+  }\n+\n+  :global([data-theme]) .row.selected {\n+    box-shadow: inset 3px 0 0 var(--accent);\n+  }\n+\n+  /* Dim path/size/date cells in themed mode */\n+  :global([data-theme]) .cell.path,\n+  :global([data-theme]) .cell.size,\n+  :global([data-theme]) .cell.modified {\n+    color: var(--text-muted);\n+  }\n+\n+  :global(:root) {\n+    background: transparent;\n+  }\n+\n   :global(html, body) {\n     margin: 0;\n     width: 100%;\n@@ -1585,7 +1813,7 @@\n     overflow: hidden;\n     background: transparent;\n     color: var(--text-primary);\n-    font-family: 'SF Pro Text', 'Segoe UI', Helvetica, Arial, sans-serif;\n+    font-family: Inter, 'SF Pro Text', 'Segoe UI', Helvetica, Arial, sans-serif;\n   }\n \n   :global(#app) {\n@@ -1595,11 +1823,62 @@\n \n   .app-shell {\n     display: grid;\n-    grid-template-rows: auto 1fr auto;\n+    grid-template-rows: auto auto 1fr auto;\n     height: 100%;\n     min-width: 0;\n   }\n \n+  .title-bar {\n+    display: flex;\n+    align-items: center;\n+    justify-content: space-between;\n+    height: 44px;\n+    padding: 0 16px;\n+    background: var(--surface-header);\n+    cursor: default;\n+    flex-shrink: 0;\n+    user-select: none;\n+    -webkit-user-select: none;\n+  }\n+\n+  .title-left {\n+    width: 72px;\n+    pointer-events: none;\n+    user-select: none;\n+    -webkit-user-select: none;\n+  }\n+\n+  .title-center {\n+    display: flex;\n+    align-items: center;\n+    gap: 8px;\n+    pointer-events: none;\n+    user-select: none;\n+    -webkit-user-select: none;\n+  }\n+\n+  .title-right {\n+    width: 72px;\n+    pointer-events: none;\n+    user-select: none;\n+    -webkit-user-select: none;\n+  }\n+\n+  .title-icon {\n+    width: 14px;\n+    height: 14px;\n+    fill: var(--accent);\n+    flex-shrink: 0;\n+  }\n+\n+  .title-text {\n+    font-family: Inter, 'SF Pro Text', sans-serif;\n+    font-size: 13px;\n+    font-weight: 500;\n+    color: var(--text-primary);\n+    letter-spacing: -0.01em;\n+  }\n+\n   .search-bar {\n     display: flex;\n     align-items: center;\n@@ -1608,6 +1887,7 @@\n     background: linear-gradient(180deg, var(--bar-grad-top) 0%, var(--bar-grad-bottom) 100%);\n     border-bottom: 1px solid var(--border-soft);\n     min-width: 0;\n+    flex-shrink: 0;\n   }\n \n   .search-input {\n@@ -1616,12 +1896,12 @@\n     width: 100%;\n     min-width: 0;\n     flex: 1 1 auto;\n-    height: 32px;\n+    height: 36px;\n     border: 1px solid var(--border-input);\n-    border-radius: 8px;\n+    border-radius: 14px;\n     padding: 0 10px;\n     font-size: 14px;\n-    background: var(--surface);\n+    background: var(--bg-input, var(--surface));\n     color: var(--text-primary);\n     backdrop-filter: blur(12px) saturate(160%);\n     -webkit-backdrop-filter: blur(12px) saturate(160%);\n@@ -1655,11 +1935,12 @@\n   }\n \n   .table-header {\n-    height: 30px;\n+    height: 32px;\n     border-bottom: 1px solid var(--border-soft);\n     background: var(--surface-header);\n     user-select: none;\n     overflow: hidden;\n+    flex-shrink: 0;\n   }\n \n   .table-header-track {\n@@ -1680,9 +1961,11 @@\n     display: flex;\n     align-items: center;\n     justify-content: flex-start;\n+    gap: 4px;\n     box-sizing: border-box;\n     padding: 0 8px;\n-    font-size: 12px;\n+    font-family: Inter, 'SF Pro Text', sans-serif;\n+    font-size: 11px;\n     font-weight: 600;\n     line-height: 1;\n     color: var(--text-muted);\n@@ -1693,6 +1976,13 @@\n     cursor: pointer;\n   }\n \n+  .sort-icon {\n+    width: 10px;\n+    height: 10px;\n+    flex-shrink: 0;\n+    color: var(--accent);\n+  }\n+\n   .col-resizer {\n     position: absolute;\n     top: 0;\n@@ -1744,7 +2034,7 @@\n   }\n \n   .row {\n-    height: 28px;\n+    height: 30px;\n     border-bottom: 1px solid var(--row-border);\n     cursor: default;\n     -webkit-user-select: none;\n@@ -1766,21 +2056,11 @@\n     display: flex;\n     align-items: center;\n     gap: 6px;\n-  }\n-\n-  .cell.name {\n-    min-width: 0;\n-  }\n-\n-  .cell.path,\n-  .cell.size,\n-  .cell.modified {\n     min-width: 0;\n   }\n \n   .cell.size {\n     text-align: right;\n-    padding-right: 8px;\n     font-variant-numeric: tabular-nums;\n   }\n \n@@ -1802,29 +2082,64 @@\n     flex: 0 0 auto;\n   }\n \n-  .rename-input {\n+  .name-editing {\n+    opacity: 0.25;\n+  }\n+\n+  .rename-overlay {\n+    position: fixed;\n+    z-index: 100;\n+    min-width: 120px;\n+  }\n+\n+  .rename-textarea {\n+    display: block;\n     width: 100%;\n-    height: 20px;\n+    box-sizing: border-box;\n+    font-family: Inter, 'SF Pro Text', sans-serif;\n     font-size: 12px;\n-    border: 1px solid var(--focus-ring);\n+    line-height: 18px;\n+    padding: 5px 4px 5px 0;\n+    border: 1.5px solid var(--focus-ring);\n     border-radius: 4px;\n-    padding: 0 4px;\n-    background: var(--surface);\n+    background: var(--bg-input, var(--surface));\n     color: var(--text-primary);\n+    outline: none;\n+    resize: none;\n+    overflow: hidden;\n+    box-shadow: 0 2px 14px rgba(0, 0, 0, 0.22), 0 0 0 3px rgba(77, 168, 255, 0.13);\n   }\n \n   .status-bar {\n     display: flex;\n     align-items: center;\n-    gap: 14px;\n-    padding: 6px 8px;\n+    justify-content: space-between;\n+    height: 32px;\n+    padding: 0 16px;\n     background: var(--surface-header);\n     border-top: 1px solid var(--border-soft);\n+    font-family: 'JetBrains Mono', monospace;\n     font-size: 11px;\n     color: var(--text-muted);\n     white-space: nowrap;\n     overflow: hidden;\n     min-width: 0;\n+    flex-shrink: 0;\n+  }\n+\n+  .status-left {\n+    display: flex;\n+    align-items: center;\n+    gap: 16px;\n+    overflow: hidden;\n+    min-width: 0;\n+  }\n+\n+  .status-right {\n+    display: flex;\n+    align-items: center;\n+    gap: 8px;\n+    flex-shrink: 0;\n   }\n \n   .status-btn {\n@@ -1848,9 +2163,54 @@\n     filter: none;\n   }\n \n-  .path-preview {\n-    overflow: hidden;\n-    text-overflow: ellipsis;\n+  .status-state {\n+    display: flex;\n+    align-items: center;\n+    gap: 6px;\n+  }\n+\n+  .state-dot {\n+    width: 6px;\n+    height: 6px;\n+    border-radius: 50%;\n+    flex-shrink: 0;\n+  }\n+\n+  .state-dot.ready { background: #28C840; }\n+  .state-dot.indexing { background: #FEBC2E; }\n+  .state-dot.error { background: #FF5F57; }\n+\n+  .rebuild-btn {\n+    display: flex;\n+    align-items: center;\n+    gap: 6px;\n+    font-family: Inter, 'SF Pro Text', sans-serif;\n+    font-size: 10px;\n+    font-weight: 500;\n+    background: var(--button-bg);\n+    border: 1px solid var(--button-border);\n+    border-radius: 4px;\n+    color: var(--button-text);\n+    height: 22px;\n+    padding: 0 10px;\n+    cursor: pointer;\n+  }\n+\n+  .rebuild-btn:hover {\n+    filter: brightness(1.1);\n+  }\n+\n+  .rebuild-btn:disabled {\n+    opacity: 0.5;\n+    cursor: not-allowed;\n+    filter: none;\n+  }\n+\n+  .rebuild-icon {\n+    width: 11px;\n+    height: 11px;\n+    color: var(--accent);\n+    flex-shrink: 0;\n   }\n \n   .status-error {","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"30124323-4ff4-4393-98f1-977724da9b72"}
{"parentUuid":"bf8b4c47-975f-4c23-9a9e-905be5fc1178","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","message":{"model":"claude-sonnet-4-6","id":"msg_013zGYC2STUHQMucMtXbsj2R","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The diff is quite large. Let me also read the current App.svelte to understand the full context.","signature":"EogCCkYICxgCKkCgBIOkKkhY+6Ija7y63BSrx6YlaJ5ydz1L2gLINNKRCJHYLTrg8MDfVF7pMui68SGcAqC9BRCdhNbflJg3NsR+EgynbFCq6H1iS82QnK8aDIV3hZTOmtggaqO30SIwNXTgLlq4bBCIbABUrc/bwzDA84Y252m5fXg4d+yBzOHspmJASAYpoH8qzCxmaTbtKnDNzqZc0UHRa0fTU/Kf3jEbZib4LGLxbujL21vhDWHLSODAaWoJycWfRw9UiF0d3Lux618JJS7+Wn6JWrjIAb4wv2c/nno92x/6rnZ7pKv2mdlznppzO5uqWK/B6dATO0vT/Oryd51d3T6awCzEzHRbGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":10564,"cache_read_input_tokens":35123,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":10564},"output_tokens":9,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMNqH3LsK82nzAiVjac4","type":"assistant","uuid":"8e717808-4879-4fa6-ba00-1ae2d370e301","timestamp":"2026-02-21T14:32:24.913Z"}
{"parentUuid":"8e717808-4879-4fa6-ba00-1ae2d370e301","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_013zGYC2STUHQMucMtXbsj2R","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Vs9HrM1wv32uxsJo2wbHFH","name":"Read","input":{"file_path":"/Users/al02402336/everything/src/App.svelte"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":10564,"cache_read_input_tokens":35123,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":10564},"output_tokens":9,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMNqH3LsK82nzAiVjac4","type":"assistant","uuid":"9da282ea-e4a9-49c5-8d9d-6c67bb4e3f6a","timestamp":"2026-02-21T14:32:25.719Z"}
{"parentUuid":"9da282ea-e4a9-49c5-8d9d-6c67bb4e3f6a","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01Vs9HrM1wv32uxsJo2wbHFH","toolUseID":"toolu_01Vs9HrM1wv32uxsJo2wbHFH","timestamp":"2026-02-21T14:32:26.032Z","uuid":"ed6cad3a-a6b0-48b7-9f0e-a959c0143470"}
{"parentUuid":"9da282ea-e4a9-49c5-8d9d-6c67bb4e3f6a","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Vs9HrM1wv32uxsJo2wbHFH","type":"tool_result","content":"     1â†’<script>\n     2â†’  import { onDestroy, onMount, tick } from 'svelte';\n     3â†’  import { invoke } from '@tauri-apps/api/core';\n     4â†’  import { listen } from '@tauri-apps/api/event';\n     5â†’  import { getCurrentWindow } from '@tauri-apps/api/window';\n     6â†’  import { startDrag } from '@crabnebula/tauri-plugin-drag';\n     7â†’\n     8â†’  const rowHeight = 30;\n     9â†’  const PAGE_SIZE = 500;\n    10â†’  let homePrefix = '';\n    11â†’  const COL_WIDTHS_KEY = 'REDACTED';\n    12â†’  const THEME_KEY = 'everything-theme';\n    13â†’  const columnKeys = ['name', 'path', 'size', 'modified'];\n    14â†’  const minColumnWidth = {\n    15â†’    name: 180,\n    16â†’    path: 240,\n    17â†’    size: 75,\n    18â†’    modified: 150\n    19â†’  };\n    20â†’  const defaultColumnRatios = {\n    21â†’    name: 0.3,\n    22â†’    path: 0.45,\n    23â†’    size: 0.1\n    24â†’  };\n    25â†’\n    26â†’  let theme = (() => { try { return localStorage.getItem(THEME_KEY) || 'dark'; } catch { return 'dark'; } })();\n    27â†’  function cycleTheme() {\n    28â†’    theme = theme === 'dark' ? 'light' : 'dark';\n    29â†’    try { localStorage.setItem(THEME_KEY, theme); } catch {}\n    30â†’  }\n    31â†’\n    32â†’  let query = '';\n    33â†’  let results = [];\n    34â†’  let totalResults = 0;\n    35â†’  let totalResultsKnown = false;\n    36â†’\n    37â†’  let dbLatencyMs = null;\n    38â†’  let dbLastQuery = '';\n    39â†’  let searchModeLabel = '';\n    40â†’  let selectedIndices = new Set();\n    41â†’  let selectionAnchor = -1;\n    42â†’  let lastSelectedIndex = -1;\n    43â†’  let editing = {\n    44â†’    active: false,\n    45â†’    path: '',\n    46â†’    index: -1,\n    47â†’    draftName: ''\n    48â†’  };\n    49â†’\n    50â†’  let renameOverlay = { top: 0, left: 0, width: 0 };\n    51â†’\n    52â†’  let indexStatus = {\n    53â†’    state: 'Indexing',\n    54â†’    entriesCount: 0,\n    55â†’    lastUpdated: null,\n    56â†’    permissionErrors: 0,\n    57â†’    message: null,\n    58â†’    isCatchup: false\n    59â†’  };\n    60â†’\n    61â†’  let indexingStartTime = null;\n    62â†’  let indexingElapsed = '';\n    63â†’  let indexingFinishedAt = '';\n    64â†’\n    65â†’  let sortBy = 'name';\n    66â†’  let sortDir = 'asc';\n    67â†’\n    68â†’  let hasMore = true;\n    69â†’  let loadingMore = false;\n    70â†’  let searchGeneration = 0;\n    71â†’\n    72â†’  let scanned = 0;\n    73â†’\n    74â†’  let searchInputEl;\n    75â†’  let renameInputEl;\n    76â†’  let tableAreaEl;\n    77â†’  let tableContainer;\n    78â†’  let tableResizeObserver = null;\n    79â†’  let viewportResizeRaf = null;\n    80â†’  let scrollTop = 0;\n    81â†’  let headerScrollLeft = 0;\n    82â†’  let viewportHeight = 520;\n    83â†’  let lastTableWidth = 0;\n    84â†’  let resizingColumn = '';\n    85â†’  let resizeCleanup = null;\n    86â†’  let colWidths = {\n    87â†’    name: 250,\n    88â†’    path: 350,\n    89â†’    size: 75,\n    90â†’    modified: 150\n    91â†’  };\n    92â†’\n    93â†’  let contextMenu = {\n    94â†’    visible: false,\n    95â†’    x: 0,\n    96â†’    y: 0\n    97â†’  };\n    98â†’\n    99â†’  let platform = '';\n   100â†’  let toast = '';\n   101â†’  let searchTimer;\n   102â†’  let lastSearchFiredAt = 0;\n   103â†’  let toastTimer;\n   104â†’  let statusRefreshTimer;\n   105â†’  let elapsedTimer;\n   106â†’  let statusRefreshInFlight = false;\n   107â†’  let lastReadyCount = 0;\n   108â†’\n   109â†’  const iconCache = new Map();\n   110â†’  const iconLoading = new Set();\n   111â†’\n   112â†’  let highlightCache = new Map();\n   113â†’  let highlightCacheQuery = '';\n   114â†’\n   115â†’  const folderFallbackIcon =\n   116â†’    \"data:image/svg+xml;utf8,\" +\n   117â†’    encodeURIComponent(\n   118â†’      `<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><rect x='1' y='4' width='14' height='10' rx='2' fill='#d9b34f'/><rect x='1' y='2' width='6' height='4' rx='1' fill='#e6ca7a'/></svg>`\n   119â†’    );\n   120â†’  const fileFallbackIcon =\n   121â†’    \"data:image/svg+xml;utf8,\" +\n   122â†’    encodeURIComponent(\n   123â†’      `<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><rect x='3' y='1' width='10' height='14' rx='1.5' fill='#b4bec9'/><rect x='5' y='5' width='6' height='1.2' fill='#8d98a5'/><rect x='5' y='8' width='6' height='1.2' fill='#8d98a5'/></svg>`\n   124â†’    );\n   125â†’\n   126â†’  $: totalHeight = results.length * rowHeight;\n   127â†’  $: startIndex = Math.max(0, Math.floor(scrollTop / rowHeight) - 10);\n   128â†’  $: visibleCount = Math.ceil(viewportHeight / rowHeight) + 20;\n   129â†’  $: endIndex = Math.min(results.length, startIndex + visibleCount);\n   130â†’  $: visibleRows = results.slice(startIndex, endIndex);\n   131â†’  $: translateY = startIndex * rowHeight;\n   132â†’  $: tableMinWidth = colWidths.name + colWidths.path + colWidths.size + colWidths.modified;\n   133â†’  $: tableGridStyle = `--col-name:${colWidths.name}px;--col-path:${colWidths.path}px;--col-size:${colWidths.size}px;--col-modified:${colWidths.modified}px;--table-min-width:${tableMinWidth}px;--header-offset:${-headerScrollLeft}px;`;\n   134â†’\n   135â†’  $: {\n   136â†’    for (const entry of visibleRows) {\n   137â†’      void ensureIcon(entry);\n   138â†’    }\n   139â†’  }\n   140â†’\n   141â†’  function showToast(message) {\n   142â†’    toast = message;\n   143â†’    clearTimeout(toastTimer);\n   144â†’    toastTimer = setTimeout(() => {\n   145â†’      toast = '';\n   146â†’    }, 3000);\n   147â†’  }\n   148â†’\n   149â†’  function bytesToBase64(bytes) {\n   150â†’    let binary = '';\n   151â†’    const chunk = 0x8000;\n   152â†’    for (let i = 0; i < bytes.length; i += chunk) {\n   153â†’      const part = bytes.subarray(i, i + chunk);\n   154â†’      binary += String.fromCharCode(...part);\n   155â†’    }\n   156â†’    return btoa(binary);\n   157â†’  }\n   158â†’\n   159â†’  function highlightSegments(name, q) {\n   160â†’    q = (q || '').trim();\n   161â†’    if (!q) return [{ text: name, hl: false }];\n   162â†’\n   163â†’    // Reset cache when query changes\n   164â†’    if (q !== highlightCacheQuery) {\n   165â†’      highlightCache = new Map();\n   166â†’      highlightCacheQuery = q;\n   167â†’    }\n   168â†’\n   169â†’    // Check cache\n   170â†’    const cached = highlightCache.get(name);\n   171â†’    if (cached) return cached;\n   172â†’\n   173â†’    if (q.includes('/')) q = q.slice(q.lastIndexOf('/') + 1);\n   174â†’    q = q.replace(/[*?]/g, '');\n   175â†’    const terms = q.split(/\\s+/).filter(Boolean);\n   176â†’    if (terms.length === 0) return [{ text: name, hl: false }];\n   177â†’\n   178â†’    const lower = name.toLowerCase();\n   179â†’    const marks = new Uint8Array(name.length);\n   180â†’    for (const t of terms) {\n   181â†’      const tl = t.toLowerCase();\n   182â†’      let idx = lower.indexOf(tl);\n   183â†’      while (idx !== -1) {\n   184â†’        for (let i = idx; i < idx + tl.length; i++) marks[i] = 1;\n   185â†’        idx = lower.indexOf(tl, idx + 1);\n   186â†’      }\n   187â†’    }\n   188â†’\n   189â†’    const segs = [];\n   190â†’    let i = 0;\n   191â†’    while (i < name.length) {\n   192â†’      const m = marks[i];\n   193â†’      let j = i + 1;\n   194â†’      while (j < name.length && marks[j] === m) j++;\n   195â†’      segs.push({ text: name.slice(i, j), hl: m === 1 });\n   196â†’      i = j;\n   197â†’    }\n   198â†’\n   199â†’    highlightCache.set(name, segs);\n   200â†’    return segs;\n   201â†’  }\n   202â†’\n   203â†’  const perFileIconExts = new Set(['exe', 'lnk', 'ico', 'url', 'scr', 'appx']);\n   204â†’\n   205â†’  function iconKey(entry) {\n   206â†’    if (entry.isDir) return '__folder__';\n   207â†’    const ext = (entry.ext || '').toLowerCase();\n   208â†’    if (perFileIconExts.has(ext)) return entry.path;\n   209â†’    return ext || '__file__';\n   210â†’  }\n   211â†’\n   212â†’  function iconFor(entry) {\n   213â†’    return iconCache.get(iconKey(entry)) || (entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n   214â†’  }\n   215â†’\n   216â†’  async function ensureIcon(entry) {\n   217â†’    const key = iconKey(entry);\n   218â†’    if (iconCache.has(key) || iconLoading.has(key)) {\n   219â†’      return;\n   220â†’    }\n   221â†’\n   222â†’    iconLoading.add(key);\n   223â†’    try {\n   224â†’      const bytes = await invoke('get_file_icon', {\n   225â†’        path: entry.path,\n   226â†’        ext: entry.isDir ? 'folder' : entry.ext || '',\n   227â†’      });\n   228â†’      if (Array.isArray(bytes) && bytes.length > 0) {\n   229â†’        const image = `data:image/png;base64,${bytesToBase64(Uint8Array.from(bytes))}`;\n   230â†’        iconCache.set(key, image);\n   231â†’      } else {\n   232â†’        iconCache.set(key, entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n   233â†’      }\n   234â†’    } catch {\n   235â†’      iconCache.set(key, entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n   236â†’    } finally {\n   237â†’      iconLoading.delete(key);\n   238â†’    }\n   239â†’  }\n   240â†’\n   241â†’  function syncColumnWidthsToContainer() {\n   242â†’    const width = tableContainer?.clientWidth || tableAreaEl?.clientWidth;\n   243â†’    if (!width || lastTableWidth !== 0) {\n   244â†’      return;\n   245â†’    }\n   246â†’\n   247â†’    const saved = loadColWidths();\n   248â†’    if (saved) {\n   249â†’      const total = columnKeys.reduce((s, k) => s + saved[k], 0);\n   250â†’      if (Math.abs(total - width) > 2) {\n   251â†’        const scale = (width - saved.modified) / (total - saved.modified);\n   252â†’        let scaledName = Math.max(minColumnWidth.name, Math.round(saved.name * scale));\n   253â†’        let scaledSize = Math.max(minColumnWidth.size, Math.round(saved.size * scale));\n   254â†’        let rawPath = width - saved.modified - scaledName - scaledSize;\n   255â†’        if (rawPath < minColumnWidth.path) {\n   256â†’          const shortfall = minColumnWidth.path - rawPath;\n   257â†’          const nameReduction = Math.min(shortfall, scaledName - minColumnWidth.name);\n   258â†’          scaledName -= nameReduction;\n   259â†’          const remaining = shortfall - nameReduction;\n   260â†’          if (remaining > 0) {\n   261â†’            scaledSize -= Math.min(remaining, scaledSize - minColumnWidth.size);\n   262â†’          }\n   263â†’          rawPath = width - saved.modified - scaledName - scaledSize;\n   264â†’        }\n   265â†’        const scaledPath = Math.max(minColumnWidth.path, rawPath);\n   266â†’        colWidths = { name: scaledName, path: scaledPath, size: scaledSize, modified: saved.modified };\n   267â†’      } else {\n   268â†’        colWidths = saved;\n   269â†’      }\n   270â†’    } else {\n   271â†’      const fixedModified = minColumnWidth.modified;\n   272â†’      const rest = width - fixedModified;\n   273â†’      const ratioSum = defaultColumnRatios.name + defaultColumnRatios.path + defaultColumnRatios.size;\n   274â†’      colWidths = {\n   275â†’        name: Math.max(minColumnWidth.name, Math.round(rest * defaultColumnRatios.name / ratioSum)),\n   276â†’        path: Math.max(minColumnWidth.path, Math.round(rest * defaultColumnRatios.path / ratioSum)),\n   277â†’        size: Math.max(minColumnWidth.size, Math.round(rest * defaultColumnRatios.size / ratioSum)),\n   278â†’        modified: fixedModified\n   279â†’      };\n   280â†’    }\n   281â†’    lastTableWidth = width;\n   282â†’  }\n   283â†’\n   284â†’  function loadColWidths() {\n   285â†’    try {\n   286â†’      const raw = localStorage.getItem(COL_WIDTHS_KEY);\n   287â†’      if (!raw) return null;\n   288â†’      const parsed = JSON.parse(raw);\n   289â†’      for (const key of columnKeys) {\n   290â†’        if (typeof parsed[key] !== 'number' || parsed[key] < (minColumnWidth[key] || 0)) return null;\n   291â†’      }\n   292â†’      return parsed;\n   293â†’    } catch {\n   294â†’      return null;\n   295â†’    }\n   296â†’  }\n   297â†’\n   298â†’  function saveColWidths() {\n   299â†’    localStorage.setItem(COL_WIDTHS_KEY, JSON.stringify(colWidths));\n   300â†’  }\n   301â†’\n   302â†’  function updateViewportHeight() {\n   303â†’    viewportHeight = tableContainer?.clientHeight || 520;\n   304â†’    syncColumnWidthsToContainer();\n   305â†’  }\n   306â†’\n   307â†’  function scheduleViewportHeightUpdate() {\n   308â†’    if (viewportResizeRaf !== null) {\n   309â†’      return;\n   310â†’    }\n   311â†’    viewportResizeRaf = requestAnimationFrame(() => {\n   312â†’      viewportResizeRaf = null;\n   313â†’      updateViewportHeight();\n   314â†’    });\n   315â†’  }\n   316â†’\n   317â†’  function startColumnResize(event, leftKey) {\n   318â†’    event.preventDefault();\n   319â†’    event.stopPropagation();\n   320â†’\n   321â†’    const index = columnKeys.indexOf(leftKey);\n   322â†’    if (index < 0 || index >= columnKeys.length - 1) {\n   323â†’      return;\n   324â†’    }\n   325â†’\n   326â†’    const startX = event.clientX;\n   327â†’    const startLeft = colWidths[leftKey];\n   328â†’    const rightKey = columnKeys[index + 1];\n   329â†’    const startRight = colWidths[rightKey];\n   330â†’\n   331â†’    resizeCleanup?.();\n   332â†’    resizingColumn = leftKey;\n   333â†’\n   334â†’    const onMove = (moveEvent) => {\n   335â†’      const delta = Math.round(moveEvent.clientX - startX);\n   336â†’      if (leftKey === 'name') {\n   337â†’        // Two-column trade: name and path swap space, each respects its minimum\n   338â†’        const nextLeft = Math.max(\n   339â†’          minColumnWidth[leftKey],\n   340â†’          Math.min(startLeft + delta, startLeft + startRight - minColumnWidth[rightKey])\n   341â†’        );\n   342â†’        const nextRight = startLeft + startRight - nextLeft;\n   343â†’        colWidths = { ...colWidths, [leftKey]: nextLeft, [rightKey]: nextRight };\n   344â†’      } else {\n   345â†’        // path splitter: path grows unconstrained (allows horizontal scroll on right drag)\n   346â†’        const nextLeft = Math.max(minColumnWidth[leftKey], startLeft + delta);\n   347â†’        colWidths = { ...colWidths, [leftKey]: nextLeft };\n   348â†’      }\n   349â†’    };\n   350â†’\n   351â†’    const onUp = () => {\n   352â†’      cleanup();\n   353â†’    };\n   354â†’\n   355â†’    const cleanup = () => {\n   356â†’      window.removeEventListener('mousemove', onMove);\n   357â†’      window.removeEventListener('mouseup', onUp);\n   358â†’      document.body.style.cursor = '';\n   359â†’      document.body.style.userSelect = '';\n   360â†’      resizingColumn = '';\n   361â†’      saveColWidths();\n   362â†’      if (resizeCleanup === cleanup) {\n   363â†’        resizeCleanup = null;\n   364â†’      }\n   365â†’    };\n   366â†’\n   367â†’    resizeCleanup = cleanup;\n   368â†’    document.body.style.cursor = 'col-resize';\n   369â†’    document.body.style.userSelect = 'none';\n   370â†’    window.addEventListener('mousemove', onMove);\n   371â†’    window.addEventListener('mouseup', onUp);\n   372â†’  }\n   373â†’\n   374â†’  function selectedPaths() {\n   375â†’    const sorted = [...selectedIndices].sort((a, b) => a - b);\n   376â†’    return sorted.map((idx) => results[idx]).filter(Boolean).map((entry) => entry.path);\n   377â†’  }\n   378â†’\n   379â†’  function clearSelection() {\n   380â†’    selectedIndices = new Set();\n   381â†’    selectionAnchor = -1;\n   382â†’    lastSelectedIndex = -1;\n   383â†’  }\n   384â†’\n   385â†’  function selectSingle(index) {\n   386â†’    selectedIndices = new Set([index]);\n   387â†’    selectionAnchor = index;\n   388â†’    lastSelectedIndex = index;\n   389â†’  }\n   390â†’\n   391â†’  function selectToggle(index) {\n   392â†’    const next = new Set(selectedIndices);\n   393â†’    if (next.has(index)) {\n   394â†’      next.delete(index);\n   395â†’    } else {\n   396â†’      next.add(index);\n   397â†’    }\n   398â†’    selectedIndices = next;\n   399â†’    selectionAnchor = index;\n   400â†’    lastSelectedIndex = index;\n   401â†’  }\n   402â†’\n   403â†’  function selectRange(index) {\n   404â†’    const anchor = selectionAnchor >= 0 ? selectionAnchor : index;\n   405â†’    const [from, to] = [Math.min(anchor, index), Math.max(anchor, index)];\n   406â†’    const next = new Set();\n   407â†’    for (let i = from; i <= to; i += 1) {\n   408â†’      next.add(i);\n   409â†’    }\n   410â†’    selectedIndices = next;\n   411â†’    lastSelectedIndex = index;\n   412â†’  }\n   413â†’\n   414â†’  function primaryEntry() {\n   415â†’    const idx = lastSelectedIndex >= 0 ? lastSelectedIndex : -1;\n   416â†’    return idx >= 0 ? results[idx] : null;\n   417â†’  }\n   418â†’\n   419â†’  async function refreshStatus() {\n   420â†’    if (statusRefreshInFlight) {\n   421â†’      return;\n   422â†’    }\n   423â†’    statusRefreshInFlight = true;\n   424â†’    try {\n   425â†’      const status = await invoke('get_index_status');\n   426â†’      const prevState = indexStatus.state;\n   427â†’      indexStatus = {\n   428â†’        state: status.state,\n   429â†’        entriesCount: status.entriesCount,\n   430â†’        lastUpdated: status.lastUpdated,\n   431â†’        permissionErrors: status.permissionErrors ?? 0,\n   432â†’        message: status.message\n   433â†’      };\n   434â†’      if (status.state === 'Indexing' && prevState !== 'Indexing') {\n   435â†’        startElapsedTimer();\n   436â†’      } else if (status.state !== 'Indexing' && prevState === 'Indexing') {\n   437â†’        stopElapsedTimer();\n   438â†’      }\n   439â†’      if (typeof status.scanned === 'number') {\n   440â†’        scanned = status.scanned;\n   441â†’      }\n   442â†’      if (status.state === 'Ready' && prevState !== 'Ready') {\n   443â†’        scheduleSearch();\n   444â†’      }\n   445â†’    } catch (err) {\n   446â†’      showToast(`Failed to get status: ${String(err)}`);\n   447â†’    } finally {\n   448â†’      statusRefreshInFlight = false;\n   449â†’    }\n   450â†’  }\n   451â†’\n   452â†’  function scheduleSearch(preserveScroll = false) {\n   453â†’    searchGeneration += 1;\n   454â†’    const scheduledGen = searchGeneration;\n   455â†’    clearTimeout(searchTimer);\n   456â†’\n   457â†’    const now = performance.now();\n   458â†’    if (now - lastSearchFiredAt >= 200) {\n   459â†’      // Leading edge: fire immediately if enough time has passed\n   460â†’      lastSearchFiredAt = now;\n   461â†’      void runSearch(preserveScroll);\n   462â†’    } else {\n   463â†’      // Trailing edge: debounce\n   464â†’      searchTimer = setTimeout(() => {\n   465â†’        if (scheduledGen !== searchGeneration) {\n   466â†’          return;\n   467â†’        }\n   468â†’        lastSearchFiredAt = performance.now();\n   469â†’        void runSearch(preserveScroll);\n   470â†’      }, 200);\n   471â†’    }\n   472â†’  }\n   473â†’\n   474â†’  async function runSearch(preserveScroll = false) {\n   475â†’    searchGeneration += 1;\n   476â†’    const gen = searchGeneration;\n   477â†’    const searchQuery = query;\n   478â†’    const searchSortBy = sortBy;\n   479â†’    const searchSortDir = sortDir;\n   480â†’    const startedAt = performance.now();\n   481â†’    try {\n   482â†’      const keepPaths = new Set(selectedPaths());\n   483â†’      const next = await invoke('search', {\n   484â†’        query: searchQuery,\n   485â†’        limit: PAGE_SIZE,\n   486â†’        offset: 0,\n   487â†’        sortBy: searchSortBy,\n   488â†’        sortDir: searchSortDir\n   489â†’      });\n   490â†’\n   491â†’      if (gen !== searchGeneration) return;\n   492â†’\n   493â†’      dbLatencyMs = Math.round(performance.now() - startedAt);\n   494â†’      dbLastQuery = searchQuery;\n   495â†’      const entries = Array.isArray(next.entries) ? next.entries : [];\n   496â†’      searchModeLabel = next.modeLabel || '';\n   497â†’      results = entries;\n   498â†’      if (next.totalCount > 0) {\n   499â†’        totalResults = next.totalCount;\n   500â†’        totalResultsKnown = true;\n   501â†’      } else {\n   502â†’        totalResults = entries.length;\n   503â†’        totalResultsKnown = false;\n   504â†’      }\n   505â†’      hasMore = totalResultsKnown ? results.length < totalResults : entries.length >= PAGE_SIZE;\n   506â†’      if (!preserveScroll && tableContainer) tableContainer.scrollTop = 0;\n   507â†’\n   508â†’      const restored = new Set();\n   509â†’      for (let i = 0; i < results.length; i += 1) {\n   510â†’        if (keepPaths.has(results[i].path)) {\n   511â†’          restored.add(i);\n   512â†’        }\n   513â†’      }\n   514â†’      selectedIndices = restored;\n   515â†’\n   516â†’      updateViewportHeight();\n   517â†’    } catch (err) {\n   518â†’      if (gen !== searchGeneration) return;\n   519â†’      showToast(`Search failed: ${String(err)}`);\n   520â†’    }\n   521â†’  }\n   522â†’\n   523â†’  async function loadMore() {\n   524â†’    if (!hasMore || loadingMore) return;\n   525â†’    const gen = searchGeneration;\n   526â†’    loadingMore = true;\n   527â†’    try {\n   528â†’      const batch = await invoke('search', {\n   529â†’        query,\n   530â†’        limit: PAGE_SIZE,\n   531â†’        offset: results.length,\n   532â†’        sortBy: sortBy,\n   533â†’        sortDir: sortDir\n   534â†’      });\n   535â†’      if (gen !== searchGeneration) return;\n   536â†’      const arr = Array.isArray(batch.entries) ? batch.entries : [];\n   537â†’      if (arr.length > 0) results = [...results, ...arr];\n   538â†’      hasMore = totalResultsKnown ? results.length < totalResults : arr.length >= PAGE_SIZE;\n   539â†’    } catch (err) {\n   540â†’      showToast(`Failed to load more: ${String(err)}`);\n   541â†’    } finally {\n   542â†’      loadingMore = false;\n   543â†’    }\n   544â†’  }\n   545â†’\n   546â†’  function moveSelection(delta, withRange = false) {\n   547â†’    if (results.length === 0) {\n   548â†’      return;\n   549â†’    }\n   550â†’\n   551â†’    const current = lastSelectedIndex >= 0 ? lastSelectedIndex : 0;\n   552â†’    const next = Math.max(0, Math.min(results.length - 1, current + delta));\n   553â†’\n   554â†’    if (withRange) {\n   555â†’      selectRange(next);\n   556â†’    } else {\n   557â†’      selectSingle(next);\n   558â†’    }\n   559â†’\n   560â†’    const top = next * rowHeight;\n   561â†’    const bottom = top + rowHeight;\n   562â†’    if (top < scrollTop) {\n   563â†’      tableContainer.scrollTop = top;\n   564â†’    } else if (bottom > scrollTop + viewportHeight) {\n   565â†’      tableContainer.scrollTop = bottom - viewportHeight;\n   566â†’    }\n   567â†’  }\n   568â†’\n   569â†’  function handleHeaderSort(column) {\n   570â†’    if (sortBy === column) {\n   571â†’      sortDir = sortDir === 'asc' ? 'desc' : 'asc';\n   572â†’    } else {\n   573â†’      sortBy = column;\n   574â†’      sortDir = 'asc';\n   575â†’    }\n   576â†’    if (tableContainer) tableContainer.scrollTop = 0;\n   577â†’    void runSearch();\n   578â†’  }\n   579â†’\n   580â†’  function handleRowClick(event, index) {\n   581â†’    contextMenu.visible = false;\n   582â†’\n   583â†’    if (event.shiftKey) {\n   584â†’      selectRange(index);\n   585â†’      return;\n   586â†’    }\n   587â†’\n   588â†’    if (event.metaKey || event.ctrlKey) {\n   589â†’      selectToggle(index);\n   590â†’      return;\n   591â†’    }\n   592â†’\n   593â†’    selectSingle(index);\n   594â†’  }\n   595â†’\n   596â†’  function handleRowContextMenu(event, index) {\n   597â†’    event.preventDefault();\n   598â†’\n   599â†’    if (!selectedIndices.has(index)) {\n   600â†’      selectSingle(index);\n   601â†’    }\n   602â†’\n   603â†’    if (platform === 'windows' || platform === 'macos') {\n   604â†’      contextMenu.visible = false;\n   605â†’      const paths = selectedPaths();\n   606â†’      if (paths.length > 0) {\n   607â†’        invoke('show_context_menu', {\n   608â†’          paths,\n   609â†’          x: event.clientX,\n   610â†’          y: event.clientY,\n   611â†’          singleSelection: selectedIndices.size === 1\n   612â†’        });\n   613â†’      }\n   614â†’      return;\n   615â†’    }\n   616â†’\n   617â†’    contextMenu = {\n   618â†’      visible: true,\n   619â†’      x: event.clientX,\n   620â†’      y: event.clientY\n   621â†’    };\n   622â†’  }\n   623â†’\n   624â†’  function handleRowA11yKeydown(event, index) {\n   625â†’    if (event.key === ' ' || event.key === 'Enter') {\n   626â†’      event.preventDefault();\n   627â†’      handleRowClick(event, index);\n   628â†’    }\n   629â†’  }\n   630â†’\n   631â†’  const DRAG_THRESHOLD = 5;\n   632â†’  let dragCleanup = null;\n   633â†’  const dragImgCache = new Map();\n   634â†’\n   635â†’  function dragPathsForIndex(index) {\n   636â†’    const entry = results[index];\n   637â†’    if (!entry) {\n   638â†’      return [];\n   639â†’    }\n   640â†’\n   641â†’    if (selectedIndices.has(index) && selectedIndices.size > 0) {\n   642â†’      return selectedPaths();\n   643â†’    }\n   644â†’\n   645â†’    return [entry.path];\n   646â†’  }\n   647â†’\n   648â†’  function getDragIconEl(entry) {\n   649â†’    const src = iconFor(entry);\n   650â†’    let img = dragImgCache.get(src);\n   651â†’    if (!img) {\n   652â†’      img = new Image();\n   653â†’      img.src = src;\n   654â†’      dragImgCache.set(src, img);\n   655â†’    }\n   656â†’    return img.complete && img.naturalWidth > 0 ? img : null;\n   657â†’  }\n   658â†’\n   659â†’  function fillRoundRect(ctx, x, y, w, h, r) {\n   660â†’    ctx.beginPath();\n   661â†’    ctx.moveTo(x + r, y);\n   662â†’    ctx.arcTo(x + w, y, x + w, y + h, r);\n   663â†’    ctx.arcTo(x + w, y + h, x, y + h, r);\n   664â†’    ctx.arcTo(x, y + h, x, y, r);\n   665â†’    ctx.arcTo(x, y, x + w, y, r);\n   666â†’    ctx.closePath();\n   667â†’    ctx.fill();\n   668â†’  }\n   669â†’\n   670â†’  function buildDragPreview(index) {\n   671â†’    const entry = results[index];\n   672â†’    if (!entry) return null;\n   673â†’\n   674â†’    const count = selectedIndices.has(index) ? selectedIndices.size : 1;\n   675â†’    const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;\n   676â†’\n   677â†’    const w = 260;\n   678â†’    const h = 28;\n   679â†’    const stackGap = count > 1 ? 4 : 0;\n   680â†’\n   681â†’    const canvas = document.createElement('canvas');\n   682â†’    canvas.width = w;\n   683â†’    canvas.height = h + stackGap;\n   684â†’    const ctx = canvas.getContext('2d');\n   685â†’\n   686â†’    if (count > 1) {\n   687â†’      ctx.globalAlpha = 0.35;\n   688â†’      ctx.fillStyle = isDark ? '#5a6070' : '#b0c4de';\n   689â†’      fillRoundRect(ctx, 3, 0, w - 3, h, 5);\n   690â†’      ctx.globalAlpha = 1.0;\n   691â†’    }\n   692â†’\n   693â†’    const ry = stackGap;\n   694â†’    ctx.fillStyle = isDark ? 'rgba(58, 64, 74, 0.94)' : 'rgba(214, 231, 255, 0.94)';\n   695â†’    fillRoundRect(ctx, 0, ry, w, h, 5);\n   696â†’\n   697â†’    ctx.strokeStyle = isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';\n   698â†’    ctx.lineWidth = 0.5;\n   699â†’    ctx.beginPath();\n   700â†’    ctx.moveTo(5, ry);\n   701â†’    ctx.arcTo(w, ry, w, ry + h, 5);\n   702â†’    ctx.arcTo(w, ry + h, 0, ry + h, 5);\n   703â†’    ctx.arcTo(0, ry + h, 0, ry, 5);\n   704â†’    ctx.arcTo(0, ry, w, ry, 5);\n   705â†’    ctx.closePath();\n   706â†’    ctx.stroke();\n   707â†’\n   708â†’    const iconEl = getDragIconEl(entry);\n   709â†’    if (iconEl) {\n   710â†’      ctx.drawImage(iconEl, 6, ry + 6, 16, 16);\n   711â†’    } else {\n   712â†’      ctx.fillStyle = entry.isDir ? '#d9b34f' : '#8d98a5';\n   713â†’      fillRoundRect(ctx, 6, ry + 6, 16, 16, 2);\n   714â†’    }\n   715â†’\n   716â†’    ctx.fillStyle = isDark ? '#e6e6e8' : '#1a1a1a';\n   717â†’    ctx.font = '12px -apple-system, \"SF Pro Text\", system-ui, sans-serif';\n   718â†’    ctx.textBaseline = 'middle';\n   719â†’\n   720â†’    let nameMaxW = w - 34;\n   721â†’    if (count > 1) nameMaxW -= 34;\n   722â†’\n   723â†’    let name = entry.name;\n   724â†’    if (ctx.measureText(name).width > nameMaxW) {\n   725â†’      while (name.length > 4 && ctx.measureText(name + '\\u2026').width > nameMaxW) {\n   726â†’        name = name.slice(0, -1);\n   727â†’      }\n   728â†’      name += '\\u2026';\n   729â†’    }\n   730â†’    ctx.fillText(name, 28, ry + h / 2 + 1);\n   731â†’\n   732â†’    if (count > 1) {\n   733â†’      const badge = String(count);\n   734â†’      ctx.font = 'bold 10px -apple-system, system-ui, sans-serif';\n   735â†’      const tw = ctx.measureText(badge).width;\n   736â†’      const bw = Math.max(20, tw + 10);\n   737â†’      const bx = w - bw - 6;\n   738â†’      const by = ry + (h - 18) / 2;\n   739â†’\n   740â†’      ctx.fillStyle = isDark ? '#5b8bd9' : '#007aff';\n   741â†’      fillRoundRect(ctx, bx, by, bw, 18, 9);\n   742â†’\n   743â†’      ctx.fillStyle = '#ffffff';\n   744â†’      ctx.textAlign = 'center';\n   745â†’      ctx.textBaseline = 'middle';\n   746â†’      ctx.fillText(badge, bx + bw / 2, by + 9);\n   747â†’    }\n   748â†’\n   749â†’    return canvas.toDataURL('image/png');\n   750â†’  }\n   751â†’\n   752â†’  function handleRowMouseDown(event, index) {\n   753â†’    if (event.button !== 0) return;\n   754â†’    if (event.metaKey || event.ctrlKey || event.shiftKey) return;\n   755â†’    if (editing.active) return;\n   756â†’\n   757â†’    const startX = event.clientX;\n   758â†’    const startY = event.clientY;\n   759â†’    let dragging = false;\n   760â†’\n   761â†’    dragCleanup?.();\n   762â†’\n   763â†’    const onMove = (e) => {\n   764â†’      if (dragging) return;\n   765â†’      const dx = e.clientX - startX;\n   766â†’      const dy = e.clientY - startY;\n   767â†’      if (dx * dx + dy * dy < DRAG_THRESHOLD * DRAG_THRESHOLD) return;\n   768â†’\n   769â†’      dragging = true;\n   770â†’      cleanup();\n   771â†’\n   772â†’      if (!selectedIndices.has(index)) {\n   773â†’        selectSingle(index);\n   774â†’      }\n   775â†’\n   776â†’      const paths = dragPathsForIndex(index);\n   777â†’      if (paths.length > 0) {\n   778â†’        const icon = buildDragPreview(index);\n   779â†’        startDrag({ item: paths, icon }).catch(() => {});\n   780â†’      }\n   781â†’    };\n   782â†’\n   783â†’    const onUp = () => cleanup();\n   784â†’\n   785â†’    const cleanup = () => {\n   786â†’      window.removeEventListener('mousemove', onMove);\n   787â†’      window.removeEventListener('mouseup', onUp);\n   788â†’      if (dragCleanup === cleanup) dragCleanup = null;\n   789â†’    };\n   790â†’\n   791â†’    dragCleanup = cleanup;\n   792â†’    window.addEventListener('mousemove', onMove);\n   793â†’    window.addEventListener('mouseup', onUp);\n   794â†’  }\n   795â†’\n   796â†’  async function handleRowDoubleClick(index) {\n   797â†’    if (!selectedIndices.has(index) || selectedIndices.size > 1) {\n   798â†’      selectSingle(index);\n   799â†’      await tick();\n   800â†’    }\n   801â†’    await invoke('open', { paths: [results[index].path] }).catch((err) => {\n   802â†’      showToast(`Failed to open: ${String(err)}`);\n   803â†’    });\n   804â†’  }\n   805â†’\n   806â†’  function closeContextMenu() {\n   807â†’    contextMenu = {\n   808â†’      ...contextMenu,\n   809â†’      visible: false\n   810â†’    };\n   811â†’  }\n   812â†’\n   813â†’  async function openSelected() {\n   814â†’    const paths = selectedPaths();\n   815â†’    if (paths.length === 0) {\n   816â†’      return;\n   817â†’    }\n   818â†’\n   819â†’    try {\n   820â†’      await invoke('open', { paths });\n   821â†’    } catch (err) {\n   822â†’      showToast(`Failed to open: ${String(err)}`);\n   823â†’    }\n   824â†’  }\n   825â†’\n   826â†’  async function openWithFallback() {\n   827â†’    const target = primaryEntry();\n   828â†’    if (!target) {\n   829â†’      return;\n   830â†’    }\n   831â†’\n   832â†’    try {\n   833â†’      await invoke('open_with', { path: target.path });\n   834â†’    } catch (err) {\n   835â†’      showToast(`Open With failed: ${String(err)}`);\n   836â†’    }\n   837â†’  }\n   838â†’\n   839â†’  async function revealSelected() {\n   840â†’    const paths = selectedPaths();\n   841â†’    if (paths.length === 0) {\n   842â†’      return;\n   843â†’    }\n   844â†’\n   845â†’    try {\n   846â†’      await invoke('reveal_in_finder', { paths });\n   847â†’    } catch (err) {\n   848â†’      showToast(`Failed to reveal in Finder: ${String(err)}`);\n   849â†’    }\n   850â†’  }\n   851â†’\n   852â†’  async function copySelectedPaths() {\n   853â†’    const paths = selectedPaths();\n   854â†’    if (paths.length === 0) {\n   855â†’      return;\n   856â†’    }\n   857â†’\n   858â†’    try {\n   859â†’      await invoke('copy_paths', { paths });\n   860â†’      showToast(`Copied ${paths.length} path(s)`);\n   861â†’    } catch (err) {\n   862â†’      showToast(`Failed to copy path: ${String(err)}`);\n   863â†’    }\n   864â†’  }\n   865â†’\n   866â†’  async function copyFiles() {\n   867â†’    const paths = selectedPaths();\n   868â†’    if (paths.length === 0) {\n   869â†’      return;\n   870â†’    }\n   871â†’\n   872â†’    try {\n   873â†’      await invoke('copy_files', { paths });\n   874â†’      showToast(`Copied ${paths.length} item(s)`);\n   875â†’    } catch (err) {\n   876â†’      showToast(`Failed to copy: ${String(err)}`);\n   877â†’    }\n   878â†’  }\n   879â†’\n   880â†’  async function trashSelected() {\n   881â†’    const paths = selectedPaths();\n   882â†’    if (paths.length === 0) {\n   883â†’      return;\n   884â†’    }\n   885â†’\n   886â†’    const message =\n   887â†’      paths.length === 1\n   888â†’        ? 'Move selected item to Trash?'\n   889â†’        : `Move ${paths.length} items to Trash?`;\n   890â†’\n   891â†’    if (!window.confirm(message)) {\n   892â†’      return;\n   893â†’    }\n   894â†’\n   895â†’    try {\n   896â†’      await invoke('move_to_trash', { paths });\n   897â†’      showToast('Moved to Trash.');\n   898â†’      clearSelection();\n   899â†’      await runSearch();\n   900â†’    } catch (err) {\n   901â†’      showToast(`Failed to move to Trash: ${String(err)}`);\n   902â†’    }\n   903â†’  }\n   904â†’\n   905â†’  async function resetIndex() {\n   906â†’    if (indexStatus.state === 'Indexing') {\n   907â†’      showToast('Indexing in progress. Please try again after it completes.');\n   908â†’      return;\n   909â†’    }\n   910â†’\n   911â†’    results = [];\n   912â†’    totalResults = 0;\n   913â†’    totalResultsKnown = false;\n   914â†’    clearSelection();\n   915â†’    scanned = 0;\n   916â†’    dbLatencyMs = null;\n   917â†’    dbLastQuery = '';\n   918â†’    indexStatus = { ...indexStatus, state: 'Indexing', entriesCount: 0, message: null };\n   919â†’    indexingStartTime = Date.now();\n   920â†’    indexingElapsed = '';\n   921â†’    indexingFinishedAt = '';\n   922â†’\n   923â†’    try {\n   924â†’      await invoke('reset_index');\n   925â†’    } catch (err) {\n   926â†’      showToast(`Failed to reset index: ${String(err)}`);\n   927â†’      await refreshStatus();\n   928â†’    }\n   929â†’  }\n   930â†’\n   931â†’  function isMultiSelected() {\n   932â†’    return selectedIndices.size > 1;\n   933â†’  }\n   934â†’\n   935â†’  function autoResizeRenameInput() {\n   936â†’    if (!renameInputEl) return;\n   937â†’    renameInputEl.style.height = '0';\n   938â†’    renameInputEl.style.height = renameInputEl.scrollHeight + 'px';\n   939â†’  }\n   940â†’\n   941â†’  async function startRename() {\n   942â†’    if (isMultiSelected()) {\n   943â†’      return;\n   944â†’    }\n   945â†’\n   946â†’    const idx = lastSelectedIndex;\n   947â†’    if (idx < 0 || !results[idx]) {\n   948â†’      return;\n   949â†’    }\n   950â†’\n   951â†’    const entry = results[idx];\n   952â†’\n   953â†’    // Calculate overlay position mathematically.\n   954â†’    // Name cell text starts at: padding-left(16) + icon(16) + gap(6) = 38px from cell left.\n   955â†’    // Textarea has padding-left: 0 and border: 1.5px, so text starts ~2px from overlay left.\n   956â†’    if (tableContainer) {\n   957â†’      const rect = tableContainer.getBoundingClientRect();\n   958â†’      const cellLeft = rect.left - tableContainer.scrollLeft;\n   959â†’      const textLeft = cellLeft + 38;\n   960â†’      const cellRight = cellLeft + colWidths.name;\n   961â†’      const rowTop = rect.top + idx * rowHeight - tableContainer.scrollTop;\n   962â†’      renameOverlay = {\n   963â†’        top: rowTop,\n   964â†’        left: textLeft - 2,\n   965â†’        width: cellRight - textLeft + 2 - 4\n   966â†’      };\n   967â†’    }\n   968â†’\n   969â†’    editing = {\n   970â†’      active: true,\n   971â†’      path: entry.path,\n   972â†’      index: idx,\n   973â†’      draftName: entry.name\n   974â†’    };\n   975â†’\n   976â†’    await tick();\n   977â†’\n   978â†’    if (renameInputEl) {\n   979â†’      autoResizeRenameInput();\n   980â†’      renameInputEl.focus();\n   981â†’      const extPos = !entry.isDir ? entry.name.lastIndexOf('.') : -1;\n   982â†’      const selectionEnd = extPos > 0 ? extPos : entry.name.length;\n   983â†’      renameInputEl.setSelectionRange(0, selectionEnd);\n   984â†’    }\n   985â†’  }\n   986â†’\n   987â†’  function cancelRename() {\n   988â†’    editing = {\n   989â†’      active: false,\n   990â†’      path: '',\n   991â†’      index: -1,\n   992â†’      draftName: ''\n   993â†’    };\n   994â†’  }\n   995â†’\n   996â†’  async function commitRename() {\n   997â†’    if (!editing.active || editing.index < 0 || !results[editing.index]) {\n   998â†’      return;\n   999â†’    }\n  1000â†’\n  1001â†’    const current = results[editing.index];\n  1002â†’    const nextName = editing.draftName;\n  1003â†’\n  1004â†’    try {\n  1005â†’      await invoke('rename', {\n  1006â†’        path: current.path,\n  1007â†’        newName: nextName\n  1008â†’      });\n  1009â†’      cancelRename();\n  1010â†’      await runSearch();\n  1011â†’    } catch (err) {\n  1012â†’      showToast(`Failed to rename: ${String(err)}`);\n  1013â†’      await tick();\n  1014â†’      renameInputEl?.focus();\n  1015â†’    }\n  1016â†’  }\n  1017â†’\n  1018â†’  function onGlobalClick() {\n  1019â†’    closeContextMenu();\n  1020â†’  }\n  1021â†’\n  1022â†’  function onTitleBarMouseDown(event) {\n  1023â†’    if (event.button !== 0) {\n  1024â†’      return;\n  1025â†’    }\n  1026â†’\n  1027â†’    const activeElement = document.activeElement;\n  1028â†’    if (activeElement instanceof HTMLElement && isTextInputTarget(activeElement)) {\n  1029â†’      activeElement.blur();\n  1030â†’    }\n  1031â†’  }\n  1032â†’\n  1033â†’  async function focusSearch() {\n  1034â†’    await getCurrentWindow().show();\n  1035â†’    await getCurrentWindow().setFocus();\n  1036â†’    searchInputEl?.focus();\n  1037â†’    searchInputEl?.select();\n  1038â†’  }\n  1039â†’\n  1040â†’  function isTextInputTarget(target) {\n  1041â†’    return (\n  1042â†’      target instanceof HTMLInputElement ||\n  1043â†’      target instanceof HTMLTextAreaElement ||\n  1044â†’      target?.isContentEditable\n  1045â†’    );\n  1046â†’  }\n  1047â†’\n  1048â†’  async function handleKeydown(event) {\n  1049â†’    const isMetaSelectAll = (event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'a';\n  1050â†’    const isMetaCopy = (event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'c';\n  1051â†’    const target = event.target;\n  1052â†’    const isTextInput = isTextInputTarget(target);\n  1053â†’\n  1054â†’    if (isMetaCopy && isTextInput) {\n  1055â†’      return;\n  1056â†’    }\n  1057â†’\n  1058â†’    if (isMetaSelectAll) {\n  1059â†’      if (isTextInput) {\n  1060â†’        event.preventDefault();\n  1061â†’        if (target instanceof HTMLInputElement || target instanceof HTMLTextAreaElement) {\n  1062â†’          target.select();\n  1063â†’        }\n  1064â†’        return;\n  1065â†’      }\n  1066â†’    }\n  1067â†’\n  1068â†’    if (editing.active) {\n  1069â†’      if (event.key === 'Enter') {\n  1070â†’        event.preventDefault();\n  1071â†’        await commitRename();\n  1072â†’        return;\n  1073â†’      }\n  1074â†’\n  1075â†’      if (event.key === 'Escape') {\n  1076â†’        event.preventDefault();\n  1077â†’        cancelRename();\n  1078â†’        searchInputEl?.focus();\n  1079â†’        return;\n  1080â†’      }\n  1081â†’      return;\n  1082â†’    }\n  1083â†’\n  1084â†’    if (event.key === 'Escape') {\n  1085â†’      event.preventDefault();\n  1086â†’      clearSelection();\n  1087â†’      searchInputEl?.focus();\n  1088â†’      return;\n  1089â†’    }\n  1090â†’\n  1091â†’    if (event.key === 'ArrowDown') {\n  1092â†’      event.preventDefault();\n  1093â†’      moveSelection(1, event.shiftKey);\n  1094â†’      return;\n  1095â†’    }\n  1096â†’\n  1097â†’    if (event.key === 'ArrowUp') {\n  1098â†’      event.preventDefault();\n  1099â†’      moveSelection(-1, event.shiftKey);\n  1100â†’      return;\n  1101â†’    }\n  1102â†’\n  1103â†’    if (event.key === 'PageDown') {\n  1104â†’      event.preventDefault();\n  1105â†’      moveSelection(Math.floor(viewportHeight / rowHeight), event.shiftKey);\n  1106â†’      return;\n  1107â†’    }\n  1108â†’\n  1109â†’    if (event.key === 'PageUp') {\n  1110â†’      event.preventDefault();\n  1111â†’      moveSelection(-Math.floor(viewportHeight / rowHeight), event.shiftKey);\n  1112â†’      return;\n  1113â†’    }\n  1114â†’\n  1115â†’    if (event.key === 'Enter') {\n  1116â†’      event.preventDefault();\n  1117â†’      if (platform === 'windows') {\n  1118â†’        await openSelected();\n  1119â†’      } else {\n  1120â†’        await startRename();\n  1121â†’      }\n  1122â†’      return;\n  1123â†’    }\n  1124â†’\n  1125â†’    if (event.key === 'F2') {\n  1126â†’      event.preventDefault();\n  1127â†’      await startRename();\n  1128â†’      return;\n  1129â†’    }\n  1130â†’\n  1131â†’    if (event.key === ' ' && !isTextInput) {\n  1132â†’      event.preventDefault();\n  1133â†’      const entry = primaryEntry();\n  1134â†’      if (entry) {\n  1135â†’        await invoke('quick_look', { path: entry.path });\n  1136â†’      }\n  1137â†’      return;\n  1138â†’    }\n  1139â†’\n  1140â†’    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'f') {\n  1141â†’      event.preventDefault();\n  1142â†’      clearSelection();\n  1143â†’      searchInputEl?.focus();\n  1144â†’      searchInputEl?.select();\n  1145â†’      return;\n  1146â†’    }\n  1147â†’\n  1148â†’    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'o') {\n  1149â†’      event.preventDefault();\n  1150â†’      await openSelected();\n  1151â†’      return;\n  1152â†’    }\n  1153â†’\n  1154â†’    if ((event.metaKey || event.ctrlKey) && event.key === 'Enter') {\n  1155â†’      event.preventDefault();\n  1156â†’      await revealSelected();\n  1157â†’      return;\n  1158â†’    }\n  1159â†’\n  1160â†’    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'c') {\n  1161â†’      event.preventDefault();\n  1162â†’      await copySelectedPaths();\n  1163â†’      return;\n  1164â†’    }\n  1165â†’\n  1166â†’    if (isMetaSelectAll) {\n  1167â†’      event.preventDefault();\n  1168â†’      selectedIndices = new Set(Array.from({ length: results.length }, (_, i) => i));\n  1169â†’      return;\n  1170â†’    }\n  1171â†’\n  1172â†’    if (event.key === 'Delete' || ((event.metaKey || event.ctrlKey) && event.key === 'Backspace')) {\n  1173â†’      if (!isTextInput) {\n  1174â†’        event.preventDefault();\n  1175â†’        await trashSelected();\n  1176â†’      }\n  1177â†’      return;\n  1178â†’    }\n  1179â†’  }\n  1180â†’\n  1181â†’  function formatSize(entry) {\n  1182â†’    if (entry.isDir || entry.size == null) return '';\n  1183â†’    const bytes = entry.size;\n  1184â†’    if (bytes < 1024) return `${bytes} B`;\n  1185â†’    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n  1186â†’    if (bytes < 1024 * 1024 * 1024) return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n  1187â†’    return `${(bytes / (1024 * 1024 * 1024)).toFixed(1)} GB`;\n  1188â†’  }\n  1189â†’\n  1190â†’  function formatModified(entry) {\n  1191â†’    if (!entry.mtime) {\n  1192â†’      return '';\n  1193â†’    }\n  1194â†’\n  1195â†’    const d = new Date(entry.mtime * 1000);\n  1196â†’    const pad = (n) => String(n).padStart(2, '0');\n  1197â†’    return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;\n  1198â†’  }\n  1199â†’\n  1200â†’  function formatLastUpdated(timestamp) {\n  1201â†’    if (!timestamp) {\n  1202â†’      return '-';\n  1203â†’    }\n  1204â†’\n  1205â†’    return new Date(timestamp * 1000).toLocaleString();\n  1206â†’  }\n  1207â†’\n  1208â†’  function formatElapsed(ms) {\n  1209â†’    const totalSec = Math.floor(ms / 1000);\n  1210â†’    const min = Math.floor(totalSec / 60);\n  1211â†’    const sec = totalSec % 60;\n  1212â†’    return min > 0 ? `${min}m ${sec}s` : `${sec}s`;\n  1213â†’  }\n  1214â†’\n  1215â†’  function updateElapsed() {\n  1216â†’    if (indexingStartTime && indexStatus.state === 'Indexing') {\n  1217â†’      indexingElapsed = formatElapsed(Date.now() - indexingStartTime);\n  1218â†’    }\n  1219â†’  }\n  1220â†’\n  1221â†’  function startElapsedTimer() {\n  1222â†’    clearInterval(elapsedTimer);\n  1223â†’    indexingStartTime = Date.now();\n  1224â†’    indexingElapsed = '0s';\n  1225â†’    indexingFinishedAt = '';\n  1226â†’    elapsedTimer = setInterval(updateElapsed, 1000);\n  1227â†’  }\n  1228â†’\n  1229â†’  function stopElapsedTimer() {\n  1230â†’    clearInterval(elapsedTimer);\n  1231â†’    if (indexingStartTime) {\n  1232â†’      const elapsed = Date.now() - indexingStartTime;\n  1233â†’      indexingFinishedAt = `${formatElapsed(elapsed)}`;\n  1234â†’    }\n  1235â†’    indexingStartTime = null;\n  1236â†’    indexingElapsed = '';\n  1237â†’  }\n  1238â†’\n  1239â†’  function displayPath(path) {\n  1240â†’    if (!path) {\n  1241â†’      return path;\n  1242â†’    }\n  1243â†’\n  1244â†’    if (!homePrefix) {\n  1245â†’      return path;\n  1246â†’    }\n  1247â†’\n  1248â†’    if (path === homePrefix) {\n  1249â†’      return '~';\n  1250â†’    }\n  1251â†’\n  1252â†’    if (path.startsWith(`${homePrefix}/`)) {\n  1253â†’      return `~${path.slice(homePrefix.length)}`;\n  1254â†’    }\n  1255â†’\n  1256â†’    return path;\n  1257â†’  }\n  1258â†’\n  1259â†’  let unlistenFns = [];\n  1260â†’\n  1261â†’  onMount(async () => {\n  1262â†’    const t0 = performance.now();\n  1263â†’    const ms = () => Math.round(performance.now() - t0);\n  1264â†’    const DEBUG_STARTUP = false;\n  1265â†’    const flog = DEBUG_STARTUP ? (msg) => invoke('frontend_log', { msg }).catch(() => {}) : () => {};\n  1266â†’\n  1267â†’    flog(`[startup/fe] onMount entered`);\n  1268â†’\n  1269â†’    updateViewportHeight();\n  1270â†’    flog(`[startup/fe] +${ms()}ms updateViewportHeight done`);\n  1271â†’\n  1272â†’    platform = await invoke('get_platform');\n  1273â†’    flog(`[startup/fe] +${ms()}ms get_platform done`);\n  1274â†’\n  1275â†’    const unlistenProgress = await listen('index_progress', (event) => {\n  1276â†’      scanned = event.payload.scanned;\n  1277â†’      if (indexStatus.state !== 'Indexing') {\n  1278â†’        indexStatus = {\n  1279â†’          ...indexStatus,\n  1280â†’          state: 'Indexing'\n  1281â†’        };\n  1282â†’      }\n  1283â†’    });\n  1284â†’    flog(`[startup/fe] +${ms()}ms listen(index_progress) registered`);\n  1285â†’\n  1286â†’    const unlistenState = await listen('index_state', (event) => {\n  1287â†’      flog(`[startup/fe] index_state event received: ${event.payload.state} at +${ms()}ms`);\n  1288â†’      const prevState = indexStatus.state;\n  1289â†’      indexStatus = {\n  1290â†’        ...indexStatus,\n  1291â†’        state: event.payload.state,\n  1292â†’        message: event.payload.message ?? null,\n  1293â†’        isCatchup: event.payload.isCatchup ?? false\n  1294â†’      };\n  1295â†’\n  1296â†’      if (event.payload.state === 'Indexing' && prevState !== 'Indexing') {\n  1297â†’        if (prevState === 'Ready') {\n  1298â†’          lastReadyCount = indexStatus.entriesCount;\n  1299â†’        }\n  1300â†’        startElapsedTimer();\n  1301â†’      } else if (event.payload.state !== 'Indexing' && prevState === 'Indexing') {\n  1302â†’        stopElapsedTimer();\n  1303â†’      }\n  1304â†’\n  1305â†’      if (event.payload.state === 'Ready') {\n  1306â†’        scheduleSearch();\n  1307â†’      }\n  1308â†’    });\n  1309â†’    flog(`[startup/fe] +${ms()}ms listen(index_state) registered`);\n  1310â†’\n  1311â†’    const unlistenUpdated = await listen('index_updated', (event) => {\n  1312â†’      indexStatus = {\n  1313â†’        ...indexStatus,\n  1314â†’        entriesCount: event.payload.entriesCount,\n  1315â†’        lastUpdated: event.payload.lastUpdated,\n  1316â†’        permissionErrors: event.payload.permissionErrors ?? indexStatus.permissionErrors\n  1317â†’      };\n  1318â†’\n  1319â†’      scheduleSearch(true);\n  1320â†’    });\n  1321â†’\n  1322â†’    const unlistenFocus = await listen('focus_search', () => {\n  1323â†’      void focusSearch();\n  1324â†’    });\n  1325â†’\n  1326â†’    const unlistenCtxMenuAction = await listen('context_menu_action', (event) => {\n  1327â†’      switch (event.payload) {\n  1328â†’        case 'open': void openSelected(); break;\n  1329â†’        case 'quick_look': {\n  1330â†’          const e = primaryEntry();\n  1331â†’          if (e) void invoke('quick_look', { path: e.path });\n  1332â†’          break;\n  1333â†’        }\n  1334â†’        case 'open_with': void openWithFallback(); break;\n  1335â†’        case 'reveal': void revealSelected(); break;\n  1336â†’        case 'copy_files': void copyFiles(); break;\n  1337â†’        case 'copy_path': void copySelectedPaths(); break;\n  1338â†’        case 'trash': void trashSelected(); break;\n  1339â†’        case 'rename': void startRename(); break;\n  1340â†’      }\n  1341â†’    });\n  1342â†’\n  1343â†’    unlistenFns = [unlistenProgress, unlistenState, unlistenUpdated, unlistenFocus, unlistenCtxMenuAction];\n  1344â†’    flog(`[startup/fe] +${ms()}ms all listeners registered`);\n  1345â†’\n  1346â†’    // Fetch backend state IMMEDIATELY after listeners are registered.\n  1347â†’    // Events emitted before listener registration are lost, so this\n  1348â†’    // is the only reliable way to get the current state.\n  1349â†’    await refreshStatus();\n  1350â†’    flog(`[startup/fe] +${ms()}ms refreshStatus done (state=${indexStatus.state})`);\n  1351â†’\n  1352â†’    // Show Svelte UI: remove skeleton, focus search input.\n  1353â†’    await tick();\n  1354â†’    document.getElementById('skeleton')?.remove();\n  1355â†’    await focusSearch();\n  1356â†’    flog(`[startup/fe] +${ms()}ms WINDOW VISIBLE â€” skeleton removed`);\n  1357â†’\n  1358â†’    try {\n  1359â†’      homePrefix = await invoke('get_home_dir');\n  1360â†’    } catch {\n  1361â†’      homePrefix = '';\n  1362â†’    }\n  1363â†’    flog(`[startup/fe] +${ms()}ms get_home_dir done`);\n  1364â†’\n  1365â†’    if (!localStorage.getItem('everything-fda-notice-v1')) {\n  1366â†’      showToast('macOS Full Disk Access permission may be required for full disk search.');\n  1367â†’      localStorage.setItem('everything-fda-notice-v1', '1');\n  1368â†’    }\n  1369â†’    flog(`[startup/fe] +${ms()}ms calling runSearch...`);\n  1370â†’    await runSearch();\n  1371â†’    flog(`[startup/fe] +${ms()}ms runSearch done`);\n  1372â†’\n  1373â†’    if (typeof ResizeObserver !== 'undefined') {\n  1374â†’      tableResizeObserver = new ResizeObserver(() => {\n  1375â†’        scheduleViewportHeightUpdate();\n  1376â†’      });\n  1377â†’      if (tableContainer) {\n  1378â†’        tableResizeObserver.observe(tableContainer);\n  1379â†’      } else if (tableAreaEl) {\n  1380â†’        tableResizeObserver.observe(tableAreaEl);\n  1381â†’      }\n  1382â†’    }\n  1383â†’\n  1384â†’    window.addEventListener('resize', scheduleViewportHeightUpdate);\n  1385â†’    window.addEventListener('click', onGlobalClick);\n  1386â†’    statusRefreshTimer = setInterval(() => {\n  1387â†’      if (indexStatus.state === 'Indexing') {\n  1388â†’        void refreshStatus();\n  1389â†’      }\n  1390â†’    }, 1000);\n  1391â†’    console.log(`[startup/fe] +${ms()}ms onMount complete`);\n  1392â†’  });\n  1393â†’\n  1394â†’  onDestroy(async () => {\n  1395â†’    clearTimeout(searchTimer);\n  1396â†’    clearTimeout(toastTimer);\n  1397â†’    clearInterval(statusRefreshTimer);\n  1398â†’    clearInterval(elapsedTimer);\n  1399â†’    resizeCleanup?.();\n  1400â†’\n  1401â†’    for (const unlisten of unlistenFns) {\n  1402â†’      unlisten();\n  1403â†’    }\n  1404â†’\n  1405â†’    tableResizeObserver?.disconnect();\n  1406â†’    tableResizeObserver = null;\n  1407â†’    if (viewportResizeRaf !== null) {\n  1408â†’      cancelAnimationFrame(viewportResizeRaf);\n  1409â†’      viewportResizeRaf = null;\n  1410â†’    }\n  1411â†’    window.removeEventListener('resize', scheduleViewportHeightUpdate);\n  1412â†’    window.removeEventListener('click', onGlobalClick);\n  1413â†’  });\n  1414â†’</script>\n  1415â†’\n  1416â†’<svelte:window on:keydown={handleKeydown} />\n  1417â†’\n  1418â†’<div class=\"app-shell\" data-theme={theme}>\n  1419â†’  <div class=\"title-bar\" role=\"presentation\" data-tauri-drag-region on:mousedown={onTitleBarMouseDown}>\n  1420â†’    <div class=\"title-left\"></div>\n  1421â†’    <div class=\"title-center\">\n  1422â†’      <svg class=\"title-icon\" viewBox=\"0 0 215 205\" fill-rule=\"evenodd\" aria-hidden=\"true\">\n  1423â†’        <path d=\"M85 0c46.9 0 85 38.1 85 85 0 20.1-7.2 38.5-19.2 52.7l40.7 40.8c5.8 5.8 5.8 15.2 0 21-5.8 5.8-15.2 5.8-21 0l-40.7-40.7c-13.6 9.7-30.4 15.2-44.8 15.2-46.9 0-85-42.1-85-89 0-46.9 38.1-85 85-85z m0 32c-29.3 0-53 23.7-53 53 0 29.3 23.7 53 53 53 29.3 0 53-23.7 53-53 0-29.3-23.7-53-53-53z\"/>\n  1424â†’      </svg>\n  1425â†’      <span class=\"title-text\">Everything</span>\n  1426â†’    </div>\n  1427â†’    <div class=\"title-right\"></div>\n  1428â†’  </div>\n  1429â†’\n  1430â†’  <header class=\"search-bar\">\n  1431â†’    <input\n  1432â†’      bind:this={searchInputEl}\n  1433â†’      class=\"search-input\"\n  1434â†’      type=\"text\"\n  1435â†’      bind:value={query}\n  1436â†’      on:input={scheduleSearch}\n  1437â†’      on:focus={clearSelection}\n  1438â†’      placeholder=\"Search file/folder names\"\n  1439â†’      autocomplete=\"off\"\n  1440â†’      spellcheck=\"false\"\n  1441â†’    />\n  1442â†’  </header>\n  1443â†’\n  1444â†’  <section class=\"table-area\" bind:this={tableAreaEl} style={tableGridStyle}>\n  1445â†’    <div class=\"table-header\">\n  1446â†’      <div class=\"table-header-track\">\n  1447â†’        <div class=\"col name\">\n  1448â†’          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('name')}>\n  1449â†’            Name{#if sortBy === 'name'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n  1450â†’          </button>\n  1451â†’          <button\n  1452â†’            type=\"button\"\n  1453â†’            class=\"col-resizer\"\n  1454â†’            class:active={resizingColumn === 'name'}\n  1455â†’            on:mousedown={(event) => startColumnResize(event, 'name')}\n  1456â†’            aria-label=\"Resize Name column\"\n  1457â†’          />\n  1458â†’        </div>\n  1459â†’\n  1460â†’        <div class=\"col path\">\n  1461â†’          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('dir')}>\n  1462â†’            Path{#if sortBy === 'dir'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n  1463â†’          </button>\n  1464â†’          <button\n  1465â†’            type=\"button\"\n  1466â†’            class=\"col-resizer\"\n  1467â†’            class:active={resizingColumn === 'path'}\n  1468â†’            on:mousedown={(event) => startColumnResize(event, 'path')}\n  1469â†’            aria-label=\"Resize Path column\"\n  1470â†’          />\n  1471â†’        </div>\n  1472â†’\n  1473â†’        <div class=\"col size\">\n  1474â†’          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('size')}>\n  1475â†’            Size{#if sortBy === 'size'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n  1476â†’          </button>\n  1477â†’        </div>\n  1478â†’\n  1479â†’        <div class=\"col modified\">\n  1480â†’          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('mtime')}>\n  1481â†’            Modified{#if sortBy === 'mtime'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n  1482â†’          </button>\n  1483â†’        </div>\n  1484â†’      </div>\n  1485â†’    </div>\n  1486â†’\n  1487â†’    <div\n  1488â†’      class=\"table-body\"\n  1489â†’      bind:this={tableContainer}\n  1490â†’      on:scroll={() => {\n  1491â†’        scrollTop = tableContainer.scrollTop;\n  1492â†’        headerScrollLeft = tableContainer.scrollLeft;\n  1493â†’        if (editing.active) cancelRename();\n  1494â†’        const scrollBottom = scrollTop + tableContainer.clientHeight;\n  1495â†’        if (scrollBottom >= totalHeight - rowHeight * 10) {\n  1496â†’          void loadMore();\n  1497â†’        }\n  1498â†’      }}\n  1499â†’    >\n  1500â†’      <div class=\"spacer\" style={`height:${totalHeight}px`}>\n  1501â†’        <div class=\"rows\" style={`transform: translateY(${translateY}px);`}>\n  1502â†’          {#each visibleRows as entry, localIndex}\n  1503â†’            {@const index = startIndex + localIndex}\n  1504â†’            <div\n  1505â†’              class=\"row {selectedIndices.has(index) ? 'selected' : ''}\"\n  1506â†’              on:mousedown={(event) => handleRowMouseDown(event, index)}\n  1507â†’              on:click={(event) => handleRowClick(event, index)}\n  1508â†’              on:keydown={(event) => handleRowA11yKeydown(event, index)}\n  1509â†’              on:dblclick={() => handleRowDoubleClick(index)}\n  1510â†’              on:contextmenu={(event) => handleRowContextMenu(event, index)}\n  1511â†’              role=\"row\"\n  1512â†’              tabindex=\"0\"\n  1513â†’            >\n  1514â†’              <div class=\"cell name\">\n  1515â†’                <img class=\"file-icon\" src={iconFor(entry)} alt=\"\" />\n  1516â†’                <span class=\"ellipsis\" class:name-editing={editing.active && editing.index === index}>{#each highlightSegments(entry.name, query) as seg}{#if seg.hl}<mark class=\"hl\">{seg.text}</mark>{:else}{seg.text}{/if}{/each}</span>\n  1517â†’              </div>\n  1518â†’              <div class=\"cell path\"><span class=\"ellipsis\">{displayPath(entry.dir)}</span></div>\n  1519â†’              <div class=\"cell size\">{formatSize(entry)}</div>\n  1520â†’              <div class=\"cell modified\">{formatModified(entry)}</div>\n  1521â†’            </div>\n  1522â†’          {/each}\n  1523â†’        </div>\n  1524â†’      </div>\n  1525â†’    </div>\n  1526â†’  </section>\n  1527â†’\n  1528â†’  <footer class=\"status-bar\">\n  1529â†’    <div class=\"status-left\">\n  1530â†’      <span class=\"status-state\">\n  1531â†’        <span class=\"state-dot {indexStatus.state === 'Indexing' ? 'indexing' : indexStatus.state === 'Error' ? 'error' : 'ready'}\"></span>\n  1532â†’        {#if indexStatus.state === 'Indexing'}\n  1533â†’          Indexing{#if lastReadyCount > 0} ({Math.min(99, Math.round((scanned / lastReadyCount) * 100))}%){/if}{#if indexingElapsed} Â· {indexingElapsed}{/if}\n  1534â†’          {#if !indexStatus.isCatchup}\n  1535â†’            Â· {scanned.toLocaleString()} scanned\n  1536â†’          {/if}\n  1537â†’        {:else}\n  1538â†’          Index: {indexStatus.state}\n  1539â†’        {/if}\n  1540â†’      </span>\n  1541â†’      <span>{indexStatus.entriesCount.toLocaleString()} entries</span>\n  1542â†’      {#if indexingFinishedAt && indexStatus.state !== 'Indexing'}\n  1543â†’        <span>in {indexingFinishedAt}</span>\n  1544â†’      {/if}\n  1545â†’      {#if dbLatencyMs !== null && dbLastQuery}\n  1546â†’        <span>\"{dbLastQuery}\" {dbLatencyMs}ms Â· {totalResults} results</span>\n  1547â†’      {/if}\n  1548â†’      {#if searchModeLabel === 'spotlight' || searchModeLabel === 'spotlight_timeout'}\n  1549â†’        <span class=\"status-spotlight\">Spotlight fallback{#if searchModeLabel === 'spotlight_timeout'} (partial){/if}</span>\n  1550â†’      {/if}\n  1551â†’      {#if indexStatus.permissionErrors > 0}\n  1552â†’        <span class=\"status-warning\">{indexStatus.permissionErrors.toLocaleString()} permission errors</span>\n  1553â†’      {/if}\n  1554â†’      {#if indexStatus.message}\n  1555â†’        <span class={indexStatus.isCatchup ? 'index-progress' : 'status-error'}>{indexStatus.message}</span>\n  1556â†’      {/if}\n  1557â†’    </div>\n  1558â†’    <div class=\"status-right\">\n  1559â†’      <button class=\"status-btn theme-btn\" on:click={cycleTheme} title=\"Switch theme\">\n  1560â†’        {theme === 'dark' ? 'â˜€ Light' : 'â—‘ Dark'}\n  1561â†’      </button>\n  1562â†’      <button\n  1563â†’        class=\"status-btn rebuild-btn\"\n  1564â†’        on:click={resetIndex}\n  1565â†’        disabled={indexStatus.state === 'Indexing'}\n  1566â†’        title={indexStatus.state === 'Indexing' ? 'Cannot reset while indexing is in progress.' : 'Reset and rebuild the index.'}\n  1567â†’      >\n  1568â†’        <svg class=\"rebuild-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n  1569â†’          <path d=\"M23 4v6h-6\"/><path d=\"M20.49 15a9 9 0 1 1-2.12-9.36L23 10\"/>\n  1570â†’        </svg>\n  1571â†’        Rebuild Index\n  1572â†’      </button>\n  1573â†’    </div>\n  1574â†’  </footer>\n  1575â†’\n  1576â†’  {#if editing.active}\n  1577â†’    <div\n  1578â†’      class=\"rename-overlay\"\n  1579â†’      style=\"top:{renameOverlay.top}px; left:{renameOverlay.left}px; width:{renameOverlay.width}px;\"\n  1580â†’      role=\"presentation\"\n  1581â†’      on:mousedown|stopPropagation\n  1582â†’    >\n  1583â†’      <textarea\n  1584â†’        bind:this={renameInputEl}\n  1585â†’        class=\"rename-textarea\"\n  1586â†’        bind:value={editing.draftName}\n  1587â†’        on:input={autoResizeRenameInput}\n  1588â†’        on:click|stopPropagation\n  1589â†’        on:blur={commitRename}\n  1590â†’      />\n  1591â†’    </div>\n  1592â†’  {/if}\n  1593â†’\n  1594â†’  {#if contextMenu.visible}\n  1595â†’    <div class=\"context-menu\" style={`left:${contextMenu.x}px;top:${contextMenu.y}px;`}>\n  1596â†’      <button on:click={() => (closeContextMenu(), openSelected())}>Open</button>\n  1597â†’      <button on:click={async () => { closeContextMenu(); const e = primaryEntry(); if (e) await invoke('quick_look', { path: e.path }); }}>Quick Look</button>\n  1598â†’      <button on:click={() => (closeContextMenu(), openWithFallback())}>Open With... (Reveal in Finder)</button>\n  1599â†’      <button on:click={() => (closeContextMenu(), revealSelected())}>Reveal in Finder</button>\n  1600â†’      <button on:click={() => (closeContextMenu(), copySelectedPaths())}>Copy Path</button>\n  1601â†’      <button on:click={() => (closeContextMenu(), trashSelected())}>Move to Trash</button>\n  1602â†’      {#if selectedIndices.size === 1}\n  1603â†’        <button on:click={() => (closeContextMenu(), startRename())}>Rename</button>\n  1604â†’      {/if}\n  1605â†’    </div>\n  1606â†’  {/if}\n  1607â†’\n  1608â†’  {#if toast}\n  1609â†’    <div class=\"toast\">{toast}</div>\n  1610â†’  {/if}\n  1611â†’</div>\n  1612â†’\n  1613â†’<style>\n  1614â†’  :global(:root) {\n  1615â†’    color-scheme: light dark;\n  1616â†’    --bg-app: transparent;\n  1617â†’    --text-primary: #0d1826;\n  1618â†’    --text-muted: #48596c;\n  1619â†’    --bar-grad-top: rgba(255, 255, 255, 0.48);\n  1620â†’    --bar-grad-bottom: rgba(248, 250, 253, 0.42);\n  1621â†’    --surface-header: rgba(252, 252, 255, 0.40);\n  1622â†’    --surface: rgba(255, 255, 255, 0.22);\n  1623â†’    --border-soft: rgba(0, 0, 0, 0.07);\n  1624â†’    --border-input: rgba(0, 0, 0, 0.13);\n  1625â†’    --focus-ring: #6f96e6;\n  1626â†’    --row-border: rgba(0, 0, 0, 0.032);\n  1627â†’    --row-hover: rgba(0, 0, 0, 0.06);\n  1628â†’    --row-selected: rgba(0, 0, 0, 0.12);\n  1629â†’    --button-bg: rgba(255, 255, 255, 0.62);\n  1630â†’    --button-border: rgba(0, 0, 0, 0.10);\n  1631â†’    --button-text: #2c3e50;\n  1632â†’    --menu-bg: rgba(240, 241, 248, 0.90);\n  1633â†’    --menu-border: rgba(0, 0, 0, 0.06);\n  1634â†’    --menu-hover: rgba(255, 255, 255, 0.62);\n  1635â†’    --menu-text: #1a2a38;\n  1636â†’    --error-text: #b64545;\n  1637â†’    --warning-text: #8f6500;\n  1638â†’    --toast-bg: rgba(18, 22, 32, 0.90);\n  1639â†’    --toast-text: #ffffff;\n  1640â†’  }\n  1641â†’\n  1642â†’  @media (prefers-color-scheme: dark) {\n  1643â†’    :global(:root) {\n  1644â†’      --bg-app: transparent;\n  1645â†’      --text-primary: #e6e6ea;\n  1646â†’      --text-muted: #9494a4;\n  1647â†’      --bar-grad-top: rgba(38, 38, 46, 0.52);\n  1648â†’      --bar-grad-bottom: rgba(30, 30, 38, 0.46);\n  1649â†’      --surface-header: rgba(32, 32, 40, 0.46);\n  1650â†’      --surface: rgba(18, 18, 26, 0.32);\n  1651â†’      --border-soft: rgba(255, 255, 255, 0.065);\n  1652â†’      --border-input: rgba(255, 255, 255, 0.14);\n  1653â†’      --focus-ring: #5b8bd9;\n  1654â†’      --row-border: rgba(255, 255, 255, 0.026);\n  1655â†’      --row-hover: rgba(255, 255, 255, 0.08);\n  1656â†’      --row-selected: rgba(255, 255, 255, 0.14);\n  1657â†’      --button-bg: rgba(255, 255, 255, 0.072);\n  1658â†’      --button-border: rgba(255, 255, 255, 0.11);\n  1659â†’      --button-text: #d6d6e0;\n  1660â†’      --menu-bg: rgba(36, 36, 46, 0.90);\n  1661â†’      --menu-border: rgba(255, 255, 255, 0.066);\n  1662â†’      --menu-hover: rgba(255, 255, 255, 0.062);\n  1663â†’      --menu-text: #e0e0e8;\n  1664â†’      --error-text: #ff9d9d;\n  1665â†’      --warning-text: #e0c670;\n  1666â†’      --toast-bg: rgba(10, 10, 16, 0.93);\n  1667â†’      --toast-text: #f2f2f6;\n  1668â†’    }\n  1669â†’  }\n  1670â†’\n  1671â†’  /* â”€â”€ Theme: Dark â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  1672â†’  :global([data-theme=\"dark\"]) {\n  1673â†’    color-scheme: dark;\n  1674â†’    --bg-app: #1E1E21;\n  1675â†’    --text-primary: #E2E8F0;\n  1676â†’    --text-muted: #94A3B8;\n  1677â†’    --bar-grad-top: #1E1E21;\n  1678â†’    --bar-grad-bottom: #1E1E21;\n  1679â†’    --surface-header: #1E1E21;\n  1680â†’    --surface: #1E1E21;\n  1681â†’    --bg-input: #161618;\n  1682â†’    --border-soft: #2A2A2D;\n  1683â†’    --border-input: rgba(255, 255, 255, 0.06);\n  1684â†’    --focus-ring: #4DA8FF;\n  1685â†’    --accent: #4DA8FF;\n  1686â†’    --row-border: rgba(255, 255, 255, 0.02);\n  1687â†’    --row-hover: #282828;\n  1688â†’    --row-selected: rgba(77, 168, 255, 0.10);\n  1689â†’    --button-bg: rgba(255, 255, 255, 0.05);\n  1690â†’    --button-border: #2A2A2D;\n  1691â†’    --button-text: #94A3B8;\n  1692â†’    --menu-bg: #252528;\n  1693â†’    --menu-border: #2A2A2D;\n  1694â†’    --menu-hover: rgba(255, 255, 255, 0.04);\n  1695â†’    --menu-text: #E2E8F0;\n  1696â†’    --error-text: #ff9d9d;\n  1697â†’    --warning-text: #e0c670;\n  1698â†’    --toast-bg: rgba(10, 10, 16, 0.93);\n  1699â†’    --toast-text: #f2f2f6;\n  1700â†’  }\n  1701â†’\n  1702â†’  /* â”€â”€ Theme: Light â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  1703â†’  :global([data-theme=\"light\"]) {\n  1704â†’    color-scheme: light;\n  1705â†’    --bg-app: #F5F5F7;\n  1706â†’    --text-primary: #1C1C1E;\n  1707â†’    --text-muted: #6E6E7A;\n  1708â†’    --bar-grad-top: #F5F5F7;\n  1709â†’    --bar-grad-bottom: #F5F5F7;\n  1710â†’    --surface-header: #F5F5F7;\n  1711â†’    --surface: #F5F5F7;\n  1712â†’    --bg-input: #FFFFFF;\n  1713â†’    --border-soft: #D1D1D6;\n  1714â†’    --border-input: rgba(0, 0, 0, 0.10);\n  1715â†’    --focus-ring: #3A8BF5;\n  1716â†’    --accent: #3A8BF5;\n  1717â†’    --row-border: rgba(0, 0, 0, 0.04);\n  1718â†’    --row-hover: rgba(0, 0, 0, 0.04);\n  1719â†’    --row-selected: rgba(58, 139, 245, 0.10);\n  1720â†’    --button-bg: #FFFFFF;\n  1721â†’    --button-border: #D1D1D6;\n  1722â†’    --button-text: #3C3C43;\n  1723â†’    --menu-bg: #FFFFFF;\n  1724â†’    --menu-border: #D1D1D6;\n  1725â†’    --menu-hover: rgba(0, 0, 0, 0.05);\n  1726â†’    --menu-text: #1C1C1E;\n  1727â†’    --error-text: #D93025;\n  1728â†’    --warning-text: #B45309;\n  1729â†’    --toast-bg: rgba(255, 255, 255, 0.95);\n  1730â†’    --toast-text: #1C1C1E;\n  1731â†’  }\n  1732â†’\n  1733â†’  /* â”€â”€ Themed element overrides â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  1734â†’  :global([data-theme]) {\n  1735â†’    background: var(--bg-app);\n  1736â†’  }\n  1737â†’\n  1738â†’  /* Search bar: flat, no gradient, no separator */\n  1739â†’  :global([data-theme]) .search-bar {\n  1740â†’    height: 44px;\n  1741â†’    padding: 0 16px;\n  1742â†’    background: var(--bg-app);\n  1743â†’    border-bottom: none;\n  1744â†’  }\n  1745â†’\n  1746â†’  :global([data-theme]) .search-input {\n  1747â†’    backdrop-filter: none;\n  1748â†’    -webkit-backdrop-filter: none;\n  1749â†’    font-family: 'JetBrains Mono', 'SF Mono', monospace;\n  1750â†’    font-size: 12px;\n  1751â†’    height: 34px;\n  1752â†’    border-radius: 8px;\n  1753â†’  }\n  1754â†’\n  1755â†’  /* Table header: flat bg, 16px edge padding */\n  1756â†’  :global([data-theme]) .table-header {\n  1757â†’    background: var(--bg-app);\n  1758â†’  }\n  1759â†’\n  1760â†’  :global([data-theme]) .col-button {\n  1761â†’    padding: 0 8px;\n  1762â†’  }\n  1763â†’\n  1764â†’  :global([data-theme]) .col.name .col-button {\n  1765â†’    padding-left: 16px;\n  1766â†’  }\n  1767â†’\n  1768â†’  /* Row cells: JetBrains Mono, 16px outer edges */\n  1769â†’  :global([data-theme]) .cell {\n  1770â†’    font-family: 'JetBrains Mono', monospace;\n  1771â†’  }\n  1772â†’\n  1773â†’  :global([data-theme]) .cell.name {\n  1774â†’    font-family: Inter, 'SF Pro Text', sans-serif;\n  1775â†’    padding-left: 16px;\n  1776â†’    font-size: 12px;\n  1777â†’    color: var(--text-primary);\n  1778â†’  }\n  1779â†’\n  1780â†’  :global([data-theme]) .cell.path {\n  1781â†’    font-size: 11px;\n  1782â†’  }\n  1783â†’\n  1784â†’  :global([data-theme]) .cell.size {\n  1785â†’    font-size: 11px;\n  1786â†’  }\n  1787â†’\n  1788â†’  :global([data-theme]) .cell.modified {\n  1789â†’    padding-right: 16px;\n  1790â†’    font-size: 11px;\n  1791â†’    white-space: nowrap;\n  1792â†’  }\n  1793â†’\n  1794â†’  :global([data-theme]) .row.selected {\n  1795â†’    box-shadow: inset 3px 0 0 var(--accent);\n  1796â†’  }\n  1797â†’\n  1798â†’  /* Dim path/size/date cells in themed mode */\n  1799â†’  :global([data-theme]) .cell.path,\n  1800â†’  :global([data-theme]) .cell.size,\n  1801â†’  :global([data-theme]) .cell.modified {\n  1802â†’    color: var(--text-muted);\n  1803â†’  }\n  1804â†’\n  1805â†’  :global(:root) {\n  1806â†’    background: transparent;\n  1807â†’  }\n  1808â†’\n  1809â†’  :global(html, body) {\n  1810â†’    margin: 0;\n  1811â†’    width: 100%;\n  1812â†’    height: 100%;\n  1813â†’    overflow: hidden;\n  1814â†’    background: transparent;\n  1815â†’    color: var(--text-primary);\n  1816â†’    font-family: Inter, 'SF Pro Text', 'Segoe UI', Helvetica, Arial, sans-serif;\n  1817â†’  }\n  1818â†’\n  1819â†’  :global(#app) {\n  1820â†’    width: 100%;\n  1821â†’    height: 100%;\n  1822â†’  }\n  1823â†’\n  1824â†’  .app-shell {\n  1825â†’    display: grid;\n  1826â†’    grid-template-rows: auto auto 1fr auto;\n  1827â†’    height: 100%;\n  1828â†’    min-width: 0;\n  1829â†’  }\n  1830â†’\n  1831â†’  .title-bar {\n  1832â†’    display: flex;\n  1833â†’    align-items: center;\n  1834â†’    justify-content: space-between;\n  1835â†’    height: 44px;\n  1836â†’    padding: 0 16px;\n  1837â†’    background: var(--surface-header);\n  1838â†’    cursor: default;\n  1839â†’    flex-shrink: 0;\n  1840â†’    user-select: none;\n  1841â†’    -webkit-user-select: none;\n  1842â†’  }\n  1843â†’\n  1844â†’  .title-left {\n  1845â†’    width: 72px;\n  1846â†’    pointer-events: none;\n  1847â†’    user-select: none;\n  1848â†’    -webkit-user-select: none;\n  1849â†’  }\n  1850â†’\n  1851â†’  .title-center {\n  1852â†’    display: flex;\n  1853â†’    align-items: center;\n  1854â†’    gap: 8px;\n  1855â†’    pointer-events: none;\n  1856â†’    user-select: none;\n  1857â†’    -webkit-user-select: none;\n  1858â†’  }\n  1859â†’\n  1860â†’  .title-right {\n  1861â†’    width: 72px;\n  1862â†’    pointer-events: none;\n  1863â†’    user-select: none;\n  1864â†’    -webkit-user-select: none;\n  1865â†’  }\n  1866â†’\n  1867â†’  .title-icon {\n  1868â†’    width: 14px;\n  1869â†’    height: 14px;\n  1870â†’    fill: var(--accent);\n  1871â†’    flex-shrink: 0;\n  1872â†’  }\n  1873â†’\n  1874â†’  .title-text {\n  1875â†’    font-family: Inter, 'SF Pro Text', sans-serif;\n  1876â†’    font-size: 13px;\n  1877â†’    font-weight: 500;\n  1878â†’    color: var(--text-primary);\n  1879â†’    letter-spacing: -0.01em;\n  1880â†’  }\n  1881â†’\n  1882â†’  .search-bar {\n  1883â†’    display: flex;\n  1884â†’    align-items: center;\n  1885â†’    gap: 6px;\n  1886â†’    padding: 8px;\n  1887â†’    background: linear-gradient(180deg, var(--bar-grad-top) 0%, var(--bar-grad-bottom) 100%);\n  1888â†’    border-bottom: 1px solid var(--border-soft);\n  1889â†’    min-width: 0;\n  1890â†’    flex-shrink: 0;\n  1891â†’  }\n  1892â†’\n  1893â†’  .search-input {\n  1894â†’    display: block;\n  1895â†’    box-sizing: border-box;\n  1896â†’    width: 100%;\n  1897â†’    min-width: 0;\n  1898â†’    flex: 1 1 auto;\n  1899â†’    height: 36px;\n  1900â†’    border: 1px solid var(--border-input);\n  1901â†’    border-radius: 14px;\n  1902â†’    padding: 0 10px;\n  1903â†’    font-size: 14px;\n  1904â†’    background: var(--bg-input, var(--surface));\n  1905â†’    color: var(--text-primary);\n  1906â†’    backdrop-filter: blur(12px) saturate(160%);\n  1907â†’    -webkit-backdrop-filter: blur(12px) saturate(160%);\n  1908â†’  }\n  1909â†’\n  1910â†’  .search-input::placeholder {\n  1911â†’    color: var(--text-muted);\n  1912â†’    opacity: 0.85;\n  1913â†’    font-size: 12px;\n  1914â†’  }\n  1915â†’\n  1916â†’  .search-input:focus {\n  1917â†’    outline: none;\n  1918â†’    border-color: var(--focus-ring);\n  1919â†’    box-shadow: 0 0 0 2px rgba(125, 169, 255, 0.25);\n  1920â†’  }\n  1921â†’\n  1922â†’  .table-area {\n  1923â†’    display: grid;\n  1924â†’    grid-template-rows: auto 1fr;\n  1925â†’    min-height: 0;\n  1926â†’    min-width: 0;\n  1927â†’  }\n  1928â†’\n  1929â†’  .table-header-track,\n  1930â†’  .row {\n  1931â†’    display: grid;\n  1932â†’    grid-template-columns: var(--col-name) var(--col-path) var(--col-size) var(--col-modified);\n  1933â†’    align-items: center;\n  1934â†’    width: max(var(--table-min-width, 0px), 100%);\n  1935â†’  }\n  1936â†’\n  1937â†’  .table-header {\n  1938â†’    height: 32px;\n  1939â†’    border-bottom: 1px solid var(--border-soft);\n  1940â†’    background: var(--surface-header);\n  1941â†’    user-select: none;\n  1942â†’    overflow: hidden;\n  1943â†’    flex-shrink: 0;\n  1944â†’  }\n  1945â†’\n  1946â†’  .table-header-track {\n  1947â†’    height: 100%;\n  1948â†’    transform: translateX(var(--header-offset, 0px));\n  1949â†’    will-change: transform;\n  1950â†’  }\n  1951â†’\n  1952â†’  .table-header .col {\n  1953â†’    position: relative;\n  1954â†’    min-width: 0;\n  1955â†’    height: 100%;\n  1956â†’  }\n  1957â†’\n  1958â†’  .col-button {\n  1959â†’    width: 100%;\n  1960â†’    height: 100%;\n  1961â†’    display: flex;\n  1962â†’    align-items: center;\n  1963â†’    justify-content: flex-start;\n  1964â†’    gap: 4px;\n  1965â†’    box-sizing: border-box;\n  1966â†’    padding: 0 8px;\n  1967â†’    font-family: Inter, 'SF Pro Text', sans-serif;\n  1968â†’    font-size: 11px;\n  1969â†’    font-weight: 600;\n  1970â†’    line-height: 1;\n  1971â†’    color: var(--text-muted);\n  1972â†’    text-align: left;\n  1973â†’    margin: 0;\n  1974â†’    border: none;\n  1975â†’    background: transparent;\n  1976â†’    cursor: pointer;\n  1977â†’  }\n  1978â†’\n  1979â†’  .sort-icon {\n  1980â†’    width: 10px;\n  1981â†’    height: 10px;\n  1982â†’    flex-shrink: 0;\n  1983â†’    color: var(--accent);\n  1984â†’  }\n  1985â†’\n  1986â†’  .col-resizer {\n  1987â†’    position: absolute;\n  1988â†’    top: 0;\n  1989â†’    right: -4px;\n  1990â†’    width: 8px;\n  1991â†’    height: 100%;\n  1992â†’    border: none;\n  1993â†’    padding: 0;\n  1994â†’    background: transparent;\n  1995â†’    cursor: col-resize;\n  1996â†’    z-index: 30;\n  1997â†’  }\n  1998â†’\n  1999â†’  .col-resizer::after {\n  2000â†’    content: '';\n  2001â†’    position: absolute;\n  2002â†’    top: 7px;\n  2003â†’    bottom: 7px;\n  2004â†’    left: 50%;\n  2005â†’    width: 1px;\n  2006â†’    transform: translateX(-50%);\n  2007â†’    background: var(--border-soft);\n  2008â†’    opacity: 0;\n  2009â†’    transition: opacity 0.15s ease;\n  2010â†’  }\n  2011â†’\n  2012â†’  .table-header .col:hover .col-resizer::after,\n  2013â†’  .col-resizer.active::after {\n  2014â†’    opacity: 1;\n  2015â†’  }\n  2016â†’\n  2017â†’  .table-body {\n  2018â†’    overflow: auto;\n  2019â†’    min-height: 0;\n  2020â†’    min-width: 0;\n  2021â†’    background: var(--surface);\n  2022â†’  }\n  2023â†’\n  2024â†’  .spacer {\n  2025â†’    position: relative;\n  2026â†’    width: max(var(--table-min-width, 0px), 100%);\n  2027â†’  }\n  2028â†’\n  2029â†’  .rows {\n  2030â†’    position: absolute;\n  2031â†’    top: 0;\n  2032â†’    left: 0;\n  2033â†’    width: max(var(--table-min-width, 0px), 100%);\n  2034â†’  }\n  2035â†’\n  2036â†’  .row {\n  2037â†’    height: 30px;\n  2038â†’    border-bottom: 1px solid var(--row-border);\n  2039â†’    cursor: default;\n  2040â†’    -webkit-user-select: none;\n  2041â†’    user-select: none;\n  2042â†’    outline: none;\n  2043â†’  }\n  2044â†’\n  2045â†’  .row:hover {\n  2046â†’    background: var(--row-hover);\n  2047â†’  }\n  2048â†’\n  2049â†’  .row.selected {\n  2050â†’    background: var(--row-selected);\n  2051â†’  }\n  2052â†’\n  2053â†’  .cell {\n  2054â†’    padding: 0 8px;\n  2055â†’    font-size: 12px;\n  2056â†’    display: flex;\n  2057â†’    align-items: center;\n  2058â†’    gap: 6px;\n  2059â†’    min-width: 0;\n  2060â†’  }\n  2061â†’\n  2062â†’  .cell.size {\n  2063â†’    text-align: right;\n  2064â†’    font-variant-numeric: tabular-nums;\n  2065â†’  }\n  2066â†’\n  2067â†’  .ellipsis {\n  2068â†’    overflow: hidden;\n  2069â†’    text-overflow: ellipsis;\n  2070â†’    white-space: nowrap;\n  2071â†’  }\n  2072â†’\n  2073â†’  .hl {\n  2074â†’    background: none;\n  2075â†’    color: inherit;\n  2076â†’    font-weight: 700;\n  2077â†’  }\n  2078â†’\n  2079â†’  .file-icon {\n  2080â†’    width: 16px;\n  2081â†’    height: 16px;\n  2082â†’    flex: 0 0 auto;\n  2083â†’  }\n  2084â†’\n  2085â†’  .name-editing {\n  2086â†’    opacity: 0.25;\n  2087â†’  }\n  2088â†’\n  2089â†’  .rename-overlay {\n  2090â†’    position: fixed;\n  2091â†’    z-index: 100;\n  2092â†’    min-width: 120px;\n  2093â†’  }\n  2094â†’\n  2095â†’  .rename-textarea {\n  2096â†’    display: block;\n  2097â†’    width: 100%;\n  2098â†’    box-sizing: border-box;\n  2099â†’    font-family: Inter, 'SF Pro Text', sans-serif;\n  2100â†’    font-size: 12px;\n  2101â†’    line-height: 18px;\n  2102â†’    padding: 5px 4px 5px 0;\n  2103â†’    border: 1.5px solid var(--focus-ring);\n  2104â†’    border-radius: 4px;\n  2105â†’    background: var(--bg-input, var(--surface));\n  2106â†’    color: var(--text-primary);\n  2107â†’    outline: none;\n  2108â†’    resize: none;\n  2109â†’    overflow: hidden;\n  2110â†’    box-shadow: 0 2px 14px rgba(0, 0, 0, 0.22), 0 0 0 3px rgba(77, 168, 255, 0.13);\n  2111â†’  }\n  2112â†’\n  2113â†’  .status-bar {\n  2114â†’    display: flex;\n  2115â†’    align-items: center;\n  2116â†’    justify-content: space-between;\n  2117â†’    height: 32px;\n  2118â†’    padding: 0 16px;\n  2119â†’    background: var(--surface-header);\n  2120â†’    border-top: 1px solid var(--border-soft);\n  2121â†’    font-family: 'JetBrains Mono', monospace;\n  2122â†’    font-size: 11px;\n  2123â†’    color: var(--text-muted);\n  2124â†’    white-space: nowrap;\n  2125â†’    overflow: hidden;\n  2126â†’    min-width: 0;\n  2127â†’    flex-shrink: 0;\n  2128â†’  }\n  2129â†’\n  2130â†’  .status-left {\n  2131â†’    display: flex;\n  2132â†’    align-items: center;\n  2133â†’    gap: 16px;\n  2134â†’    overflow: hidden;\n  2135â†’    min-width: 0;\n  2136â†’  }\n  2137â†’\n  2138â†’  .status-right {\n  2139â†’    display: flex;\n  2140â†’    align-items: center;\n  2141â†’    gap: 8px;\n  2142â†’    flex-shrink: 0;\n  2143â†’  }\n  2144â†’\n  2145â†’  .status-btn {\n  2146â†’    border: 1px solid var(--button-border);\n  2147â†’    border-radius: 5px;\n  2148â†’    background: var(--button-bg);\n  2149â†’    color: var(--button-text);\n  2150â†’    font-size: 11px;\n  2151â†’    height: 22px;\n  2152â†’    padding: 0 8px;\n  2153â†’    cursor: pointer;\n  2154â†’  }\n  2155â†’\n  2156â†’  .status-btn:hover {\n  2157â†’    filter: brightness(1.06);\n  2158â†’  }\n  2159â†’\n  2160â†’  .status-btn:disabled {\n  2161â†’    opacity: 0.55;\n  2162â†’    cursor: not-allowed;\n  2163â†’    filter: none;\n  2164â†’  }\n  2165â†’\n  2166â†’  .status-state {\n  2167â†’    display: flex;\n  2168â†’    align-items: center;\n  2169â†’    gap: 6px;\n  2170â†’  }\n  2171â†’\n  2172â†’  .state-dot {\n  2173â†’    width: 6px;\n  2174â†’    height: 6px;\n  2175â†’    border-radius: 50%;\n  2176â†’    flex-shrink: 0;\n  2177â†’  }\n  2178â†’\n  2179â†’  .state-dot.ready { background: #28C840; }\n  2180â†’  .state-dot.indexing { background: #FEBC2E; }\n  2181â†’  .state-dot.error { background: #FF5F57; }\n  2182â†’\n  2183â†’  .rebuild-btn {\n  2184â†’    display: flex;\n  2185â†’    align-items: center;\n  2186â†’    gap: 6px;\n  2187â†’    font-family: Inter, 'SF Pro Text', sans-serif;\n  2188â†’    font-size: 10px;\n  2189â†’    font-weight: 500;\n  2190â†’    background: var(--button-bg);\n  2191â†’    border: 1px solid var(--button-border);\n  2192â†’    border-radius: 4px;\n  2193â†’    color: var(--button-text);\n  2194â†’    height: 22px;\n  2195â†’    padding: 0 10px;\n  2196â†’    cursor: pointer;\n  2197â†’  }\n  2198â†’\n  2199â†’  .rebuild-btn:hover {\n  2200â†’    filter: brightness(1.1);\n  2201â†’  }\n  2202â†’\n  2203â†’  .rebuild-btn:disabled {\n  2204â†’    opacity: 0.5;\n  2205â†’    cursor: not-allowed;\n  2206â†’    filter: none;\n  2207â†’  }\n  2208â†’\n  2209â†’  .rebuild-icon {\n  2210â†’    width: 11px;\n  2211â†’    height: 11px;\n  2212â†’    color: var(--accent);\n  2213â†’    flex-shrink: 0;\n  2214â†’  }\n  2215â†’\n  2216â†’  .status-error {\n  2217â†’    color: var(--error-text);\n  2218â†’  }\n  2219â†’\n  2220â†’  .status-warning {\n  2221â†’    color: var(--warning-text);\n  2222â†’  }\n  2223â†’\n  2224â†’  .status-spotlight {\n  2225â†’    color: #f59e0b;\n  2226â†’    font-weight: 600;\n  2227â†’  }\n  2228â†’\n  2229â†’  .context-menu {\n  2230â†’    position: fixed;\n  2231â†’    z-index: 200;\n  2232â†’    width: 220px;\n  2233â†’    border: 1px solid var(--menu-border);\n  2234â†’    border-radius: 10px;\n  2235â†’    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.16), inset 0 0 0 0.5px rgba(255, 255, 255, 0.18);\n  2236â†’    background: var(--menu-bg);\n  2237â†’    backdrop-filter: blur(28px) saturate(180%);\n  2238â†’    -webkit-backdrop-filter: blur(28px) saturate(180%);\n  2239â†’    overflow: hidden;\n  2240â†’  }\n  2241â†’\n  2242â†’  .context-menu button {\n  2243â†’    width: 100%;\n  2244â†’    text-align: left;\n  2245â†’    border: none;\n  2246â†’    background: transparent;\n  2247â†’    padding: 8px 10px;\n  2248â†’    font-size: 12px;\n  2249â†’    color: var(--menu-text);\n  2250â†’  }\n  2251â†’\n  2252â†’  .context-menu button:hover {\n  2253â†’    background: var(--menu-hover);\n  2254â†’  }\n  2255â†’\n  2256â†’  .toast {\n  2257â†’    position: fixed;\n  2258â†’    right: 14px;\n  2259â†’    bottom: 18px;\n  2260â†’    background: var(--toast-bg);\n  2261â†’    color: var(--toast-text);\n  2262â†’    border-radius: 10px;\n  2263â†’    padding: 9px 12px;\n  2264â†’    font-size: 12px;\n  2265â†’    z-index: 250;\n  2266â†’    backdrop-filter: blur(20px) saturate(180%);\n  2267â†’    -webkit-backdrop-filter: blur(20px) saturate(180%);\n  2268â†’    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);\n  2269â†’  }\n  2270â†’</style>\n  2271â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"845ef5d4-08d9-4bac-b064-d22f87dd6f9b","timestamp":"2026-02-21T14:32:26.031Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/al02402336/everything/src/App.svelte","content":"<script>\n  import { onDestroy, onMount, tick } from 'svelte';\n  import { invoke } from '@tauri-apps/api/core';\n  import { listen } from '@tauri-apps/api/event';\n  import { getCurrentWindow } from '@tauri-apps/api/window';\n  import { startDrag } from '@crabnebula/tauri-plugin-drag';\n\n  const rowHeight = 30;\n  const PAGE_SIZE = 500;\n  let homePrefix = '';\n  const COL_WIDTHS_KEY = 'REDACTED';\n  const THEME_KEY = 'everything-theme';\n  const columnKeys = ['name', 'path', 'size', 'modified'];\n  const minColumnWidth = {\n    name: 180,\n    path: 240,\n    size: 75,\n    modified: 150\n  };\n  const defaultColumnRatios = {\n    name: 0.3,\n    path: 0.45,\n    size: 0.1\n  };\n\n  let theme = (() => { try { return localStorage.getItem(THEME_KEY) || 'dark'; } catch { return 'dark'; } })();\n  function cycleTheme() {\n    theme = theme === 'dark' ? 'light' : 'dark';\n    try { localStorage.setItem(THEME_KEY, theme); } catch {}\n  }\n\n  let query = '';\n  let results = [];\n  let totalResults = 0;\n  let totalResultsKnown = false;\n\n  let dbLatencyMs = null;\n  let dbLastQuery = '';\n  let searchModeLabel = '';\n  let selectedIndices = new Set();\n  let selectionAnchor = -1;\n  let lastSelectedIndex = -1;\n  let editing = {\n    active: false,\n    path: '',\n    index: -1,\n    draftName: ''\n  };\n\n  let renameOverlay = { top: 0, left: 0, width: 0 };\n\n  let indexStatus = {\n    state: 'Indexing',\n    entriesCount: 0,\n    lastUpdated: null,\n    permissionErrors: 0,\n    message: null,\n    isCatchup: false\n  };\n\n  let indexingStartTime = null;\n  let indexingElapsed = '';\n  let indexingFinishedAt = '';\n\n  let sortBy = 'name';\n  let sortDir = 'asc';\n\n  let hasMore = true;\n  let loadingMore = false;\n  let searchGeneration = 0;\n\n  let scanned = 0;\n\n  let searchInputEl;\n  let renameInputEl;\n  let tableAreaEl;\n  let tableContainer;\n  let tableResizeObserver = null;\n  let viewportResizeRaf = null;\n  let scrollTop = 0;\n  let headerScrollLeft = 0;\n  let viewportHeight = 520;\n  let lastTableWidth = 0;\n  let resizingColumn = '';\n  let resizeCleanup = null;\n  let colWidths = {\n    name: 250,\n    path: 350,\n    size: 75,\n    modified: 150\n  };\n\n  let contextMenu = {\n    visible: false,\n    x: 0,\n    y: 0\n  };\n\n  let platform = '';\n  let toast = '';\n  let searchTimer;\n  let lastSearchFiredAt = 0;\n  let toastTimer;\n  let statusRefreshTimer;\n  let elapsedTimer;\n  let statusRefreshInFlight = false;\n  let lastReadyCount = 0;\n\n  const iconCache = new Map();\n  const iconLoading = new Set();\n\n  let highlightCache = new Map();\n  let highlightCacheQuery = '';\n\n  const folderFallbackIcon =\n    \"data:image/svg+xml;utf8,\" +\n    encodeURIComponent(\n      `<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><rect x='1' y='4' width='14' height='10' rx='2' fill='#d9b34f'/><rect x='1' y='2' width='6' height='4' rx='1' fill='#e6ca7a'/></svg>`\n    );\n  const fileFallbackIcon =\n    \"data:image/svg+xml;utf8,\" +\n    encodeURIComponent(\n      `<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><rect x='3' y='1' width='10' height='14' rx='1.5' fill='#b4bec9'/><rect x='5' y='5' width='6' height='1.2' fill='#8d98a5'/><rect x='5' y='8' width='6' height='1.2' fill='#8d98a5'/></svg>`\n    );\n\n  $: totalHeight = results.length * rowHeight;\n  $: startIndex = Math.max(0, Math.floor(scrollTop / rowHeight) - 10);\n  $: visibleCount = Math.ceil(viewportHeight / rowHeight) + 20;\n  $: endIndex = Math.min(results.length, startIndex + visibleCount);\n  $: visibleRows = results.slice(startIndex, endIndex);\n  $: translateY = startIndex * rowHeight;\n  $: tableMinWidth = colWidths.name + colWidths.path + colWidths.size + colWidths.modified;\n  $: tableGridStyle = `--col-name:${colWidths.name}px;--col-path:${colWidths.path}px;--col-size:${colWidths.size}px;--col-modified:${colWidths.modified}px;--table-min-width:${tableMinWidth}px;--header-offset:${-headerScrollLeft}px;`;\n\n  $: {\n    for (const entry of visibleRows) {\n      void ensureIcon(entry);\n    }\n  }\n\n  function showToast(message) {\n    toast = message;\n    clearTimeout(toastTimer);\n    toastTimer = setTimeout(() => {\n      toast = '';\n    }, 3000);\n  }\n\n  function bytesToBase64(bytes) {\n    let binary = '';\n    const chunk = 0x8000;\n    for (let i = 0; i < bytes.length; i += chunk) {\n      const part = bytes.subarray(i, i + chunk);\n      binary += String.fromCharCode(...part);\n    }\n    return btoa(binary);\n  }\n\n  function highlightSegments(name, q) {\n    q = (q || '').trim();\n    if (!q) return [{ text: name, hl: false }];\n\n    // Reset cache when query changes\n    if (q !== highlightCacheQuery) {\n      highlightCache = new Map();\n      highlightCacheQuery = q;\n    }\n\n    // Check cache\n    const cached = highlightCache.get(name);\n    if (cached) return cached;\n\n    if (q.includes('/')) q = q.slice(q.lastIndexOf('/') + 1);\n    q = q.replace(/[*?]/g, '');\n    const terms = q.split(/\\s+/).filter(Boolean);\n    if (terms.length === 0) return [{ text: name, hl: false }];\n\n    const lower = name.toLowerCase();\n    const marks = new Uint8Array(name.length);\n    for (const t of terms) {\n      const tl = t.toLowerCase();\n      let idx = lower.indexOf(tl);\n      while (idx !== -1) {\n        for (let i = idx; i < idx + tl.length; i++) marks[i] = 1;\n        idx = lower.indexOf(tl, idx + 1);\n      }\n    }\n\n    const segs = [];\n    let i = 0;\n    while (i < name.length) {\n      const m = marks[i];\n      let j = i + 1;\n      while (j < name.length && marks[j] === m) j++;\n      segs.push({ text: name.slice(i, j), hl: m === 1 });\n      i = j;\n    }\n\n    highlightCache.set(name, segs);\n    return segs;\n  }\n\n  const perFileIconExts = new Set(['exe', 'lnk', 'ico', 'url', 'scr', 'appx']);\n\n  function iconKey(entry) {\n    if (entry.isDir) return '__folder__';\n    const ext = (entry.ext || '').toLowerCase();\n    if (perFileIconExts.has(ext)) return entry.path;\n    return ext || '__file__';\n  }\n\n  function iconFor(entry) {\n    return iconCache.get(iconKey(entry)) || (entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n  }\n\n  async function ensureIcon(entry) {\n    const key = iconKey(entry);\n    if (iconCache.has(key) || iconLoading.has(key)) {\n      return;\n    }\n\n    iconLoading.add(key);\n    try {\n      const bytes = await invoke('get_file_icon', {\n        path: entry.path,\n        ext: entry.isDir ? 'folder' : entry.ext || '',\n      });\n      if (Array.isArray(bytes) && bytes.length > 0) {\n        const image = `data:image/png;base64,${bytesToBase64(Uint8Array.from(bytes))}`;\n        iconCache.set(key, image);\n      } else {\n        iconCache.set(key, entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n      }\n    } catch {\n      iconCache.set(key, entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n    } finally {\n      iconLoading.delete(key);\n    }\n  }\n\n  function syncColumnWidthsToContainer() {\n    const width = tableContainer?.clientWidth || tableAreaEl?.clientWidth;\n    if (!width || lastTableWidth !== 0) {\n      return;\n    }\n\n    const saved = loadColWidths();\n    if (saved) {\n      const total = columnKeys.reduce((s, k) => s + saved[k], 0);\n      if (Math.abs(total - width) > 2) {\n        const scale = (width - saved.modified) / (total - saved.modified);\n        let scaledName = Math.max(minColumnWidth.name, Math.round(saved.name * scale));\n        let scaledSize = Math.max(minColumnWidth.size, Math.round(saved.size * scale));\n        let rawPath = width - saved.modified - scaledName - scaledSize;\n        if (rawPath < minColumnWidth.path) {\n          const shortfall = minColumnWidth.path - rawPath;\n          const nameReduction = Math.min(shortfall, scaledName - minColumnWidth.name);\n          scaledName -= nameReduction;\n          const remaining = shortfall - nameReduction;\n          if (remaining > 0) {\n            scaledSize -= Math.min(remaining, scaledSize - minColumnWidth.size);\n          }\n          rawPath = width - saved.modified - scaledName - scaledSize;\n        }\n        const scaledPath = Math.max(minColumnWidth.path, rawPath);\n        colWidths = { name: scaledName, path: scaledPath, size: scaledSize, modified: saved.modified };\n      } else {\n        colWidths = saved;\n      }\n    } else {\n      const fixedModified = minColumnWidth.modified;\n      const rest = width - fixedModified;\n      const ratioSum = defaultColumnRatios.name + defaultColumnRatios.path + defaultColumnRatios.size;\n      colWidths = {\n        name: Math.max(minColumnWidth.name, Math.round(rest * defaultColumnRatios.name / ratioSum)),\n        path: Math.max(minColumnWidth.path, Math.round(rest * defaultColumnRatios.path / ratioSum)),\n        size: Math.max(minColumnWidth.size, Math.round(rest * defaultColumnRatios.size / ratioSum)),\n        modified: fixedModified\n      };\n    }\n    lastTableWidth = width;\n  }\n\n  function loadColWidths() {\n    try {\n      const raw = localStorage.getItem(COL_WIDTHS_KEY);\n      if (!raw) return null;\n      const parsed = JSON.parse(raw);\n      for (const key of columnKeys) {\n        if (typeof parsed[key] !== 'number' || parsed[key] < (minColumnWidth[key] || 0)) return null;\n      }\n      return parsed;\n    } catch {\n      return null;\n    }\n  }\n\n  function saveColWidths() {\n    localStorage.setItem(COL_WIDTHS_KEY, JSON.stringify(colWidths));\n  }\n\n  function updateViewportHeight() {\n    viewportHeight = tableContainer?.clientHeight || 520;\n    syncColumnWidthsToContainer();\n  }\n\n  function scheduleViewportHeightUpdate() {\n    if (viewportResizeRaf !== null) {\n      return;\n    }\n    viewportResizeRaf = requestAnimationFrame(() => {\n      viewportResizeRaf = null;\n      updateViewportHeight();\n    });\n  }\n\n  function startColumnResize(event, leftKey) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    const index = columnKeys.indexOf(leftKey);\n    if (index < 0 || index >= columnKeys.length - 1) {\n      return;\n    }\n\n    const startX = event.clientX;\n    const startLeft = colWidths[leftKey];\n    const rightKey = columnKeys[index + 1];\n    const startRight = colWidths[rightKey];\n\n    resizeCleanup?.();\n    resizingColumn = leftKey;\n\n    const onMove = (moveEvent) => {\n      const delta = Math.round(moveEvent.clientX - startX);\n      if (leftKey === 'name') {\n        // Two-column trade: name and path swap space, each respects its minimum\n        const nextLeft = Math.max(\n          minColumnWidth[leftKey],\n          Math.min(startLeft + delta, startLeft + startRight - minColumnWidth[rightKey])\n        );\n        const nextRight = startLeft + startRight - nextLeft;\n        colWidths = { ...colWidths, [leftKey]: nextLeft, [rightKey]: nextRight };\n      } else {\n        // path splitter: path grows unconstrained (allows horizontal scroll on right drag)\n        const nextLeft = Math.max(minColumnWidth[leftKey], startLeft + delta);\n        colWidths = { ...colWidths, [leftKey]: nextLeft };\n      }\n    };\n\n    const onUp = () => {\n      cleanup();\n    };\n\n    const cleanup = () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n      document.body.style.cursor = '';\n      document.body.style.userSelect = '';\n      resizingColumn = '';\n      saveColWidths();\n      if (resizeCleanup === cleanup) {\n        resizeCleanup = null;\n      }\n    };\n\n    resizeCleanup = cleanup;\n    document.body.style.cursor = 'col-resize';\n    document.body.style.userSelect = 'none';\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n  }\n\n  function selectedPaths() {\n    const sorted = [...selectedIndices].sort((a, b) => a - b);\n    return sorted.map((idx) => results[idx]).filter(Boolean).map((entry) => entry.path);\n  }\n\n  function clearSelection() {\n    selectedIndices = new Set();\n    selectionAnchor = -1;\n    lastSelectedIndex = -1;\n  }\n\n  function selectSingle(index) {\n    selectedIndices = new Set([index]);\n    selectionAnchor = index;\n    lastSelectedIndex = index;\n  }\n\n  function selectToggle(index) {\n    const next = new Set(selectedIndices);\n    if (next.has(index)) {\n      next.delete(index);\n    } else {\n      next.add(index);\n    }\n    selectedIndices = next;\n    selectionAnchor = index;\n    lastSelectedIndex = index;\n  }\n\n  function selectRange(index) {\n    const anchor = selectionAnchor >= 0 ? selectionAnchor : index;\n    const [from, to] = [Math.min(anchor, index), Math.max(anchor, index)];\n    const next = new Set();\n    for (let i = from; i <= to; i += 1) {\n      next.add(i);\n    }\n    selectedIndices = next;\n    lastSelectedIndex = index;\n  }\n\n  function primaryEntry() {\n    const idx = lastSelectedIndex >= 0 ? lastSelectedIndex : -1;\n    return idx >= 0 ? results[idx] : null;\n  }\n\n  async function refreshStatus() {\n    if (statusRefreshInFlight) {\n      return;\n    }\n    statusRefreshInFlight = true;\n    try {\n      const status = await invoke('get_index_status');\n      const prevState = indexStatus.state;\n      indexStatus = {\n        state: status.state,\n        entriesCount: status.entriesCount,\n        lastUpdated: status.lastUpdated,\n        permissionErrors: status.permissionErrors ?? 0,\n        message: status.message\n      };\n      if (status.state === 'Indexing' && prevState !== 'Indexing') {\n        startElapsedTimer();\n      } else if (status.state !== 'Indexing' && prevState === 'Indexing') {\n        stopElapsedTimer();\n      }\n      if (typeof status.scanned === 'number') {\n        scanned = status.scanned;\n      }\n      if (status.state === 'Ready' && prevState !== 'Ready') {\n        scheduleSearch();\n      }\n    } catch (err) {\n      showToast(`Failed to get status: ${String(err)}`);\n    } finally {\n      statusRefreshInFlight = false;\n    }\n  }\n\n  function scheduleSearch(preserveScroll = false) {\n    searchGeneration += 1;\n    const scheduledGen = searchGeneration;\n    clearTimeout(searchTimer);\n\n    const now = performance.now();\n    if (now - lastSearchFiredAt >= 200) {\n      // Leading edge: fire immediately if enough time has passed\n      lastSearchFiredAt = now;\n      void runSearch(preserveScroll);\n    } else {\n      // Trailing edge: debounce\n      searchTimer = setTimeout(() => {\n        if (scheduledGen !== searchGeneration) {\n          return;\n        }\n        lastSearchFiredAt = performance.now();\n        void runSearch(preserveScroll);\n      }, 200);\n    }\n  }\n\n  async function runSearch(preserveScroll = false) {\n    searchGeneration += 1;\n    const gen = searchGeneration;\n    const searchQuery = query;\n    const searchSortBy = sortBy;\n    const searchSortDir = sortDir;\n    const startedAt = performance.now();\n    try {\n      const keepPaths = new Set(selectedPaths());\n      const next = await invoke('search', {\n        query: searchQuery,\n        limit: PAGE_SIZE,\n        offset: 0,\n        sortBy: searchSortBy,\n        sortDir: searchSortDir\n      });\n\n      if (gen !== searchGeneration) return;\n\n      dbLatencyMs = Math.round(performance.now() - startedAt);\n      dbLastQuery = searchQuery;\n      const entries = Array.isArray(next.entries) ? next.entries : [];\n      searchModeLabel = next.modeLabel || '';\n      results = entries;\n      if (next.totalCount > 0) {\n        totalResults = next.totalCount;\n        totalResultsKnown = true;\n      } else {\n        totalResults = entries.length;\n        totalResultsKnown = false;\n      }\n      hasMore = totalResultsKnown ? results.length < totalResults : entries.length >= PAGE_SIZE;\n      if (!preserveScroll && tableContainer) tableContainer.scrollTop = 0;\n\n      const restored = new Set();\n      for (let i = 0; i < results.length; i += 1) {\n        if (keepPaths.has(results[i].path)) {\n          restored.add(i);\n        }\n      }\n      selectedIndices = restored;\n\n      updateViewportHeight();\n    } catch (err) {\n      if (gen !== searchGeneration) return;\n      showToast(`Search failed: ${String(err)}`);\n    }\n  }\n\n  async function loadMore() {\n    if (!hasMore || loadingMore) return;\n    const gen = searchGeneration;\n    loadingMore = true;\n    try {\n      const batch = await invoke('search', {\n        query,\n        limit: PAGE_SIZE,\n        offset: results.length,\n        sortBy: sortBy,\n        sortDir: sortDir\n      });\n      if (gen !== searchGeneration) return;\n      const arr = Array.isArray(batch.entries) ? batch.entries : [];\n      if (arr.length > 0) results = [...results, ...arr];\n      hasMore = totalResultsKnown ? results.length < totalResults : arr.length >= PAGE_SIZE;\n    } catch (err) {\n      showToast(`Failed to load more: ${String(err)}`);\n    } finally {\n      loadingMore = false;\n    }\n  }\n\n  function moveSelection(delta, withRange = false) {\n    if (results.length === 0) {\n      return;\n    }\n\n    const current = lastSelectedIndex >= 0 ? lastSelectedIndex : 0;\n    const next = Math.max(0, Math.min(results.length - 1, current + delta));\n\n    if (withRange) {\n      selectRange(next);\n    } else {\n      selectSingle(next);\n    }\n\n    const top = next * rowHeight;\n    const bottom = top + rowHeight;\n    if (top < scrollTop) {\n      tableContainer.scrollTop = top;\n    } else if (bottom > scrollTop + viewportHeight) {\n      tableContainer.scrollTop = bottom - viewportHeight;\n    }\n  }\n\n  function handleHeaderSort(column) {\n    if (sortBy === column) {\n      sortDir = sortDir === 'asc' ? 'desc' : 'asc';\n    } else {\n      sortBy = column;\n      sortDir = 'asc';\n    }\n    if (tableContainer) tableContainer.scrollTop = 0;\n    void runSearch();\n  }\n\n  function handleRowClick(event, index) {\n    contextMenu.visible = false;\n\n    if (event.shiftKey) {\n      selectRange(index);\n      return;\n    }\n\n    if (event.metaKey || event.ctrlKey) {\n      selectToggle(index);\n      return;\n    }\n\n    selectSingle(index);\n  }\n\n  function handleRowContextMenu(event, index) {\n    event.preventDefault();\n\n    if (!selectedIndices.has(index)) {\n      selectSingle(index);\n    }\n\n    if (platform === 'windows' || platform === 'macos') {\n      contextMenu.visible = false;\n      const paths = selectedPaths();\n      if (paths.length > 0) {\n        invoke('show_context_menu', {\n          paths,\n          x: event.clientX,\n          y: event.clientY,\n          singleSelection: selectedIndices.size === 1\n        });\n      }\n      return;\n    }\n\n    contextMenu = {\n      visible: true,\n      x: event.clientX,\n      y: event.clientY\n    };\n  }\n\n  function handleRowA11yKeydown(event, index) {\n    if (event.key === ' ' || event.key === 'Enter') {\n      event.preventDefault();\n      handleRowClick(event, index);\n    }\n  }\n\n  const DRAG_THRESHOLD = 5;\n  let dragCleanup = null;\n  const dragImgCache = new Map();\n\n  function dragPathsForIndex(index) {\n    const entry = results[index];\n    if (!entry) {\n      return [];\n    }\n\n    if (selectedIndices.has(index) && selectedIndices.size > 0) {\n      return selectedPaths();\n    }\n\n    return [entry.path];\n  }\n\n  function getDragIconEl(entry) {\n    const src = iconFor(entry);\n    let img = dragImgCache.get(src);\n    if (!img) {\n      img = new Image();\n      img.src = src;\n      dragImgCache.set(src, img);\n    }\n    return img.complete && img.naturalWidth > 0 ? img : null;\n  }\n\n  function fillRoundRect(ctx, x, y, w, h, r) {\n    ctx.beginPath();\n    ctx.moveTo(x + r, y);\n    ctx.arcTo(x + w, y, x + w, y + h, r);\n    ctx.arcTo(x + w, y + h, x, y + h, r);\n    ctx.arcTo(x, y + h, x, y, r);\n    ctx.arcTo(x, y, x + w, y, r);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  function buildDragPreview(index) {\n    const entry = results[index];\n    if (!entry) return null;\n\n    const count = selectedIndices.has(index) ? selectedIndices.size : 1;\n    const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;\n\n    const w = 260;\n    const h = 28;\n    const stackGap = count > 1 ? 4 : 0;\n\n    const canvas = document.createElement('canvas');\n    canvas.width = w;\n    canvas.height = h + stackGap;\n    const ctx = canvas.getContext('2d');\n\n    if (count > 1) {\n      ctx.globalAlpha = 0.35;\n      ctx.fillStyle = isDark ? '#5a6070' : '#b0c4de';\n      fillRoundRect(ctx, 3, 0, w - 3, h, 5);\n      ctx.globalAlpha = 1.0;\n    }\n\n    const ry = stackGap;\n    ctx.fillStyle = isDark ? 'rgba(58, 64, 74, 0.94)' : 'rgba(214, 231, 255, 0.94)';\n    fillRoundRect(ctx, 0, ry, w, h, 5);\n\n    ctx.strokeStyle = isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';\n    ctx.lineWidth = 0.5;\n    ctx.beginPath();\n    ctx.moveTo(5, ry);\n    ctx.arcTo(w, ry, w, ry + h, 5);\n    ctx.arcTo(w, ry + h, 0, ry + h, 5);\n    ctx.arcTo(0, ry + h, 0, ry, 5);\n    ctx.arcTo(0, ry, w, ry, 5);\n    ctx.closePath();\n    ctx.stroke();\n\n    const iconEl = getDragIconEl(entry);\n    if (iconEl) {\n      ctx.drawImage(iconEl, 6, ry + 6, 16, 16);\n    } else {\n      ctx.fillStyle = entry.isDir ? '#d9b34f' : '#8d98a5';\n      fillRoundRect(ctx, 6, ry + 6, 16, 16, 2);\n    }\n\n    ctx.fillStyle = isDark ? '#e6e6e8' : '#1a1a1a';\n    ctx.font = '12px -apple-system, \"SF Pro Text\", system-ui, sans-serif';\n    ctx.textBaseline = 'middle';\n\n    let nameMaxW = w - 34;\n    if (count > 1) nameMaxW -= 34;\n\n    let name = entry.name;\n    if (ctx.measureText(name).width > nameMaxW) {\n      while (name.length > 4 && ctx.measureText(name + '\\u2026').width > nameMaxW) {\n        name = name.slice(0, -1);\n      }\n      name += '\\u2026';\n    }\n    ctx.fillText(name, 28, ry + h / 2 + 1);\n\n    if (count > 1) {\n      const badge = String(count);\n      ctx.font = 'bold 10px -apple-system, system-ui, sans-serif';\n      const tw = ctx.measureText(badge).width;\n      const bw = Math.max(20, tw + 10);\n      const bx = w - bw - 6;\n      const by = ry + (h - 18) / 2;\n\n      ctx.fillStyle = isDark ? '#5b8bd9' : '#007aff';\n      fillRoundRect(ctx, bx, by, bw, 18, 9);\n\n      ctx.fillStyle = '#ffffff';\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(badge, bx + bw / 2, by + 9);\n    }\n\n    return canvas.toDataURL('image/png');\n  }\n\n  function handleRowMouseDown(event, index) {\n    if (event.button !== 0) return;\n    if (event.metaKey || event.ctrlKey || event.shiftKey) return;\n    if (editing.active) return;\n\n    const startX = event.clientX;\n    const startY = event.clientY;\n    let dragging = false;\n\n    dragCleanup?.();\n\n    const onMove = (e) => {\n      if (dragging) return;\n      const dx = e.clientX - startX;\n      const dy = e.clientY - startY;\n      if (dx * dx + dy * dy < DRAG_THRESHOLD * DRAG_THRESHOLD) return;\n\n      dragging = true;\n      cleanup();\n\n      if (!selectedIndices.has(index)) {\n        selectSingle(index);\n      }\n\n      const paths = dragPathsForIndex(index);\n      if (paths.length > 0) {\n        const icon = buildDragPreview(index);\n        startDrag({ item: paths, icon }).catch(() => {});\n      }\n    };\n\n    const onUp = () => cleanup();\n\n    const cleanup = () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n      if (dragCleanup === cleanup) dragCleanup = null;\n    };\n\n    dragCleanup = cleanup;\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n  }\n\n  async function handleRowDoubleClick(index) {\n    if (!selectedIndices.has(index) || selectedIndices.size > 1) {\n      selectSingle(index);\n      await tick();\n    }\n    await invoke('open', { paths: [results[index].path] }).catch((err) => {\n      showToast(`Failed to open: ${String(err)}`);\n    });\n  }\n\n  function closeContextMenu() {\n    contextMenu = {\n      ...contextMenu,\n      visible: false\n    };\n  }\n\n  async function openSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('open', { paths });\n    } catch (err) {\n      showToast(`Failed to open: ${String(err)}`);\n    }\n  }\n\n  async function openWithFallback() {\n    const target = primaryEntry();\n    if (!target) {\n      return;\n    }\n\n    try {\n      await invoke('open_with', { path: target.path });\n    } catch (err) {\n      showToast(`Open With failed: ${String(err)}`);\n    }\n  }\n\n  async function revealSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('reveal_in_finder', { paths });\n    } catch (err) {\n      showToast(`Failed to reveal in Finder: ${String(err)}`);\n    }\n  }\n\n  async function copySelectedPaths() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('copy_paths', { paths });\n      showToast(`Copied ${paths.length} path(s)`);\n    } catch (err) {\n      showToast(`Failed to copy path: ${String(err)}`);\n    }\n  }\n\n  async function copyFiles() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('copy_files', { paths });\n      showToast(`Copied ${paths.length} item(s)`);\n    } catch (err) {\n      showToast(`Failed to copy: ${String(err)}`);\n    }\n  }\n\n  async function trashSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    const message =\n      paths.length === 1\n        ? 'Move selected item to Trash?'\n        : `Move ${paths.length} items to Trash?`;\n\n    if (!window.confirm(message)) {\n      return;\n    }\n\n    try {\n      await invoke('move_to_trash', { paths });\n      showToast('Moved to Trash.');\n      clearSelection();\n      await runSearch();\n    } catch (err) {\n      showToast(`Failed to move to Trash: ${String(err)}`);\n    }\n  }\n\n  async function resetIndex() {\n    if (indexStatus.state === 'Indexing') {\n      showToast('Indexing in progress. Please try again after it completes.');\n      return;\n    }\n\n    results = [];\n    totalResults = 0;\n    totalResultsKnown = false;\n    clearSelection();\n    scanned = 0;\n    dbLatencyMs = null;\n    dbLastQuery = '';\n    indexStatus = { ...indexStatus, state: 'Indexing', entriesCount: 0, message: null };\n    indexingStartTime = Date.now();\n    indexingElapsed = '';\n    indexingFinishedAt = '';\n\n    try {\n      await invoke('reset_index');\n    } catch (err) {\n      showToast(`Failed to reset index: ${String(err)}`);\n      await refreshStatus();\n    }\n  }\n\n  function isMultiSelected() {\n    return selectedIndices.size > 1;\n  }\n\n  function autoResizeRenameInput() {\n    if (!renameInputEl) return;\n    renameInputEl.style.height = '0';\n    renameInputEl.style.height = renameInputEl.scrollHeight + 'px';\n  }\n\n  async function startRename() {\n    if (isMultiSelected()) {\n      return;\n    }\n\n    const idx = lastSelectedIndex;\n    if (idx < 0 || !results[idx]) {\n      return;\n    }\n\n    const entry = results[idx];\n\n    // Calculate overlay position mathematically.\n    // Name cell text starts at: padding-left(16) + icon(16) + gap(6) = 38px from cell left.\n    // Textarea has padding-left: 0 and border: 1.5px, so text starts ~2px from overlay left.\n    if (tableContainer) {\n      const rect = tableContainer.getBoundingClientRect();\n      const cellLeft = rect.left - tableContainer.scrollLeft;\n      const textLeft = cellLeft + 38;\n      const cellRight = cellLeft + colWidths.name;\n      const rowTop = rect.top + idx * rowHeight - tableContainer.scrollTop;\n      renameOverlay = {\n        top: rowTop,\n        left: textLeft - 2,\n        width: cellRight - textLeft + 2 - 4\n      };\n    }\n\n    editing = {\n      active: true,\n      path: entry.path,\n      index: idx,\n      draftName: entry.name\n    };\n\n    await tick();\n\n    if (renameInputEl) {\n      autoResizeRenameInput();\n      renameInputEl.focus();\n      const extPos = !entry.isDir ? entry.name.lastIndexOf('.') : -1;\n      const selectionEnd = extPos > 0 ? extPos : entry.name.length;\n      renameInputEl.setSelectionRange(0, selectionEnd);\n    }\n  }\n\n  function cancelRename() {\n    editing = {\n      active: false,\n      path: '',\n      index: -1,\n      draftName: ''\n    };\n  }\n\n  async function commitRename() {\n    if (!editing.active || editing.index < 0 || !results[editing.index]) {\n      return;\n    }\n\n    const current = results[editing.index];\n    const nextName = editing.draftName;\n\n    try {\n      await invoke('rename', {\n        path: current.path,\n        newName: nextName\n      });\n      cancelRename();\n      await runSearch();\n    } catch (err) {\n      showToast(`Failed to rename: ${String(err)}`);\n      await tick();\n      renameInputEl?.focus();\n    }\n  }\n\n  function onGlobalClick() {\n    closeContextMenu();\n  }\n\n  function onTitleBarMouseDown(event) {\n    if (event.button !== 0) {\n      return;\n    }\n\n    const activeElement = document.activeElement;\n    if (activeElement instanceof HTMLElement && isTextInputTarget(activeElement)) {\n      activeElement.blur();\n    }\n  }\n\n  async function focusSearch() {\n    await getCurrentWindow().show();\n    await getCurrentWindow().setFocus();\n    searchInputEl?.focus();\n    searchInputEl?.select();\n  }\n\n  function isTextInputTarget(target) {\n    return (\n      target instanceof HTMLInputElement ||\n      target instanceof HTMLTextAreaElement ||\n      target?.isContentEditable\n    );\n  }\n\n  async function handleKeydown(event) {\n    const isMetaSelectAll = (event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'a';\n    const isMetaCopy = (event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'c';\n    const target = event.target;\n    const isTextInput = isTextInputTarget(target);\n\n    if (isMetaCopy && isTextInput) {\n      return;\n    }\n\n    if (isMetaSelectAll) {\n      if (isTextInput) {\n        event.preventDefault();\n        if (target instanceof HTMLInputElement || target instanceof HTMLTextAreaElement) {\n          target.select();\n        }\n        return;\n      }\n    }\n\n    if (editing.active) {\n      if (event.key === 'Enter') {\n        event.preventDefault();\n        await commitRename();\n        return;\n      }\n\n      if (event.key === 'Escape') {\n        event.preventDefault();\n        cancelRename();\n        searchInputEl?.focus();\n        return;\n      }\n      return;\n    }\n\n    if (event.key === 'Escape') {\n      event.preventDefault();\n      clearSelection();\n      searchInputEl?.focus();\n      return;\n    }\n\n    if (event.key === 'ArrowDown') {\n      event.preventDefault();\n      moveSelection(1, event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'ArrowUp') {\n      event.preventDefault();\n      moveSelection(-1, event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'PageDown') {\n      event.preventDefault();\n      moveSelection(Math.floor(viewportHeight / rowHeight), event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'PageUp') {\n      event.preventDefault();\n      moveSelection(-Math.floor(viewportHeight / rowHeight), event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'Enter') {\n      event.preventDefault();\n      if (platform === 'windows') {\n        await openSelected();\n      } else {\n        await startRename();\n      }\n      return;\n    }\n\n    if (event.key === 'F2') {\n      event.preventDefault();\n      await startRename();\n      return;\n    }\n\n    if (event.key === ' ' && !isTextInput) {\n      event.preventDefault();\n      const entry = primaryEntry();\n      if (entry) {\n        await invoke('quick_look', { path: entry.path });\n      }\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'f') {\n      event.preventDefault();\n      clearSelection();\n      searchInputEl?.focus();\n      searchInputEl?.select();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'o') {\n      event.preventDefault();\n      await openSelected();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key === 'Enter') {\n      event.preventDefault();\n      await revealSelected();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'c') {\n      event.preventDefault();\n      await copySelectedPaths();\n      return;\n    }\n\n    if (isMetaSelectAll) {\n      event.preventDefault();\n      selectedIndices = new Set(Array.from({ length: results.length }, (_, i) => i));\n      return;\n    }\n\n    if (event.key === 'Delete' || ((event.metaKey || event.ctrlKey) && event.key === 'Backspace')) {\n      if (!isTextInput) {\n        event.preventDefault();\n        await trashSelected();\n      }\n      return;\n    }\n  }\n\n  function formatSize(entry) {\n    if (entry.isDir || entry.size == null) return '';\n    const bytes = entry.size;\n    if (bytes < 1024) return `${bytes} B`;\n    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n    if (bytes < 1024 * 1024 * 1024) return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n    return `${(bytes / (1024 * 1024 * 1024)).toFixed(1)} GB`;\n  }\n\n  function formatModified(entry) {\n    if (!entry.mtime) {\n      return '';\n    }\n\n    const d = new Date(entry.mtime * 1000);\n    const pad = (n) => String(n).padStart(2, '0');\n    return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;\n  }\n\n  function formatLastUpdated(timestamp) {\n    if (!timestamp) {\n      return '-';\n    }\n\n    return new Date(timestamp * 1000).toLocaleString();\n  }\n\n  function formatElapsed(ms) {\n    const totalSec = Math.floor(ms / 1000);\n    const min = Math.floor(totalSec / 60);\n    const sec = totalSec % 60;\n    return min > 0 ? `${min}m ${sec}s` : `${sec}s`;\n  }\n\n  function updateElapsed() {\n    if (indexingStartTime && indexStatus.state === 'Indexing') {\n      indexingElapsed = formatElapsed(Date.now() - indexingStartTime);\n    }\n  }\n\n  function startElapsedTimer() {\n    clearInterval(elapsedTimer);\n    indexingStartTime = Date.now();\n    indexingElapsed = '0s';\n    indexingFinishedAt = '';\n    elapsedTimer = setInterval(updateElapsed, 1000);\n  }\n\n  function stopElapsedTimer() {\n    clearInterval(elapsedTimer);\n    if (indexingStartTime) {\n      const elapsed = Date.now() - indexingStartTime;\n      indexingFinishedAt = `${formatElapsed(elapsed)}`;\n    }\n    indexingStartTime = null;\n    indexingElapsed = '';\n  }\n\n  function displayPath(path) {\n    if (!path) {\n      return path;\n    }\n\n    if (!homePrefix) {\n      return path;\n    }\n\n    if (path === homePrefix) {\n      return '~';\n    }\n\n    if (path.startsWith(`${homePrefix}/`)) {\n      return `~${path.slice(homePrefix.length)}`;\n    }\n\n    return path;\n  }\n\n  let unlistenFns = [];\n\n  onMount(async () => {\n    const t0 = performance.now();\n    const ms = () => Math.round(performance.now() - t0);\n    const DEBUG_STARTUP = false;\n    const flog = DEBUG_STARTUP ? (msg) => invoke('frontend_log', { msg }).catch(() => {}) : () => {};\n\n    flog(`[startup/fe] onMount entered`);\n\n    updateViewportHeight();\n    flog(`[startup/fe] +${ms()}ms updateViewportHeight done`);\n\n    platform = await invoke('get_platform');\n    flog(`[startup/fe] +${ms()}ms get_platform done`);\n\n    const unlistenProgress = await listen('index_progress', (event) => {\n      scanned = event.payload.scanned;\n      if (indexStatus.state !== 'Indexing') {\n        indexStatus = {\n          ...indexStatus,\n          state: 'Indexing'\n        };\n      }\n    });\n    flog(`[startup/fe] +${ms()}ms listen(index_progress) registered`);\n\n    const unlistenState = await listen('index_state', (event) => {\n      flog(`[startup/fe] index_state event received: ${event.payload.state} at +${ms()}ms`);\n      const prevState = indexStatus.state;\n      indexStatus = {\n        ...indexStatus,\n        state: event.payload.state,\n        message: event.payload.message ?? null,\n        isCatchup: event.payload.isCatchup ?? false\n      };\n\n      if (event.payload.state === 'Indexing' && prevState !== 'Indexing') {\n        if (prevState === 'Ready') {\n          lastReadyCount = indexStatus.entriesCount;\n        }\n        startElapsedTimer();\n      } else if (event.payload.state !== 'Indexing' && prevState === 'Indexing') {\n        stopElapsedTimer();\n      }\n\n      if (event.payload.state === 'Ready') {\n        scheduleSearch();\n      }\n    });\n    flog(`[startup/fe] +${ms()}ms listen(index_state) registered`);\n\n    const unlistenUpdated = await listen('index_updated', (event) => {\n      indexStatus = {\n        ...indexStatus,\n        entriesCount: event.payload.entriesCount,\n        lastUpdated: event.payload.lastUpdated,\n        permissionErrors: event.payload.permissionErrors ?? indexStatus.permissionErrors\n      };\n\n      scheduleSearch(true);\n    });\n\n    const unlistenFocus = await listen('focus_search', () => {\n      void focusSearch();\n    });\n\n    const unlistenCtxMenuAction = await listen('context_menu_action', (event) => {\n      switch (event.payload) {\n        case 'open': void openSelected(); break;\n        case 'quick_look': {\n          const e = primaryEntry();\n          if (e) void invoke('quick_look', { path: e.path });\n          break;\n        }\n        case 'open_with': void openWithFallback(); break;\n        case 'reveal': void revealSelected(); break;\n        case 'copy_files': void copyFiles(); break;\n        case 'copy_path': void copySelectedPaths(); break;\n        case 'trash': void trashSelected(); break;\n        case 'rename': void startRename(); break;\n      }\n    });\n\n    unlistenFns = [unlistenProgress, unlistenState, unlistenUpdated, unlistenFocus, unlistenCtxMenuAction];\n    flog(`[startup/fe] +${ms()}ms all listeners registered`);\n\n    // Fetch backend state IMMEDIATELY after listeners are registered.\n    // Events emitted before listener registration are lost, so this\n    // is the only reliable way to get the current state.\n    await refreshStatus();\n    flog(`[startup/fe] +${ms()}ms refreshStatus done (state=${indexStatus.state})`);\n\n    // Show Svelte UI: remove skeleton, focus search input.\n    await tick();\n    document.getElementById('skeleton')?.remove();\n    await focusSearch();\n    flog(`[startup/fe] +${ms()}ms WINDOW VISIBLE â€” skeleton removed`);\n\n    try {\n      homePrefix = await invoke('get_home_dir');\n    } catch {\n      homePrefix = '';\n    }\n    flog(`[startup/fe] +${ms()}ms get_home_dir done`);\n\n    if (!localStorage.getItem('everything-fda-notice-v1')) {\n      showToast('macOS Full Disk Access permission may be required for full disk search.');\n      localStorage.setItem('everything-fda-notice-v1', '1');\n    }\n    flog(`[startup/fe] +${ms()}ms calling runSearch...`);\n    await runSearch();\n    flog(`[startup/fe] +${ms()}ms runSearch done`);\n\n    if (typeof ResizeObserver !== 'undefined') {\n      tableResizeObserver = new ResizeObserver(() => {\n        scheduleViewportHeightUpdate();\n      });\n      if (tableContainer) {\n        tableResizeObserver.observe(tableContainer);\n      } else if (tableAreaEl) {\n        tableResizeObserver.observe(tableAreaEl);\n      }\n    }\n\n    window.addEventListener('resize', scheduleViewportHeightUpdate);\n    window.addEventListener('click', onGlobalClick);\n    statusRefreshTimer = setInterval(() => {\n      if (indexStatus.state === 'Indexing') {\n        void refreshStatus();\n      }\n    }, 1000);\n    console.log(`[startup/fe] +${ms()}ms onMount complete`);\n  });\n\n  onDestroy(async () => {\n    clearTimeout(searchTimer);\n    clearTimeout(toastTimer);\n    clearInterval(statusRefreshTimer);\n    clearInterval(elapsedTimer);\n    resizeCleanup?.();\n\n    for (const unlisten of unlistenFns) {\n      unlisten();\n    }\n\n    tableResizeObserver?.disconnect();\n    tableResizeObserver = null;\n    if (viewportResizeRaf !== null) {\n      cancelAnimationFrame(viewportResizeRaf);\n      viewportResizeRaf = null;\n    }\n    window.removeEventListener('resize', scheduleViewportHeightUpdate);\n    window.removeEventListener('click', onGlobalClick);\n  });\n</script>\n\n<svelte:window on:keydown={handleKeydown} />\n\n<div class=\"app-shell\" data-theme={theme}>\n  <div class=\"title-bar\" role=\"presentation\" data-tauri-drag-region on:mousedown={onTitleBarMouseDown}>\n    <div class=\"title-left\"></div>\n    <div class=\"title-center\">\n      <svg class=\"title-icon\" viewBox=\"0 0 215 205\" fill-rule=\"evenodd\" aria-hidden=\"true\">\n        <path d=\"M85 0c46.9 0 85 38.1 85 85 0 20.1-7.2 38.5-19.2 52.7l40.7 40.8c5.8 5.8 5.8 15.2 0 21-5.8 5.8-15.2 5.8-21 0l-40.7-40.7c-13.6 9.7-30.4 15.2-44.8 15.2-46.9 0-85-42.1-85-89 0-46.9 38.1-85 85-85z m0 32c-29.3 0-53 23.7-53 53 0 29.3 23.7 53 53 53 29.3 0 53-23.7 53-53 0-29.3-23.7-53-53-53z\"/>\n      </svg>\n      <span class=\"title-text\">Everything</span>\n    </div>\n    <div class=\"title-right\"></div>\n  </div>\n\n  <header class=\"search-bar\">\n    <input\n      bind:this={searchInputEl}\n      class=\"search-input\"\n      type=\"text\"\n      bind:value={query}\n      on:input={scheduleSearch}\n      on:focus={clearSelection}\n      placeholder=\"Search file/folder names\"\n      autocomplete=\"off\"\n      spellcheck=\"false\"\n    />\n  </header>\n\n  <section class=\"table-area\" bind:this={tableAreaEl} style={tableGridStyle}>\n    <div class=\"table-header\">\n      <div class=\"table-header-track\">\n        <div class=\"col name\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('name')}>\n            Name{#if sortBy === 'name'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n          <button\n            type=\"button\"\n            class=\"col-resizer\"\n            class:active={resizingColumn === 'name'}\n            on:mousedown={(event) => startColumnResize(event, 'name')}\n            aria-label=\"Resize Name column\"\n          />\n        </div>\n\n        <div class=\"col path\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('dir')}>\n            Path{#if sortBy === 'dir'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n          <button\n            type=\"button\"\n            class=\"col-resizer\"\n            class:active={resizingColumn === 'path'}\n            on:mousedown={(event) => startColumnResize(event, 'path')}\n            aria-label=\"Resize Path column\"\n          />\n        </div>\n\n        <div class=\"col size\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('size')}>\n            Size{#if sortBy === 'size'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n        </div>\n\n        <div class=\"col modified\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('mtime')}>\n            Modified{#if sortBy === 'mtime'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <div\n      class=\"table-body\"\n      bind:this={tableContainer}\n      on:scroll={() => {\n        scrollTop = tableContainer.scrollTop;\n        headerScrollLeft = tableContainer.scrollLeft;\n        if (editing.active) cancelRename();\n        const scrollBottom = scrollTop + tableContainer.clientHeight;\n        if (scrollBottom >= totalHeight - rowHeight * 10) {\n          void loadMore();\n        }\n      }}\n    >\n      <div class=\"spacer\" style={`height:${totalHeight}px`}>\n        <div class=\"rows\" style={`transform: translateY(${translateY}px);`}>\n          {#each visibleRows as entry, localIndex}\n            {@const index = startIndex + localIndex}\n            <div\n              class=\"row {selectedIndices.has(index) ? 'selected' : ''}\"\n              on:mousedown={(event) => handleRowMouseDown(event, index)}\n              on:click={(event) => handleRowClick(event, index)}\n              on:keydown={(event) => handleRowA11yKeydown(event, index)}\n              on:dblclick={() => handleRowDoubleClick(index)}\n              on:contextmenu={(event) => handleRowContextMenu(event, index)}\n              role=\"row\"\n              tabindex=\"0\"\n            >\n              <div class=\"cell name\">\n                <img class=\"file-icon\" src={iconFor(entry)} alt=\"\" />\n                <span class=\"ellipsis\" class:name-editing={editing.active && editing.index === index}>{#each highlightSegments(entry.name, query) as seg}{#if seg.hl}<mark class=\"hl\">{seg.text}</mark>{:else}{seg.text}{/if}{/each}</span>\n              </div>\n              <div class=\"cell path\"><span class=\"ellipsis\">{displayPath(entry.dir)}</span></div>\n              <div class=\"cell size\">{formatSize(entry)}</div>\n              <div class=\"cell modified\">{formatModified(entry)}</div>\n            </div>\n          {/each}\n        </div>\n      </div>\n    </div>\n  </section>\n\n  <footer class=\"status-bar\">\n    <div class=\"status-left\">\n      <span class=\"status-state\">\n        <span class=\"state-dot {indexStatus.state === 'Indexing' ? 'indexing' : indexStatus.state === 'Error' ? 'error' : 'ready'}\"></span>\n        {#if indexStatus.state === 'Indexing'}\n          Indexing{#if lastReadyCount > 0} ({Math.min(99, Math.round((scanned / lastReadyCount) * 100))}%){/if}{#if indexingElapsed} Â· {indexingElapsed}{/if}\n          {#if !indexStatus.isCatchup}\n            Â· {scanned.toLocaleString()} scanned\n          {/if}\n        {:else}\n          Index: {indexStatus.state}\n        {/if}\n      </span>\n      <span>{indexStatus.entriesCount.toLocaleString()} entries</span>\n      {#if indexingFinishedAt && indexStatus.state !== 'Indexing'}\n        <span>in {indexingFinishedAt}</span>\n      {/if}\n      {#if dbLatencyMs !== null && dbLastQuery}\n        <span>\"{dbLastQuery}\" {dbLatencyMs}ms Â· {totalResults} results</span>\n      {/if}\n      {#if searchModeLabel === 'spotlight' || searchModeLabel === 'spotlight_timeout'}\n        <span class=\"status-spotlight\">Spotlight fallback{#if searchModeLabel === 'spotlight_timeout'} (partial){/if}</span>\n      {/if}\n      {#if indexStatus.permissionErrors > 0}\n        <span class=\"status-warning\">{indexStatus.permissionErrors.toLocaleString()} permission errors</span>\n      {/if}\n      {#if indexStatus.message}\n        <span class={indexStatus.isCatchup ? 'index-progress' : 'status-error'}>{indexStatus.message}</span>\n      {/if}\n    </div>\n    <div class=\"status-right\">\n      <button class=\"status-btn theme-btn\" on:click={cycleTheme} title=\"Switch theme\">\n        {theme === 'dark' ? 'â˜€ Light' : 'â—‘ Dark'}\n      </button>\n      <button\n        class=\"status-btn rebuild-btn\"\n        on:click={resetIndex}\n        disabled={indexStatus.state === 'Indexing'}\n        title={indexStatus.state === 'Indexing' ? 'Cannot reset while indexing is in progress.' : 'Reset and rebuild the index.'}\n      >\n        <svg class=\"rebuild-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <path d=\"M23 4v6h-6\"/><path d=\"M20.49 15a9 9 0 1 1-2.12-9.36L23 10\"/>\n        </svg>\n        Rebuild Index\n      </button>\n    </div>\n  </footer>\n\n  {#if editing.active}\n    <div\n      class=\"rename-overlay\"\n      style=\"top:{renameOverlay.top}px; left:{renameOverlay.left}px; width:{renameOverlay.width}px;\"\n      role=\"presentation\"\n      on:mousedown|stopPropagation\n    >\n      <textarea\n        bind:this={renameInputEl}\n        class=\"rename-textarea\"\n        bind:value={editing.draftName}\n        on:input={autoResizeRenameInput}\n        on:click|stopPropagation\n        on:blur={commitRename}\n      />\n    </div>\n  {/if}\n\n  {#if contextMenu.visible}\n    <div class=\"context-menu\" style={`left:${contextMenu.x}px;top:${contextMenu.y}px;`}>\n      <button on:click={() => (closeContextMenu(), openSelected())}>Open</button>\n      <button on:click={async () => { closeContextMenu(); const e = primaryEntry(); if (e) await invoke('quick_look', { path: e.path }); }}>Quick Look</button>\n      <button on:click={() => (closeContextMenu(), openWithFallback())}>Open With... (Reveal in Finder)</button>\n      <button on:click={() => (closeContextMenu(), revealSelected())}>Reveal in Finder</button>\n      <button on:click={() => (closeContextMenu(), copySelectedPaths())}>Copy Path</button>\n      <button on:click={() => (closeContextMenu(), trashSelected())}>Move to Trash</button>\n      {#if selectedIndices.size === 1}\n        <button on:click={() => (closeContextMenu(), startRename())}>Rename</button>\n      {/if}\n    </div>\n  {/if}\n\n  {#if toast}\n    <div class=\"toast\">{toast}</div>\n  {/if}\n</div>\n\n<style>\n  :global(:root) {\n    color-scheme: light dark;\n    --bg-app: transparent;\n    --text-primary: #0d1826;\n    --text-muted: #48596c;\n    --bar-grad-top: rgba(255, 255, 255, 0.48);\n    --bar-grad-bottom: rgba(248, 250, 253, 0.42);\n    --surface-header: rgba(252, 252, 255, 0.40);\n    --surface: rgba(255, 255, 255, 0.22);\n    --border-soft: rgba(0, 0, 0, 0.07);\n    --border-input: rgba(0, 0, 0, 0.13);\n    --focus-ring: #6f96e6;\n    --row-border: rgba(0, 0, 0, 0.032);\n    --row-hover: rgba(0, 0, 0, 0.06);\n    --row-selected: rgba(0, 0, 0, 0.12);\n    --button-bg: rgba(255, 255, 255, 0.62);\n    --button-border: rgba(0, 0, 0, 0.10);\n    --button-text: #2c3e50;\n    --menu-bg: rgba(240, 241, 248, 0.90);\n    --menu-border: rgba(0, 0, 0, 0.06);\n    --menu-hover: rgba(255, 255, 255, 0.62);\n    --menu-text: #1a2a38;\n    --error-text: #b64545;\n    --warning-text: #8f6500;\n    --toast-bg: rgba(18, 22, 32, 0.90);\n    --toast-text: #ffffff;\n  }\n\n  @media (prefers-color-scheme: dark) {\n    :global(:root) {\n      --bg-app: transparent;\n      --text-primary: #e6e6ea;\n      --text-muted: #9494a4;\n      --bar-grad-top: rgba(38, 38, 46, 0.52);\n      --bar-grad-bottom: rgba(30, 30, 38, 0.46);\n      --surface-header: rgba(32, 32, 40, 0.46);\n      --surface: rgba(18, 18, 26, 0.32);\n      --border-soft: rgba(255, 255, 255, 0.065);\n      --border-input: rgba(255, 255, 255, 0.14);\n      --focus-ring: #5b8bd9;\n      --row-border: rgba(255, 255, 255, 0.026);\n      --row-hover: rgba(255, 255, 255, 0.08);\n      --row-selected: rgba(255, 255, 255, 0.14);\n      --button-bg: rgba(255, 255, 255, 0.072);\n      --button-border: rgba(255, 255, 255, 0.11);\n      --button-text: #d6d6e0;\n      --menu-bg: rgba(36, 36, 46, 0.90);\n      --menu-border: rgba(255, 255, 255, 0.066);\n      --menu-hover: rgba(255, 255, 255, 0.062);\n      --menu-text: #e0e0e8;\n      --error-text: #ff9d9d;\n      --warning-text: #e0c670;\n      --toast-bg: rgba(10, 10, 16, 0.93);\n      --toast-text: #f2f2f6;\n    }\n  }\n\n  /* â”€â”€ Theme: Dark â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme=\"dark\"]) {\n    color-scheme: dark;\n    --bg-app: #1E1E21;\n    --text-primary: #E2E8F0;\n    --text-muted: #94A3B8;\n    --bar-grad-top: #1E1E21;\n    --bar-grad-bottom: #1E1E21;\n    --surface-header: #1E1E21;\n    --surface: #1E1E21;\n    --bg-input: #161618;\n    --border-soft: #2A2A2D;\n    --border-input: rgba(255, 255, 255, 0.06);\n    --focus-ring: #4DA8FF;\n    --accent: #4DA8FF;\n    --row-border: rgba(255, 255, 255, 0.02);\n    --row-hover: #282828;\n    --row-selected: rgba(77, 168, 255, 0.10);\n    --button-bg: rgba(255, 255, 255, 0.05);\n    --button-border: #2A2A2D;\n    --button-text: #94A3B8;\n    --menu-bg: #252528;\n    --menu-border: #2A2A2D;\n    --menu-hover: rgba(255, 255, 255, 0.04);\n    --menu-text: #E2E8F0;\n    --error-text: #ff9d9d;\n    --warning-text: #e0c670;\n    --toast-bg: rgba(10, 10, 16, 0.93);\n    --toast-text: #f2f2f6;\n  }\n\n  /* â”€â”€ Theme: Light â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme=\"light\"]) {\n    color-scheme: light;\n    --bg-app: #F5F5F7;\n    --text-primary: #1C1C1E;\n    --text-muted: #6E6E7A;\n    --bar-grad-top: #F5F5F7;\n    --bar-grad-bottom: #F5F5F7;\n    --surface-header: #F5F5F7;\n    --surface: #F5F5F7;\n    --bg-input: #FFFFFF;\n    --border-soft: #D1D1D6;\n    --border-input: rgba(0, 0, 0, 0.10);\n    --focus-ring: #3A8BF5;\n    --accent: #3A8BF5;\n    --row-border: rgba(0, 0, 0, 0.04);\n    --row-hover: rgba(0, 0, 0, 0.04);\n    --row-selected: rgba(58, 139, 245, 0.10);\n    --button-bg: #FFFFFF;\n    --button-border: #D1D1D6;\n    --button-text: #3C3C43;\n    --menu-bg: #FFFFFF;\n    --menu-border: #D1D1D6;\n    --menu-hover: rgba(0, 0, 0, 0.05);\n    --menu-text: #1C1C1E;\n    --error-text: #D93025;\n    --warning-text: #B45309;\n    --toast-bg: rgba(255, 255, 255, 0.95);\n    --toast-text: #1C1C1E;\n  }\n\n  /* â”€â”€ Themed element overrides â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme]) {\n    background: var(--bg-app);\n  }\n\n  /* Search bar: flat, no gradient, no separator */\n  :global([data-theme]) .search-bar {\n    height: 44px;\n    padding: 0 16px;\n    background: var(--bg-app);\n    border-bottom: none;\n  }\n\n  :global([data-theme]) .search-input {\n    backdrop-filter: none;\n    -webkit-backdrop-filter: none;\n    font-family: 'JetBrains Mono', 'SF Mono', monospace;\n    font-size: 12px;\n    height: 34px;\n    border-radius: 8px;\n  }\n\n  /* Table header: flat bg, 16px edge padding */\n  :global([data-theme]) .table-header {\n    background: var(--bg-app);\n  }\n\n  :global([data-theme]) .col-button {\n    padding: 0 8px;\n  }\n\n  :global([data-theme]) .col.name .col-button {\n    padding-left: 16px;\n  }\n\n  /* Row cells: JetBrains Mono, 16px outer edges */\n  :global([data-theme]) .cell {\n    font-family: 'JetBrains Mono', monospace;\n  }\n\n  :global([data-theme]) .cell.name {\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    padding-left: 16px;\n    font-size: 12px;\n    color: var(--text-primary);\n  }\n\n  :global([data-theme]) .cell.path {\n    font-size: 11px;\n  }\n\n  :global([data-theme]) .cell.size {\n    font-size: 11px;\n  }\n\n  :global([data-theme]) .cell.modified {\n    padding-right: 16px;\n    font-size: 11px;\n    white-space: nowrap;\n  }\n\n  :global([data-theme]) .row.selected {\n    box-shadow: inset 3px 0 0 var(--accent);\n  }\n\n  /* Dim path/size/date cells in themed mode */\n  :global([data-theme]) .cell.path,\n  :global([data-theme]) .cell.size,\n  :global([data-theme]) .cell.modified {\n    color: var(--text-muted);\n  }\n\n  :global(:root) {\n    background: transparent;\n  }\n\n  :global(html, body) {\n    margin: 0;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n    background: transparent;\n    color: var(--text-primary);\n    font-family: Inter, 'SF Pro Text', 'Segoe UI', Helvetica, Arial, sans-serif;\n  }\n\n  :global(#app) {\n    width: 100%;\n    height: 100%;\n  }\n\n  .app-shell {\n    display: grid;\n    grid-template-rows: auto auto 1fr auto;\n    height: 100%;\n    min-width: 0;\n  }\n\n  .title-bar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 44px;\n    padding: 0 16px;\n    background: var(--surface-header);\n    cursor: default;\n    flex-shrink: 0;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-left {\n    width: 72px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-center {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-right {\n    width: 72px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-icon {\n    width: 14px;\n    height: 14px;\n    fill: var(--accent);\n    flex-shrink: 0;\n  }\n\n  .title-text {\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--text-primary);\n    letter-spacing: -0.01em;\n  }\n\n  .search-bar {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 8px;\n    background: linear-gradient(180deg, var(--bar-grad-top) 0%, var(--bar-grad-bottom) 100%);\n    border-bottom: 1px solid var(--border-soft);\n    min-width: 0;\n    flex-shrink: 0;\n  }\n\n  .search-input {\n    display: block;\n    box-sizing: border-box;\n    width: 100%;\n    min-width: 0;\n    flex: 1 1 auto;\n    height: 36px;\n    border: 1px solid var(--border-input);\n    border-radius: 14px;\n    padding: 0 10px;\n    font-size: 14px;\n    background: var(--bg-input, var(--surface));\n    color: var(--text-primary);\n    backdrop-filter: blur(12px) saturate(160%);\n    -webkit-backdrop-filter: blur(12px) saturate(160%);\n  }\n\n  .search-input::placeholder {\n    color: var(--text-muted);\n    opacity: 0.85;\n    font-size: 12px;\n  }\n\n  .search-input:focus {\n    outline: none;\n    border-color: var(--focus-ring);\n    box-shadow: 0 0 0 2px rgba(125, 169, 255, 0.25);\n  }\n\n  .table-area {\n    display: grid;\n    grid-template-rows: auto 1fr;\n    min-height: 0;\n    min-width: 0;\n  }\n\n  .table-header-track,\n  .row {\n    display: grid;\n    grid-template-columns: var(--col-name) var(--col-path) var(--col-size) var(--col-modified);\n    align-items: center;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .table-header {\n    height: 32px;\n    border-bottom: 1px solid var(--border-soft);\n    background: var(--surface-header);\n    user-select: none;\n    overflow: hidden;\n    flex-shrink: 0;\n  }\n\n  .table-header-track {\n    height: 100%;\n    transform: translateX(var(--header-offset, 0px));\n    will-change: transform;\n  }\n\n  .table-header .col {\n    position: relative;\n    min-width: 0;\n    height: 100%;\n  }\n\n  .col-button {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: flex-start;\n    gap: 4px;\n    box-sizing: border-box;\n    padding: 0 8px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 11px;\n    font-weight: 600;\n    line-height: 1;\n    color: var(--text-muted);\n    text-align: left;\n    margin: 0;\n    border: none;\n    background: transparent;\n    cursor: pointer;\n  }\n\n  .sort-icon {\n    width: 10px;\n    height: 10px;\n    flex-shrink: 0;\n    color: var(--accent);\n  }\n\n  .col-resizer {\n    position: absolute;\n    top: 0;\n    right: -4px;\n    width: 8px;\n    height: 100%;\n    border: none;\n    padding: 0;\n    background: transparent;\n    cursor: col-resize;\n    z-index: 30;\n  }\n\n  .col-resizer::after {\n    content: '';\n    position: absolute;\n    top: 7px;\n    bottom: 7px;\n    left: 50%;\n    width: 1px;\n    transform: translateX(-50%);\n    background: var(--border-soft);\n    opacity: 0;\n    transition: opacity 0.15s ease;\n  }\n\n  .table-header .col:hover .col-resizer::after,\n  .col-resizer.active::after {\n    opacity: 1;\n  }\n\n  .table-body {\n    overflow: auto;\n    min-height: 0;\n    min-width: 0;\n    background: var(--surface);\n  }\n\n  .spacer {\n    position: relative;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .rows {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .row {\n    height: 30px;\n    border-bottom: 1px solid var(--row-border);\n    cursor: default;\n    -webkit-user-select: none;\n    user-select: none;\n    outline: none;\n  }\n\n  .row:hover {\n    background: var(--row-hover);\n  }\n\n  .row.selected {\n    background: var(--row-selected);\n  }\n\n  .cell {\n    padding: 0 8px;\n    font-size: 12px;\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    min-width: 0;\n  }\n\n  .cell.size {\n    text-align: right;\n    font-variant-numeric: tabular-nums;\n  }\n\n  .ellipsis {\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n\n  .hl {\n    background: none;\n    color: inherit;\n    font-weight: 700;\n  }\n\n  .file-icon {\n    width: 16px;\n    height: 16px;\n    flex: 0 0 auto;\n  }\n\n  .name-editing {\n    opacity: 0.25;\n  }\n\n  .rename-overlay {\n    position: fixed;\n    z-index: 100;\n    min-width: 120px;\n  }\n\n  .rename-textarea {\n    display: block;\n    width: 100%;\n    box-sizing: border-box;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 12px;\n    line-height: 18px;\n    padding: 5px 4px 5px 0;\n    border: 1.5px solid var(--focus-ring);\n    border-radius: 4px;\n    background: var(--bg-input, var(--surface));\n    color: var(--text-primary);\n    outline: none;\n    resize: none;\n    overflow: hidden;\n    box-shadow: 0 2px 14px rgba(0, 0, 0, 0.22), 0 0 0 3px rgba(77, 168, 255, 0.13);\n  }\n\n  .status-bar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 32px;\n    padding: 0 16px;\n    background: var(--surface-header);\n    border-top: 1px solid var(--border-soft);\n    font-family: 'JetBrains Mono', monospace;\n    font-size: 11px;\n    color: var(--text-muted);\n    white-space: nowrap;\n    overflow: hidden;\n    min-width: 0;\n    flex-shrink: 0;\n  }\n\n  .status-left {\n    display: flex;\n    align-items: center;\n    gap: 16px;\n    overflow: hidden;\n    min-width: 0;\n  }\n\n  .status-right {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    flex-shrink: 0;\n  }\n\n  .status-btn {\n    border: 1px solid var(--button-border);\n    border-radius: 5px;\n    background: var(--button-bg);\n    color: var(--button-text);\n    font-size: 11px;\n    height: 22px;\n    padding: 0 8px;\n    cursor: pointer;\n  }\n\n  .status-btn:hover {\n    filter: brightness(1.06);\n  }\n\n  .status-btn:disabled {\n    opacity: 0.55;\n    cursor: not-allowed;\n    filter: none;\n  }\n\n  .status-state {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n  }\n\n  .state-dot {\n    width: 6px;\n    height: 6px;\n    border-radius: 50%;\n    flex-shrink: 0;\n  }\n\n  .state-dot.ready { background: #28C840; }\n  .state-dot.indexing { background: #FEBC2E; }\n  .state-dot.error { background: #FF5F57; }\n\n  .rebuild-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 10px;\n    font-weight: 500;\n    background: var(--button-bg);\n    border: 1px solid var(--button-border);\n    border-radius: 4px;\n    color: var(--button-text);\n    height: 22px;\n    padding: 0 10px;\n    cursor: pointer;\n  }\n\n  .rebuild-btn:hover {\n    filter: brightness(1.1);\n  }\n\n  .rebuild-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    filter: none;\n  }\n\n  .rebuild-icon {\n    width: 11px;\n    height: 11px;\n    color: var(--accent);\n    flex-shrink: 0;\n  }\n\n  .status-error {\n    color: var(--error-text);\n  }\n\n  .status-warning {\n    color: var(--warning-text);\n  }\n\n  .status-spotlight {\n    color: #f59e0b;\n    font-weight: 600;\n  }\n\n  .context-menu {\n    position: fixed;\n    z-index: 200;\n    width: 220px;\n    border: 1px solid var(--menu-border);\n    border-radius: 10px;\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.16), inset 0 0 0 0.5px rgba(255, 255, 255, 0.18);\n    background: var(--menu-bg);\n    backdrop-filter: blur(28px) saturate(180%);\n    -webkit-backdrop-filter: blur(28px) saturate(180%);\n    overflow: hidden;\n  }\n\n  .context-menu button {\n    width: 100%;\n    text-align: left;\n    border: none;\n    background: transparent;\n    padding: 8px 10px;\n    font-size: 12px;\n    color: var(--menu-text);\n  }\n\n  .context-menu button:hover {\n    background: var(--menu-hover);\n  }\n\n  .toast {\n    position: fixed;\n    right: 14px;\n    bottom: 18px;\n    background: var(--toast-bg);\n    color: var(--toast-text);\n    border-radius: 10px;\n    padding: 9px 12px;\n    font-size: 12px;\n    z-index: 250;\n    backdrop-filter: blur(20px) saturate(180%);\n    -webkit-backdrop-filter: blur(20px) saturate(180%);\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);\n  }\n</style>\n","numLines":2271,"startLine":1,"totalLines":2271}},"sourceToolAssistantUUID":"9da282ea-e4a9-49c5-8d9d-6c67bb4e3f6a"}
{"parentUuid":"845ef5d4-08d9-4bac-b064-d22f87dd6f9b","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_014bggPqP4dDP5KyeHSZcHjN","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I have the full picture. Let me analyze the changes carefully.\n\n## Summary of Changes\n\n1. **`rowHeight` changed**: 28 â†’ 30px\n2. **`THEME_KEY` constant added** for localStorage\n3. **`minColumnWidth.modified` changed**: 120 â†’ 150px\n4. **`theme` state + `cycleTheme()` function** added â€” dark/light toggle with localStorage persistence\n5. **`renameOverlay` state** added â€” for fixed-positioned rename textarea\n6. **`indexed` and `currentPath` state removed** â€” these were tracking indexing progress\n\n\n7. **`tableResizeObserver` and `viewportResizeRaf`** added â€” using `ResizeObserver` and `requestAnimationFrame` to handle viewport height updates\n8. **`scheduleViewportHeightUpdate()`** added â€” debounced viewport height recalculation\n9. **`indexStatus` in `refreshStatus()`** â€” removed the indexed/currentPath tracking from status updates\n10. **`resetIndex()`** â€” cleaned up to remove indexed and currentPath resets\n11. **`autoResizeRenameInput()`** â€” dynamically adjusts the rename textarea height based on content\n12. Still implementing rename functionality...\n13. **`onTitleBarMouseDown()`** â€” handling title bar interactions for dragging\n14. **Escape key behavior** â€” now focuses the search input after canceling a rename\n15. **Scroll cancellation** â€” rename gets cancelled when the user scrolls\n16. **`index_progress` event** â€” no longer updates indexed/currentPath fields\n17. **`ResizeObserver`** â€” replacing the old window resize listener with a more efficient observer pattern\n18. **Title bar redesign** â€” adding a draggable region with icon and centered text\n19. **Sort icons** â€” switching from unicode to SVG icons for better control\n20. **Status bar layout** â€” restructured with left/right sections, state indicator, theme toggle, and rebuild button\n21. **Rename input repositioning** â€” moving from inline to a fixed overlay...\n\nNow I'm looking at the theme system with dark/light CSS variables using data attributes, plus some styling adjustments like the row height change from 28 to 30 pixels. I'm also spotting a potential bug in how the rename overlay position is being calculated â€” the viewport-relative rect coordinates and scroll offset math doesn't quite add up correctly. Container positioning is getting confusing. Let me reconsider how the viewport coordinates work when the table scrolls horizontallyâ€”the name column starts at x=0 within the scrollable container, so its viewport-relative position should account for the scroll offset differently than I initially thought. I need to reconsider how the positioning works with the absolute-positioned rows inside the scrollable container. When `scrollLeft` is 0, the rows align with the container's viewport edge at `rect.left`, but as scrolling increases, the viewport position shifts to `rect.left - scrollLeft`. The text offset calculation of `textLeft = cellLeft + 38` should then give me the correct viewport coordinate where the text actually begins.\n\nFor the vertical positioning, I'm checking the `rowTop` calculation where `lastSelectedIndex * rowHeight` gives the absolute position within the virtual scroll content, and subtracting `scrollTop` accounts for how much has scrolled out of view, then adding `rect.top` converts it to viewport coordinates. The logic tracksâ€”I'm just verifying that `lastSelectedIndex` is indeed the right index to use here rather than a loop variable.\n\nNow I'm looking at the `commitRename` function triggered by the textarea blur event. The issue is that blurring the textarea (whether intentional or accidental, like clicking elsewhere) will silently commit the rename. The `cancelRename` function handles Escape and scroll events, and it sets `editing.active = false`, which should prevent the blur handler from firing, but I need to trace through that logic more carefully. causes `{#if editing.active}` to be false, so the textarea would be removed from DOM... Actually it's a Svelte reactive block. When `cancelRename()` is called, it sets `editing = { active: false, ... }`, which means the `{#if editing.active}` block becomes false. Svelte will then remove the textarea from DOM, which should trigger the blur event. But by the time blur fires, `editing.active` is already false, so `commitRename` will check `if (!editing.active ...)` and return early. So this case is safe.\n\nWhat about scrolling? The scroll handler calls `cancelRename()` at line 1493, which would also cause the textarea to be removed, triggering blur â†’ `commitRename()`. But here's the thing: in Svelte 4, the reactive assignment and DOM update are batched asynchronously. When scroll fires and `cancelRename()` sets `editing = { active: false, ... }`, the DOM update gets scheduled as a microtask, so the blur event might actually fire before the textarea is removed from the DOM. At that point, `editing.active` could still be true, which would let `commitRename()` proceed instead of returning early.\n\nActually, let me reconsider. Svelte's reactivity is synchronous for the JavaScript state updates. So when `cancelRename()` runs, `editing.active` becomes false immediately in JavaScript, even though the DOM update is scheduled for later. So when blur fires (whether before or after the DOM update), `editing.active` is already false, and `commitRename()` returns early. This is safe.\n\nNow what about clicking the title bar? The title bar has a mousedown handler that calls `activeElement.blur()`. This triggers blur on the textarea, which calls `commitRename()`. At this point `editing.active` is still true, so the rename gets committed. That seems intentionalâ€”clicking outside the rename area should save the changes. But I need to check if there's an issue with the `stopPropagation` on the rename input itself.\n\nWhen the user clicks on a table row while the textarea is focused, the row's mousedown handler would normally run, but it has a guard that returns early if `editing.active` is true. So the row click is effectively ignored while renaming is active, and the blur from clicking the row will trigger `commitRename()` with `editing.active` still true.\n\nNow I'm looking at the CSS variable issue: `--accent` is used throughout the component for icon fills and the selected row highlight, but it's only defined within the dark and light theme blocks, not in the global root. This means if the `data-theme` attribute isn't set, the variable won't be available.\n\nActually, reconsidering thisâ€”the `app-shell` div always gets a `data-theme` attribute set from the theme variable, which is initialized synchronously to either `'dark'` or `'light'` before the component mounts. So the themed selectors will always match and the global root variables won't be needed for the main content. But there's a potential flash of unstyled content in the HTML skeleton before Svelte takes over.\n\nThe real problem is that both the old `:root` variable system and the new `data-theme` system are coexisting. The `data-theme` rules override the root variables within `.app-shell`, but the skeleton and any elements outside that wrapper still rely on the root variables. And critically, `--accent` isn't defined in `:global(:root)`, only in the `data-theme` selectorsâ€”so any elements using `var(--accent)` before the theme system kicks in would have no color.\n\nSince `.app-shell` always gets a `data-theme` attribute, this works in practice. The SVG icons inherit `--accent` correctly through the CSS cascade from the themed container.\n\nNow I'm noticing that `onTitleBarMouseDown` calls `isTextInputTarget` before it's defined in the code, though function hoisting should handle this in the compiled output.\n\nThere's also a mismatch where `buildDragPreview` uses the OS color scheme preference directly instead of respecting the user's theme toggleâ€”if someone switches to light mode but their system is set to dark, the drag preview won't match. It's a minor inconsistency but not critical.\n\nLooking at the cell name positioning calculation, the comment references padding values that only apply when `data-theme` is active, which might not account for all scenarios. rically correct, though there's an edge case where if the cell scrolls off-screen to the left, the rename overlay would position off-screen tooâ€”but that's unlikely since you'd only rename a visible row. I'm also noticing some style duplication: `.rebuild-btn` redefines most of the same properties as `.status-btn` even though it has both classes in the HTML, which is a minor issue. And the `.theme-btn` class is applied to a button but has no corresponding CSS definition anywhere, so it only inherits `.status-btn` styles.\n\nThere's also a bug in `refreshStatus()` where it creates a new `indexStatus` object but omits the `isCatchup` field, leaving it undefined. This means the \"Â· scanned\" indicator would always show during indexing when the status refreshes, since the falsy value would lose the original `isCatchup` state.\n\nThe `sort-icon` SVG is duplicated four times across the template, which is minor duplication. The `state-dot` class uses dynamic conditional logic to apply different styles based on the indexing state.\n\nWhen scrolling the table, `cancelRename()` fires if editing is active, which makes sense now that the rename overlay is fixed rather than inline. But there's a timing issue: `on:blur={commitRename}` will fire after `cancelRename()` sets `editing.active` to false, causing `commitRename` to return early without saving the changes.\n\nSo if a user accidentally scrolls while renaming, their edits get discardedâ€”not a correctness bug, but a UX problem worth noting.\n\nThe `isTextInputTarget` check for Cmd+A in the rename textarea looks correct since it properly identifies `HTMLTextAreaElement` and calls `select()`.\n\nNow I'm thinking through what actually matters to report here. The critical issues are noneâ€”no crashes or data loss. For major issues, the rename discard on scroll is the main concern. arded (not committed) on table scroll** â€” When user scrolls the table with rename active, `cancelRename()` is called, discarding the in-progress rename. The `on:blur={commitRename}` won't commit it because `editing.active` is false by then. This is a behavior change from inline editing (where blur would commit). If this is intentional, it should be documented; if unintentional, scrolling should commit rather than discard.\n\n2. **`--accent` not defined in `:global(:root)`** â€” The `--accent` variable is used in base styles but only defined in the dark and light theme blocks. Since `data-theme` is always set on `.app-shell`, this works in practice. However, the glassmorphism default theme won't have full accent support.\n\n3. **`isDark` in `buildDragPreview` uses OS preference instead of the user's theme setting** â€” If someone switches to light mode but their OS is set to dark, the drag preview will still use dark colors, creating a minor visual inconsistency.\n\nFor the minor issues, the `theme-btn` CSS class is referenced in HTML but never defined in the stylesheet, and there's some duplicate styling between `.status-btn` and `.rebuild-btn` that could be consolidated. I'm tracing through the blur event behavior more carefully. When the user presses Enter, `commitRename` fires from the keydown handler, which calls `cancelRename()` and sets editing to inactive. The textarea then unmounts, triggering its blur event, which calls `commitRename` againâ€”but the guard clause catches it since `editing.active` is already false, so the rename gets discarded safely. This is the correct behavior, though it might surprise users expecting the rename to persist. editing.active is false). âœ“\n2. User presses Escape â†’ `cancelRename` called â†’ editing inactive â†’ textarea unmounts â†’ blur fires â†’ `commitRename` â†’ guard catches it. âœ“  \n3. User clicks on title bar â†’ `activeElement.blur()` called â†’ blur fires â†’ `commitRename` â†’ editing.active is true â†’ commits rename. âœ“\n4. User clicks elsewhere (non-focusable) â†’ browser blurs textarea â†’ `commitRename` â†’ editing.active is true â†’ commits rename. âœ“\n5. User scrolls â†’ `cancelRename` â†’ editing inactive â†’ textarea unmounts â†’ blur fires â†’ `commitRename` â†’ guard. âœ“\n\nSo the blur-based commit is safe. The only behavioral concern is that scroll cancels (discards) rename rather than committing it.\n\nWait, let me trace through the scroll scenario more carefully. When scroll fires, `cancelRename()` runs synchronously and sets `editing.active` to false, but Svelte batches the DOM update as a microtask. So there's a window where the textarea still exists in the DOM even though `editing.active` is already false in JavaScript. When blur fires during this phase, `commitRename` checks the guard and returns early since the store is inactive. The key insight is that blur fires when the element loses focus, which happens after the synchronous event handler completes.\n\nNow I'm checking the `onTitleBarMouseDown` function, which explicitly blurs any active text input when the title bar is clicked.  This allows the title bar drag to work properly, but it also means a rename would be committed if one is activeâ€”which seems like the intended behavior when the user interacts with the title bar.\n\nI'm also noticing the `--accent` CSS variable issue: it's defined in the dark and light theme selectors but not in the root, so I need to verify how that's being handled across the theme system.\n\nLooking at the actual usage, all the places where `--accent` is referenced are scoped within `[data-theme]` elements, so there's no real problem hereâ€”it's just not defined at the root level, which is fine given how it's being used.\n\nNow I'm noticing the `buildDragPreview` function has a separate issue: it reads the OS preference for dark mode to style the drag preview canvas, but the UI uses the `theme` state instead. If someone manually switches to light mode while their OS is set to dark, the drag preview will still render with dark styling, creating an inconsistency between what they see in the UI and what appears when dragging. I'll flag this as a minor UX issue.","signature":"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"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":30837,"cache_read_input_tokens":45687,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":30837},"output_tokens":10,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMNqWcfCq7HeoXb9cTNR","type":"assistant","uuid":"d54e1b5b-7bb4-4003-91fa-672c36873c76","timestamp":"2026-02-21T14:34:31.826Z"}
{"parentUuid":"d54e1b5b-7bb4-4003-91fa-672c36873c76","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_014bggPqP4dDP5KyeHSZcHjN","type":"message","role":"assistant","content":[{"type":"text","text":"Now I have a full picture. Let me write the review.\n\n---\n\n## Code Review â€” `src/App.svelte`\n\nThis is a significant UI update adding: theme toggle (dark/light), title bar, SVG sort indicators, a fixed-position rename overlay, `ResizeObserver` for viewport sizing, and a redesigned status bar.\n\n---\n\n### Critical Issues ðŸš¨\n\nNone.\n\n---\n\n### Major Issues âš ï¸\n\n**1. Scroll during rename discards (not commits) the in-progress edit â€” silent data loss**\n\n`src/App.svelte:1493`\n\n```js\nif (editing.active) cancelRename();\n```\n\n`cancelRename()` sets `editing.active = false` synchronously. The Svelte DOM update is batched, so `editing.active` is already `false` when the textarea unmounts and `on:blur={commitRename}` fires. `commitRename` returns early because `!editing.active`. The user's in-progress name is silently thrown away.\n\nPreviously the rename input was inline and scrolled with the row, making scroll-while-editing sensible. The new fixed overlay approach changes the contract â€” the rename box floats in place while the list scrolls underneath it. The expected behavior when scrolling off the renamed row is ambiguous, but **silent discard** is the worst outcome. Consider either committing on scroll, or at minimum making the user explicitly cancel.\n\n---\n\n**2. `buildDragPreview` uses OS color-scheme instead of the `theme` state**\n\n`src/App.svelte:675`\n\n```js\nconst isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;\n```\n\nIf the user has toggled to light theme (OS = dark), the drag preview renders dark-colored cards while the rest of the UI is light. Since the canvas is drawn imperatively and can't use CSS variables, the fix is to read `theme` directly:\n\n```js\nconst isDark = theme === 'dark';\n```\n\n---\n\n### Minor Issues ðŸ’¡\n\n**1. `.theme-btn` CSS class is referenced but never defined**\n\n`src/App.svelte:1559`\n\n```html\n<button class=\"status-btn theme-btn\" ...>\n```\n\nNo `.theme-btn` rule exists. The class has no effect. Remove it or add a rule if differentiating this button from `.rebuild-btn` is intended.\n\n---\n\n**2. `.rebuild-btn` redundantly redeclares all `.status-btn` properties**\n\n`src/App.svelte` (CSS, `.rebuild-btn` block)\n\nThe HTML gives this button both `class=\"status-btn rebuild-btn\"`. `.rebuild-btn` re-declares `background`, `border`, `border-radius`, `color`, `height`, `padding`, and `cursor` â€” most of which are already set by `.status-btn`. The duplicated `:hover` and `:disabled` states also replicate `.status-btn`'s rules. Keep only the *differences* (e.g., `display: flex`, `gap`, `font-family`, `font-size`, `font-weight`, `border-radius`).\n\n---\n\n**3. Sort icon SVG is inlined identically in four places**\n\n`src/App.svelte:1449, 1462, 1475, 1481`\n\nThe same 10Ã—10 chevron SVG is copy-pasted for each column header. If the icon design changes this needs updating in 4 places. A local Svelte component or a single `sortIconPath` helper constant would eliminate the duplication.\n\n---\n\n### Positive Highlights âœ…\n\n- **`scheduleViewportHeightUpdate()`** correctly debounces `ResizeObserver` callbacks via `requestAnimationFrame` and cancels the pending frame in `onDestroy`. Proper cleanup.\n- **`on:blur={commitRename}`** interaction is correctly guarded â€” all paths that cancel editing (Escape, scroll, programmatic cancel) set `editing.active = false` *before* the DOM update that triggers blur, so `commitRename` safely returns early. No double-commit possible.\n- **`cycleTheme()`** wraps `localStorage` access in try/catch â€” correct defensive pattern for environments where storage access might be blocked.\n- **`renameOverlay` position math** is geometrically sound: uses `getBoundingClientRect()` (viewport-relative) + subtracts `scrollTop`/`scrollLeft` to produce correct `position: fixed` coordinates.\n- Removing `indexed` and `currentPath` state is a clean simplification â€” these were never displayed in a meaningful way.\n\n---\n\n### Overall Assessment\n\nThe changes are well-structured and the rename overlay architecture is sound. The one real behavior concern is the silent discard of rename content on scroll (#1 above). Everything else compiles cleanly conceptually; run `npm run tauri dev` to verify visual parity."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":30837,"cache_read_input_tokens":45687,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":30837},"output_tokens":10,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMNqWcfCq7HeoXb9cTNR","type":"assistant","uuid":"bd610725-980c-4e50-9304-f4027fcf9ea0","timestamp":"2026-02-21T14:34:53.904Z"}
{"parentUuid":"bd610725-980c-4e50-9304-f4027fcf9ea0","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"2eed66a3-67d3-4fdb-b5b4-ce7dc94c05fd","toolUseID":"2eed66a3-67d3-4fdb-b5b4-ce7dc94c05fd","timestamp":"2026-02-21T14:34:53.955Z","uuid":"bd99bd38-36be-4a37-b972-2b02d40fbc9c"}
{"parentUuid":"bd99bd38-36be-4a37-b972-2b02d40fbc9c","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"system","subtype":"stop_hook_summary","hookCount":1,"hookInfos":[{"command":"entire hooks claude-code stop","durationMs":1440}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-21T14:34:55.396Z","uuid":"93f8b2c0-90bb-45b6-bb25-686bb357d1c3","toolUseID":"2eed66a3-67d3-4fdb-b5b4-ce7dc94c05fd"}
{"parentUuid":"93f8b2c0-90bb-45b6-bb25-686bb357d1c3","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"system","subtype":"turn_duration","durationMs":158580,"timestamp":"2026-02-21T14:34:55.398Z","uuid":"ffbe1a21-298e-49f8-b121-ad2d4e5bb3fd","isMeta":false}
{"type":"file-history-snapshot","messageId":"1328a288-d2f6-4263-8570-b556ad230dfd","snapshot":{"messageId":"1328a288-d2f6-4263-8570-b556ad230dfd","trackedFileBackups":{},"timestamp":"2026-02-21T14:36:33.132Z"},"isSnapshotUpdate":false}
{"parentUuid":"ffbe1a21-298e-49f8-b121-ad2d4e5bb3fd","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":"ìˆ˜ì •í•´ì¤˜"},"uuid":"1328a288-d2f6-4263-8570-b556ad230dfd","timestamp":"2026-02-21T14:36:30.894Z","permissionMode":"bypassPermissions"}
{"parentUuid":"1328a288-d2f6-4263-8570-b556ad230dfd","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01F4YofEMbREC4bdWvqKqqcN","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants me to fix the issues identified in the code review. Let me address each one:\n\n1. **Major: Scroll during rename discards the in-progress edit** â€” Change `cancelRename()` to `commitRename()` on scroll, or at minimum commit instead of discard.\n\n2. **Major: `buildDragPreview` uses OS color-scheme instead of `theme` state** â€” Change `window.matchMedia(...)` to use `theme` variable.\n\n3. **Minor: `.theme-btn` CSS class is referenced but never defined** â€” Remove the class.\n\n4. **Minor: `.rebuild-btn` redundantly redeclares `.status-btn` properties** â€” Clean up the duplicate CSS.\n\n\n5. **Minor: Sort icon SVG inlined 4 times** â€” Extract to a helper or constant.\n\nNow I'm going through each fix. For the scroll handler, I need to swap out the cancel call with a commit instead, using `void` since it's async. For the drag preview, I'll replace the media query check with the actual theme state variable. Fixing the CSS issues is straightforwardâ€”removing the undefined class and consolidating the button styles. And for the SVG duplication, I'll pull that sort icon out into a reusable constant.\n\nExtracting the sort icon... I'm creating a helper function that generates the sort icon SVG dynamically based on direction, then using `{@html}` to render it in the template, though I'm running into issues with Svelte's scoping when using class attributes this way.\n\nInstead, I'll extract the path data as constants and render the SVG directly in the template so the scoped styles apply properly. Extracting the SVG attributes into constants...\n\nActually, the real issue is that the entire SVG element is duplicated four times across the code. I should create a reusable SortIcon component in Svelte to handle this properly. But waitâ€”the user asked me to fix the issues from the review, not refactor everything. Let me focus on the actual bugs: the scroll commit/discard problem, the isDark state inconsistency, removing unused CSS classes, and simplifying the button styles. The sort icon duplication is lower priority compared to these functional issues. For #5, the simplest approach in Svelte 4 without creating a new file is to use a `{#snippet}` - wait, that's Svelte 5. In Svelte 4 there's no snippet. We can create a helper string and use `{@html}` but that has the scoped CSS issue.\n\nThe cleanest approach without creating a new file would be to accept that the SVG is repeated 4 times but factor out just the `d` attribute values. But honestly, I think for this case, creating a simple `SortIcon.svelte` is the right call as the skill says to fix it.\n\nActually let me reconsider. The sort icon duplication is a *minor* issue. Let me keep it simple: I'll factor out the SVG markup with `{@html}` but move the `.sort-icon` style to `:global` to work around the scoping issue. I can use `{@html}` and apply the CSS via a global rule since sort icons are always inside `.col-button`. So I'll change `.sort-icon` to a global style and create a helper function that generates the SVG markup with the appropriate `d` attribute based on the sort direction.\n\nWriting SVG helper function... Extracting the path data constants...\n\nActually, I'm realizing the real issue is that the full SVG markup gets repeated four times, not just the paths. Using `{@html}` with global CSS would be cleaner, but I need to account for Svelte's scopingâ€”the hash added to scoped selectors won't apply to elements created via `{@html}`, so I'd need to make sure the `.sort-icon` styles are truly global or use `:global()` to bypass the scoping.\n\nMy approach is to create a helper function that returns the SVG as an HTML string, then render it with `{@html}` in each column header while using `:global(.sort-icon)` in the styles to ensure the icons are styled correctly without collision risk since they're always nested within the scoped `.col-button`.\n\nFor the scroll handler issue, I need to commit the rename instead of canceling it when scrolling, but since `commitRename` is async, I should handle that properly. Looking at the error handling, on failure it shows a toast and refocuses the input while the overlay stays fixed in placeâ€”which could feel disconnected if the table has scrolled. But weighing the UX tradeoffs, silently canceling on scroll might surprise the user by discarding their changes, while committing could also be unexpected, so the current behavior of letting them retry seems like the safer choice.\n\nActually, I'm reconsideringâ€”most file managers commit the rename when you click away, so committing on scroll would be more consistent. The user can always press Escape if they want to cancel. Let me switch to that approach.\n\nThere's a potential async issue though: when `commitRename()` is called from the scroll handler, the rename request runs asynchronously while scrolling continues. Once it succeeds and calls `cancelRename()`, that unmounts the textarea and triggers the blur handler again. But since `editing.active` is already false, the blur handler exits early, so there's no infinite loop.\n\nActually, I need to think through a race condition more carefully. The textarea has a blur handler that also calls `commitRename()`, so if both the scroll handler and blur fire while the rename is in flight, I could end up with concurrent calls to `commitRename()` that don't have any guard against simultaneous execution. of `commitRename` instead of `cancelRename`, I'd create a race condition where both the scroll handler and blur event could trigger concurrent rename calls. The current code avoids this because `cancelRename` clears the flag before blur can fire, but switching to `commitRename` would leave `editing.active` true during the await, allowing blur to sneak in and call it again.\n\nI need to add a guard flag to prevent `commitRename` from running concurrentlyâ€”something that tracks whether a rename is already in flight and bails out if one is. Adding this guard...\n\nActually, let me trace through the event sequence more carefully. When scroll fires and then blur fires, the scroll handler calls `commitRename()` which suspends at the async invoke. Meanwhile, the textarea stays in the DOM with focus until `cancelRename()` runs and sets `editing.active` to false, which triggers the DOM update that removes the textarea. By the time blur fires and calls `commitRename()` again, `editing.active` is already false, so it returns early. The double-commit might not actually happen in practice because the guard check catches it.\n\nThe real question is whether blur can fire while the invoke is still pending. During an async call, the event loop keeps running, so technically yesâ€”but in the scroll scenario, the textarea only loses focus if something else takes focus, which is unlikely while scrolling. So I'll go with the straightforward fix: change `cancelRename()` to call `commitRename()` instead.\n\nNow I'm mapping out all the fixes needed: the scroll handler should commit the rename, fix the isDark logic, remove the theme-btn class, clean up the rebuild-btn CSS, and handle sort icon deduplication. For the sort icons, I'm thinking the cleanest approach is to generate the SVG HTML dynamically in the script and use `:global` CSS to style it.\n\nGenerating sort icon markup... I'm refactoring the template to use a helper function instead of repeating the SVG markup four times, which is much cleaner. The `sortIconHtml` function generates the appropriate arrow path based on sort direction, and I'm using `{@html}` to render it. I should also scope the CSS class with `:global()` since it's being injected dynamically. There's a minor security consideration with `{@html}`, but since the function only uses controlled string constants from the application state, it's safe here.\n\nNow I need to go through and apply all the fixes systematicallyâ€”updating the theme detection logic, fixing the rename handler, removing the redundant theme class from the button, implementing the SVG refactor, and cleaning up the CSS.\n\nLooking at the style overlap, `.status-btn` already covers most of the base styling, so `.rebuild-btn` just needs to add its unique flexbox layout, alignment, gap, and font family while adjusting the font size down to 10px. Still writing styles... I need to walk through the rename flow when scroll triggers itâ€”`commitRename` runs async until the invoke call, and during that await the textarea keeps focus, then once it succeeds `cancelRename` clears the editing state and blurs the field. I'm realizing there's a potential race condition: if blur fires while the scroll-triggered `commitRename()` is suspended at the `await invoke()` step, the blur handler would call `commitRename()` again while `editing.active` is still true, causing it to also invoke the rename operation.\n\nI could add an in-progress flag to guard against this, but that introduces complexityâ€”especially since `cancelRename` would also need to reset it. Let me check what the original code already handles...\n\nactually, the existing `on:blur={commitRename}` was considered safe, and the only new risk is scroll triggering `commitRename` while the textarea still has focus. For blur to fire during the async rename, the user would need to actively click something else in those milliseconds, which is extremely unlikely. I'll skip the guard and keep it simple.\n\nNow I'm making the actual code changes...\n\nImplementing the modifications...\n\nI'm identifying the exact lines to change: updating the theme detection logic, modifying the rename cancellation behavior, removing the theme-btn class, and adding a helper function to generate sort icon SVG paths dynamically instead of hardcoding them inline. I'm realizing each column header only displays the sort icon when that column is the active sort target, and the icon direction depends on whether we're sorting ascending or descending. The `sortIconHtml` function is safe from XSS since the direction parameter is always constrained to `'asc'` or `'desc'`. Now I need to implement the function and update all four template locations where sort icons appear, then clean up the old `.rebuild-btn` styles. I see that `.rebuild-btn` has both `status-btn` and `rebuild-btn` classes, so I need to keep the overrides for `:hover` and `:disabled` since they differ from the base status button styles. The cleaned-up CSS will include the core styling properties along with these necessary state overrides.\n\nNow I'm looking at the sort icon template to identify exactly what needs to be replaced. Adding sort icons to table headers...","signature":"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"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":9,"cache_read_input_tokens":84467,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":9},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMP9iyody1DZrw8aFpBD","type":"assistant","uuid":"e89783a2-92c2-4dbb-bf7f-a40702511407","timestamp":"2026-02-21T14:38:52.124Z"}
{"parentUuid":"e89783a2-92c2-4dbb-bf7f-a40702511407","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01F4YofEMbREC4bdWvqKqqcN","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01DCwsS5ZdvffJSg7HhRJVRS","name":"TaskCreate","input":{"subject":"Fix all code review issues in App.svelte","description":"Fix 5 issues: 1) scroll discards rename â†’ commit instead, 2) drag preview uses OS theme â†’ use theme state, 3) remove unused .theme-btn class, 4) clean up duplicate .rebuild-btn CSS, 5) deduplicate sort icon SVG x4","activeForm":"Fixing code review issues"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":9,"cache_read_input_tokens":84467,"output_tokens":9553,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":9,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYMP9iyody1DZrw8aFpBD","type":"assistant","uuid":"64915270-5d88-4830-9d8d-44e86e76a692","timestamp":"2026-02-21T14:38:54.394Z"}
{"parentUuid":"64915270-5d88-4830-9d8d-44e86e76a692","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01DCwsS5ZdvffJSg7HhRJVRS","type":"tool_result","content":"Task #1 created successfully: Fix all code review issues in App.svelte"}]},"uuid":"00818609-4795-46d7-8429-d09377e82b61","timestamp":"2026-02-21T14:38:54.419Z","toolUseResult":{"task":{"id":"1","subject":"Fix all code review issues in App.svelte"}},"sourceToolAssistantUUID":"64915270-5d88-4830-9d8d-44e86e76a692"}
{"parentUuid":"00818609-4795-46d7-8429-d09377e82b61","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01WCyM4EoAww6SeEH17et5WV","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015ryKf18Y5dkubyykDSZRv4","name":"TaskUpdate","input":{"taskId":"1","status":"in_progress"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":9409,"cache_read_input_tokens":84476,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":9409},"output_tokens":26,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPL92hFKAqRYwniFcPN","type":"assistant","uuid":"d351b862-7a66-4b2b-8716-83ff1c0300dd","timestamp":"2026-02-21T14:38:56.515Z"}
{"parentUuid":"d351b862-7a66-4b2b-8716-83ff1c0300dd","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015ryKf18Y5dkubyykDSZRv4","type":"tool_result","content":"Updated task #1 status"}]},"uuid":"9896d7f1-938a-42b2-bcbf-a1cee7b3cf6e","timestamp":"2026-02-21T14:38:56.519Z","toolUseResult":{"success":true,"taskId":"1","updatedFields":["status"],"statusChange":{"from":"pending","to":"in_progress"}},"sourceToolAssistantUUID":"d351b862-7a66-4b2b-8716-83ff1c0300dd"}
{"parentUuid":"9896d7f1-938a-42b2-bcbf-a1cee7b3cf6e","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01KA9CXRhQgszmyHmWw1mcCt","type":"message","role":"assistant","content":[{"type":"text","text":"5ê°€ì§€ ì´ìŠˆë¥¼ ë™ì‹œì— ìˆ˜ì •í•©ë‹ˆë‹¤."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":90,"cache_read_input_tokens":93885,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":90},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPLJC75uE1NgJrrYTwK","type":"assistant","uuid":"3eabc1a1-7dce-4582-b1fb-8fea6da42009","timestamp":"2026-02-21T14:38:58.918Z"}
{"parentUuid":"3eabc1a1-7dce-4582-b1fb-8fea6da42009","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01KA9CXRhQgszmyHmWw1mcCt","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01XReSSi69dvd7gMNj291x6R","name":"Edit","input":{"replace_all":false,"file_path":"/Users/al02402336/everything/src/App.svelte","old_string":"    const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;","new_string":"    const isDark = theme === 'dark';"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":90,"cache_read_input_tokens":93885,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":90},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPLJC75uE1NgJrrYTwK","type":"assistant","uuid":"c4df8436-5711-4ed6-b1a1-9f7cf57ff642","timestamp":"2026-02-21T14:39:00.494Z"}
{"parentUuid":"c4df8436-5711-4ed6-b1a1-9f7cf57ff642","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>File has been modified since read, either by the user or by a linter. Read it again before attempting to write it.</tool_use_error>","is_error":true,"tool_use_id":"toolu_01XReSSi69dvd7gMNj291x6R"}]},"uuid":"16917a90-25ea-4dfc-aeac-9319cfe4f0e7","timestamp":"2026-02-21T14:39:00.494Z","toolUseResult":"Error: File has been modified since read, either by the user or by a linter. Read it again before attempting to write it.","sourceToolAssistantUUID":"c4df8436-5711-4ed6-b1a1-9f7cf57ff642"}
{"parentUuid":"16917a90-25ea-4dfc-aeac-9319cfe4f0e7","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01TkLeRrz2LhrV7tY46Zunrq","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UZbCNPwhnkZFev7rH8Gq8X","name":"Read","input":{"file_path":"/Users/al02402336/everything/src/App.svelte","offset":670,"limit":10},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":233,"cache_read_input_tokens":93975,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":233},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPLb4rvnaMJfW7e4aG8","type":"assistant","uuid":"db79cd21-158c-4353-b209-6722c9967736","timestamp":"2026-02-21T14:39:02.780Z"}
{"parentUuid":"db79cd21-158c-4353-b209-6722c9967736","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01UZbCNPwhnkZFev7rH8Gq8X","toolUseID":"toolu_01UZbCNPwhnkZFev7rH8Gq8X","timestamp":"2026-02-21T14:39:02.788Z","uuid":"ba1ce53e-8373-4367-84d2-50dd2aad0036"}
{"parentUuid":"db79cd21-158c-4353-b209-6722c9967736","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01UZbCNPwhnkZFev7rH8Gq8X","type":"tool_result","content":"   670â†’  }\n   671â†’\n   672â†’  function buildDragPreview(index) {\n   673â†’    const entry = results[index];\n   674â†’    if (!entry) return null;\n   675â†’\n   676â†’    const count = selectedIndices.has(index) ? selectedIndices.size : 1;\n   677â†’    const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;\n   678â†’\n   679â†’    const w = 260;\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"ef9fcb33-d8f9-4ccc-897e-38bbefbc0890","timestamp":"2026-02-21T14:39:02.787Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/al02402336/everything/src/App.svelte","content":"  }\n\n  function buildDragPreview(index) {\n    const entry = results[index];\n    if (!entry) return null;\n\n    const count = selectedIndices.has(index) ? selectedIndices.size : 1;\n    const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;\n\n    const w = 260;","numLines":10,"startLine":670,"totalLines":2277}},"sourceToolAssistantUUID":"db79cd21-158c-4353-b209-6722c9967736"}
{"type":"file-history-snapshot","messageId":"8baef013-3843-4882-98e8-e431ade589d2","snapshot":{"messageId":"1328a288-d2f6-4263-8570-b556ad230dfd","trackedFileBackups":{"src/App.svelte":{"backupFileName":"f2ffc3f5647f6015@v1","version":1,"backupTime":"2026-02-21T14:39:05.714Z"}},"timestamp":"2026-02-21T14:36:33.132Z"},"isSnapshotUpdate":true}
{"parentUuid":"ef9fcb33-d8f9-4ccc-897e-38bbefbc0890","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_019vz8jaPModkNamtL2ij44E","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01NiJg1beLNcWdzC9VjfbAvs","name":"Edit","input":{"replace_all":false,"file_path":"/Users/al02402336/everything/src/App.svelte","old_string":"    const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;","new_string":"    const isDark = theme === 'dark';"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":314,"cache_read_input_tokens":94208,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":314},"output_tokens":24,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPLmjoeNFvQGNbycgZy","type":"assistant","uuid":"8baef013-3843-4882-98e8-e431ade589d2","timestamp":"2026-02-21T14:39:05.710Z"}
{"parentUuid":"8baef013-3843-4882-98e8-e431ade589d2","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01NiJg1beLNcWdzC9VjfbAvs","toolUseID":"toolu_01NiJg1beLNcWdzC9VjfbAvs","timestamp":"2026-02-21T14:39:05.719Z","uuid":"096d169e-0d0f-49e5-afb7-021d45bad937"}
{"parentUuid":"8baef013-3843-4882-98e8-e431ade589d2","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01NiJg1beLNcWdzC9VjfbAvs","type":"tool_result","content":"The file /Users/al02402336/everything/src/App.svelte has been updated successfully."}]},"uuid":"b8fc5a41-c56a-4165-8a4e-7c9bab901911","timestamp":"2026-02-21T14:39:05.718Z","toolUseResult":{"filePath":"/Users/al02402336/everything/src/App.svelte","oldString":"    const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;","newString":"    const isDark = theme === 'dark';","originalFile":"<script>\n  import { onDestroy, onMount, tick } from 'svelte';\n  import { invoke } from '@tauri-apps/api/core';\n  import { listen } from '@tauri-apps/api/event';\n  import { getCurrentWindow } from '@tauri-apps/api/window';\n  import { startDrag } from '@crabnebula/tauri-plugin-drag';\n\n  const rowHeight = 30;\n  const PAGE_SIZE = 500;\n  let homePrefix = '';\n  const COL_WIDTHS_KEY = 'REDACTED';\n  const THEME_KEY = 'everything-theme';\n  const columnKeys = ['name', 'path', 'size', 'modified'];\n  const minColumnWidth = {\n    name: 180,\n    path: 240,\n    size: 75,\n    modified: 150\n  };\n  const defaultColumnRatios = {\n    name: 0.3,\n    path: 0.45,\n    size: 0.1\n  };\n\n  const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n  let theme = (() => { try { return localStorage.getItem(THEME_KEY) || systemTheme; } catch { return systemTheme; } })();\n  function cycleTheme() {\n    theme = theme === 'dark' ? 'light' : 'dark';\n    try { localStorage.setItem(THEME_KEY, theme); } catch {}\n    invoke('set_native_theme', { theme });\n  }\n\n  let query = '';\n  let results = [];\n  let totalResults = 0;\n  let totalResultsKnown = false;\n\n  let dbLatencyMs = null;\n  let dbLastQuery = '';\n  let searchModeLabel = '';\n  let selectedIndices = new Set();\n  let selectionAnchor = -1;\n  let lastSelectedIndex = -1;\n  let editing = {\n    active: false,\n    path: '',\n    index: -1,\n    draftName: ''\n  };\n\n  let renameOverlay = { top: 0, left: 0, width: 0 };\n\n  let indexStatus = {\n    state: 'Indexing',\n    entriesCount: 0,\n    lastUpdated: null,\n    permissionErrors: 0,\n    message: null,\n    isCatchup: false\n  };\n\n  let indexingStartTime = null;\n  let indexingElapsed = '';\n  let indexingFinishedAt = '';\n\n  let sortBy = 'name';\n  let sortDir = 'asc';\n\n  let hasMore = true;\n  let loadingMore = false;\n  let searchGeneration = 0;\n\n  let scanned = 0;\n\n  let searchInputEl;\n  let renameInputEl;\n  let tableAreaEl;\n  let tableContainer;\n  let tableResizeObserver = null;\n  let viewportResizeRaf = null;\n  let scrollTop = 0;\n  let headerScrollLeft = 0;\n  let viewportHeight = 520;\n  let lastTableWidth = 0;\n  let resizingColumn = '';\n  let resizeCleanup = null;\n  let colWidths = {\n    name: 250,\n    path: 350,\n    size: 75,\n    modified: 150\n  };\n\n  let contextMenu = {\n    visible: false,\n    x: 0,\n    y: 0\n  };\n\n  let platform = '';\n  let toast = '';\n  let searchTimer;\n  let lastSearchFiredAt = 0;\n  let toastTimer;\n  let statusRefreshTimer;\n  let elapsedTimer;\n  let statusRefreshInFlight = false;\n  let lastReadyCount = 0;\n\n  const iconCache = new Map();\n  const iconLoading = new Set();\n\n  let highlightCache = new Map();\n  let highlightCacheQuery = '';\n\n  const folderFallbackIcon =\n    \"data:image/svg+xml;utf8,\" +\n    encodeURIComponent(\n      `<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><rect x='1' y='4' width='14' height='10' rx='2' fill='#d9b34f'/><rect x='1' y='2' width='6' height='4' rx='1' fill='#e6ca7a'/></svg>`\n    );\n  const fileFallbackIcon =\n    \"data:image/svg+xml;utf8,\" +\n    encodeURIComponent(\n      `<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><rect x='3' y='1' width='10' height='14' rx='1.5' fill='#b4bec9'/><rect x='5' y='5' width='6' height='1.2' fill='#8d98a5'/><rect x='5' y='8' width='6' height='1.2' fill='#8d98a5'/></svg>`\n    );\n\n  $: totalHeight = results.length * rowHeight;\n  $: startIndex = Math.max(0, Math.floor(scrollTop / rowHeight) - 10);\n  $: visibleCount = Math.ceil(viewportHeight / rowHeight) + 20;\n  $: endIndex = Math.min(results.length, startIndex + visibleCount);\n  $: visibleRows = results.slice(startIndex, endIndex);\n  $: translateY = startIndex * rowHeight;\n  $: tableMinWidth = colWidths.name + colWidths.path + colWidths.size + colWidths.modified;\n  $: tableGridStyle = `--col-name:${colWidths.name}px;--col-path:${colWidths.path}px;--col-size:${colWidths.size}px;--col-modified:${colWidths.modified}px;--table-min-width:${tableMinWidth}px;--header-offset:${-headerScrollLeft}px;`;\n\n  $: {\n    for (const entry of visibleRows) {\n      void ensureIcon(entry);\n    }\n  }\n\n  function showToast(message) {\n    toast = message;\n    clearTimeout(toastTimer);\n    toastTimer = setTimeout(() => {\n      toast = '';\n    }, 3000);\n  }\n\n  function bytesToBase64(bytes) {\n    let binary = '';\n    const chunk = 0x8000;\n    for (let i = 0; i < bytes.length; i += chunk) {\n      const part = bytes.subarray(i, i + chunk);\n      binary += String.fromCharCode(...part);\n    }\n    return btoa(binary);\n  }\n\n  function highlightSegments(name, q) {\n    q = (q || '').trim();\n    if (!q) return [{ text: name, hl: false }];\n\n    // Reset cache when query changes\n    if (q !== highlightCacheQuery) {\n      highlightCache = new Map();\n      highlightCacheQuery = q;\n    }\n\n    // Check cache\n    const cached = highlightCache.get(name);\n    if (cached) return cached;\n\n    if (q.includes('/')) q = q.slice(q.lastIndexOf('/') + 1);\n    q = q.replace(/[*?]/g, '');\n    const terms = q.split(/\\s+/).filter(Boolean);\n    if (terms.length === 0) return [{ text: name, hl: false }];\n\n    const lower = name.toLowerCase();\n    const marks = new Uint8Array(name.length);\n    for (const t of terms) {\n      const tl = t.toLowerCase();\n      let idx = lower.indexOf(tl);\n      while (idx !== -1) {\n        for (let i = idx; i < idx + tl.length; i++) marks[i] = 1;\n        idx = lower.indexOf(tl, idx + 1);\n      }\n    }\n\n    const segs = [];\n    let i = 0;\n    while (i < name.length) {\n      const m = marks[i];\n      let j = i + 1;\n      while (j < name.length && marks[j] === m) j++;\n      segs.push({ text: name.slice(i, j), hl: m === 1 });\n      i = j;\n    }\n\n    highlightCache.set(name, segs);\n    return segs;\n  }\n\n  const perFileIconExts = new Set(['exe', 'lnk', 'ico', 'url', 'scr', 'appx']);\n\n  function iconKey(entry) {\n    if (entry.isDir) return '__folder__';\n    const ext = (entry.ext || '').toLowerCase();\n    if (perFileIconExts.has(ext)) return entry.path;\n    return ext || '__file__';\n  }\n\n  function iconFor(entry) {\n    return iconCache.get(iconKey(entry)) || (entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n  }\n\n  async function ensureIcon(entry) {\n    const key = iconKey(entry);\n    if (iconCache.has(key) || iconLoading.has(key)) {\n      return;\n    }\n\n    iconLoading.add(key);\n    try {\n      const bytes = await invoke('get_file_icon', {\n        path: entry.path,\n        ext: entry.isDir ? 'folder' : entry.ext || '',\n      });\n      if (Array.isArray(bytes) && bytes.length > 0) {\n        const image = `data:image/png;base64,${bytesToBase64(Uint8Array.from(bytes))}`;\n        iconCache.set(key, image);\n      } else {\n        iconCache.set(key, entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n      }\n    } catch {\n      iconCache.set(key, entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n    } finally {\n      iconLoading.delete(key);\n    }\n  }\n\n  function syncColumnWidthsToContainer() {\n    const width = tableContainer?.clientWidth || tableAreaEl?.clientWidth;\n    if (!width || lastTableWidth !== 0) {\n      return;\n    }\n\n    const saved = loadColWidths();\n    if (saved) {\n      const total = columnKeys.reduce((s, k) => s + saved[k], 0);\n      if (Math.abs(total - width) > 2) {\n        const scale = (width - saved.modified) / (total - saved.modified);\n        let scaledName = Math.max(minColumnWidth.name, Math.round(saved.name * scale));\n        let scaledSize = Math.max(minColumnWidth.size, Math.round(saved.size * scale));\n        let rawPath = width - saved.modified - scaledName - scaledSize;\n        if (rawPath < minColumnWidth.path) {\n          const shortfall = minColumnWidth.path - rawPath;\n          const nameReduction = Math.min(shortfall, scaledName - minColumnWidth.name);\n          scaledName -= nameReduction;\n          const remaining = shortfall - nameReduction;\n          if (remaining > 0) {\n            scaledSize -= Math.min(remaining, scaledSize - minColumnWidth.size);\n          }\n          rawPath = width - saved.modified - scaledName - scaledSize;\n        }\n        const scaledPath = Math.max(minColumnWidth.path, rawPath);\n        colWidths = { name: scaledName, path: scaledPath, size: scaledSize, modified: saved.modified };\n      } else {\n        colWidths = saved;\n      }\n    } else {\n      const fixedModified = minColumnWidth.modified;\n      const rest = width - fixedModified;\n      const ratioSum = defaultColumnRatios.name + defaultColumnRatios.path + defaultColumnRatios.size;\n      colWidths = {\n        name: Math.max(minColumnWidth.name, Math.round(rest * defaultColumnRatios.name / ratioSum)),\n        path: Math.max(minColumnWidth.path, Math.round(rest * defaultColumnRatios.path / ratioSum)),\n        size: Math.max(minColumnWidth.size, Math.round(rest * defaultColumnRatios.size / ratioSum)),\n        modified: fixedModified\n      };\n    }\n    lastTableWidth = width;\n  }\n\n  function loadColWidths() {\n    try {\n      const raw = localStorage.getItem(COL_WIDTHS_KEY);\n      if (!raw) return null;\n      const parsed = JSON.parse(raw);\n      for (const key of columnKeys) {\n        if (typeof parsed[key] !== 'number' || parsed[key] < (minColumnWidth[key] || 0)) return null;\n      }\n      return parsed;\n    } catch {\n      return null;\n    }\n  }\n\n  function saveColWidths() {\n    localStorage.setItem(COL_WIDTHS_KEY, JSON.stringify(colWidths));\n  }\n\n  function updateViewportHeight() {\n    viewportHeight = tableContainer?.clientHeight || 520;\n    syncColumnWidthsToContainer();\n  }\n\n  function scheduleViewportHeightUpdate() {\n    if (viewportResizeRaf !== null) {\n      return;\n    }\n    viewportResizeRaf = requestAnimationFrame(() => {\n      viewportResizeRaf = null;\n      updateViewportHeight();\n    });\n  }\n\n  function startColumnResize(event, leftKey) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    const index = columnKeys.indexOf(leftKey);\n    if (index < 0 || index >= columnKeys.length - 1) {\n      return;\n    }\n\n    const startX = event.clientX;\n    const startLeft = colWidths[leftKey];\n    const rightKey = columnKeys[index + 1];\n    const startRight = colWidths[rightKey];\n\n    resizeCleanup?.();\n    resizingColumn = leftKey;\n\n    const onMove = (moveEvent) => {\n      const delta = Math.round(moveEvent.clientX - startX);\n      if (leftKey === 'name') {\n        // Two-column trade: name and path swap space, each respects its minimum\n        const nextLeft = Math.max(\n          minColumnWidth[leftKey],\n          Math.min(startLeft + delta, startLeft + startRight - minColumnWidth[rightKey])\n        );\n        const nextRight = startLeft + startRight - nextLeft;\n        colWidths = { ...colWidths, [leftKey]: nextLeft, [rightKey]: nextRight };\n      } else {\n        // path splitter: path grows unconstrained (allows horizontal scroll on right drag)\n        const nextLeft = Math.max(minColumnWidth[leftKey], startLeft + delta);\n        colWidths = { ...colWidths, [leftKey]: nextLeft };\n      }\n    };\n\n    const onUp = () => {\n      cleanup();\n    };\n\n    const cleanup = () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n      document.body.style.cursor = '';\n      document.body.style.userSelect = '';\n      resizingColumn = '';\n      saveColWidths();\n      if (resizeCleanup === cleanup) {\n        resizeCleanup = null;\n      }\n    };\n\n    resizeCleanup = cleanup;\n    document.body.style.cursor = 'col-resize';\n    document.body.style.userSelect = 'none';\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n  }\n\n  function selectedPaths() {\n    const sorted = [...selectedIndices].sort((a, b) => a - b);\n    return sorted.map((idx) => results[idx]).filter(Boolean).map((entry) => entry.path);\n  }\n\n  function clearSelection() {\n    selectedIndices = new Set();\n    selectionAnchor = -1;\n    lastSelectedIndex = -1;\n  }\n\n  function selectSingle(index) {\n    selectedIndices = new Set([index]);\n    selectionAnchor = index;\n    lastSelectedIndex = index;\n  }\n\n  function selectToggle(index) {\n    const next = new Set(selectedIndices);\n    if (next.has(index)) {\n      next.delete(index);\n    } else {\n      next.add(index);\n    }\n    selectedIndices = next;\n    selectionAnchor = index;\n    lastSelectedIndex = index;\n  }\n\n  function selectRange(index) {\n    const anchor = selectionAnchor >= 0 ? selectionAnchor : index;\n    const [from, to] = [Math.min(anchor, index), Math.max(anchor, index)];\n    const next = new Set();\n    for (let i = from; i <= to; i += 1) {\n      next.add(i);\n    }\n    selectedIndices = next;\n    lastSelectedIndex = index;\n  }\n\n  function primaryEntry() {\n    const idx = lastSelectedIndex >= 0 ? lastSelectedIndex : -1;\n    return idx >= 0 ? results[idx] : null;\n  }\n\n  async function refreshStatus() {\n    if (statusRefreshInFlight) {\n      return;\n    }\n    statusRefreshInFlight = true;\n    try {\n      const status = await invoke('get_index_status');\n      const prevState = indexStatus.state;\n      indexStatus = {\n        state: status.state,\n        entriesCount: status.entriesCount,\n        lastUpdated: status.lastUpdated,\n        permissionErrors: status.permissionErrors ?? 0,\n        message: status.message\n      };\n      if (status.state === 'Indexing' && prevState !== 'Indexing') {\n        startElapsedTimer();\n      } else if (status.state !== 'Indexing' && prevState === 'Indexing') {\n        stopElapsedTimer();\n      }\n      if (typeof status.scanned === 'number') {\n        scanned = status.scanned;\n      }\n      if (status.state === 'Ready' && prevState !== 'Ready') {\n        scheduleSearch();\n      }\n    } catch (err) {\n      showToast(`Failed to get status: ${String(err)}`);\n    } finally {\n      statusRefreshInFlight = false;\n    }\n  }\n\n  function scheduleSearch(preserveScroll = false) {\n    searchGeneration += 1;\n    const scheduledGen = searchGeneration;\n    clearTimeout(searchTimer);\n\n    const now = performance.now();\n    if (now - lastSearchFiredAt >= 200) {\n      // Leading edge: fire immediately if enough time has passed\n      lastSearchFiredAt = now;\n      void runSearch(preserveScroll);\n    } else {\n      // Trailing edge: debounce\n      searchTimer = setTimeout(() => {\n        if (scheduledGen !== searchGeneration) {\n          return;\n        }\n        lastSearchFiredAt = performance.now();\n        void runSearch(preserveScroll);\n      }, 200);\n    }\n  }\n\n  async function runSearch(preserveScroll = false) {\n    searchGeneration += 1;\n    const gen = searchGeneration;\n    const searchQuery = query;\n    const searchSortBy = sortBy;\n    const searchSortDir = sortDir;\n    const startedAt = performance.now();\n    try {\n      const keepPaths = new Set(selectedPaths());\n      const next = await invoke('search', {\n        query: searchQuery,\n        limit: PAGE_SIZE,\n        offset: 0,\n        sortBy: searchSortBy,\n        sortDir: searchSortDir\n      });\n\n      if (gen !== searchGeneration) return;\n\n      dbLatencyMs = Math.round(performance.now() - startedAt);\n      dbLastQuery = searchQuery;\n      const entries = Array.isArray(next.entries) ? next.entries : [];\n      searchModeLabel = next.modeLabel || '';\n      results = entries;\n      if (next.totalCount > 0) {\n        totalResults = next.totalCount;\n        totalResultsKnown = true;\n      } else {\n        totalResults = entries.length;\n        totalResultsKnown = false;\n      }\n      hasMore = totalResultsKnown ? results.length < totalResults : entries.length >= PAGE_SIZE;\n      if (!preserveScroll && tableContainer) tableContainer.scrollTop = 0;\n\n      const restored = new Set();\n      for (let i = 0; i < results.length; i += 1) {\n        if (keepPaths.has(results[i].path)) {\n          restored.add(i);\n        }\n      }\n      selectedIndices = restored;\n\n      updateViewportHeight();\n    } catch (err) {\n      if (gen !== searchGeneration) return;\n      showToast(`Search failed: ${String(err)}`);\n    }\n  }\n\n  async function loadMore() {\n    if (!hasMore || loadingMore) return;\n    const gen = searchGeneration;\n    loadingMore = true;\n    try {\n      const batch = await invoke('search', {\n        query,\n        limit: PAGE_SIZE,\n        offset: results.length,\n        sortBy: sortBy,\n        sortDir: sortDir\n      });\n      if (gen !== searchGeneration) return;\n      const arr = Array.isArray(batch.entries) ? batch.entries : [];\n      if (arr.length > 0) results = [...results, ...arr];\n      hasMore = totalResultsKnown ? results.length < totalResults : arr.length >= PAGE_SIZE;\n    } catch (err) {\n      showToast(`Failed to load more: ${String(err)}`);\n    } finally {\n      loadingMore = false;\n    }\n  }\n\n  function moveSelection(delta, withRange = false) {\n    if (results.length === 0) {\n      return;\n    }\n\n    const current = lastSelectedIndex >= 0 ? lastSelectedIndex : 0;\n    const next = Math.max(0, Math.min(results.length - 1, current + delta));\n\n    if (withRange) {\n      selectRange(next);\n    } else {\n      selectSingle(next);\n    }\n\n    const top = next * rowHeight;\n    const bottom = top + rowHeight;\n    if (top < scrollTop) {\n      tableContainer.scrollTop = top;\n    } else if (bottom > scrollTop + viewportHeight) {\n      tableContainer.scrollTop = bottom - viewportHeight;\n    }\n  }\n\n  function handleHeaderSort(column) {\n    if (sortBy === column) {\n      sortDir = sortDir === 'asc' ? 'desc' : 'asc';\n    } else {\n      sortBy = column;\n      sortDir = 'asc';\n    }\n    if (tableContainer) tableContainer.scrollTop = 0;\n    void runSearch();\n  }\n\n  function handleRowClick(event, index) {\n    contextMenu.visible = false;\n\n    if (event.shiftKey) {\n      selectRange(index);\n      return;\n    }\n\n    if (event.metaKey || event.ctrlKey) {\n      selectToggle(index);\n      return;\n    }\n\n    selectSingle(index);\n  }\n\n  function handleRowContextMenu(event, index) {\n    event.preventDefault();\n\n    if (!selectedIndices.has(index)) {\n      selectSingle(index);\n    }\n\n    if (platform === 'windows' || platform === 'macos') {\n      contextMenu.visible = false;\n      const paths = selectedPaths();\n      if (paths.length > 0) {\n        invoke('show_context_menu', {\n          paths,\n          x: event.clientX,\n          y: event.clientY,\n          singleSelection: selectedIndices.size === 1\n        });\n      }\n      return;\n    }\n\n    contextMenu = {\n      visible: true,\n      x: event.clientX,\n      y: event.clientY\n    };\n  }\n\n  function handleRowA11yKeydown(event, index) {\n    if (event.key === ' ' || event.key === 'Enter') {\n      event.preventDefault();\n      handleRowClick(event, index);\n    }\n  }\n\n  const DRAG_THRESHOLD = 5;\n  let dragCleanup = null;\n  const dragImgCache = new Map();\n\n  function dragPathsForIndex(index) {\n    const entry = results[index];\n    if (!entry) {\n      return [];\n    }\n\n    if (selectedIndices.has(index) && selectedIndices.size > 0) {\n      return selectedPaths();\n    }\n\n    return [entry.path];\n  }\n\n  function getDragIconEl(entry) {\n    const src = iconFor(entry);\n    let img = dragImgCache.get(src);\n    if (!img) {\n      img = new Image();\n      img.src = src;\n      dragImgCache.set(src, img);\n    }\n    return img.complete && img.naturalWidth > 0 ? img : null;\n  }\n\n  function fillRoundRect(ctx, x, y, w, h, r) {\n    ctx.beginPath();\n    ctx.moveTo(x + r, y);\n    ctx.arcTo(x + w, y, x + w, y + h, r);\n    ctx.arcTo(x + w, y + h, x, y + h, r);\n    ctx.arcTo(x, y + h, x, y, r);\n    ctx.arcTo(x, y, x + w, y, r);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  function buildDragPreview(index) {\n    const entry = results[index];\n    if (!entry) return null;\n\n    const count = selectedIndices.has(index) ? selectedIndices.size : 1;\n    const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;\n\n    const w = 260;\n    const h = 28;\n    const stackGap = count > 1 ? 4 : 0;\n\n    const canvas = document.createElement('canvas');\n    canvas.width = w;\n    canvas.height = h + stackGap;\n    const ctx = canvas.getContext('2d');\n\n    if (count > 1) {\n      ctx.globalAlpha = 0.35;\n      ctx.fillStyle = isDark ? '#5a6070' : '#b0c4de';\n      fillRoundRect(ctx, 3, 0, w - 3, h, 5);\n      ctx.globalAlpha = 1.0;\n    }\n\n    const ry = stackGap;\n    ctx.fillStyle = isDark ? 'rgba(58, 64, 74, 0.94)' : 'rgba(214, 231, 255, 0.94)';\n    fillRoundRect(ctx, 0, ry, w, h, 5);\n\n    ctx.strokeStyle = isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';\n    ctx.lineWidth = 0.5;\n    ctx.beginPath();\n    ctx.moveTo(5, ry);\n    ctx.arcTo(w, ry, w, ry + h, 5);\n    ctx.arcTo(w, ry + h, 0, ry + h, 5);\n    ctx.arcTo(0, ry + h, 0, ry, 5);\n    ctx.arcTo(0, ry, w, ry, 5);\n    ctx.closePath();\n    ctx.stroke();\n\n    const iconEl = getDragIconEl(entry);\n    if (iconEl) {\n      ctx.drawImage(iconEl, 6, ry + 6, 16, 16);\n    } else {\n      ctx.fillStyle = entry.isDir ? '#d9b34f' : '#8d98a5';\n      fillRoundRect(ctx, 6, ry + 6, 16, 16, 2);\n    }\n\n    ctx.fillStyle = isDark ? '#e6e6e8' : '#1a1a1a';\n    ctx.font = '12px -apple-system, \"SF Pro Text\", system-ui, sans-serif';\n    ctx.textBaseline = 'middle';\n\n    let nameMaxW = w - 34;\n    if (count > 1) nameMaxW -= 34;\n\n    let name = entry.name;\n    if (ctx.measureText(name).width > nameMaxW) {\n      while (name.length > 4 && ctx.measureText(name + '\\u2026').width > nameMaxW) {\n        name = name.slice(0, -1);\n      }\n      name += '\\u2026';\n    }\n    ctx.fillText(name, 28, ry + h / 2 + 1);\n\n    if (count > 1) {\n      const badge = String(count);\n      ctx.font = 'bold 10px -apple-system, system-ui, sans-serif';\n      const tw = ctx.measureText(badge).width;\n      const bw = Math.max(20, tw + 10);\n      const bx = w - bw - 6;\n      const by = ry + (h - 18) / 2;\n\n      ctx.fillStyle = isDark ? '#5b8bd9' : '#007aff';\n      fillRoundRect(ctx, bx, by, bw, 18, 9);\n\n      ctx.fillStyle = '#ffffff';\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(badge, bx + bw / 2, by + 9);\n    }\n\n    return canvas.toDataURL('image/png');\n  }\n\n  function handleRowMouseDown(event, index) {\n    if (event.button !== 0) return;\n    if (event.metaKey || event.ctrlKey || event.shiftKey) return;\n    if (editing.active) return;\n\n    const startX = event.clientX;\n    const startY = event.clientY;\n    let dragging = false;\n\n    dragCleanup?.();\n\n    const onMove = (e) => {\n      if (dragging) return;\n      const dx = e.clientX - startX;\n      const dy = e.clientY - startY;\n      if (dx * dx + dy * dy < DRAG_THRESHOLD * DRAG_THRESHOLD) return;\n\n      dragging = true;\n      cleanup();\n\n      if (!selectedIndices.has(index)) {\n        selectSingle(index);\n      }\n\n      const paths = dragPathsForIndex(index);\n      if (paths.length > 0) {\n        const icon = buildDragPreview(index);\n        startDrag({ item: paths, icon }).catch(() => {});\n      }\n    };\n\n    const onUp = () => cleanup();\n\n    const cleanup = () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n      if (dragCleanup === cleanup) dragCleanup = null;\n    };\n\n    dragCleanup = cleanup;\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n  }\n\n  async function handleRowDoubleClick(index) {\n    if (!selectedIndices.has(index) || selectedIndices.size > 1) {\n      selectSingle(index);\n      await tick();\n    }\n    await invoke('open', { paths: [results[index].path] }).catch((err) => {\n      showToast(`Failed to open: ${String(err)}`);\n    });\n  }\n\n  function closeContextMenu() {\n    contextMenu = {\n      ...contextMenu,\n      visible: false\n    };\n  }\n\n  async function openSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('open', { paths });\n    } catch (err) {\n      showToast(`Failed to open: ${String(err)}`);\n    }\n  }\n\n  async function openWithFallback() {\n    const target = primaryEntry();\n    if (!target) {\n      return;\n    }\n\n    try {\n      await invoke('open_with', { path: target.path });\n    } catch (err) {\n      showToast(`Open With failed: ${String(err)}`);\n    }\n  }\n\n  async function revealSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('reveal_in_finder', { paths });\n    } catch (err) {\n      showToast(`Failed to reveal in Finder: ${String(err)}`);\n    }\n  }\n\n  async function copySelectedPaths() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('copy_paths', { paths });\n      showToast(`Copied ${paths.length} path(s)`);\n    } catch (err) {\n      showToast(`Failed to copy path: ${String(err)}`);\n    }\n  }\n\n  async function copyFiles() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('copy_files', { paths });\n      showToast(`Copied ${paths.length} item(s)`);\n    } catch (err) {\n      showToast(`Failed to copy: ${String(err)}`);\n    }\n  }\n\n  async function trashSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    const message =\n      paths.length === 1\n        ? 'Move selected item to Trash?'\n        : `Move ${paths.length} items to Trash?`;\n\n    if (!window.confirm(message)) {\n      return;\n    }\n\n    try {\n      await invoke('move_to_trash', { paths });\n      showToast('Moved to Trash.');\n      clearSelection();\n      await runSearch();\n    } catch (err) {\n      showToast(`Failed to move to Trash: ${String(err)}`);\n    }\n  }\n\n  async function resetIndex() {\n    if (indexStatus.state === 'Indexing') {\n      showToast('Indexing in progress. Please try again after it completes.');\n      return;\n    }\n\n    results = [];\n    totalResults = 0;\n    totalResultsKnown = false;\n    clearSelection();\n    scanned = 0;\n    dbLatencyMs = null;\n    dbLastQuery = '';\n    indexStatus = { ...indexStatus, state: 'Indexing', entriesCount: 0, message: null };\n    indexingStartTime = Date.now();\n    indexingElapsed = '';\n    indexingFinishedAt = '';\n\n    try {\n      await invoke('reset_index');\n    } catch (err) {\n      showToast(`Failed to reset index: ${String(err)}`);\n      await refreshStatus();\n    }\n  }\n\n  function isMultiSelected() {\n    return selectedIndices.size > 1;\n  }\n\n  function autoResizeRenameInput() {\n    if (!renameInputEl) return;\n    renameInputEl.style.height = '0';\n    renameInputEl.style.height = renameInputEl.scrollHeight + 'px';\n  }\n\n  async function startRename() {\n    if (isMultiSelected()) {\n      return;\n    }\n\n    const idx = lastSelectedIndex;\n    if (idx < 0 || !results[idx]) {\n      return;\n    }\n\n    const entry = results[idx];\n\n    // Calculate overlay position mathematically.\n    // Name cell text starts at: padding-left(16) + icon(16) + gap(6) = 38px from cell left.\n    // Textarea has padding-left: 0 and border: 1.5px, so text starts ~2px from overlay left.\n    if (tableContainer) {\n      const rect = tableContainer.getBoundingClientRect();\n      const cellLeft = rect.left - tableContainer.scrollLeft;\n      const textLeft = cellLeft + 38;\n      const cellRight = cellLeft + colWidths.name;\n      const rowTop = rect.top + idx * rowHeight - tableContainer.scrollTop;\n      renameOverlay = {\n        top: rowTop,\n        left: textLeft - 2,\n        width: cellRight - textLeft + 2 - 4\n      };\n    }\n\n    editing = {\n      active: true,\n      path: entry.path,\n      index: idx,\n      draftName: entry.name\n    };\n\n    await tick();\n\n    if (renameInputEl) {\n      autoResizeRenameInput();\n      renameInputEl.focus();\n      const extPos = !entry.isDir ? entry.name.lastIndexOf('.') : -1;\n      const selectionEnd = extPos > 0 ? extPos : entry.name.length;\n      renameInputEl.setSelectionRange(0, selectionEnd);\n    }\n  }\n\n  function cancelRename() {\n    editing = {\n      active: false,\n      path: '',\n      index: -1,\n      draftName: ''\n    };\n  }\n\n  async function commitRename() {\n    if (!editing.active || editing.index < 0 || !results[editing.index]) {\n      return;\n    }\n\n    const current = results[editing.index];\n    const nextName = editing.draftName;\n\n    try {\n      await invoke('rename', {\n        path: current.path,\n        newName: nextName\n      });\n      cancelRename();\n      await runSearch();\n    } catch (err) {\n      showToast(`Failed to rename: ${String(err)}`);\n      await tick();\n      renameInputEl?.focus();\n    }\n  }\n\n  function onGlobalClick() {\n    closeContextMenu();\n  }\n\n  function onTitleBarMouseDown(event) {\n    if (event.button !== 0) {\n      return;\n    }\n\n    const activeElement = document.activeElement;\n    if (activeElement instanceof HTMLElement && isTextInputTarget(activeElement)) {\n      activeElement.blur();\n    }\n  }\n\n  async function focusSearch() {\n    await getCurrentWindow().show();\n    await getCurrentWindow().setFocus();\n    searchInputEl?.focus();\n    searchInputEl?.select();\n  }\n\n  function isTextInputTarget(target) {\n    return (\n      target instanceof HTMLInputElement ||\n      target instanceof HTMLTextAreaElement ||\n      target?.isContentEditable\n    );\n  }\n\n  async function handleKeydown(event) {\n    const isMetaSelectAll = (event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'a';\n    const isMetaCopy = (event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'c';\n    const target = event.target;\n    const isTextInput = isTextInputTarget(target);\n\n    if (isMetaCopy && isTextInput) {\n      return;\n    }\n\n    if (isMetaSelectAll) {\n      if (isTextInput) {\n        event.preventDefault();\n        if (target instanceof HTMLInputElement || target instanceof HTMLTextAreaElement) {\n          target.select();\n        }\n        return;\n      }\n    }\n\n    if (editing.active) {\n      if (event.key === 'Enter') {\n        event.preventDefault();\n        await commitRename();\n        return;\n      }\n\n      if (event.key === 'Escape') {\n        event.preventDefault();\n        const idx = editing.index;\n        cancelRename();\n        selectSingle(idx);\n        await tick();\n        tableContainer?.querySelector('.row.selected')?.focus();\n        return;\n      }\n      return;\n    }\n\n    if (event.key === 'Escape') {\n      event.preventDefault();\n      clearSelection();\n      return;\n    }\n\n    if (event.key === 'ArrowDown') {\n      event.preventDefault();\n      moveSelection(1, event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'ArrowUp') {\n      event.preventDefault();\n      moveSelection(-1, event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'PageDown') {\n      event.preventDefault();\n      moveSelection(Math.floor(viewportHeight / rowHeight), event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'PageUp') {\n      event.preventDefault();\n      moveSelection(-Math.floor(viewportHeight / rowHeight), event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'Enter') {\n      event.preventDefault();\n      if (platform === 'windows') {\n        await openSelected();\n      } else {\n        await startRename();\n      }\n      return;\n    }\n\n    if (event.key === 'F2') {\n      event.preventDefault();\n      await startRename();\n      return;\n    }\n\n    if (event.key === ' ' && !isTextInput) {\n      event.preventDefault();\n      const entry = primaryEntry();\n      if (entry) {\n        await invoke('quick_look', { path: entry.path });\n      }\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'f') {\n      event.preventDefault();\n      clearSelection();\n      searchInputEl?.focus();\n      searchInputEl?.select();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'o') {\n      event.preventDefault();\n      await openSelected();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key === 'Enter') {\n      event.preventDefault();\n      await revealSelected();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'c') {\n      event.preventDefault();\n      await copySelectedPaths();\n      return;\n    }\n\n    if (isMetaSelectAll) {\n      event.preventDefault();\n      selectedIndices = new Set(Array.from({ length: results.length }, (_, i) => i));\n      return;\n    }\n\n    if (event.key === 'Delete' || ((event.metaKey || event.ctrlKey) && event.key === 'Backspace')) {\n      if (!isTextInput) {\n        event.preventDefault();\n        await trashSelected();\n      }\n      return;\n    }\n  }\n\n  function formatSize(entry) {\n    if (entry.isDir || entry.size == null) return '';\n    const bytes = entry.size;\n    if (bytes < 1024) return `${bytes} B`;\n    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n    if (bytes < 1024 * 1024 * 1024) return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n    return `${(bytes / (1024 * 1024 * 1024)).toFixed(1)} GB`;\n  }\n\n  function formatModified(entry) {\n    if (!entry.mtime) {\n      return '';\n    }\n\n    const d = new Date(entry.mtime * 1000);\n    const pad = (n) => String(n).padStart(2, '0');\n    return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;\n  }\n\n  function formatLastUpdated(timestamp) {\n    if (!timestamp) {\n      return '-';\n    }\n\n    return new Date(timestamp * 1000).toLocaleString();\n  }\n\n  function formatElapsed(ms) {\n    const totalSec = Math.floor(ms / 1000);\n    const min = Math.floor(totalSec / 60);\n    const sec = totalSec % 60;\n    return min > 0 ? `${min}m ${sec}s` : `${sec}s`;\n  }\n\n  function updateElapsed() {\n    if (indexingStartTime && indexStatus.state === 'Indexing') {\n      indexingElapsed = formatElapsed(Date.now() - indexingStartTime);\n    }\n  }\n\n  function startElapsedTimer() {\n    clearInterval(elapsedTimer);\n    indexingStartTime = Date.now();\n    indexingElapsed = '0s';\n    indexingFinishedAt = '';\n    elapsedTimer = setInterval(updateElapsed, 1000);\n  }\n\n  function stopElapsedTimer() {\n    clearInterval(elapsedTimer);\n    if (indexingStartTime) {\n      const elapsed = Date.now() - indexingStartTime;\n      indexingFinishedAt = `${formatElapsed(elapsed)}`;\n    }\n    indexingStartTime = null;\n    indexingElapsed = '';\n  }\n\n  function displayPath(path) {\n    if (!path) {\n      return path;\n    }\n\n    if (!homePrefix) {\n      return path;\n    }\n\n    if (path === homePrefix) {\n      return '~';\n    }\n\n    if (path.startsWith(`${homePrefix}/`)) {\n      return `~${path.slice(homePrefix.length)}`;\n    }\n\n    return path;\n  }\n\n  let unlistenFns = [];\n\n  onMount(async () => {\n    const t0 = performance.now();\n    const ms = () => Math.round(performance.now() - t0);\n    const DEBUG_STARTUP = false;\n    const flog = DEBUG_STARTUP ? (msg) => invoke('frontend_log', { msg }).catch(() => {}) : () => {};\n\n    flog(`[startup/fe] onMount entered`);\n\n    updateViewportHeight();\n    flog(`[startup/fe] +${ms()}ms updateViewportHeight done`);\n\n    invoke('set_native_theme', { theme });\n\n    platform = await invoke('get_platform');\n    flog(`[startup/fe] +${ms()}ms get_platform done`);\n\n    const unlistenProgress = await listen('index_progress', (event) => {\n      scanned = event.payload.scanned;\n      if (indexStatus.state !== 'Indexing') {\n        indexStatus = {\n          ...indexStatus,\n          state: 'Indexing'\n        };\n      }\n    });\n    flog(`[startup/fe] +${ms()}ms listen(index_progress) registered`);\n\n    const unlistenState = await listen('index_state', (event) => {\n      flog(`[startup/fe] index_state event received: ${event.payload.state} at +${ms()}ms`);\n      const prevState = indexStatus.state;\n      indexStatus = {\n        ...indexStatus,\n        state: event.payload.state,\n        message: event.payload.message ?? null,\n        isCatchup: event.payload.isCatchup ?? false\n      };\n\n      if (event.payload.state === 'Indexing' && prevState !== 'Indexing') {\n        if (prevState === 'Ready') {\n          lastReadyCount = indexStatus.entriesCount;\n        }\n        startElapsedTimer();\n      } else if (event.payload.state !== 'Indexing' && prevState === 'Indexing') {\n        stopElapsedTimer();\n      }\n\n      if (event.payload.state === 'Ready') {\n        scheduleSearch();\n      }\n    });\n    flog(`[startup/fe] +${ms()}ms listen(index_state) registered`);\n\n    const unlistenUpdated = await listen('index_updated', (event) => {\n      indexStatus = {\n        ...indexStatus,\n        entriesCount: event.payload.entriesCount,\n        lastUpdated: event.payload.lastUpdated,\n        permissionErrors: event.payload.permissionErrors ?? indexStatus.permissionErrors\n      };\n\n      scheduleSearch(true);\n    });\n\n    const unlistenFocus = await listen('focus_search', () => {\n      void focusSearch();\n    });\n\n    const unlistenCtxMenuAction = await listen('context_menu_action', (event) => {\n      switch (event.payload) {\n        case 'open': void openSelected(); break;\n        case 'quick_look': {\n          const e = primaryEntry();\n          if (e) void invoke('quick_look', { path: e.path });\n          break;\n        }\n        case 'open_with': void openWithFallback(); break;\n        case 'reveal': void revealSelected(); break;\n        case 'copy_files': void copyFiles(); break;\n        case 'copy_path': void copySelectedPaths(); break;\n        case 'trash': void trashSelected(); break;\n        case 'rename': void startRename(); break;\n      }\n    });\n\n    unlistenFns = [unlistenProgress, unlistenState, unlistenUpdated, unlistenFocus, unlistenCtxMenuAction];\n    flog(`[startup/fe] +${ms()}ms all listeners registered`);\n\n    // Fetch backend state IMMEDIATELY after listeners are registered.\n    // Events emitted before listener registration are lost, so this\n    // is the only reliable way to get the current state.\n    await refreshStatus();\n    flog(`[startup/fe] +${ms()}ms refreshStatus done (state=${indexStatus.state})`);\n\n    // Show Svelte UI: remove skeleton, focus search input.\n    await tick();\n    document.getElementById('skeleton')?.remove();\n    await focusSearch();\n    flog(`[startup/fe] +${ms()}ms WINDOW VISIBLE â€” skeleton removed`);\n\n    try {\n      homePrefix = await invoke('get_home_dir');\n    } catch {\n      homePrefix = '';\n    }\n    flog(`[startup/fe] +${ms()}ms get_home_dir done`);\n\n    if (!localStorage.getItem('everything-fda-notice-v1')) {\n      showToast('macOS Full Disk Access permission may be required for full disk search.');\n      localStorage.setItem('everything-fda-notice-v1', '1');\n    }\n    flog(`[startup/fe] +${ms()}ms calling runSearch...`);\n    await runSearch();\n    flog(`[startup/fe] +${ms()}ms runSearch done`);\n\n    if (typeof ResizeObserver !== 'undefined') {\n      tableResizeObserver = new ResizeObserver(() => {\n        scheduleViewportHeightUpdate();\n      });\n      if (tableContainer) {\n        tableResizeObserver.observe(tableContainer);\n      } else if (tableAreaEl) {\n        tableResizeObserver.observe(tableAreaEl);\n      }\n    }\n\n    window.addEventListener('resize', scheduleViewportHeightUpdate);\n    window.addEventListener('click', onGlobalClick);\n    statusRefreshTimer = setInterval(() => {\n      if (indexStatus.state === 'Indexing') {\n        void refreshStatus();\n      }\n    }, 1000);\n    console.log(`[startup/fe] +${ms()}ms onMount complete`);\n  });\n\n  onDestroy(async () => {\n    clearTimeout(searchTimer);\n    clearTimeout(toastTimer);\n    clearInterval(statusRefreshTimer);\n    clearInterval(elapsedTimer);\n    resizeCleanup?.();\n\n    for (const unlisten of unlistenFns) {\n      unlisten();\n    }\n\n    tableResizeObserver?.disconnect();\n    tableResizeObserver = null;\n    if (viewportResizeRaf !== null) {\n      cancelAnimationFrame(viewportResizeRaf);\n      viewportResizeRaf = null;\n    }\n    window.removeEventListener('resize', scheduleViewportHeightUpdate);\n    window.removeEventListener('click', onGlobalClick);\n  });\n</script>\n\n<svelte:window on:keydown={handleKeydown} />\n\n<div class=\"app-shell\" data-theme={theme}>\n  <div class=\"title-bar\" role=\"presentation\" data-tauri-drag-region on:mousedown={onTitleBarMouseDown}>\n    <div class=\"title-left\"></div>\n    <div class=\"title-center\">\n      <svg class=\"title-icon\" viewBox=\"0 0 215 205\" fill-rule=\"evenodd\" aria-hidden=\"true\">\n        <path d=\"M85 0c46.9 0 85 38.1 85 85 0 20.1-7.2 38.5-19.2 52.7l40.7 40.8c5.8 5.8 5.8 15.2 0 21-5.8 5.8-15.2 5.8-21 0l-40.7-40.7c-13.6 9.7-30.4 15.2-44.8 15.2-46.9 0-85-42.1-85-89 0-46.9 38.1-85 85-85z m0 32c-29.3 0-53 23.7-53 53 0 29.3 23.7 53 53 53 29.3 0 53-23.7 53-53 0-29.3-23.7-53-53-53z\"/>\n      </svg>\n      <span class=\"title-text\">Everything</span>\n    </div>\n    <div class=\"title-right\"></div>\n  </div>\n\n  <header class=\"search-bar\">\n    <input\n      bind:this={searchInputEl}\n      class=\"search-input\"\n      type=\"text\"\n      bind:value={query}\n      on:input={scheduleSearch}\n      on:focus={clearSelection}\n      placeholder=\"Search file/folder names\"\n      autocomplete=\"off\"\n      spellcheck=\"false\"\n    />\n  </header>\n\n  <section class=\"table-area\" bind:this={tableAreaEl} style={tableGridStyle}>\n    <div class=\"table-header\">\n      <div class=\"table-header-track\">\n        <div class=\"col name\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('name')}>\n            Name{#if sortBy === 'name'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n          <button\n            type=\"button\"\n            class=\"col-resizer\"\n            class:active={resizingColumn === 'name'}\n            on:mousedown={(event) => startColumnResize(event, 'name')}\n            aria-label=\"Resize Name column\"\n          />\n        </div>\n\n        <div class=\"col path\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('dir')}>\n            Path{#if sortBy === 'dir'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n          <button\n            type=\"button\"\n            class=\"col-resizer\"\n            class:active={resizingColumn === 'path'}\n            on:mousedown={(event) => startColumnResize(event, 'path')}\n            aria-label=\"Resize Path column\"\n          />\n        </div>\n\n        <div class=\"col size\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('size')}>\n            Size{#if sortBy === 'size'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n        </div>\n\n        <div class=\"col modified\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('mtime')}>\n            Modified{#if sortBy === 'mtime'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <div\n      class=\"table-body\"\n      bind:this={tableContainer}\n      on:scroll={() => {\n        scrollTop = tableContainer.scrollTop;\n        headerScrollLeft = tableContainer.scrollLeft;\n        if (editing.active) cancelRename();\n        const scrollBottom = scrollTop + tableContainer.clientHeight;\n        if (scrollBottom >= totalHeight - rowHeight * 10) {\n          void loadMore();\n        }\n      }}\n    >\n      <div class=\"spacer\" style={`height:${totalHeight}px`}>\n        <div class=\"rows\" style={`transform: translateY(${translateY}px);`}>\n          {#each visibleRows as entry, localIndex}\n            {@const index = startIndex + localIndex}\n            <div\n              class=\"row {selectedIndices.has(index) ? 'selected' : ''}\"\n              on:mousedown={(event) => handleRowMouseDown(event, index)}\n              on:click={(event) => handleRowClick(event, index)}\n              on:keydown={(event) => handleRowA11yKeydown(event, index)}\n              on:dblclick={() => handleRowDoubleClick(index)}\n              on:contextmenu={(event) => handleRowContextMenu(event, index)}\n              role=\"row\"\n              tabindex=\"0\"\n            >\n              <div class=\"cell name\">\n                <img class=\"file-icon\" src={iconFor(entry)} alt=\"\" />\n                <span class=\"ellipsis\" class:name-editing={editing.active && editing.index === index}>{#each highlightSegments(entry.name, query) as seg}{#if seg.hl}<mark class=\"hl\">{seg.text}</mark>{:else}{seg.text}{/if}{/each}</span>\n              </div>\n              <div class=\"cell path\"><span class=\"ellipsis\">{displayPath(entry.dir)}</span></div>\n              <div class=\"cell size\">{formatSize(entry)}</div>\n              <div class=\"cell modified\">{formatModified(entry)}</div>\n            </div>\n          {/each}\n        </div>\n      </div>\n    </div>\n  </section>\n\n  <footer class=\"status-bar\">\n    <div class=\"status-left\">\n      <span class=\"status-state\">\n        <span class=\"state-dot {indexStatus.state === 'Indexing' ? 'indexing' : indexStatus.state === 'Error' ? 'error' : 'ready'}\"></span>\n        {#if indexStatus.state === 'Indexing'}\n          Indexing{#if lastReadyCount > 0} ({Math.min(99, Math.round((scanned / lastReadyCount) * 100))}%){/if}{#if indexingElapsed} Â· {indexingElapsed}{/if}\n          {#if !indexStatus.isCatchup}\n            Â· {scanned.toLocaleString()} scanned\n          {/if}\n        {:else}\n          Index: {indexStatus.state}\n        {/if}\n      </span>\n      <span>{indexStatus.entriesCount.toLocaleString()} entries</span>\n      {#if indexingFinishedAt && indexStatus.state !== 'Indexing'}\n        <span>in {indexingFinishedAt}</span>\n      {/if}\n      {#if dbLatencyMs !== null && dbLastQuery}\n        <span>\"{dbLastQuery}\" {dbLatencyMs}ms Â· {totalResults} results</span>\n      {/if}\n      {#if searchModeLabel === 'spotlight' || searchModeLabel === 'spotlight_timeout'}\n        <span class=\"status-spotlight\">Spotlight fallback{#if searchModeLabel === 'spotlight_timeout'} (partial){/if}</span>\n      {/if}\n      {#if indexStatus.permissionErrors > 0}\n        <span class=\"status-warning\">{indexStatus.permissionErrors.toLocaleString()} permission errors</span>\n      {/if}\n      {#if indexStatus.message}\n        <span class={indexStatus.isCatchup ? 'index-progress' : 'status-error'}>{indexStatus.message}</span>\n      {/if}\n    </div>\n    <div class=\"status-right\">\n      <button class=\"status-btn theme-btn\" on:click={cycleTheme} title=\"Switch theme\">\n        {theme === 'dark' ? 'â˜€ Light' : 'â—‘ Dark'}\n      </button>\n      <button\n        class=\"status-btn rebuild-btn\"\n        on:click={resetIndex}\n        disabled={indexStatus.state === 'Indexing'}\n        title={indexStatus.state === 'Indexing' ? 'Cannot reset while indexing is in progress.' : 'Reset and rebuild the index.'}\n      >\n        <svg class=\"rebuild-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <path d=\"M23 4v6h-6\"/><path d=\"M20.49 15a9 9 0 1 1-2.12-9.36L23 10\"/>\n        </svg>\n        Rebuild Index\n      </button>\n    </div>\n  </footer>\n\n  {#if editing.active}\n    <div\n      class=\"rename-overlay\"\n      style=\"top:{renameOverlay.top}px; left:{renameOverlay.left}px; width:{renameOverlay.width}px;\"\n      role=\"presentation\"\n      on:mousedown|stopPropagation\n    >\n      <textarea\n        bind:this={renameInputEl}\n        class=\"rename-textarea\"\n        bind:value={editing.draftName}\n        on:input={autoResizeRenameInput}\n        on:click|stopPropagation\n        on:blur={commitRename}\n      />\n    </div>\n  {/if}\n\n  {#if contextMenu.visible}\n    <div class=\"context-menu\" style={`left:${contextMenu.x}px;top:${contextMenu.y}px;`}>\n      <button on:click={() => (closeContextMenu(), openSelected())}>Open</button>\n      <button on:click={async () => { closeContextMenu(); const e = primaryEntry(); if (e) await invoke('quick_look', { path: e.path }); }}>Quick Look</button>\n      <button on:click={() => (closeContextMenu(), openWithFallback())}>Open With... (Reveal in Finder)</button>\n      <button on:click={() => (closeContextMenu(), revealSelected())}>Reveal in Finder</button>\n      <button on:click={() => (closeContextMenu(), copySelectedPaths())}>Copy Path</button>\n      <button on:click={() => (closeContextMenu(), trashSelected())}>Move to Trash</button>\n      {#if selectedIndices.size === 1}\n        <button on:click={() => (closeContextMenu(), startRename())}>Rename</button>\n      {/if}\n    </div>\n  {/if}\n\n  {#if toast}\n    <div class=\"toast\">{toast}</div>\n  {/if}\n</div>\n\n<style>\n  :global(:root) {\n    color-scheme: light dark;\n    --bg-app: transparent;\n    --text-primary: #0d1826;\n    --text-muted: #48596c;\n    --bar-grad-top: rgba(255, 255, 255, 0.48);\n    --bar-grad-bottom: rgba(248, 250, 253, 0.42);\n    --surface-header: rgba(252, 252, 255, 0.40);\n    --surface: rgba(255, 255, 255, 0.22);\n    --border-soft: rgba(0, 0, 0, 0.07);\n    --border-input: rgba(0, 0, 0, 0.13);\n    --focus-ring: #6f96e6;\n    --row-border: rgba(0, 0, 0, 0.032);\n    --row-hover: rgba(0, 0, 0, 0.06);\n    --row-selected: rgba(0, 0, 0, 0.12);\n    --button-bg: rgba(255, 255, 255, 0.62);\n    --button-border: rgba(0, 0, 0, 0.10);\n    --button-text: #2c3e50;\n    --menu-bg: rgba(240, 241, 248, 0.90);\n    --menu-border: rgba(0, 0, 0, 0.06);\n    --menu-hover: rgba(255, 255, 255, 0.62);\n    --menu-text: #1a2a38;\n    --error-text: #b64545;\n    --warning-text: #8f6500;\n    --toast-bg: rgba(18, 22, 32, 0.90);\n    --toast-text: #ffffff;\n  }\n\n  @media (prefers-color-scheme: dark) {\n    :global(:root) {\n      --bg-app: transparent;\n      --text-primary: #e6e6ea;\n      --text-muted: #9494a4;\n      --bar-grad-top: rgba(38, 38, 46, 0.52);\n      --bar-grad-bottom: rgba(30, 30, 38, 0.46);\n      --surface-header: rgba(32, 32, 40, 0.46);\n      --surface: rgba(18, 18, 26, 0.32);\n      --border-soft: rgba(255, 255, 255, 0.065);\n      --border-input: rgba(255, 255, 255, 0.14);\n      --focus-ring: #5b8bd9;\n      --row-border: rgba(255, 255, 255, 0.026);\n      --row-hover: rgba(255, 255, 255, 0.08);\n      --row-selected: rgba(255, 255, 255, 0.14);\n      --button-bg: rgba(255, 255, 255, 0.072);\n      --button-border: rgba(255, 255, 255, 0.11);\n      --button-text: #d6d6e0;\n      --menu-bg: rgba(36, 36, 46, 0.90);\n      --menu-border: rgba(255, 255, 255, 0.066);\n      --menu-hover: rgba(255, 255, 255, 0.062);\n      --menu-text: #e0e0e8;\n      --error-text: #ff9d9d;\n      --warning-text: #e0c670;\n      --toast-bg: rgba(10, 10, 16, 0.93);\n      --toast-text: #f2f2f6;\n    }\n  }\n\n  /* â”€â”€ Theme: Dark â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme=\"dark\"]) {\n    color-scheme: dark;\n    --bg-app: #1E1E21;\n    --text-primary: #E2E8F0;\n    --text-muted: #94A3B8;\n    --bar-grad-top: #1E1E21;\n    --bar-grad-bottom: #1E1E21;\n    --surface-header: #1E1E21;\n    --surface: #1E1E21;\n    --bg-input: #161618;\n    --border-soft: #2A2A2D;\n    --border-input: rgba(255, 255, 255, 0.06);\n    --focus-ring: #4DA8FF;\n    --accent: #4DA8FF;\n    --row-border: rgba(255, 255, 255, 0.02);\n    --row-hover: #282828;\n    --row-selected: rgba(77, 168, 255, 0.10);\n    --button-bg: rgba(255, 255, 255, 0.05);\n    --button-border: #2A2A2D;\n    --button-text: #94A3B8;\n    --menu-bg: #252528;\n    --menu-border: #2A2A2D;\n    --menu-hover: rgba(255, 255, 255, 0.04);\n    --menu-text: #E2E8F0;\n    --error-text: #ff9d9d;\n    --warning-text: #e0c670;\n    --toast-bg: rgba(10, 10, 16, 0.93);\n    --toast-text: #f2f2f6;\n  }\n\n  /* â”€â”€ Theme: Light â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme=\"light\"]) {\n    color-scheme: light;\n    --bg-app: #F5F5F7;\n    --text-primary: #1C1C1E;\n    --text-muted: #6E6E7A;\n    --bar-grad-top: #F5F5F7;\n    --bar-grad-bottom: #F5F5F7;\n    --surface-header: #F5F5F7;\n    --surface: #F5F5F7;\n    --bg-input: #FFFFFF;\n    --border-soft: #D1D1D6;\n    --border-input: rgba(0, 0, 0, 0.10);\n    --focus-ring: #3A8BF5;\n    --accent: #3A8BF5;\n    --row-border: rgba(0, 0, 0, 0.04);\n    --row-hover: rgba(0, 0, 0, 0.04);\n    --row-selected: rgba(58, 139, 245, 0.10);\n    --button-bg: #FFFFFF;\n    --button-border: #D1D1D6;\n    --button-text: #3C3C43;\n    --menu-bg: #FFFFFF;\n    --menu-border: #D1D1D6;\n    --menu-hover: rgba(0, 0, 0, 0.05);\n    --menu-text: #1C1C1E;\n    --error-text: #D93025;\n    --warning-text: #B45309;\n    --toast-bg: rgba(255, 255, 255, 0.95);\n    --toast-text: #1C1C1E;\n  }\n\n  /* â”€â”€ Themed element overrides â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme]) {\n    background: var(--bg-app);\n  }\n\n  /* Search bar: flat, no gradient, no separator */\n  :global([data-theme]) .search-bar {\n    height: 44px;\n    padding: 0 16px;\n    background: var(--bg-app);\n    border-bottom: none;\n  }\n\n  :global([data-theme]) .search-input {\n    backdrop-filter: none;\n    -webkit-backdrop-filter: none;\n    font-family: 'JetBrains Mono', 'SF Mono', monospace;\n    font-size: 12px;\n    height: 34px;\n    border-radius: 8px;\n  }\n\n  /* Table header: flat bg, 16px edge padding */\n  :global([data-theme]) .table-header {\n    background: var(--bg-app);\n  }\n\n  :global([data-theme]) .col-button {\n    padding: 0 8px;\n  }\n\n  :global([data-theme]) .col.name .col-button {\n    padding-left: 16px;\n  }\n\n  /* Row cells: JetBrains Mono, 16px outer edges */\n  :global([data-theme]) .cell {\n    font-family: 'JetBrains Mono', monospace;\n  }\n\n  :global([data-theme]) .cell.name {\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    padding-left: 16px;\n    font-size: 12px;\n    color: var(--text-primary);\n  }\n\n  :global([data-theme]) .cell.path {\n    font-size: 11px;\n  }\n\n  :global([data-theme]) .cell.size {\n    font-size: 11px;\n  }\n\n  :global([data-theme]) .cell.modified {\n    padding-right: 16px;\n    font-size: 11px;\n    white-space: nowrap;\n  }\n\n  :global([data-theme]) .row.selected {\n    box-shadow: inset 3px 0 0 var(--accent);\n  }\n\n  /* Dim path/size/date cells in themed mode */\n  :global([data-theme]) .cell.path,\n  :global([data-theme]) .cell.size,\n  :global([data-theme]) .cell.modified {\n    color: var(--text-muted);\n  }\n\n  :global(:root) {\n    background: transparent;\n  }\n\n  :global(html, body) {\n    margin: 0;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n    background: transparent;\n    color: var(--text-primary);\n    font-family: Inter, 'SF Pro Text', 'Segoe UI', Helvetica, Arial, sans-serif;\n  }\n\n  :global(#app) {\n    width: 100%;\n    height: 100%;\n  }\n\n  .app-shell {\n    display: grid;\n    grid-template-rows: auto auto 1fr auto;\n    height: 100%;\n    min-width: 0;\n  }\n\n  .title-bar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 44px;\n    padding: 0 16px;\n    background: var(--surface-header);\n    cursor: default;\n    flex-shrink: 0;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-left {\n    width: 72px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-center {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-right {\n    width: 72px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-icon {\n    width: 14px;\n    height: 14px;\n    fill: var(--accent);\n    flex-shrink: 0;\n  }\n\n  .title-text {\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--text-primary);\n    letter-spacing: -0.01em;\n  }\n\n  .search-bar {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 8px;\n    background: linear-gradient(180deg, var(--bar-grad-top) 0%, var(--bar-grad-bottom) 100%);\n    border-bottom: 1px solid var(--border-soft);\n    min-width: 0;\n    flex-shrink: 0;\n  }\n\n  .search-input {\n    display: block;\n    box-sizing: border-box;\n    width: 100%;\n    min-width: 0;\n    flex: 1 1 auto;\n    height: 36px;\n    border: 1px solid var(--border-input);\n    border-radius: 14px;\n    padding: 0 10px;\n    font-size: 14px;\n    background: var(--bg-input, var(--surface));\n    color: var(--text-primary);\n    backdrop-filter: blur(12px) saturate(160%);\n    -webkit-backdrop-filter: blur(12px) saturate(160%);\n  }\n\n  .search-input::placeholder {\n    color: var(--text-muted);\n    opacity: 0.85;\n    font-size: 12px;\n  }\n\n  .search-input:focus {\n    outline: none;\n    border-color: var(--focus-ring);\n    box-shadow: 0 0 0 2px rgba(125, 169, 255, 0.25);\n  }\n\n  .table-area {\n    display: grid;\n    grid-template-rows: auto 1fr;\n    min-height: 0;\n    min-width: 0;\n  }\n\n  .table-header-track,\n  .row {\n    display: grid;\n    grid-template-columns: var(--col-name) var(--col-path) var(--col-size) var(--col-modified);\n    align-items: center;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .table-header {\n    height: 32px;\n    border-bottom: 1px solid var(--border-soft);\n    background: var(--surface-header);\n    user-select: none;\n    overflow: hidden;\n    flex-shrink: 0;\n  }\n\n  .table-header-track {\n    height: 100%;\n    transform: translateX(var(--header-offset, 0px));\n    will-change: transform;\n  }\n\n  .table-header .col {\n    position: relative;\n    min-width: 0;\n    height: 100%;\n  }\n\n  .col-button {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: flex-start;\n    gap: 4px;\n    box-sizing: border-box;\n    padding: 0 8px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 11px;\n    font-weight: 600;\n    line-height: 1;\n    color: var(--text-muted);\n    text-align: left;\n    margin: 0;\n    border: none;\n    background: transparent;\n    cursor: pointer;\n  }\n\n  .sort-icon {\n    width: 10px;\n    height: 10px;\n    flex-shrink: 0;\n    color: var(--accent);\n  }\n\n  .col-resizer {\n    position: absolute;\n    top: 0;\n    right: -4px;\n    width: 8px;\n    height: 100%;\n    border: none;\n    padding: 0;\n    background: transparent;\n    cursor: col-resize;\n    z-index: 30;\n  }\n\n  .col-resizer::after {\n    content: '';\n    position: absolute;\n    top: 7px;\n    bottom: 7px;\n    left: 50%;\n    width: 1px;\n    transform: translateX(-50%);\n    background: var(--border-soft);\n    opacity: 0;\n    transition: opacity 0.15s ease;\n  }\n\n  .table-header .col:hover .col-resizer::after,\n  .col-resizer.active::after {\n    opacity: 1;\n  }\n\n  .table-body {\n    overflow: auto;\n    min-height: 0;\n    min-width: 0;\n    background: var(--surface);\n  }\n\n  .spacer {\n    position: relative;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .rows {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .row {\n    height: 30px;\n    border-bottom: 1px solid var(--row-border);\n    cursor: default;\n    -webkit-user-select: none;\n    user-select: none;\n    outline: none;\n  }\n\n  .row:hover {\n    background: var(--row-hover);\n  }\n\n  .row.selected {\n    background: var(--row-selected);\n  }\n\n  .cell {\n    padding: 0 8px;\n    font-size: 12px;\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    min-width: 0;\n  }\n\n  .cell.size {\n    text-align: right;\n    font-variant-numeric: tabular-nums;\n  }\n\n  .ellipsis {\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n\n  .hl {\n    background: none;\n    color: inherit;\n    font-weight: 700;\n  }\n\n  .file-icon {\n    width: 16px;\n    height: 16px;\n    flex: 0 0 auto;\n  }\n\n  .name-editing {\n    opacity: 0.25;\n  }\n\n  .rename-overlay {\n    position: fixed;\n    z-index: 100;\n    min-width: 120px;\n  }\n\n  .rename-textarea {\n    display: block;\n    width: 100%;\n    box-sizing: border-box;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 12px;\n    line-height: 18px;\n    padding: 5px 4px 5px 0;\n    border: 1.5px solid var(--focus-ring);\n    border-radius: 4px;\n    background: var(--bg-input, var(--surface));\n    color: var(--text-primary);\n    outline: none;\n    resize: none;\n    overflow: hidden;\n    box-shadow: 0 2px 14px rgba(0, 0, 0, 0.22), 0 0 0 3px rgba(77, 168, 255, 0.13);\n  }\n\n  .status-bar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 32px;\n    padding: 0 16px;\n    background: var(--surface-header);\n    border-top: 1px solid var(--border-soft);\n    font-family: 'JetBrains Mono', monospace;\n    font-size: 11px;\n    color: var(--text-muted);\n    white-space: nowrap;\n    overflow: hidden;\n    min-width: 0;\n    flex-shrink: 0;\n  }\n\n  .status-left {\n    display: flex;\n    align-items: center;\n    gap: 16px;\n    overflow: hidden;\n    min-width: 0;\n  }\n\n  .status-right {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    flex-shrink: 0;\n  }\n\n  .status-btn {\n    border: 1px solid var(--button-border);\n    border-radius: 5px;\n    background: var(--button-bg);\n    color: var(--button-text);\n    font-size: 11px;\n    height: 22px;\n    padding: 0 8px;\n    cursor: pointer;\n  }\n\n  .status-btn:hover {\n    filter: brightness(1.06);\n  }\n\n  .status-btn:disabled {\n    opacity: 0.55;\n    cursor: not-allowed;\n    filter: none;\n  }\n\n  .status-state {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n  }\n\n  .state-dot {\n    width: 6px;\n    height: 6px;\n    border-radius: 50%;\n    flex-shrink: 0;\n  }\n\n  .state-dot.ready { background: #28C840; }\n  .state-dot.indexing { background: #FEBC2E; }\n  .state-dot.error { background: #FF5F57; }\n\n  .rebuild-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 10px;\n    font-weight: 500;\n    background: var(--button-bg);\n    border: 1px solid var(--button-border);\n    border-radius: 4px;\n    color: var(--button-text);\n    height: 22px;\n    padding: 0 10px;\n    cursor: pointer;\n  }\n\n  .rebuild-btn:hover {\n    filter: brightness(1.1);\n  }\n\n  .rebuild-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    filter: none;\n  }\n\n  .rebuild-icon {\n    width: 11px;\n    height: 11px;\n    color: var(--accent);\n    flex-shrink: 0;\n  }\n\n  .status-error {\n    color: var(--error-text);\n  }\n\n  .status-warning {\n    color: var(--warning-text);\n  }\n\n  .status-spotlight {\n    color: #f59e0b;\n    font-weight: 600;\n  }\n\n  .context-menu {\n    position: fixed;\n    z-index: 200;\n    width: 220px;\n    border: 1px solid var(--menu-border);\n    border-radius: 10px;\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.16), inset 0 0 0 0.5px rgba(255, 255, 255, 0.18);\n    background: var(--menu-bg);\n    backdrop-filter: blur(28px) saturate(180%);\n    -webkit-backdrop-filter: blur(28px) saturate(180%);\n    overflow: hidden;\n  }\n\n  .context-menu button {\n    width: 100%;\n    text-align: left;\n    border: none;\n    background: transparent;\n    padding: 8px 10px;\n    font-size: 12px;\n    color: var(--menu-text);\n  }\n\n  .context-menu button:hover {\n    background: var(--menu-hover);\n  }\n\n  .toast {\n    position: fixed;\n    right: 14px;\n    bottom: 18px;\n    background: var(--toast-bg);\n    color: var(--toast-text);\n    border-radius: 10px;\n    padding: 9px 12px;\n    font-size: 12px;\n    z-index: 250;\n    backdrop-filter: blur(20px) saturate(180%);\n    -webkit-backdrop-filter: blur(20px) saturate(180%);\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);\n  }\n</style>\n","structuredPatch":[{"oldStart":674,"oldLines":7,"newStart":674,"newLines":7,"lines":["     if (!entry) return null;"," ","     const count = selectedIndices.has(index) ? selectedIndices.size : 1;","-    const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;","+    const isDark = theme === 'dark';"," ","     const w = 260;","     const h = 28;"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"8baef013-3843-4882-98e8-e431ade589d2"}
{"parentUuid":"b8fc5a41-c56a-4165-8a4e-7c9bab901911","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_0143VK3YDbCv8h3Rqe2sCPFn","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01JxHC4gzCb2Yeh7heVG56q7","name":"Read","input":{"file_path":"/Users/al02402336/everything/src/App.svelte","offset":1488,"limit":10},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":190,"cache_read_input_tokens":94522,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":190},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPLz9gKo2TUdrEw5CWY","type":"assistant","uuid":"7ae2bd8a-9df9-4256-aad3-f8e20d391b8e","timestamp":"2026-02-21T14:39:08.481Z"}
{"parentUuid":"7ae2bd8a-9df9-4256-aad3-f8e20d391b8e","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01JxHC4gzCb2Yeh7heVG56q7","toolUseID":"toolu_01JxHC4gzCb2Yeh7heVG56q7","timestamp":"2026-02-21T14:39:08.489Z","uuid":"695dcf07-e5e6-43bb-88e1-bf3a22cb23f8"}
{"parentUuid":"7ae2bd8a-9df9-4256-aad3-f8e20d391b8e","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01JxHC4gzCb2Yeh7heVG56q7","type":"tool_result","content":"  1488â†’          </button>\n  1489â†’        </div>\n  1490â†’      </div>\n  1491â†’    </div>\n  1492â†’\n  1493â†’    <div\n  1494â†’      class=\"table-body\"\n  1495â†’      bind:this={tableContainer}\n  1496â†’      on:scroll={() => {\n  1497â†’        scrollTop = tableContainer.scrollTop;\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"985b78f4-06c6-4e77-b6b4-a3ea27dc7981","timestamp":"2026-02-21T14:39:08.488Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/al02402336/everything/src/App.svelte","content":"          </button>\n        </div>\n      </div>\n    </div>\n\n    <div\n      class=\"table-body\"\n      bind:this={tableContainer}\n      on:scroll={() => {\n        scrollTop = tableContainer.scrollTop;","numLines":10,"startLine":1488,"totalLines":2277}},"sourceToolAssistantUUID":"7ae2bd8a-9df9-4256-aad3-f8e20d391b8e"}
{"parentUuid":"985b78f4-06c6-4e77-b6b4-a3ea27dc7981","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01CMk9KqdVCLQRAx5UY61Sha","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01T2TmKFWf18GVBekwhVKgLM","name":"Read","input":{"file_path":"/Users/al02402336/everything/src/App.svelte","offset":1496,"limit":8},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":295,"cache_read_input_tokens":94712,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":295},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPMBPrJfccTzRzNoeFV","type":"assistant","uuid":"a72d3c04-cf72-4afd-97a1-fcd3d77c90ae","timestamp":"2026-02-21T14:39:10.885Z"}
{"parentUuid":"a72d3c04-cf72-4afd-97a1-fcd3d77c90ae","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01T2TmKFWf18GVBekwhVKgLM","toolUseID":"toolu_01T2TmKFWf18GVBekwhVKgLM","timestamp":"2026-02-21T14:39:10.901Z","uuid":"02b9a2ae-ebce-480e-9cbd-231a19494ed3"}
{"parentUuid":"a72d3c04-cf72-4afd-97a1-fcd3d77c90ae","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01T2TmKFWf18GVBekwhVKgLM","type":"tool_result","content":"  1496â†’      on:scroll={() => {\n  1497â†’        scrollTop = tableContainer.scrollTop;\n  1498â†’        headerScrollLeft = tableContainer.scrollLeft;\n  1499â†’        if (editing.active) cancelRename();\n  1500â†’        const scrollBottom = scrollTop + tableContainer.clientHeight;\n  1501â†’        if (scrollBottom >= totalHeight - rowHeight * 10) {\n  1502â†’          void loadMore();\n  1503â†’        }\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"06c9cb70-5c9e-4093-9c3b-9110840e4546","timestamp":"2026-02-21T14:39:10.900Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/al02402336/everything/src/App.svelte","content":"      on:scroll={() => {\n        scrollTop = tableContainer.scrollTop;\n        headerScrollLeft = tableContainer.scrollLeft;\n        if (editing.active) cancelRename();\n        const scrollBottom = scrollTop + tableContainer.clientHeight;\n        if (scrollBottom >= totalHeight - rowHeight * 10) {\n          void loadMore();\n        }","numLines":8,"startLine":1496,"totalLines":2277}},"sourceToolAssistantUUID":"a72d3c04-cf72-4afd-97a1-fcd3d77c90ae"}
{"parentUuid":"06c9cb70-5c9e-4093-9c3b-9110840e4546","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_017PXbz5rnPvqWQiYe8vhZbP","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01H8yYGpkTGyQqu2J5t5Zgys","name":"Edit","input":{"replace_all":false,"file_path":"/Users/al02402336/everything/src/App.svelte","old_string":"        if (editing.active) cancelRename();","new_string":"        if (editing.active) void commitRename();"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":310,"cache_read_input_tokens":95007,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":310},"output_tokens":24,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPMMhihLbn5YgGDT6MX","type":"assistant","uuid":"944cf29a-b74b-4058-bd23-8e54493a6eae","timestamp":"2026-02-21T14:39:14.110Z"}
{"parentUuid":"944cf29a-b74b-4058-bd23-8e54493a6eae","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01H8yYGpkTGyQqu2J5t5Zgys","toolUseID":"toolu_01H8yYGpkTGyQqu2J5t5Zgys","timestamp":"2026-02-21T14:39:14.118Z","uuid":"87b3e8f5-807b-490e-a328-7ec8793ba8c0"}
{"parentUuid":"944cf29a-b74b-4058-bd23-8e54493a6eae","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01H8yYGpkTGyQqu2J5t5Zgys","type":"tool_result","content":"The file /Users/al02402336/everything/src/App.svelte has been updated successfully."}]},"uuid":"53960ac4-565d-418b-96ca-6d97918b7beb","timestamp":"2026-02-21T14:39:14.117Z","toolUseResult":{"filePath":"/Users/al02402336/everything/src/App.svelte","oldString":"        if (editing.active) cancelRename();","newString":"        if (editing.active) void commitRename();","originalFile":"<script>\n  import { onDestroy, onMount, tick } from 'svelte';\n  import { invoke } from '@tauri-apps/api/core';\n  import { listen } from '@tauri-apps/api/event';\n  import { getCurrentWindow } from '@tauri-apps/api/window';\n  import { startDrag } from '@crabnebula/tauri-plugin-drag';\n\n  const rowHeight = 30;\n  const PAGE_SIZE = 500;\n  let homePrefix = '';\n  const COL_WIDTHS_KEY = 'REDACTED';\n  const THEME_KEY = 'everything-theme';\n  const columnKeys = ['name', 'path', 'size', 'modified'];\n  const minColumnWidth = {\n    name: 180,\n    path: 240,\n    size: 75,\n    modified: 150\n  };\n  const defaultColumnRatios = {\n    name: 0.3,\n    path: 0.45,\n    size: 0.1\n  };\n\n  const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n  let theme = (() => { try { return localStorage.getItem(THEME_KEY) || systemTheme; } catch { return systemTheme; } })();\n  function cycleTheme() {\n    theme = theme === 'dark' ? 'light' : 'dark';\n    try { localStorage.setItem(THEME_KEY, theme); } catch {}\n    invoke('set_native_theme', { theme });\n  }\n\n  let query = '';\n  let results = [];\n  let totalResults = 0;\n  let totalResultsKnown = false;\n\n  let dbLatencyMs = null;\n  let dbLastQuery = '';\n  let searchModeLabel = '';\n  let selectedIndices = new Set();\n  let selectionAnchor = -1;\n  let lastSelectedIndex = -1;\n  let editing = {\n    active: false,\n    path: '',\n    index: -1,\n    draftName: ''\n  };\n\n  let renameOverlay = { top: 0, left: 0, width: 0 };\n\n  let indexStatus = {\n    state: 'Indexing',\n    entriesCount: 0,\n    lastUpdated: null,\n    permissionErrors: 0,\n    message: null,\n    isCatchup: false\n  };\n\n  let indexingStartTime = null;\n  let indexingElapsed = '';\n  let indexingFinishedAt = '';\n\n  let sortBy = 'name';\n  let sortDir = 'asc';\n\n  let hasMore = true;\n  let loadingMore = false;\n  let searchGeneration = 0;\n\n  let scanned = 0;\n\n  let searchInputEl;\n  let renameInputEl;\n  let tableAreaEl;\n  let tableContainer;\n  let tableResizeObserver = null;\n  let viewportResizeRaf = null;\n  let scrollTop = 0;\n  let headerScrollLeft = 0;\n  let viewportHeight = 520;\n  let lastTableWidth = 0;\n  let resizingColumn = '';\n  let resizeCleanup = null;\n  let colWidths = {\n    name: 250,\n    path: 350,\n    size: 75,\n    modified: 150\n  };\n\n  let contextMenu = {\n    visible: false,\n    x: 0,\n    y: 0\n  };\n\n  let platform = '';\n  let toast = '';\n  let searchTimer;\n  let lastSearchFiredAt = 0;\n  let toastTimer;\n  let statusRefreshTimer;\n  let elapsedTimer;\n  let statusRefreshInFlight = false;\n  let lastReadyCount = 0;\n\n  const iconCache = new Map();\n  const iconLoading = new Set();\n\n  let highlightCache = new Map();\n  let highlightCacheQuery = '';\n\n  const folderFallbackIcon =\n    \"data:image/svg+xml;utf8,\" +\n    encodeURIComponent(\n      `<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><rect x='1' y='4' width='14' height='10' rx='2' fill='#d9b34f'/><rect x='1' y='2' width='6' height='4' rx='1' fill='#e6ca7a'/></svg>`\n    );\n  const fileFallbackIcon =\n    \"data:image/svg+xml;utf8,\" +\n    encodeURIComponent(\n      `<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><rect x='3' y='1' width='10' height='14' rx='1.5' fill='#b4bec9'/><rect x='5' y='5' width='6' height='1.2' fill='#8d98a5'/><rect x='5' y='8' width='6' height='1.2' fill='#8d98a5'/></svg>`\n    );\n\n  $: totalHeight = results.length * rowHeight;\n  $: startIndex = Math.max(0, Math.floor(scrollTop / rowHeight) - 10);\n  $: visibleCount = Math.ceil(viewportHeight / rowHeight) + 20;\n  $: endIndex = Math.min(results.length, startIndex + visibleCount);\n  $: visibleRows = results.slice(startIndex, endIndex);\n  $: translateY = startIndex * rowHeight;\n  $: tableMinWidth = colWidths.name + colWidths.path + colWidths.size + colWidths.modified;\n  $: tableGridStyle = `--col-name:${colWidths.name}px;--col-path:${colWidths.path}px;--col-size:${colWidths.size}px;--col-modified:${colWidths.modified}px;--table-min-width:${tableMinWidth}px;--header-offset:${-headerScrollLeft}px;`;\n\n  $: {\n    for (const entry of visibleRows) {\n      void ensureIcon(entry);\n    }\n  }\n\n  function showToast(message) {\n    toast = message;\n    clearTimeout(toastTimer);\n    toastTimer = setTimeout(() => {\n      toast = '';\n    }, 3000);\n  }\n\n  function bytesToBase64(bytes) {\n    let binary = '';\n    const chunk = 0x8000;\n    for (let i = 0; i < bytes.length; i += chunk) {\n      const part = bytes.subarray(i, i + chunk);\n      binary += String.fromCharCode(...part);\n    }\n    return btoa(binary);\n  }\n\n  function highlightSegments(name, q) {\n    q = (q || '').trim();\n    if (!q) return [{ text: name, hl: false }];\n\n    // Reset cache when query changes\n    if (q !== highlightCacheQuery) {\n      highlightCache = new Map();\n      highlightCacheQuery = q;\n    }\n\n    // Check cache\n    const cached = highlightCache.get(name);\n    if (cached) return cached;\n\n    if (q.includes('/')) q = q.slice(q.lastIndexOf('/') + 1);\n    q = q.replace(/[*?]/g, '');\n    const terms = q.split(/\\s+/).filter(Boolean);\n    if (terms.length === 0) return [{ text: name, hl: false }];\n\n    const lower = name.toLowerCase();\n    const marks = new Uint8Array(name.length);\n    for (const t of terms) {\n      const tl = t.toLowerCase();\n      let idx = lower.indexOf(tl);\n      while (idx !== -1) {\n        for (let i = idx; i < idx + tl.length; i++) marks[i] = 1;\n        idx = lower.indexOf(tl, idx + 1);\n      }\n    }\n\n    const segs = [];\n    let i = 0;\n    while (i < name.length) {\n      const m = marks[i];\n      let j = i + 1;\n      while (j < name.length && marks[j] === m) j++;\n      segs.push({ text: name.slice(i, j), hl: m === 1 });\n      i = j;\n    }\n\n    highlightCache.set(name, segs);\n    return segs;\n  }\n\n  const perFileIconExts = new Set(['exe', 'lnk', 'ico', 'url', 'scr', 'appx']);\n\n  function iconKey(entry) {\n    if (entry.isDir) return '__folder__';\n    const ext = (entry.ext || '').toLowerCase();\n    if (perFileIconExts.has(ext)) return entry.path;\n    return ext || '__file__';\n  }\n\n  function iconFor(entry) {\n    return iconCache.get(iconKey(entry)) || (entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n  }\n\n  async function ensureIcon(entry) {\n    const key = iconKey(entry);\n    if (iconCache.has(key) || iconLoading.has(key)) {\n      return;\n    }\n\n    iconLoading.add(key);\n    try {\n      const bytes = await invoke('get_file_icon', {\n        path: entry.path,\n        ext: entry.isDir ? 'folder' : entry.ext || '',\n      });\n      if (Array.isArray(bytes) && bytes.length > 0) {\n        const image = `data:image/png;base64,${bytesToBase64(Uint8Array.from(bytes))}`;\n        iconCache.set(key, image);\n      } else {\n        iconCache.set(key, entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n      }\n    } catch {\n      iconCache.set(key, entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n    } finally {\n      iconLoading.delete(key);\n    }\n  }\n\n  function syncColumnWidthsToContainer() {\n    const width = tableContainer?.clientWidth || tableAreaEl?.clientWidth;\n    if (!width || lastTableWidth !== 0) {\n      return;\n    }\n\n    const saved = loadColWidths();\n    if (saved) {\n      const total = columnKeys.reduce((s, k) => s + saved[k], 0);\n      if (Math.abs(total - width) > 2) {\n        const scale = (width - saved.modified) / (total - saved.modified);\n        let scaledName = Math.max(minColumnWidth.name, Math.round(saved.name * scale));\n        let scaledSize = Math.max(minColumnWidth.size, Math.round(saved.size * scale));\n        let rawPath = width - saved.modified - scaledName - scaledSize;\n        if (rawPath < minColumnWidth.path) {\n          const shortfall = minColumnWidth.path - rawPath;\n          const nameReduction = Math.min(shortfall, scaledName - minColumnWidth.name);\n          scaledName -= nameReduction;\n          const remaining = shortfall - nameReduction;\n          if (remaining > 0) {\n            scaledSize -= Math.min(remaining, scaledSize - minColumnWidth.size);\n          }\n          rawPath = width - saved.modified - scaledName - scaledSize;\n        }\n        const scaledPath = Math.max(minColumnWidth.path, rawPath);\n        colWidths = { name: scaledName, path: scaledPath, size: scaledSize, modified: saved.modified };\n      } else {\n        colWidths = saved;\n      }\n    } else {\n      const fixedModified = minColumnWidth.modified;\n      const rest = width - fixedModified;\n      const ratioSum = defaultColumnRatios.name + defaultColumnRatios.path + defaultColumnRatios.size;\n      colWidths = {\n        name: Math.max(minColumnWidth.name, Math.round(rest * defaultColumnRatios.name / ratioSum)),\n        path: Math.max(minColumnWidth.path, Math.round(rest * defaultColumnRatios.path / ratioSum)),\n        size: Math.max(minColumnWidth.size, Math.round(rest * defaultColumnRatios.size / ratioSum)),\n        modified: fixedModified\n      };\n    }\n    lastTableWidth = width;\n  }\n\n  function loadColWidths() {\n    try {\n      const raw = localStorage.getItem(COL_WIDTHS_KEY);\n      if (!raw) return null;\n      const parsed = JSON.parse(raw);\n      for (const key of columnKeys) {\n        if (typeof parsed[key] !== 'number' || parsed[key] < (minColumnWidth[key] || 0)) return null;\n      }\n      return parsed;\n    } catch {\n      return null;\n    }\n  }\n\n  function saveColWidths() {\n    localStorage.setItem(COL_WIDTHS_KEY, JSON.stringify(colWidths));\n  }\n\n  function updateViewportHeight() {\n    viewportHeight = tableContainer?.clientHeight || 520;\n    syncColumnWidthsToContainer();\n  }\n\n  function scheduleViewportHeightUpdate() {\n    if (viewportResizeRaf !== null) {\n      return;\n    }\n    viewportResizeRaf = requestAnimationFrame(() => {\n      viewportResizeRaf = null;\n      updateViewportHeight();\n    });\n  }\n\n  function startColumnResize(event, leftKey) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    const index = columnKeys.indexOf(leftKey);\n    if (index < 0 || index >= columnKeys.length - 1) {\n      return;\n    }\n\n    const startX = event.clientX;\n    const startLeft = colWidths[leftKey];\n    const rightKey = columnKeys[index + 1];\n    const startRight = colWidths[rightKey];\n\n    resizeCleanup?.();\n    resizingColumn = leftKey;\n\n    const onMove = (moveEvent) => {\n      const delta = Math.round(moveEvent.clientX - startX);\n      if (leftKey === 'name') {\n        // Two-column trade: name and path swap space, each respects its minimum\n        const nextLeft = Math.max(\n          minColumnWidth[leftKey],\n          Math.min(startLeft + delta, startLeft + startRight - minColumnWidth[rightKey])\n        );\n        const nextRight = startLeft + startRight - nextLeft;\n        colWidths = { ...colWidths, [leftKey]: nextLeft, [rightKey]: nextRight };\n      } else {\n        // path splitter: path grows unconstrained (allows horizontal scroll on right drag)\n        const nextLeft = Math.max(minColumnWidth[leftKey], startLeft + delta);\n        colWidths = { ...colWidths, [leftKey]: nextLeft };\n      }\n    };\n\n    const onUp = () => {\n      cleanup();\n    };\n\n    const cleanup = () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n      document.body.style.cursor = '';\n      document.body.style.userSelect = '';\n      resizingColumn = '';\n      saveColWidths();\n      if (resizeCleanup === cleanup) {\n        resizeCleanup = null;\n      }\n    };\n\n    resizeCleanup = cleanup;\n    document.body.style.cursor = 'col-resize';\n    document.body.style.userSelect = 'none';\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n  }\n\n  function selectedPaths() {\n    const sorted = [...selectedIndices].sort((a, b) => a - b);\n    return sorted.map((idx) => results[idx]).filter(Boolean).map((entry) => entry.path);\n  }\n\n  function clearSelection() {\n    selectedIndices = new Set();\n    selectionAnchor = -1;\n    lastSelectedIndex = -1;\n  }\n\n  function selectSingle(index) {\n    selectedIndices = new Set([index]);\n    selectionAnchor = index;\n    lastSelectedIndex = index;\n  }\n\n  function selectToggle(index) {\n    const next = new Set(selectedIndices);\n    if (next.has(index)) {\n      next.delete(index);\n    } else {\n      next.add(index);\n    }\n    selectedIndices = next;\n    selectionAnchor = index;\n    lastSelectedIndex = index;\n  }\n\n  function selectRange(index) {\n    const anchor = selectionAnchor >= 0 ? selectionAnchor : index;\n    const [from, to] = [Math.min(anchor, index), Math.max(anchor, index)];\n    const next = new Set();\n    for (let i = from; i <= to; i += 1) {\n      next.add(i);\n    }\n    selectedIndices = next;\n    lastSelectedIndex = index;\n  }\n\n  function primaryEntry() {\n    const idx = lastSelectedIndex >= 0 ? lastSelectedIndex : -1;\n    return idx >= 0 ? results[idx] : null;\n  }\n\n  async function refreshStatus() {\n    if (statusRefreshInFlight) {\n      return;\n    }\n    statusRefreshInFlight = true;\n    try {\n      const status = await invoke('get_index_status');\n      const prevState = indexStatus.state;\n      indexStatus = {\n        state: status.state,\n        entriesCount: status.entriesCount,\n        lastUpdated: status.lastUpdated,\n        permissionErrors: status.permissionErrors ?? 0,\n        message: status.message\n      };\n      if (status.state === 'Indexing' && prevState !== 'Indexing') {\n        startElapsedTimer();\n      } else if (status.state !== 'Indexing' && prevState === 'Indexing') {\n        stopElapsedTimer();\n      }\n      if (typeof status.scanned === 'number') {\n        scanned = status.scanned;\n      }\n      if (status.state === 'Ready' && prevState !== 'Ready') {\n        scheduleSearch();\n      }\n    } catch (err) {\n      showToast(`Failed to get status: ${String(err)}`);\n    } finally {\n      statusRefreshInFlight = false;\n    }\n  }\n\n  function scheduleSearch(preserveScroll = false) {\n    searchGeneration += 1;\n    const scheduledGen = searchGeneration;\n    clearTimeout(searchTimer);\n\n    const now = performance.now();\n    if (now - lastSearchFiredAt >= 200) {\n      // Leading edge: fire immediately if enough time has passed\n      lastSearchFiredAt = now;\n      void runSearch(preserveScroll);\n    } else {\n      // Trailing edge: debounce\n      searchTimer = setTimeout(() => {\n        if (scheduledGen !== searchGeneration) {\n          return;\n        }\n        lastSearchFiredAt = performance.now();\n        void runSearch(preserveScroll);\n      }, 200);\n    }\n  }\n\n  async function runSearch(preserveScroll = false) {\n    searchGeneration += 1;\n    const gen = searchGeneration;\n    const searchQuery = query;\n    const searchSortBy = sortBy;\n    const searchSortDir = sortDir;\n    const startedAt = performance.now();\n    try {\n      const keepPaths = new Set(selectedPaths());\n      const next = await invoke('search', {\n        query: searchQuery,\n        limit: PAGE_SIZE,\n        offset: 0,\n        sortBy: searchSortBy,\n        sortDir: searchSortDir\n      });\n\n      if (gen !== searchGeneration) return;\n\n      dbLatencyMs = Math.round(performance.now() - startedAt);\n      dbLastQuery = searchQuery;\n      const entries = Array.isArray(next.entries) ? next.entries : [];\n      searchModeLabel = next.modeLabel || '';\n      results = entries;\n      if (next.totalCount > 0) {\n        totalResults = next.totalCount;\n        totalResultsKnown = true;\n      } else {\n        totalResults = entries.length;\n        totalResultsKnown = false;\n      }\n      hasMore = totalResultsKnown ? results.length < totalResults : entries.length >= PAGE_SIZE;\n      if (!preserveScroll && tableContainer) tableContainer.scrollTop = 0;\n\n      const restored = new Set();\n      for (let i = 0; i < results.length; i += 1) {\n        if (keepPaths.has(results[i].path)) {\n          restored.add(i);\n        }\n      }\n      selectedIndices = restored;\n\n      updateViewportHeight();\n    } catch (err) {\n      if (gen !== searchGeneration) return;\n      showToast(`Search failed: ${String(err)}`);\n    }\n  }\n\n  async function loadMore() {\n    if (!hasMore || loadingMore) return;\n    const gen = searchGeneration;\n    loadingMore = true;\n    try {\n      const batch = await invoke('search', {\n        query,\n        limit: PAGE_SIZE,\n        offset: results.length,\n        sortBy: sortBy,\n        sortDir: sortDir\n      });\n      if (gen !== searchGeneration) return;\n      const arr = Array.isArray(batch.entries) ? batch.entries : [];\n      if (arr.length > 0) results = [...results, ...arr];\n      hasMore = totalResultsKnown ? results.length < totalResults : arr.length >= PAGE_SIZE;\n    } catch (err) {\n      showToast(`Failed to load more: ${String(err)}`);\n    } finally {\n      loadingMore = false;\n    }\n  }\n\n  function moveSelection(delta, withRange = false) {\n    if (results.length === 0) {\n      return;\n    }\n\n    const current = lastSelectedIndex >= 0 ? lastSelectedIndex : 0;\n    const next = Math.max(0, Math.min(results.length - 1, current + delta));\n\n    if (withRange) {\n      selectRange(next);\n    } else {\n      selectSingle(next);\n    }\n\n    const top = next * rowHeight;\n    const bottom = top + rowHeight;\n    if (top < scrollTop) {\n      tableContainer.scrollTop = top;\n    } else if (bottom > scrollTop + viewportHeight) {\n      tableContainer.scrollTop = bottom - viewportHeight;\n    }\n  }\n\n  function handleHeaderSort(column) {\n    if (sortBy === column) {\n      sortDir = sortDir === 'asc' ? 'desc' : 'asc';\n    } else {\n      sortBy = column;\n      sortDir = 'asc';\n    }\n    if (tableContainer) tableContainer.scrollTop = 0;\n    void runSearch();\n  }\n\n  function handleRowClick(event, index) {\n    contextMenu.visible = false;\n\n    if (event.shiftKey) {\n      selectRange(index);\n      return;\n    }\n\n    if (event.metaKey || event.ctrlKey) {\n      selectToggle(index);\n      return;\n    }\n\n    selectSingle(index);\n  }\n\n  function handleRowContextMenu(event, index) {\n    event.preventDefault();\n\n    if (!selectedIndices.has(index)) {\n      selectSingle(index);\n    }\n\n    if (platform === 'windows' || platform === 'macos') {\n      contextMenu.visible = false;\n      const paths = selectedPaths();\n      if (paths.length > 0) {\n        invoke('show_context_menu', {\n          paths,\n          x: event.clientX,\n          y: event.clientY,\n          singleSelection: selectedIndices.size === 1\n        });\n      }\n      return;\n    }\n\n    contextMenu = {\n      visible: true,\n      x: event.clientX,\n      y: event.clientY\n    };\n  }\n\n  function handleRowA11yKeydown(event, index) {\n    if (event.key === ' ' || event.key === 'Enter') {\n      event.preventDefault();\n      handleRowClick(event, index);\n    }\n  }\n\n  const DRAG_THRESHOLD = 5;\n  let dragCleanup = null;\n  const dragImgCache = new Map();\n\n  function dragPathsForIndex(index) {\n    const entry = results[index];\n    if (!entry) {\n      return [];\n    }\n\n    if (selectedIndices.has(index) && selectedIndices.size > 0) {\n      return selectedPaths();\n    }\n\n    return [entry.path];\n  }\n\n  function getDragIconEl(entry) {\n    const src = iconFor(entry);\n    let img = dragImgCache.get(src);\n    if (!img) {\n      img = new Image();\n      img.src = src;\n      dragImgCache.set(src, img);\n    }\n    return img.complete && img.naturalWidth > 0 ? img : null;\n  }\n\n  function fillRoundRect(ctx, x, y, w, h, r) {\n    ctx.beginPath();\n    ctx.moveTo(x + r, y);\n    ctx.arcTo(x + w, y, x + w, y + h, r);\n    ctx.arcTo(x + w, y + h, x, y + h, r);\n    ctx.arcTo(x, y + h, x, y, r);\n    ctx.arcTo(x, y, x + w, y, r);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  function buildDragPreview(index) {\n    const entry = results[index];\n    if (!entry) return null;\n\n    const count = selectedIndices.has(index) ? selectedIndices.size : 1;\n    const isDark = theme === 'dark';\n\n    const w = 260;\n    const h = 28;\n    const stackGap = count > 1 ? 4 : 0;\n\n    const canvas = document.createElement('canvas');\n    canvas.width = w;\n    canvas.height = h + stackGap;\n    const ctx = canvas.getContext('2d');\n\n    if (count > 1) {\n      ctx.globalAlpha = 0.35;\n      ctx.fillStyle = isDark ? '#5a6070' : '#b0c4de';\n      fillRoundRect(ctx, 3, 0, w - 3, h, 5);\n      ctx.globalAlpha = 1.0;\n    }\n\n    const ry = stackGap;\n    ctx.fillStyle = isDark ? 'rgba(58, 64, 74, 0.94)' : 'rgba(214, 231, 255, 0.94)';\n    fillRoundRect(ctx, 0, ry, w, h, 5);\n\n    ctx.strokeStyle = isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';\n    ctx.lineWidth = 0.5;\n    ctx.beginPath();\n    ctx.moveTo(5, ry);\n    ctx.arcTo(w, ry, w, ry + h, 5);\n    ctx.arcTo(w, ry + h, 0, ry + h, 5);\n    ctx.arcTo(0, ry + h, 0, ry, 5);\n    ctx.arcTo(0, ry, w, ry, 5);\n    ctx.closePath();\n    ctx.stroke();\n\n    const iconEl = getDragIconEl(entry);\n    if (iconEl) {\n      ctx.drawImage(iconEl, 6, ry + 6, 16, 16);\n    } else {\n      ctx.fillStyle = entry.isDir ? '#d9b34f' : '#8d98a5';\n      fillRoundRect(ctx, 6, ry + 6, 16, 16, 2);\n    }\n\n    ctx.fillStyle = isDark ? '#e6e6e8' : '#1a1a1a';\n    ctx.font = '12px -apple-system, \"SF Pro Text\", system-ui, sans-serif';\n    ctx.textBaseline = 'middle';\n\n    let nameMaxW = w - 34;\n    if (count > 1) nameMaxW -= 34;\n\n    let name = entry.name;\n    if (ctx.measureText(name).width > nameMaxW) {\n      while (name.length > 4 && ctx.measureText(name + '\\u2026').width > nameMaxW) {\n        name = name.slice(0, -1);\n      }\n      name += '\\u2026';\n    }\n    ctx.fillText(name, 28, ry + h / 2 + 1);\n\n    if (count > 1) {\n      const badge = String(count);\n      ctx.font = 'bold 10px -apple-system, system-ui, sans-serif';\n      const tw = ctx.measureText(badge).width;\n      const bw = Math.max(20, tw + 10);\n      const bx = w - bw - 6;\n      const by = ry + (h - 18) / 2;\n\n      ctx.fillStyle = isDark ? '#5b8bd9' : '#007aff';\n      fillRoundRect(ctx, bx, by, bw, 18, 9);\n\n      ctx.fillStyle = '#ffffff';\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(badge, bx + bw / 2, by + 9);\n    }\n\n    return canvas.toDataURL('image/png');\n  }\n\n  function handleRowMouseDown(event, index) {\n    if (event.button !== 0) return;\n    if (event.metaKey || event.ctrlKey || event.shiftKey) return;\n    if (editing.active) return;\n\n    const startX = event.clientX;\n    const startY = event.clientY;\n    let dragging = false;\n\n    dragCleanup?.();\n\n    const onMove = (e) => {\n      if (dragging) return;\n      const dx = e.clientX - startX;\n      const dy = e.clientY - startY;\n      if (dx * dx + dy * dy < DRAG_THRESHOLD * DRAG_THRESHOLD) return;\n\n      dragging = true;\n      cleanup();\n\n      if (!selectedIndices.has(index)) {\n        selectSingle(index);\n      }\n\n      const paths = dragPathsForIndex(index);\n      if (paths.length > 0) {\n        const icon = buildDragPreview(index);\n        startDrag({ item: paths, icon }).catch(() => {});\n      }\n    };\n\n    const onUp = () => cleanup();\n\n    const cleanup = () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n      if (dragCleanup === cleanup) dragCleanup = null;\n    };\n\n    dragCleanup = cleanup;\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n  }\n\n  async function handleRowDoubleClick(index) {\n    if (!selectedIndices.has(index) || selectedIndices.size > 1) {\n      selectSingle(index);\n      await tick();\n    }\n    await invoke('open', { paths: [results[index].path] }).catch((err) => {\n      showToast(`Failed to open: ${String(err)}`);\n    });\n  }\n\n  function closeContextMenu() {\n    contextMenu = {\n      ...contextMenu,\n      visible: false\n    };\n  }\n\n  async function openSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('open', { paths });\n    } catch (err) {\n      showToast(`Failed to open: ${String(err)}`);\n    }\n  }\n\n  async function openWithFallback() {\n    const target = primaryEntry();\n    if (!target) {\n      return;\n    }\n\n    try {\n      await invoke('open_with', { path: target.path });\n    } catch (err) {\n      showToast(`Open With failed: ${String(err)}`);\n    }\n  }\n\n  async function revealSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('reveal_in_finder', { paths });\n    } catch (err) {\n      showToast(`Failed to reveal in Finder: ${String(err)}`);\n    }\n  }\n\n  async function copySelectedPaths() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('copy_paths', { paths });\n      showToast(`Copied ${paths.length} path(s)`);\n    } catch (err) {\n      showToast(`Failed to copy path: ${String(err)}`);\n    }\n  }\n\n  async function copyFiles() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('copy_files', { paths });\n      showToast(`Copied ${paths.length} item(s)`);\n    } catch (err) {\n      showToast(`Failed to copy: ${String(err)}`);\n    }\n  }\n\n  async function trashSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    const message =\n      paths.length === 1\n        ? 'Move selected item to Trash?'\n        : `Move ${paths.length} items to Trash?`;\n\n    if (!window.confirm(message)) {\n      return;\n    }\n\n    try {\n      await invoke('move_to_trash', { paths });\n      showToast('Moved to Trash.');\n      clearSelection();\n      await runSearch();\n    } catch (err) {\n      showToast(`Failed to move to Trash: ${String(err)}`);\n    }\n  }\n\n  async function resetIndex() {\n    if (indexStatus.state === 'Indexing') {\n      showToast('Indexing in progress. Please try again after it completes.');\n      return;\n    }\n\n    results = [];\n    totalResults = 0;\n    totalResultsKnown = false;\n    clearSelection();\n    scanned = 0;\n    dbLatencyMs = null;\n    dbLastQuery = '';\n    indexStatus = { ...indexStatus, state: 'Indexing', entriesCount: 0, message: null };\n    indexingStartTime = Date.now();\n    indexingElapsed = '';\n    indexingFinishedAt = '';\n\n    try {\n      await invoke('reset_index');\n    } catch (err) {\n      showToast(`Failed to reset index: ${String(err)}`);\n      await refreshStatus();\n    }\n  }\n\n  function isMultiSelected() {\n    return selectedIndices.size > 1;\n  }\n\n  function autoResizeRenameInput() {\n    if (!renameInputEl) return;\n    renameInputEl.style.height = '0';\n    renameInputEl.style.height = renameInputEl.scrollHeight + 'px';\n  }\n\n  async function startRename() {\n    if (isMultiSelected()) {\n      return;\n    }\n\n    const idx = lastSelectedIndex;\n    if (idx < 0 || !results[idx]) {\n      return;\n    }\n\n    const entry = results[idx];\n\n    // Calculate overlay position mathematically.\n    // Name cell text starts at: padding-left(16) + icon(16) + gap(6) = 38px from cell left.\n    // Textarea has padding-left: 0 and border: 1.5px, so text starts ~2px from overlay left.\n    if (tableContainer) {\n      const rect = tableContainer.getBoundingClientRect();\n      const cellLeft = rect.left - tableContainer.scrollLeft;\n      const textLeft = cellLeft + 38;\n      const cellRight = cellLeft + colWidths.name;\n      const rowTop = rect.top + idx * rowHeight - tableContainer.scrollTop;\n      renameOverlay = {\n        top: rowTop,\n        left: textLeft - 2,\n        width: cellRight - textLeft + 2 - 4\n      };\n    }\n\n    editing = {\n      active: true,\n      path: entry.path,\n      index: idx,\n      draftName: entry.name\n    };\n\n    await tick();\n\n    if (renameInputEl) {\n      autoResizeRenameInput();\n      renameInputEl.focus();\n      const extPos = !entry.isDir ? entry.name.lastIndexOf('.') : -1;\n      const selectionEnd = extPos > 0 ? extPos : entry.name.length;\n      renameInputEl.setSelectionRange(0, selectionEnd);\n    }\n  }\n\n  function cancelRename() {\n    editing = {\n      active: false,\n      path: '',\n      index: -1,\n      draftName: ''\n    };\n  }\n\n  async function commitRename() {\n    if (!editing.active || editing.index < 0 || !results[editing.index]) {\n      return;\n    }\n\n    const current = results[editing.index];\n    const nextName = editing.draftName;\n\n    try {\n      await invoke('rename', {\n        path: current.path,\n        newName: nextName\n      });\n      cancelRename();\n      await runSearch();\n    } catch (err) {\n      showToast(`Failed to rename: ${String(err)}`);\n      await tick();\n      renameInputEl?.focus();\n    }\n  }\n\n  function onGlobalClick() {\n    closeContextMenu();\n  }\n\n  function onTitleBarMouseDown(event) {\n    if (event.button !== 0) {\n      return;\n    }\n\n    const activeElement = document.activeElement;\n    if (activeElement instanceof HTMLElement && isTextInputTarget(activeElement)) {\n      activeElement.blur();\n    }\n  }\n\n  async function focusSearch() {\n    await getCurrentWindow().show();\n    await getCurrentWindow().setFocus();\n    searchInputEl?.focus();\n    searchInputEl?.select();\n  }\n\n  function isTextInputTarget(target) {\n    return (\n      target instanceof HTMLInputElement ||\n      target instanceof HTMLTextAreaElement ||\n      target?.isContentEditable\n    );\n  }\n\n  async function handleKeydown(event) {\n    const isMetaSelectAll = (event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'a';\n    const isMetaCopy = (event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'c';\n    const target = event.target;\n    const isTextInput = isTextInputTarget(target);\n\n    if (isMetaCopy && isTextInput) {\n      return;\n    }\n\n    if (isMetaSelectAll) {\n      if (isTextInput) {\n        event.preventDefault();\n        if (target instanceof HTMLInputElement || target instanceof HTMLTextAreaElement) {\n          target.select();\n        }\n        return;\n      }\n    }\n\n    if (editing.active) {\n      if (event.key === 'Enter') {\n        event.preventDefault();\n        await commitRename();\n        return;\n      }\n\n      if (event.key === 'Escape') {\n        event.preventDefault();\n        const idx = editing.index;\n        cancelRename();\n        selectSingle(idx);\n        await tick();\n        tableContainer?.querySelector('.row.selected')?.focus();\n        return;\n      }\n      return;\n    }\n\n    if (event.key === 'Escape') {\n      event.preventDefault();\n      clearSelection();\n      return;\n    }\n\n    if (event.key === 'ArrowDown') {\n      event.preventDefault();\n      moveSelection(1, event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'ArrowUp') {\n      event.preventDefault();\n      moveSelection(-1, event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'PageDown') {\n      event.preventDefault();\n      moveSelection(Math.floor(viewportHeight / rowHeight), event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'PageUp') {\n      event.preventDefault();\n      moveSelection(-Math.floor(viewportHeight / rowHeight), event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'Enter') {\n      event.preventDefault();\n      if (platform === 'windows') {\n        await openSelected();\n      } else {\n        await startRename();\n      }\n      return;\n    }\n\n    if (event.key === 'F2') {\n      event.preventDefault();\n      await startRename();\n      return;\n    }\n\n    if (event.key === ' ' && !isTextInput) {\n      event.preventDefault();\n      const entry = primaryEntry();\n      if (entry) {\n        await invoke('quick_look', { path: entry.path });\n      }\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'f') {\n      event.preventDefault();\n      clearSelection();\n      searchInputEl?.focus();\n      searchInputEl?.select();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'o') {\n      event.preventDefault();\n      await openSelected();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key === 'Enter') {\n      event.preventDefault();\n      await revealSelected();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'c') {\n      event.preventDefault();\n      await copySelectedPaths();\n      return;\n    }\n\n    if (isMetaSelectAll) {\n      event.preventDefault();\n      selectedIndices = new Set(Array.from({ length: results.length }, (_, i) => i));\n      return;\n    }\n\n    if (event.key === 'Delete' || ((event.metaKey || event.ctrlKey) && event.key === 'Backspace')) {\n      if (!isTextInput) {\n        event.preventDefault();\n        await trashSelected();\n      }\n      return;\n    }\n  }\n\n  function formatSize(entry) {\n    if (entry.isDir || entry.size == null) return '';\n    const bytes = entry.size;\n    if (bytes < 1024) return `${bytes} B`;\n    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n    if (bytes < 1024 * 1024 * 1024) return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n    return `${(bytes / (1024 * 1024 * 1024)).toFixed(1)} GB`;\n  }\n\n  function formatModified(entry) {\n    if (!entry.mtime) {\n      return '';\n    }\n\n    const d = new Date(entry.mtime * 1000);\n    const pad = (n) => String(n).padStart(2, '0');\n    return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;\n  }\n\n  function formatLastUpdated(timestamp) {\n    if (!timestamp) {\n      return '-';\n    }\n\n    return new Date(timestamp * 1000).toLocaleString();\n  }\n\n  function formatElapsed(ms) {\n    const totalSec = Math.floor(ms / 1000);\n    const min = Math.floor(totalSec / 60);\n    const sec = totalSec % 60;\n    return min > 0 ? `${min}m ${sec}s` : `${sec}s`;\n  }\n\n  function updateElapsed() {\n    if (indexingStartTime && indexStatus.state === 'Indexing') {\n      indexingElapsed = formatElapsed(Date.now() - indexingStartTime);\n    }\n  }\n\n  function startElapsedTimer() {\n    clearInterval(elapsedTimer);\n    indexingStartTime = Date.now();\n    indexingElapsed = '0s';\n    indexingFinishedAt = '';\n    elapsedTimer = setInterval(updateElapsed, 1000);\n  }\n\n  function stopElapsedTimer() {\n    clearInterval(elapsedTimer);\n    if (indexingStartTime) {\n      const elapsed = Date.now() - indexingStartTime;\n      indexingFinishedAt = `${formatElapsed(elapsed)}`;\n    }\n    indexingStartTime = null;\n    indexingElapsed = '';\n  }\n\n  function displayPath(path) {\n    if (!path) {\n      return path;\n    }\n\n    if (!homePrefix) {\n      return path;\n    }\n\n    if (path === homePrefix) {\n      return '~';\n    }\n\n    if (path.startsWith(`${homePrefix}/`)) {\n      return `~${path.slice(homePrefix.length)}`;\n    }\n\n    return path;\n  }\n\n  let unlistenFns = [];\n\n  onMount(async () => {\n    const t0 = performance.now();\n    const ms = () => Math.round(performance.now() - t0);\n    const DEBUG_STARTUP = false;\n    const flog = DEBUG_STARTUP ? (msg) => invoke('frontend_log', { msg }).catch(() => {}) : () => {};\n\n    flog(`[startup/fe] onMount entered`);\n\n    updateViewportHeight();\n    flog(`[startup/fe] +${ms()}ms updateViewportHeight done`);\n\n    invoke('set_native_theme', { theme });\n\n    platform = await invoke('get_platform');\n    flog(`[startup/fe] +${ms()}ms get_platform done`);\n\n    const unlistenProgress = await listen('index_progress', (event) => {\n      scanned = event.payload.scanned;\n      if (indexStatus.state !== 'Indexing') {\n        indexStatus = {\n          ...indexStatus,\n          state: 'Indexing'\n        };\n      }\n    });\n    flog(`[startup/fe] +${ms()}ms listen(index_progress) registered`);\n\n    const unlistenState = await listen('index_state', (event) => {\n      flog(`[startup/fe] index_state event received: ${event.payload.state} at +${ms()}ms`);\n      const prevState = indexStatus.state;\n      indexStatus = {\n        ...indexStatus,\n        state: event.payload.state,\n        message: event.payload.message ?? null,\n        isCatchup: event.payload.isCatchup ?? false\n      };\n\n      if (event.payload.state === 'Indexing' && prevState !== 'Indexing') {\n        if (prevState === 'Ready') {\n          lastReadyCount = indexStatus.entriesCount;\n        }\n        startElapsedTimer();\n      } else if (event.payload.state !== 'Indexing' && prevState === 'Indexing') {\n        stopElapsedTimer();\n      }\n\n      if (event.payload.state === 'Ready') {\n        scheduleSearch();\n      }\n    });\n    flog(`[startup/fe] +${ms()}ms listen(index_state) registered`);\n\n    const unlistenUpdated = await listen('index_updated', (event) => {\n      indexStatus = {\n        ...indexStatus,\n        entriesCount: event.payload.entriesCount,\n        lastUpdated: event.payload.lastUpdated,\n        permissionErrors: event.payload.permissionErrors ?? indexStatus.permissionErrors\n      };\n\n      scheduleSearch(true);\n    });\n\n    const unlistenFocus = await listen('focus_search', () => {\n      void focusSearch();\n    });\n\n    const unlistenCtxMenuAction = await listen('context_menu_action', (event) => {\n      switch (event.payload) {\n        case 'open': void openSelected(); break;\n        case 'quick_look': {\n          const e = primaryEntry();\n          if (e) void invoke('quick_look', { path: e.path });\n          break;\n        }\n        case 'open_with': void openWithFallback(); break;\n        case 'reveal': void revealSelected(); break;\n        case 'copy_files': void copyFiles(); break;\n        case 'copy_path': void copySelectedPaths(); break;\n        case 'trash': void trashSelected(); break;\n        case 'rename': void startRename(); break;\n      }\n    });\n\n    unlistenFns = [unlistenProgress, unlistenState, unlistenUpdated, unlistenFocus, unlistenCtxMenuAction];\n    flog(`[startup/fe] +${ms()}ms all listeners registered`);\n\n    // Fetch backend state IMMEDIATELY after listeners are registered.\n    // Events emitted before listener registration are lost, so this\n    // is the only reliable way to get the current state.\n    await refreshStatus();\n    flog(`[startup/fe] +${ms()}ms refreshStatus done (state=${indexStatus.state})`);\n\n    // Show Svelte UI: remove skeleton, focus search input.\n    await tick();\n    document.getElementById('skeleton')?.remove();\n    await focusSearch();\n    flog(`[startup/fe] +${ms()}ms WINDOW VISIBLE â€” skeleton removed`);\n\n    try {\n      homePrefix = await invoke('get_home_dir');\n    } catch {\n      homePrefix = '';\n    }\n    flog(`[startup/fe] +${ms()}ms get_home_dir done`);\n\n    if (!localStorage.getItem('everything-fda-notice-v1')) {\n      showToast('macOS Full Disk Access permission may be required for full disk search.');\n      localStorage.setItem('everything-fda-notice-v1', '1');\n    }\n    flog(`[startup/fe] +${ms()}ms calling runSearch...`);\n    await runSearch();\n    flog(`[startup/fe] +${ms()}ms runSearch done`);\n\n    if (typeof ResizeObserver !== 'undefined') {\n      tableResizeObserver = new ResizeObserver(() => {\n        scheduleViewportHeightUpdate();\n      });\n      if (tableContainer) {\n        tableResizeObserver.observe(tableContainer);\n      } else if (tableAreaEl) {\n        tableResizeObserver.observe(tableAreaEl);\n      }\n    }\n\n    window.addEventListener('resize', scheduleViewportHeightUpdate);\n    window.addEventListener('click', onGlobalClick);\n    statusRefreshTimer = setInterval(() => {\n      if (indexStatus.state === 'Indexing') {\n        void refreshStatus();\n      }\n    }, 1000);\n    console.log(`[startup/fe] +${ms()}ms onMount complete`);\n  });\n\n  onDestroy(async () => {\n    clearTimeout(searchTimer);\n    clearTimeout(toastTimer);\n    clearInterval(statusRefreshTimer);\n    clearInterval(elapsedTimer);\n    resizeCleanup?.();\n\n    for (const unlisten of unlistenFns) {\n      unlisten();\n    }\n\n    tableResizeObserver?.disconnect();\n    tableResizeObserver = null;\n    if (viewportResizeRaf !== null) {\n      cancelAnimationFrame(viewportResizeRaf);\n      viewportResizeRaf = null;\n    }\n    window.removeEventListener('resize', scheduleViewportHeightUpdate);\n    window.removeEventListener('click', onGlobalClick);\n  });\n</script>\n\n<svelte:window on:keydown={handleKeydown} />\n\n<div class=\"app-shell\" data-theme={theme}>\n  <div class=\"title-bar\" role=\"presentation\" data-tauri-drag-region on:mousedown={onTitleBarMouseDown}>\n    <div class=\"title-left\"></div>\n    <div class=\"title-center\">\n      <svg class=\"title-icon\" viewBox=\"0 0 215 205\" fill-rule=\"evenodd\" aria-hidden=\"true\">\n        <path d=\"M85 0c46.9 0 85 38.1 85 85 0 20.1-7.2 38.5-19.2 52.7l40.7 40.8c5.8 5.8 5.8 15.2 0 21-5.8 5.8-15.2 5.8-21 0l-40.7-40.7c-13.6 9.7-30.4 15.2-44.8 15.2-46.9 0-85-42.1-85-89 0-46.9 38.1-85 85-85z m0 32c-29.3 0-53 23.7-53 53 0 29.3 23.7 53 53 53 29.3 0 53-23.7 53-53 0-29.3-23.7-53-53-53z\"/>\n      </svg>\n      <span class=\"title-text\">Everything</span>\n    </div>\n    <div class=\"title-right\"></div>\n  </div>\n\n  <header class=\"search-bar\">\n    <input\n      bind:this={searchInputEl}\n      class=\"search-input\"\n      type=\"text\"\n      bind:value={query}\n      on:input={scheduleSearch}\n      on:focus={clearSelection}\n      placeholder=\"Search file/folder names\"\n      autocomplete=\"off\"\n      spellcheck=\"false\"\n    />\n  </header>\n\n  <section class=\"table-area\" bind:this={tableAreaEl} style={tableGridStyle}>\n    <div class=\"table-header\">\n      <div class=\"table-header-track\">\n        <div class=\"col name\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('name')}>\n            Name{#if sortBy === 'name'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n          <button\n            type=\"button\"\n            class=\"col-resizer\"\n            class:active={resizingColumn === 'name'}\n            on:mousedown={(event) => startColumnResize(event, 'name')}\n            aria-label=\"Resize Name column\"\n          />\n        </div>\n\n        <div class=\"col path\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('dir')}>\n            Path{#if sortBy === 'dir'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n          <button\n            type=\"button\"\n            class=\"col-resizer\"\n            class:active={resizingColumn === 'path'}\n            on:mousedown={(event) => startColumnResize(event, 'path')}\n            aria-label=\"Resize Path column\"\n          />\n        </div>\n\n        <div class=\"col size\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('size')}>\n            Size{#if sortBy === 'size'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n        </div>\n\n        <div class=\"col modified\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('mtime')}>\n            Modified{#if sortBy === 'mtime'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <div\n      class=\"table-body\"\n      bind:this={tableContainer}\n      on:scroll={() => {\n        scrollTop = tableContainer.scrollTop;\n        headerScrollLeft = tableContainer.scrollLeft;\n        if (editing.active) cancelRename();\n        const scrollBottom = scrollTop + tableContainer.clientHeight;\n        if (scrollBottom >= totalHeight - rowHeight * 10) {\n          void loadMore();\n        }\n      }}\n    >\n      <div class=\"spacer\" style={`height:${totalHeight}px`}>\n        <div class=\"rows\" style={`transform: translateY(${translateY}px);`}>\n          {#each visibleRows as entry, localIndex}\n            {@const index = startIndex + localIndex}\n            <div\n              class=\"row {selectedIndices.has(index) ? 'selected' : ''}\"\n              on:mousedown={(event) => handleRowMouseDown(event, index)}\n              on:click={(event) => handleRowClick(event, index)}\n              on:keydown={(event) => handleRowA11yKeydown(event, index)}\n              on:dblclick={() => handleRowDoubleClick(index)}\n              on:contextmenu={(event) => handleRowContextMenu(event, index)}\n              role=\"row\"\n              tabindex=\"0\"\n            >\n              <div class=\"cell name\">\n                <img class=\"file-icon\" src={iconFor(entry)} alt=\"\" />\n                <span class=\"ellipsis\" class:name-editing={editing.active && editing.index === index}>{#each highlightSegments(entry.name, query) as seg}{#if seg.hl}<mark class=\"hl\">{seg.text}</mark>{:else}{seg.text}{/if}{/each}</span>\n              </div>\n              <div class=\"cell path\"><span class=\"ellipsis\">{displayPath(entry.dir)}</span></div>\n              <div class=\"cell size\">{formatSize(entry)}</div>\n              <div class=\"cell modified\">{formatModified(entry)}</div>\n            </div>\n          {/each}\n        </div>\n      </div>\n    </div>\n  </section>\n\n  <footer class=\"status-bar\">\n    <div class=\"status-left\">\n      <span class=\"status-state\">\n        <span class=\"state-dot {indexStatus.state === 'Indexing' ? 'indexing' : indexStatus.state === 'Error' ? 'error' : 'ready'}\"></span>\n        {#if indexStatus.state === 'Indexing'}\n          Indexing{#if lastReadyCount > 0} ({Math.min(99, Math.round((scanned / lastReadyCount) * 100))}%){/if}{#if indexingElapsed} Â· {indexingElapsed}{/if}\n          {#if !indexStatus.isCatchup}\n            Â· {scanned.toLocaleString()} scanned\n          {/if}\n        {:else}\n          Index: {indexStatus.state}\n        {/if}\n      </span>\n      <span>{indexStatus.entriesCount.toLocaleString()} entries</span>\n      {#if indexingFinishedAt && indexStatus.state !== 'Indexing'}\n        <span>in {indexingFinishedAt}</span>\n      {/if}\n      {#if dbLatencyMs !== null && dbLastQuery}\n        <span>\"{dbLastQuery}\" {dbLatencyMs}ms Â· {totalResults} results</span>\n      {/if}\n      {#if searchModeLabel === 'spotlight' || searchModeLabel === 'spotlight_timeout'}\n        <span class=\"status-spotlight\">Spotlight fallback{#if searchModeLabel === 'spotlight_timeout'} (partial){/if}</span>\n      {/if}\n      {#if indexStatus.permissionErrors > 0}\n        <span class=\"status-warning\">{indexStatus.permissionErrors.toLocaleString()} permission errors</span>\n      {/if}\n      {#if indexStatus.message}\n        <span class={indexStatus.isCatchup ? 'index-progress' : 'status-error'}>{indexStatus.message}</span>\n      {/if}\n    </div>\n    <div class=\"status-right\">\n      <button class=\"status-btn theme-btn\" on:click={cycleTheme} title=\"Switch theme\">\n        {theme === 'dark' ? 'â˜€ Light' : 'â—‘ Dark'}\n      </button>\n      <button\n        class=\"status-btn rebuild-btn\"\n        on:click={resetIndex}\n        disabled={indexStatus.state === 'Indexing'}\n        title={indexStatus.state === 'Indexing' ? 'Cannot reset while indexing is in progress.' : 'Reset and rebuild the index.'}\n      >\n        <svg class=\"rebuild-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <path d=\"M23 4v6h-6\"/><path d=\"M20.49 15a9 9 0 1 1-2.12-9.36L23 10\"/>\n        </svg>\n        Rebuild Index\n      </button>\n    </div>\n  </footer>\n\n  {#if editing.active}\n    <div\n      class=\"rename-overlay\"\n      style=\"top:{renameOverlay.top}px; left:{renameOverlay.left}px; width:{renameOverlay.width}px;\"\n      role=\"presentation\"\n      on:mousedown|stopPropagation\n    >\n      <textarea\n        bind:this={renameInputEl}\n        class=\"rename-textarea\"\n        bind:value={editing.draftName}\n        on:input={autoResizeRenameInput}\n        on:click|stopPropagation\n        on:blur={commitRename}\n      />\n    </div>\n  {/if}\n\n  {#if contextMenu.visible}\n    <div class=\"context-menu\" style={`left:${contextMenu.x}px;top:${contextMenu.y}px;`}>\n      <button on:click={() => (closeContextMenu(), openSelected())}>Open</button>\n      <button on:click={async () => { closeContextMenu(); const e = primaryEntry(); if (e) await invoke('quick_look', { path: e.path }); }}>Quick Look</button>\n      <button on:click={() => (closeContextMenu(), openWithFallback())}>Open With... (Reveal in Finder)</button>\n      <button on:click={() => (closeContextMenu(), revealSelected())}>Reveal in Finder</button>\n      <button on:click={() => (closeContextMenu(), copySelectedPaths())}>Copy Path</button>\n      <button on:click={() => (closeContextMenu(), trashSelected())}>Move to Trash</button>\n      {#if selectedIndices.size === 1}\n        <button on:click={() => (closeContextMenu(), startRename())}>Rename</button>\n      {/if}\n    </div>\n  {/if}\n\n  {#if toast}\n    <div class=\"toast\">{toast}</div>\n  {/if}\n</div>\n\n<style>\n  :global(:root) {\n    color-scheme: light dark;\n    --bg-app: transparent;\n    --text-primary: #0d1826;\n    --text-muted: #48596c;\n    --bar-grad-top: rgba(255, 255, 255, 0.48);\n    --bar-grad-bottom: rgba(248, 250, 253, 0.42);\n    --surface-header: rgba(252, 252, 255, 0.40);\n    --surface: rgba(255, 255, 255, 0.22);\n    --border-soft: rgba(0, 0, 0, 0.07);\n    --border-input: rgba(0, 0, 0, 0.13);\n    --focus-ring: #6f96e6;\n    --row-border: rgba(0, 0, 0, 0.032);\n    --row-hover: rgba(0, 0, 0, 0.06);\n    --row-selected: rgba(0, 0, 0, 0.12);\n    --button-bg: rgba(255, 255, 255, 0.62);\n    --button-border: rgba(0, 0, 0, 0.10);\n    --button-text: #2c3e50;\n    --menu-bg: rgba(240, 241, 248, 0.90);\n    --menu-border: rgba(0, 0, 0, 0.06);\n    --menu-hover: rgba(255, 255, 255, 0.62);\n    --menu-text: #1a2a38;\n    --error-text: #b64545;\n    --warning-text: #8f6500;\n    --toast-bg: rgba(18, 22, 32, 0.90);\n    --toast-text: #ffffff;\n  }\n\n  @media (prefers-color-scheme: dark) {\n    :global(:root) {\n      --bg-app: transparent;\n      --text-primary: #e6e6ea;\n      --text-muted: #9494a4;\n      --bar-grad-top: rgba(38, 38, 46, 0.52);\n      --bar-grad-bottom: rgba(30, 30, 38, 0.46);\n      --surface-header: rgba(32, 32, 40, 0.46);\n      --surface: rgba(18, 18, 26, 0.32);\n      --border-soft: rgba(255, 255, 255, 0.065);\n      --border-input: rgba(255, 255, 255, 0.14);\n      --focus-ring: #5b8bd9;\n      --row-border: rgba(255, 255, 255, 0.026);\n      --row-hover: rgba(255, 255, 255, 0.08);\n      --row-selected: rgba(255, 255, 255, 0.14);\n      --button-bg: rgba(255, 255, 255, 0.072);\n      --button-border: rgba(255, 255, 255, 0.11);\n      --button-text: #d6d6e0;\n      --menu-bg: rgba(36, 36, 46, 0.90);\n      --menu-border: rgba(255, 255, 255, 0.066);\n      --menu-hover: rgba(255, 255, 255, 0.062);\n      --menu-text: #e0e0e8;\n      --error-text: #ff9d9d;\n      --warning-text: #e0c670;\n      --toast-bg: rgba(10, 10, 16, 0.93);\n      --toast-text: #f2f2f6;\n    }\n  }\n\n  /* â”€â”€ Theme: Dark â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme=\"dark\"]) {\n    color-scheme: dark;\n    --bg-app: #1E1E21;\n    --text-primary: #E2E8F0;\n    --text-muted: #94A3B8;\n    --bar-grad-top: #1E1E21;\n    --bar-grad-bottom: #1E1E21;\n    --surface-header: #1E1E21;\n    --surface: #1E1E21;\n    --bg-input: #161618;\n    --border-soft: #2A2A2D;\n    --border-input: rgba(255, 255, 255, 0.06);\n    --focus-ring: #4DA8FF;\n    --accent: #4DA8FF;\n    --row-border: rgba(255, 255, 255, 0.02);\n    --row-hover: #282828;\n    --row-selected: rgba(77, 168, 255, 0.10);\n    --button-bg: rgba(255, 255, 255, 0.05);\n    --button-border: #2A2A2D;\n    --button-text: #94A3B8;\n    --menu-bg: #252528;\n    --menu-border: #2A2A2D;\n    --menu-hover: rgba(255, 255, 255, 0.04);\n    --menu-text: #E2E8F0;\n    --error-text: #ff9d9d;\n    --warning-text: #e0c670;\n    --toast-bg: rgba(10, 10, 16, 0.93);\n    --toast-text: #f2f2f6;\n  }\n\n  /* â”€â”€ Theme: Light â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme=\"light\"]) {\n    color-scheme: light;\n    --bg-app: #F5F5F7;\n    --text-primary: #1C1C1E;\n    --text-muted: #6E6E7A;\n    --bar-grad-top: #F5F5F7;\n    --bar-grad-bottom: #F5F5F7;\n    --surface-header: #F5F5F7;\n    --surface: #F5F5F7;\n    --bg-input: #FFFFFF;\n    --border-soft: #D1D1D6;\n    --border-input: rgba(0, 0, 0, 0.10);\n    --focus-ring: #3A8BF5;\n    --accent: #3A8BF5;\n    --row-border: rgba(0, 0, 0, 0.04);\n    --row-hover: rgba(0, 0, 0, 0.04);\n    --row-selected: rgba(58, 139, 245, 0.10);\n    --button-bg: #FFFFFF;\n    --button-border: #D1D1D6;\n    --button-text: #3C3C43;\n    --menu-bg: #FFFFFF;\n    --menu-border: #D1D1D6;\n    --menu-hover: rgba(0, 0, 0, 0.05);\n    --menu-text: #1C1C1E;\n    --error-text: #D93025;\n    --warning-text: #B45309;\n    --toast-bg: rgba(255, 255, 255, 0.95);\n    --toast-text: #1C1C1E;\n  }\n\n  /* â”€â”€ Themed element overrides â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme]) {\n    background: var(--bg-app);\n  }\n\n  /* Search bar: flat, no gradient, no separator */\n  :global([data-theme]) .search-bar {\n    height: 44px;\n    padding: 0 16px;\n    background: var(--bg-app);\n    border-bottom: none;\n  }\n\n  :global([data-theme]) .search-input {\n    backdrop-filter: none;\n    -webkit-backdrop-filter: none;\n    font-family: 'JetBrains Mono', 'SF Mono', monospace;\n    font-size: 12px;\n    height: 34px;\n    border-radius: 8px;\n  }\n\n  /* Table header: flat bg, 16px edge padding */\n  :global([data-theme]) .table-header {\n    background: var(--bg-app);\n  }\n\n  :global([data-theme]) .col-button {\n    padding: 0 8px;\n  }\n\n  :global([data-theme]) .col.name .col-button {\n    padding-left: 16px;\n  }\n\n  /* Row cells: JetBrains Mono, 16px outer edges */\n  :global([data-theme]) .cell {\n    font-family: 'JetBrains Mono', monospace;\n  }\n\n  :global([data-theme]) .cell.name {\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    padding-left: 16px;\n    font-size: 12px;\n    color: var(--text-primary);\n  }\n\n  :global([data-theme]) .cell.path {\n    font-size: 11px;\n  }\n\n  :global([data-theme]) .cell.size {\n    font-size: 11px;\n  }\n\n  :global([data-theme]) .cell.modified {\n    padding-right: 16px;\n    font-size: 11px;\n    white-space: nowrap;\n  }\n\n  :global([data-theme]) .row.selected {\n    box-shadow: inset 3px 0 0 var(--accent);\n  }\n\n  /* Dim path/size/date cells in themed mode */\n  :global([data-theme]) .cell.path,\n  :global([data-theme]) .cell.size,\n  :global([data-theme]) .cell.modified {\n    color: var(--text-muted);\n  }\n\n  :global(:root) {\n    background: transparent;\n  }\n\n  :global(html, body) {\n    margin: 0;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n    background: transparent;\n    color: var(--text-primary);\n    font-family: Inter, 'SF Pro Text', 'Segoe UI', Helvetica, Arial, sans-serif;\n  }\n\n  :global(#app) {\n    width: 100%;\n    height: 100%;\n  }\n\n  .app-shell {\n    display: grid;\n    grid-template-rows: auto auto 1fr auto;\n    height: 100%;\n    min-width: 0;\n  }\n\n  .title-bar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 44px;\n    padding: 0 16px;\n    background: var(--surface-header);\n    cursor: default;\n    flex-shrink: 0;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-left {\n    width: 72px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-center {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-right {\n    width: 72px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-icon {\n    width: 14px;\n    height: 14px;\n    fill: var(--accent);\n    flex-shrink: 0;\n  }\n\n  .title-text {\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--text-primary);\n    letter-spacing: -0.01em;\n  }\n\n  .search-bar {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 8px;\n    background: linear-gradient(180deg, var(--bar-grad-top) 0%, var(--bar-grad-bottom) 100%);\n    border-bottom: 1px solid var(--border-soft);\n    min-width: 0;\n    flex-shrink: 0;\n  }\n\n  .search-input {\n    display: block;\n    box-sizing: border-box;\n    width: 100%;\n    min-width: 0;\n    flex: 1 1 auto;\n    height: 36px;\n    border: 1px solid var(--border-input);\n    border-radius: 14px;\n    padding: 0 10px;\n    font-size: 14px;\n    background: var(--bg-input, var(--surface));\n    color: var(--text-primary);\n    backdrop-filter: blur(12px) saturate(160%);\n    -webkit-backdrop-filter: blur(12px) saturate(160%);\n  }\n\n  .search-input::placeholder {\n    color: var(--text-muted);\n    opacity: 0.85;\n    font-size: 12px;\n  }\n\n  .search-input:focus {\n    outline: none;\n    border-color: var(--focus-ring);\n    box-shadow: 0 0 0 2px rgba(125, 169, 255, 0.25);\n  }\n\n  .table-area {\n    display: grid;\n    grid-template-rows: auto 1fr;\n    min-height: 0;\n    min-width: 0;\n  }\n\n  .table-header-track,\n  .row {\n    display: grid;\n    grid-template-columns: var(--col-name) var(--col-path) var(--col-size) var(--col-modified);\n    align-items: center;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .table-header {\n    height: 32px;\n    border-bottom: 1px solid var(--border-soft);\n    background: var(--surface-header);\n    user-select: none;\n    overflow: hidden;\n    flex-shrink: 0;\n  }\n\n  .table-header-track {\n    height: 100%;\n    transform: translateX(var(--header-offset, 0px));\n    will-change: transform;\n  }\n\n  .table-header .col {\n    position: relative;\n    min-width: 0;\n    height: 100%;\n  }\n\n  .col-button {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: flex-start;\n    gap: 4px;\n    box-sizing: border-box;\n    padding: 0 8px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 11px;\n    font-weight: 600;\n    line-height: 1;\n    color: var(--text-muted);\n    text-align: left;\n    margin: 0;\n    border: none;\n    background: transparent;\n    cursor: pointer;\n  }\n\n  .sort-icon {\n    width: 10px;\n    height: 10px;\n    flex-shrink: 0;\n    color: var(--accent);\n  }\n\n  .col-resizer {\n    position: absolute;\n    top: 0;\n    right: -4px;\n    width: 8px;\n    height: 100%;\n    border: none;\n    padding: 0;\n    background: transparent;\n    cursor: col-resize;\n    z-index: 30;\n  }\n\n  .col-resizer::after {\n    content: '';\n    position: absolute;\n    top: 7px;\n    bottom: 7px;\n    left: 50%;\n    width: 1px;\n    transform: translateX(-50%);\n    background: var(--border-soft);\n    opacity: 0;\n    transition: opacity 0.15s ease;\n  }\n\n  .table-header .col:hover .col-resizer::after,\n  .col-resizer.active::after {\n    opacity: 1;\n  }\n\n  .table-body {\n    overflow: auto;\n    min-height: 0;\n    min-width: 0;\n    background: var(--surface);\n  }\n\n  .spacer {\n    position: relative;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .rows {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .row {\n    height: 30px;\n    border-bottom: 1px solid var(--row-border);\n    cursor: default;\n    -webkit-user-select: none;\n    user-select: none;\n    outline: none;\n  }\n\n  .row:hover {\n    background: var(--row-hover);\n  }\n\n  .row.selected {\n    background: var(--row-selected);\n  }\n\n  .cell {\n    padding: 0 8px;\n    font-size: 12px;\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    min-width: 0;\n  }\n\n  .cell.size {\n    text-align: right;\n    font-variant-numeric: tabular-nums;\n  }\n\n  .ellipsis {\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n\n  .hl {\n    background: none;\n    color: inherit;\n    font-weight: 700;\n  }\n\n  .file-icon {\n    width: 16px;\n    height: 16px;\n    flex: 0 0 auto;\n  }\n\n  .name-editing {\n    opacity: 0.25;\n  }\n\n  .rename-overlay {\n    position: fixed;\n    z-index: 100;\n    min-width: 120px;\n  }\n\n  .rename-textarea {\n    display: block;\n    width: 100%;\n    box-sizing: border-box;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 12px;\n    line-height: 18px;\n    padding: 5px 4px 5px 0;\n    border: 1.5px solid var(--focus-ring);\n    border-radius: 4px;\n    background: var(--bg-input, var(--surface));\n    color: var(--text-primary);\n    outline: none;\n    resize: none;\n    overflow: hidden;\n    box-shadow: 0 2px 14px rgba(0, 0, 0, 0.22), 0 0 0 3px rgba(77, 168, 255, 0.13);\n  }\n\n  .status-bar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 32px;\n    padding: 0 16px;\n    background: var(--surface-header);\n    border-top: 1px solid var(--border-soft);\n    font-family: 'JetBrains Mono', monospace;\n    font-size: 11px;\n    color: var(--text-muted);\n    white-space: nowrap;\n    overflow: hidden;\n    min-width: 0;\n    flex-shrink: 0;\n  }\n\n  .status-left {\n    display: flex;\n    align-items: center;\n    gap: 16px;\n    overflow: hidden;\n    min-width: 0;\n  }\n\n  .status-right {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    flex-shrink: 0;\n  }\n\n  .status-btn {\n    border: 1px solid var(--button-border);\n    border-radius: 5px;\n    background: var(--button-bg);\n    color: var(--button-text);\n    font-size: 11px;\n    height: 22px;\n    padding: 0 8px;\n    cursor: pointer;\n  }\n\n  .status-btn:hover {\n    filter: brightness(1.06);\n  }\n\n  .status-btn:disabled {\n    opacity: 0.55;\n    cursor: not-allowed;\n    filter: none;\n  }\n\n  .status-state {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n  }\n\n  .state-dot {\n    width: 6px;\n    height: 6px;\n    border-radius: 50%;\n    flex-shrink: 0;\n  }\n\n  .state-dot.ready { background: #28C840; }\n  .state-dot.indexing { background: #FEBC2E; }\n  .state-dot.error { background: #FF5F57; }\n\n  .rebuild-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 10px;\n    font-weight: 500;\n    background: var(--button-bg);\n    border: 1px solid var(--button-border);\n    border-radius: 4px;\n    color: var(--button-text);\n    height: 22px;\n    padding: 0 10px;\n    cursor: pointer;\n  }\n\n  .rebuild-btn:hover {\n    filter: brightness(1.1);\n  }\n\n  .rebuild-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    filter: none;\n  }\n\n  .rebuild-icon {\n    width: 11px;\n    height: 11px;\n    color: var(--accent);\n    flex-shrink: 0;\n  }\n\n  .status-error {\n    color: var(--error-text);\n  }\n\n  .status-warning {\n    color: var(--warning-text);\n  }\n\n  .status-spotlight {\n    color: #f59e0b;\n    font-weight: 600;\n  }\n\n  .context-menu {\n    position: fixed;\n    z-index: 200;\n    width: 220px;\n    border: 1px solid var(--menu-border);\n    border-radius: 10px;\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.16), inset 0 0 0 0.5px rgba(255, 255, 255, 0.18);\n    background: var(--menu-bg);\n    backdrop-filter: blur(28px) saturate(180%);\n    -webkit-backdrop-filter: blur(28px) saturate(180%);\n    overflow: hidden;\n  }\n\n  .context-menu button {\n    width: 100%;\n    text-align: left;\n    border: none;\n    background: transparent;\n    padding: 8px 10px;\n    font-size: 12px;\n    color: var(--menu-text);\n  }\n\n  .context-menu button:hover {\n    background: var(--menu-hover);\n  }\n\n  .toast {\n    position: fixed;\n    right: 14px;\n    bottom: 18px;\n    background: var(--toast-bg);\n    color: var(--toast-text);\n    border-radius: 10px;\n    padding: 9px 12px;\n    font-size: 12px;\n    z-index: 250;\n    backdrop-filter: blur(20px) saturate(180%);\n    -webkit-backdrop-filter: blur(20px) saturate(180%);\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);\n  }\n</style>\n","structuredPatch":[{"oldStart":1496,"oldLines":7,"newStart":1496,"newLines":7,"lines":["       on:scroll={() => {","         scrollTop = tableContainer.scrollTop;","         headerScrollLeft = tableContainer.scrollLeft;","-        if (editing.active) cancelRename();","+        if (editing.active) void commitRename();","         const scrollBottom = scrollTop + tableContainer.clientHeight;","         if (scrollBottom >= totalHeight - rowHeight * 10) {","           void loadMore();"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"944cf29a-b74b-4058-bd23-8e54493a6eae"}
{"parentUuid":"53960ac4-565d-418b-96ca-6d97918b7beb","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_018jRYmmdjXVysS5xkUb5qXF","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Fr3Rh7GHnK4Wh2USGqRK7i","name":"Read","input":{"file_path":"/Users/al02402336/everything/src/App.svelte","offset":1556,"limit":6},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":180,"cache_read_input_tokens":95317,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":180},"output_tokens":24,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPMbbPTWY7RKU9ZwxGM","type":"assistant","uuid":"2c8f465b-fb01-4dd5-acd1-7dc347bb04e2","timestamp":"2026-02-21T14:39:17.033Z"}
{"parentUuid":"2c8f465b-fb01-4dd5-acd1-7dc347bb04e2","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01Fr3Rh7GHnK4Wh2USGqRK7i","toolUseID":"toolu_01Fr3Rh7GHnK4Wh2USGqRK7i","timestamp":"2026-02-21T14:39:17.052Z","uuid":"ebe8931f-e411-4bdd-a962-68a68866d210"}
{"parentUuid":"2c8f465b-fb01-4dd5-acd1-7dc347bb04e2","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Fr3Rh7GHnK4Wh2USGqRK7i","type":"tool_result","content":"  1556â†’      {/if}\n  1557â†’      {#if indexStatus.permissionErrors > 0}\n  1558â†’        <span class=\"status-warning\">{indexStatus.permissionErrors.toLocaleString()} permission errors</span>\n  1559â†’      {/if}\n  1560â†’      {#if indexStatus.message}\n  1561â†’        <span class={indexStatus.isCatchup ? 'index-progress' : 'status-error'}>{indexStatus.message}</span>\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"7d7457db-dd7c-4bf6-8f7c-23156449f84b","timestamp":"2026-02-21T14:39:17.051Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/al02402336/everything/src/App.svelte","content":"      {/if}\n      {#if indexStatus.permissionErrors > 0}\n        <span class=\"status-warning\">{indexStatus.permissionErrors.toLocaleString()} permission errors</span>\n      {/if}\n      {#if indexStatus.message}\n        <span class={indexStatus.isCatchup ? 'index-progress' : 'status-error'}>{indexStatus.message}</span>","numLines":6,"startLine":1556,"totalLines":2277}},"sourceToolAssistantUUID":"2c8f465b-fb01-4dd5-acd1-7dc347bb04e2"}
{"parentUuid":"7d7457db-dd7c-4bf6-8f7c-23156449f84b","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01HSEDTtp8hdsxS5YKAXiKfN","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01DzgJtU4YBfZFfiPYKvhv6S","name":"Read","input":{"file_path":"/Users/al02402336/everything/src/App.svelte","offset":1563,"limit":6},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":319,"cache_read_input_tokens":95497,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":319},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPMp1ktcPvkjE4m4Ewb","type":"assistant","uuid":"4a7617a8-86ba-48e3-aaf5-b3cd6a3caeee","timestamp":"2026-02-21T14:39:19.776Z"}
{"parentUuid":"4a7617a8-86ba-48e3-aaf5-b3cd6a3caeee","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01DzgJtU4YBfZFfiPYKvhv6S","toolUseID":"toolu_01DzgJtU4YBfZFfiPYKvhv6S","timestamp":"2026-02-21T14:39:19.783Z","uuid":"00922c5f-156f-42c6-b39f-064aaa6ed693"}
{"parentUuid":"4a7617a8-86ba-48e3-aaf5-b3cd6a3caeee","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01DzgJtU4YBfZFfiPYKvhv6S","type":"tool_result","content":"  1563â†’    </div>\n  1564â†’    <div class=\"status-right\">\n  1565â†’      <button class=\"status-btn theme-btn\" on:click={cycleTheme} title=\"Switch theme\">\n  1566â†’        {theme === 'dark' ? 'â˜€ Light' : 'â—‘ Dark'}\n  1567â†’      </button>\n  1568â†’      <button\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"f9cdf32e-f139-43c3-b210-7fa04317bf5b","timestamp":"2026-02-21T14:39:19.782Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/al02402336/everything/src/App.svelte","content":"    </div>\n    <div class=\"status-right\">\n      <button class=\"status-btn theme-btn\" on:click={cycleTheme} title=\"Switch theme\">\n        {theme === 'dark' ? 'â˜€ Light' : 'â—‘ Dark'}\n      </button>\n      <button","numLines":6,"startLine":1563,"totalLines":2277}},"sourceToolAssistantUUID":"4a7617a8-86ba-48e3-aaf5-b3cd6a3caeee"}
{"parentUuid":"f9cdf32e-f139-43c3-b210-7fa04317bf5b","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01T2DmdiwQydRDG24MtU79u6","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01KFXY9DhG5tgWWyoHadhS75","name":"Edit","input":{"replace_all":false,"file_path":"/Users/al02402336/everything/src/App.svelte","old_string":"      <button class=\"status-btn theme-btn\" on:click={cycleTheme} title=\"Switch theme\">","new_string":"      <button class=\"status-btn\" on:click={cycleTheme} title=\"Switch theme\">"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":292,"cache_read_input_tokens":95816,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":292},"output_tokens":24,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPN2TceJZ8BjoUtyZA7","type":"assistant","uuid":"ba852004-4461-4dc4-b70d-af38b492c147","timestamp":"2026-02-21T14:39:22.678Z"}
{"parentUuid":"ba852004-4461-4dc4-b70d-af38b492c147","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01KFXY9DhG5tgWWyoHadhS75","toolUseID":"toolu_01KFXY9DhG5tgWWyoHadhS75","timestamp":"2026-02-21T14:39:22.683Z","uuid":"01fd2cfa-8059-4147-bb79-0e04c85ae64e"}
{"parentUuid":"ba852004-4461-4dc4-b70d-af38b492c147","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01KFXY9DhG5tgWWyoHadhS75","type":"tool_result","content":"The file /Users/al02402336/everything/src/App.svelte has been updated successfully."}]},"uuid":"defd8358-40e2-46db-a3d7-ec9964108c9b","timestamp":"2026-02-21T14:39:22.683Z","toolUseResult":{"filePath":"/Users/al02402336/everything/src/App.svelte","oldString":"      <button class=\"status-btn theme-btn\" on:click={cycleTheme} title=\"Switch theme\">","newString":"      <button class=\"status-btn\" on:click={cycleTheme} title=\"Switch theme\">","originalFile":"<script>\n  import { onDestroy, onMount, tick } from 'svelte';\n  import { invoke } from '@tauri-apps/api/core';\n  import { listen } from '@tauri-apps/api/event';\n  import { getCurrentWindow } from '@tauri-apps/api/window';\n  import { startDrag } from '@crabnebula/tauri-plugin-drag';\n\n  const rowHeight = 30;\n  const PAGE_SIZE = 500;\n  let homePrefix = '';\n  const COL_WIDTHS_KEY = 'REDACTED';\n  const THEME_KEY = 'everything-theme';\n  const columnKeys = ['name', 'path', 'size', 'modified'];\n  const minColumnWidth = {\n    name: 180,\n    path: 240,\n    size: 75,\n    modified: 150\n  };\n  const defaultColumnRatios = {\n    name: 0.3,\n    path: 0.45,\n    size: 0.1\n  };\n\n  const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n  let theme = (() => { try { return localStorage.getItem(THEME_KEY) || systemTheme; } catch { return systemTheme; } })();\n  function cycleTheme() {\n    theme = theme === 'dark' ? 'light' : 'dark';\n    try { localStorage.setItem(THEME_KEY, theme); } catch {}\n    invoke('set_native_theme', { theme });\n  }\n\n  let query = '';\n  let results = [];\n  let totalResults = 0;\n  let totalResultsKnown = false;\n\n  let dbLatencyMs = null;\n  let dbLastQuery = '';\n  let searchModeLabel = '';\n  let selectedIndices = new Set();\n  let selectionAnchor = -1;\n  let lastSelectedIndex = -1;\n  let editing = {\n    active: false,\n    path: '',\n    index: -1,\n    draftName: ''\n  };\n\n  let renameOverlay = { top: 0, left: 0, width: 0 };\n\n  let indexStatus = {\n    state: 'Indexing',\n    entriesCount: 0,\n    lastUpdated: null,\n    permissionErrors: 0,\n    message: null,\n    isCatchup: false\n  };\n\n  let indexingStartTime = null;\n  let indexingElapsed = '';\n  let indexingFinishedAt = '';\n\n  let sortBy = 'name';\n  let sortDir = 'asc';\n\n  let hasMore = true;\n  let loadingMore = false;\n  let searchGeneration = 0;\n\n  let scanned = 0;\n\n  let searchInputEl;\n  let renameInputEl;\n  let tableAreaEl;\n  let tableContainer;\n  let tableResizeObserver = null;\n  let viewportResizeRaf = null;\n  let scrollTop = 0;\n  let headerScrollLeft = 0;\n  let viewportHeight = 520;\n  let lastTableWidth = 0;\n  let resizingColumn = '';\n  let resizeCleanup = null;\n  let colWidths = {\n    name: 250,\n    path: 350,\n    size: 75,\n    modified: 150\n  };\n\n  let contextMenu = {\n    visible: false,\n    x: 0,\n    y: 0\n  };\n\n  let platform = '';\n  let toast = '';\n  let searchTimer;\n  let lastSearchFiredAt = 0;\n  let toastTimer;\n  let statusRefreshTimer;\n  let elapsedTimer;\n  let statusRefreshInFlight = false;\n  let lastReadyCount = 0;\n\n  const iconCache = new Map();\n  const iconLoading = new Set();\n\n  let highlightCache = new Map();\n  let highlightCacheQuery = '';\n\n  const folderFallbackIcon =\n    \"data:image/svg+xml;utf8,\" +\n    encodeURIComponent(\n      `<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><rect x='1' y='4' width='14' height='10' rx='2' fill='#d9b34f'/><rect x='1' y='2' width='6' height='4' rx='1' fill='#e6ca7a'/></svg>`\n    );\n  const fileFallbackIcon =\n    \"data:image/svg+xml;utf8,\" +\n    encodeURIComponent(\n      `<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><rect x='3' y='1' width='10' height='14' rx='1.5' fill='#b4bec9'/><rect x='5' y='5' width='6' height='1.2' fill='#8d98a5'/><rect x='5' y='8' width='6' height='1.2' fill='#8d98a5'/></svg>`\n    );\n\n  $: totalHeight = results.length * rowHeight;\n  $: startIndex = Math.max(0, Math.floor(scrollTop / rowHeight) - 10);\n  $: visibleCount = Math.ceil(viewportHeight / rowHeight) + 20;\n  $: endIndex = Math.min(results.length, startIndex + visibleCount);\n  $: visibleRows = results.slice(startIndex, endIndex);\n  $: translateY = startIndex * rowHeight;\n  $: tableMinWidth = colWidths.name + colWidths.path + colWidths.size + colWidths.modified;\n  $: tableGridStyle = `--col-name:${colWidths.name}px;--col-path:${colWidths.path}px;--col-size:${colWidths.size}px;--col-modified:${colWidths.modified}px;--table-min-width:${tableMinWidth}px;--header-offset:${-headerScrollLeft}px;`;\n\n  $: {\n    for (const entry of visibleRows) {\n      void ensureIcon(entry);\n    }\n  }\n\n  function showToast(message) {\n    toast = message;\n    clearTimeout(toastTimer);\n    toastTimer = setTimeout(() => {\n      toast = '';\n    }, 3000);\n  }\n\n  function bytesToBase64(bytes) {\n    let binary = '';\n    const chunk = 0x8000;\n    for (let i = 0; i < bytes.length; i += chunk) {\n      const part = bytes.subarray(i, i + chunk);\n      binary += String.fromCharCode(...part);\n    }\n    return btoa(binary);\n  }\n\n  function highlightSegments(name, q) {\n    q = (q || '').trim();\n    if (!q) return [{ text: name, hl: false }];\n\n    // Reset cache when query changes\n    if (q !== highlightCacheQuery) {\n      highlightCache = new Map();\n      highlightCacheQuery = q;\n    }\n\n    // Check cache\n    const cached = highlightCache.get(name);\n    if (cached) return cached;\n\n    if (q.includes('/')) q = q.slice(q.lastIndexOf('/') + 1);\n    q = q.replace(/[*?]/g, '');\n    const terms = q.split(/\\s+/).filter(Boolean);\n    if (terms.length === 0) return [{ text: name, hl: false }];\n\n    const lower = name.toLowerCase();\n    const marks = new Uint8Array(name.length);\n    for (const t of terms) {\n      const tl = t.toLowerCase();\n      let idx = lower.indexOf(tl);\n      while (idx !== -1) {\n        for (let i = idx; i < idx + tl.length; i++) marks[i] = 1;\n        idx = lower.indexOf(tl, idx + 1);\n      }\n    }\n\n    const segs = [];\n    let i = 0;\n    while (i < name.length) {\n      const m = marks[i];\n      let j = i + 1;\n      while (j < name.length && marks[j] === m) j++;\n      segs.push({ text: name.slice(i, j), hl: m === 1 });\n      i = j;\n    }\n\n    highlightCache.set(name, segs);\n    return segs;\n  }\n\n  const perFileIconExts = new Set(['exe', 'lnk', 'ico', 'url', 'scr', 'appx']);\n\n  function iconKey(entry) {\n    if (entry.isDir) return '__folder__';\n    const ext = (entry.ext || '').toLowerCase();\n    if (perFileIconExts.has(ext)) return entry.path;\n    return ext || '__file__';\n  }\n\n  function iconFor(entry) {\n    return iconCache.get(iconKey(entry)) || (entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n  }\n\n  async function ensureIcon(entry) {\n    const key = iconKey(entry);\n    if (iconCache.has(key) || iconLoading.has(key)) {\n      return;\n    }\n\n    iconLoading.add(key);\n    try {\n      const bytes = await invoke('get_file_icon', {\n        path: entry.path,\n        ext: entry.isDir ? 'folder' : entry.ext || '',\n      });\n      if (Array.isArray(bytes) && bytes.length > 0) {\n        const image = `data:image/png;base64,${bytesToBase64(Uint8Array.from(bytes))}`;\n        iconCache.set(key, image);\n      } else {\n        iconCache.set(key, entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n      }\n    } catch {\n      iconCache.set(key, entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n    } finally {\n      iconLoading.delete(key);\n    }\n  }\n\n  function syncColumnWidthsToContainer() {\n    const width = tableContainer?.clientWidth || tableAreaEl?.clientWidth;\n    if (!width || lastTableWidth !== 0) {\n      return;\n    }\n\n    const saved = loadColWidths();\n    if (saved) {\n      const total = columnKeys.reduce((s, k) => s + saved[k], 0);\n      if (Math.abs(total - width) > 2) {\n        const scale = (width - saved.modified) / (total - saved.modified);\n        let scaledName = Math.max(minColumnWidth.name, Math.round(saved.name * scale));\n        let scaledSize = Math.max(minColumnWidth.size, Math.round(saved.size * scale));\n        let rawPath = width - saved.modified - scaledName - scaledSize;\n        if (rawPath < minColumnWidth.path) {\n          const shortfall = minColumnWidth.path - rawPath;\n          const nameReduction = Math.min(shortfall, scaledName - minColumnWidth.name);\n          scaledName -= nameReduction;\n          const remaining = shortfall - nameReduction;\n          if (remaining > 0) {\n            scaledSize -= Math.min(remaining, scaledSize - minColumnWidth.size);\n          }\n          rawPath = width - saved.modified - scaledName - scaledSize;\n        }\n        const scaledPath = Math.max(minColumnWidth.path, rawPath);\n        colWidths = { name: scaledName, path: scaledPath, size: scaledSize, modified: saved.modified };\n      } else {\n        colWidths = saved;\n      }\n    } else {\n      const fixedModified = minColumnWidth.modified;\n      const rest = width - fixedModified;\n      const ratioSum = defaultColumnRatios.name + defaultColumnRatios.path + defaultColumnRatios.size;\n      colWidths = {\n        name: Math.max(minColumnWidth.name, Math.round(rest * defaultColumnRatios.name / ratioSum)),\n        path: Math.max(minColumnWidth.path, Math.round(rest * defaultColumnRatios.path / ratioSum)),\n        size: Math.max(minColumnWidth.size, Math.round(rest * defaultColumnRatios.size / ratioSum)),\n        modified: fixedModified\n      };\n    }\n    lastTableWidth = width;\n  }\n\n  function loadColWidths() {\n    try {\n      const raw = localStorage.getItem(COL_WIDTHS_KEY);\n      if (!raw) return null;\n      const parsed = JSON.parse(raw);\n      for (const key of columnKeys) {\n        if (typeof parsed[key] !== 'number' || parsed[key] < (minColumnWidth[key] || 0)) return null;\n      }\n      return parsed;\n    } catch {\n      return null;\n    }\n  }\n\n  function saveColWidths() {\n    localStorage.setItem(COL_WIDTHS_KEY, JSON.stringify(colWidths));\n  }\n\n  function updateViewportHeight() {\n    viewportHeight = tableContainer?.clientHeight || 520;\n    syncColumnWidthsToContainer();\n  }\n\n  function scheduleViewportHeightUpdate() {\n    if (viewportResizeRaf !== null) {\n      return;\n    }\n    viewportResizeRaf = requestAnimationFrame(() => {\n      viewportResizeRaf = null;\n      updateViewportHeight();\n    });\n  }\n\n  function startColumnResize(event, leftKey) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    const index = columnKeys.indexOf(leftKey);\n    if (index < 0 || index >= columnKeys.length - 1) {\n      return;\n    }\n\n    const startX = event.clientX;\n    const startLeft = colWidths[leftKey];\n    const rightKey = columnKeys[index + 1];\n    const startRight = colWidths[rightKey];\n\n    resizeCleanup?.();\n    resizingColumn = leftKey;\n\n    const onMove = (moveEvent) => {\n      const delta = Math.round(moveEvent.clientX - startX);\n      if (leftKey === 'name') {\n        // Two-column trade: name and path swap space, each respects its minimum\n        const nextLeft = Math.max(\n          minColumnWidth[leftKey],\n          Math.min(startLeft + delta, startLeft + startRight - minColumnWidth[rightKey])\n        );\n        const nextRight = startLeft + startRight - nextLeft;\n        colWidths = { ...colWidths, [leftKey]: nextLeft, [rightKey]: nextRight };\n      } else {\n        // path splitter: path grows unconstrained (allows horizontal scroll on right drag)\n        const nextLeft = Math.max(minColumnWidth[leftKey], startLeft + delta);\n        colWidths = { ...colWidths, [leftKey]: nextLeft };\n      }\n    };\n\n    const onUp = () => {\n      cleanup();\n    };\n\n    const cleanup = () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n      document.body.style.cursor = '';\n      document.body.style.userSelect = '';\n      resizingColumn = '';\n      saveColWidths();\n      if (resizeCleanup === cleanup) {\n        resizeCleanup = null;\n      }\n    };\n\n    resizeCleanup = cleanup;\n    document.body.style.cursor = 'col-resize';\n    document.body.style.userSelect = 'none';\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n  }\n\n  function selectedPaths() {\n    const sorted = [...selectedIndices].sort((a, b) => a - b);\n    return sorted.map((idx) => results[idx]).filter(Boolean).map((entry) => entry.path);\n  }\n\n  function clearSelection() {\n    selectedIndices = new Set();\n    selectionAnchor = -1;\n    lastSelectedIndex = -1;\n  }\n\n  function selectSingle(index) {\n    selectedIndices = new Set([index]);\n    selectionAnchor = index;\n    lastSelectedIndex = index;\n  }\n\n  function selectToggle(index) {\n    const next = new Set(selectedIndices);\n    if (next.has(index)) {\n      next.delete(index);\n    } else {\n      next.add(index);\n    }\n    selectedIndices = next;\n    selectionAnchor = index;\n    lastSelectedIndex = index;\n  }\n\n  function selectRange(index) {\n    const anchor = selectionAnchor >= 0 ? selectionAnchor : index;\n    const [from, to] = [Math.min(anchor, index), Math.max(anchor, index)];\n    const next = new Set();\n    for (let i = from; i <= to; i += 1) {\n      next.add(i);\n    }\n    selectedIndices = next;\n    lastSelectedIndex = index;\n  }\n\n  function primaryEntry() {\n    const idx = lastSelectedIndex >= 0 ? lastSelectedIndex : -1;\n    return idx >= 0 ? results[idx] : null;\n  }\n\n  async function refreshStatus() {\n    if (statusRefreshInFlight) {\n      return;\n    }\n    statusRefreshInFlight = true;\n    try {\n      const status = await invoke('get_index_status');\n      const prevState = indexStatus.state;\n      indexStatus = {\n        state: status.state,\n        entriesCount: status.entriesCount,\n        lastUpdated: status.lastUpdated,\n        permissionErrors: status.permissionErrors ?? 0,\n        message: status.message\n      };\n      if (status.state === 'Indexing' && prevState !== 'Indexing') {\n        startElapsedTimer();\n      } else if (status.state !== 'Indexing' && prevState === 'Indexing') {\n        stopElapsedTimer();\n      }\n      if (typeof status.scanned === 'number') {\n        scanned = status.scanned;\n      }\n      if (status.state === 'Ready' && prevState !== 'Ready') {\n        scheduleSearch();\n      }\n    } catch (err) {\n      showToast(`Failed to get status: ${String(err)}`);\n    } finally {\n      statusRefreshInFlight = false;\n    }\n  }\n\n  function scheduleSearch(preserveScroll = false) {\n    searchGeneration += 1;\n    const scheduledGen = searchGeneration;\n    clearTimeout(searchTimer);\n\n    const now = performance.now();\n    if (now - lastSearchFiredAt >= 200) {\n      // Leading edge: fire immediately if enough time has passed\n      lastSearchFiredAt = now;\n      void runSearch(preserveScroll);\n    } else {\n      // Trailing edge: debounce\n      searchTimer = setTimeout(() => {\n        if (scheduledGen !== searchGeneration) {\n          return;\n        }\n        lastSearchFiredAt = performance.now();\n        void runSearch(preserveScroll);\n      }, 200);\n    }\n  }\n\n  async function runSearch(preserveScroll = false) {\n    searchGeneration += 1;\n    const gen = searchGeneration;\n    const searchQuery = query;\n    const searchSortBy = sortBy;\n    const searchSortDir = sortDir;\n    const startedAt = performance.now();\n    try {\n      const keepPaths = new Set(selectedPaths());\n      const next = await invoke('search', {\n        query: searchQuery,\n        limit: PAGE_SIZE,\n        offset: 0,\n        sortBy: searchSortBy,\n        sortDir: searchSortDir\n      });\n\n      if (gen !== searchGeneration) return;\n\n      dbLatencyMs = Math.round(performance.now() - startedAt);\n      dbLastQuery = searchQuery;\n      const entries = Array.isArray(next.entries) ? next.entries : [];\n      searchModeLabel = next.modeLabel || '';\n      results = entries;\n      if (next.totalCount > 0) {\n        totalResults = next.totalCount;\n        totalResultsKnown = true;\n      } else {\n        totalResults = entries.length;\n        totalResultsKnown = false;\n      }\n      hasMore = totalResultsKnown ? results.length < totalResults : entries.length >= PAGE_SIZE;\n      if (!preserveScroll && tableContainer) tableContainer.scrollTop = 0;\n\n      const restored = new Set();\n      for (let i = 0; i < results.length; i += 1) {\n        if (keepPaths.has(results[i].path)) {\n          restored.add(i);\n        }\n      }\n      selectedIndices = restored;\n\n      updateViewportHeight();\n    } catch (err) {\n      if (gen !== searchGeneration) return;\n      showToast(`Search failed: ${String(err)}`);\n    }\n  }\n\n  async function loadMore() {\n    if (!hasMore || loadingMore) return;\n    const gen = searchGeneration;\n    loadingMore = true;\n    try {\n      const batch = await invoke('search', {\n        query,\n        limit: PAGE_SIZE,\n        offset: results.length,\n        sortBy: sortBy,\n        sortDir: sortDir\n      });\n      if (gen !== searchGeneration) return;\n      const arr = Array.isArray(batch.entries) ? batch.entries : [];\n      if (arr.length > 0) results = [...results, ...arr];\n      hasMore = totalResultsKnown ? results.length < totalResults : arr.length >= PAGE_SIZE;\n    } catch (err) {\n      showToast(`Failed to load more: ${String(err)}`);\n    } finally {\n      loadingMore = false;\n    }\n  }\n\n  function moveSelection(delta, withRange = false) {\n    if (results.length === 0) {\n      return;\n    }\n\n    const current = lastSelectedIndex >= 0 ? lastSelectedIndex : 0;\n    const next = Math.max(0, Math.min(results.length - 1, current + delta));\n\n    if (withRange) {\n      selectRange(next);\n    } else {\n      selectSingle(next);\n    }\n\n    const top = next * rowHeight;\n    const bottom = top + rowHeight;\n    if (top < scrollTop) {\n      tableContainer.scrollTop = top;\n    } else if (bottom > scrollTop + viewportHeight) {\n      tableContainer.scrollTop = bottom - viewportHeight;\n    }\n  }\n\n  function handleHeaderSort(column) {\n    if (sortBy === column) {\n      sortDir = sortDir === 'asc' ? 'desc' : 'asc';\n    } else {\n      sortBy = column;\n      sortDir = 'asc';\n    }\n    if (tableContainer) tableContainer.scrollTop = 0;\n    void runSearch();\n  }\n\n  function handleRowClick(event, index) {\n    contextMenu.visible = false;\n\n    if (event.shiftKey) {\n      selectRange(index);\n      return;\n    }\n\n    if (event.metaKey || event.ctrlKey) {\n      selectToggle(index);\n      return;\n    }\n\n    selectSingle(index);\n  }\n\n  function handleRowContextMenu(event, index) {\n    event.preventDefault();\n\n    if (!selectedIndices.has(index)) {\n      selectSingle(index);\n    }\n\n    if (platform === 'windows' || platform === 'macos') {\n      contextMenu.visible = false;\n      const paths = selectedPaths();\n      if (paths.length > 0) {\n        invoke('show_context_menu', {\n          paths,\n          x: event.clientX,\n          y: event.clientY,\n          singleSelection: selectedIndices.size === 1\n        });\n      }\n      return;\n    }\n\n    contextMenu = {\n      visible: true,\n      x: event.clientX,\n      y: event.clientY\n    };\n  }\n\n  function handleRowA11yKeydown(event, index) {\n    if (event.key === ' ' || event.key === 'Enter') {\n      event.preventDefault();\n      handleRowClick(event, index);\n    }\n  }\n\n  const DRAG_THRESHOLD = 5;\n  let dragCleanup = null;\n  const dragImgCache = new Map();\n\n  function dragPathsForIndex(index) {\n    const entry = results[index];\n    if (!entry) {\n      return [];\n    }\n\n    if (selectedIndices.has(index) && selectedIndices.size > 0) {\n      return selectedPaths();\n    }\n\n    return [entry.path];\n  }\n\n  function getDragIconEl(entry) {\n    const src = iconFor(entry);\n    let img = dragImgCache.get(src);\n    if (!img) {\n      img = new Image();\n      img.src = src;\n      dragImgCache.set(src, img);\n    }\n    return img.complete && img.naturalWidth > 0 ? img : null;\n  }\n\n  function fillRoundRect(ctx, x, y, w, h, r) {\n    ctx.beginPath();\n    ctx.moveTo(x + r, y);\n    ctx.arcTo(x + w, y, x + w, y + h, r);\n    ctx.arcTo(x + w, y + h, x, y + h, r);\n    ctx.arcTo(x, y + h, x, y, r);\n    ctx.arcTo(x, y, x + w, y, r);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  function buildDragPreview(index) {\n    const entry = results[index];\n    if (!entry) return null;\n\n    const count = selectedIndices.has(index) ? selectedIndices.size : 1;\n    const isDark = theme === 'dark';\n\n    const w = 260;\n    const h = 28;\n    const stackGap = count > 1 ? 4 : 0;\n\n    const canvas = document.createElement('canvas');\n    canvas.width = w;\n    canvas.height = h + stackGap;\n    const ctx = canvas.getContext('2d');\n\n    if (count > 1) {\n      ctx.globalAlpha = 0.35;\n      ctx.fillStyle = isDark ? '#5a6070' : '#b0c4de';\n      fillRoundRect(ctx, 3, 0, w - 3, h, 5);\n      ctx.globalAlpha = 1.0;\n    }\n\n    const ry = stackGap;\n    ctx.fillStyle = isDark ? 'rgba(58, 64, 74, 0.94)' : 'rgba(214, 231, 255, 0.94)';\n    fillRoundRect(ctx, 0, ry, w, h, 5);\n\n    ctx.strokeStyle = isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';\n    ctx.lineWidth = 0.5;\n    ctx.beginPath();\n    ctx.moveTo(5, ry);\n    ctx.arcTo(w, ry, w, ry + h, 5);\n    ctx.arcTo(w, ry + h, 0, ry + h, 5);\n    ctx.arcTo(0, ry + h, 0, ry, 5);\n    ctx.arcTo(0, ry, w, ry, 5);\n    ctx.closePath();\n    ctx.stroke();\n\n    const iconEl = getDragIconEl(entry);\n    if (iconEl) {\n      ctx.drawImage(iconEl, 6, ry + 6, 16, 16);\n    } else {\n      ctx.fillStyle = entry.isDir ? '#d9b34f' : '#8d98a5';\n      fillRoundRect(ctx, 6, ry + 6, 16, 16, 2);\n    }\n\n    ctx.fillStyle = isDark ? '#e6e6e8' : '#1a1a1a';\n    ctx.font = '12px -apple-system, \"SF Pro Text\", system-ui, sans-serif';\n    ctx.textBaseline = 'middle';\n\n    let nameMaxW = w - 34;\n    if (count > 1) nameMaxW -= 34;\n\n    let name = entry.name;\n    if (ctx.measureText(name).width > nameMaxW) {\n      while (name.length > 4 && ctx.measureText(name + '\\u2026').width > nameMaxW) {\n        name = name.slice(0, -1);\n      }\n      name += '\\u2026';\n    }\n    ctx.fillText(name, 28, ry + h / 2 + 1);\n\n    if (count > 1) {\n      const badge = String(count);\n      ctx.font = 'bold 10px -apple-system, system-ui, sans-serif';\n      const tw = ctx.measureText(badge).width;\n      const bw = Math.max(20, tw + 10);\n      const bx = w - bw - 6;\n      const by = ry + (h - 18) / 2;\n\n      ctx.fillStyle = isDark ? '#5b8bd9' : '#007aff';\n      fillRoundRect(ctx, bx, by, bw, 18, 9);\n\n      ctx.fillStyle = '#ffffff';\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(badge, bx + bw / 2, by + 9);\n    }\n\n    return canvas.toDataURL('image/png');\n  }\n\n  function handleRowMouseDown(event, index) {\n    if (event.button !== 0) return;\n    if (event.metaKey || event.ctrlKey || event.shiftKey) return;\n    if (editing.active) return;\n\n    const startX = event.clientX;\n    const startY = event.clientY;\n    let dragging = false;\n\n    dragCleanup?.();\n\n    const onMove = (e) => {\n      if (dragging) return;\n      const dx = e.clientX - startX;\n      const dy = e.clientY - startY;\n      if (dx * dx + dy * dy < DRAG_THRESHOLD * DRAG_THRESHOLD) return;\n\n      dragging = true;\n      cleanup();\n\n      if (!selectedIndices.has(index)) {\n        selectSingle(index);\n      }\n\n      const paths = dragPathsForIndex(index);\n      if (paths.length > 0) {\n        const icon = buildDragPreview(index);\n        startDrag({ item: paths, icon }).catch(() => {});\n      }\n    };\n\n    const onUp = () => cleanup();\n\n    const cleanup = () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n      if (dragCleanup === cleanup) dragCleanup = null;\n    };\n\n    dragCleanup = cleanup;\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n  }\n\n  async function handleRowDoubleClick(index) {\n    if (!selectedIndices.has(index) || selectedIndices.size > 1) {\n      selectSingle(index);\n      await tick();\n    }\n    await invoke('open', { paths: [results[index].path] }).catch((err) => {\n      showToast(`Failed to open: ${String(err)}`);\n    });\n  }\n\n  function closeContextMenu() {\n    contextMenu = {\n      ...contextMenu,\n      visible: false\n    };\n  }\n\n  async function openSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('open', { paths });\n    } catch (err) {\n      showToast(`Failed to open: ${String(err)}`);\n    }\n  }\n\n  async function openWithFallback() {\n    const target = primaryEntry();\n    if (!target) {\n      return;\n    }\n\n    try {\n      await invoke('open_with', { path: target.path });\n    } catch (err) {\n      showToast(`Open With failed: ${String(err)}`);\n    }\n  }\n\n  async function revealSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('reveal_in_finder', { paths });\n    } catch (err) {\n      showToast(`Failed to reveal in Finder: ${String(err)}`);\n    }\n  }\n\n  async function copySelectedPaths() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('copy_paths', { paths });\n      showToast(`Copied ${paths.length} path(s)`);\n    } catch (err) {\n      showToast(`Failed to copy path: ${String(err)}`);\n    }\n  }\n\n  async function copyFiles() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('copy_files', { paths });\n      showToast(`Copied ${paths.length} item(s)`);\n    } catch (err) {\n      showToast(`Failed to copy: ${String(err)}`);\n    }\n  }\n\n  async function trashSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    const message =\n      paths.length === 1\n        ? 'Move selected item to Trash?'\n        : `Move ${paths.length} items to Trash?`;\n\n    if (!window.confirm(message)) {\n      return;\n    }\n\n    try {\n      await invoke('move_to_trash', { paths });\n      showToast('Moved to Trash.');\n      clearSelection();\n      await runSearch();\n    } catch (err) {\n      showToast(`Failed to move to Trash: ${String(err)}`);\n    }\n  }\n\n  async function resetIndex() {\n    if (indexStatus.state === 'Indexing') {\n      showToast('Indexing in progress. Please try again after it completes.');\n      return;\n    }\n\n    results = [];\n    totalResults = 0;\n    totalResultsKnown = false;\n    clearSelection();\n    scanned = 0;\n    dbLatencyMs = null;\n    dbLastQuery = '';\n    indexStatus = { ...indexStatus, state: 'Indexing', entriesCount: 0, message: null };\n    indexingStartTime = Date.now();\n    indexingElapsed = '';\n    indexingFinishedAt = '';\n\n    try {\n      await invoke('reset_index');\n    } catch (err) {\n      showToast(`Failed to reset index: ${String(err)}`);\n      await refreshStatus();\n    }\n  }\n\n  function isMultiSelected() {\n    return selectedIndices.size > 1;\n  }\n\n  function autoResizeRenameInput() {\n    if (!renameInputEl) return;\n    renameInputEl.style.height = '0';\n    renameInputEl.style.height = renameInputEl.scrollHeight + 'px';\n  }\n\n  async function startRename() {\n    if (isMultiSelected()) {\n      return;\n    }\n\n    const idx = lastSelectedIndex;\n    if (idx < 0 || !results[idx]) {\n      return;\n    }\n\n    const entry = results[idx];\n\n    // Calculate overlay position mathematically.\n    // Name cell text starts at: padding-left(16) + icon(16) + gap(6) = 38px from cell left.\n    // Textarea has padding-left: 0 and border: 1.5px, so text starts ~2px from overlay left.\n    if (tableContainer) {\n      const rect = tableContainer.getBoundingClientRect();\n      const cellLeft = rect.left - tableContainer.scrollLeft;\n      const textLeft = cellLeft + 38;\n      const cellRight = cellLeft + colWidths.name;\n      const rowTop = rect.top + idx * rowHeight - tableContainer.scrollTop;\n      renameOverlay = {\n        top: rowTop,\n        left: textLeft - 2,\n        width: cellRight - textLeft + 2 - 4\n      };\n    }\n\n    editing = {\n      active: true,\n      path: entry.path,\n      index: idx,\n      draftName: entry.name\n    };\n\n    await tick();\n\n    if (renameInputEl) {\n      autoResizeRenameInput();\n      renameInputEl.focus();\n      const extPos = !entry.isDir ? entry.name.lastIndexOf('.') : -1;\n      const selectionEnd = extPos > 0 ? extPos : entry.name.length;\n      renameInputEl.setSelectionRange(0, selectionEnd);\n    }\n  }\n\n  function cancelRename() {\n    editing = {\n      active: false,\n      path: '',\n      index: -1,\n      draftName: ''\n    };\n  }\n\n  async function commitRename() {\n    if (!editing.active || editing.index < 0 || !results[editing.index]) {\n      return;\n    }\n\n    const current = results[editing.index];\n    const nextName = editing.draftName;\n\n    try {\n      await invoke('rename', {\n        path: current.path,\n        newName: nextName\n      });\n      cancelRename();\n      await runSearch();\n    } catch (err) {\n      showToast(`Failed to rename: ${String(err)}`);\n      await tick();\n      renameInputEl?.focus();\n    }\n  }\n\n  function onGlobalClick() {\n    closeContextMenu();\n  }\n\n  function onTitleBarMouseDown(event) {\n    if (event.button !== 0) {\n      return;\n    }\n\n    const activeElement = document.activeElement;\n    if (activeElement instanceof HTMLElement && isTextInputTarget(activeElement)) {\n      activeElement.blur();\n    }\n  }\n\n  async function focusSearch() {\n    await getCurrentWindow().show();\n    await getCurrentWindow().setFocus();\n    searchInputEl?.focus();\n    searchInputEl?.select();\n  }\n\n  function isTextInputTarget(target) {\n    return (\n      target instanceof HTMLInputElement ||\n      target instanceof HTMLTextAreaElement ||\n      target?.isContentEditable\n    );\n  }\n\n  async function handleKeydown(event) {\n    const isMetaSelectAll = (event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'a';\n    const isMetaCopy = (event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'c';\n    const target = event.target;\n    const isTextInput = isTextInputTarget(target);\n\n    if (isMetaCopy && isTextInput) {\n      return;\n    }\n\n    if (isMetaSelectAll) {\n      if (isTextInput) {\n        event.preventDefault();\n        if (target instanceof HTMLInputElement || target instanceof HTMLTextAreaElement) {\n          target.select();\n        }\n        return;\n      }\n    }\n\n    if (editing.active) {\n      if (event.key === 'Enter') {\n        event.preventDefault();\n        await commitRename();\n        return;\n      }\n\n      if (event.key === 'Escape') {\n        event.preventDefault();\n        const idx = editing.index;\n        cancelRename();\n        selectSingle(idx);\n        await tick();\n        tableContainer?.querySelector('.row.selected')?.focus();\n        return;\n      }\n      return;\n    }\n\n    if (event.key === 'Escape') {\n      event.preventDefault();\n      clearSelection();\n      return;\n    }\n\n    if (event.key === 'ArrowDown') {\n      event.preventDefault();\n      moveSelection(1, event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'ArrowUp') {\n      event.preventDefault();\n      moveSelection(-1, event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'PageDown') {\n      event.preventDefault();\n      moveSelection(Math.floor(viewportHeight / rowHeight), event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'PageUp') {\n      event.preventDefault();\n      moveSelection(-Math.floor(viewportHeight / rowHeight), event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'Enter') {\n      event.preventDefault();\n      if (platform === 'windows') {\n        await openSelected();\n      } else {\n        await startRename();\n      }\n      return;\n    }\n\n    if (event.key === 'F2') {\n      event.preventDefault();\n      await startRename();\n      return;\n    }\n\n    if (event.key === ' ' && !isTextInput) {\n      event.preventDefault();\n      const entry = primaryEntry();\n      if (entry) {\n        await invoke('quick_look', { path: entry.path });\n      }\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'f') {\n      event.preventDefault();\n      clearSelection();\n      searchInputEl?.focus();\n      searchInputEl?.select();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'o') {\n      event.preventDefault();\n      await openSelected();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key === 'Enter') {\n      event.preventDefault();\n      await revealSelected();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'c') {\n      event.preventDefault();\n      await copySelectedPaths();\n      return;\n    }\n\n    if (isMetaSelectAll) {\n      event.preventDefault();\n      selectedIndices = new Set(Array.from({ length: results.length }, (_, i) => i));\n      return;\n    }\n\n    if (event.key === 'Delete' || ((event.metaKey || event.ctrlKey) && event.key === 'Backspace')) {\n      if (!isTextInput) {\n        event.preventDefault();\n        await trashSelected();\n      }\n      return;\n    }\n  }\n\n  function formatSize(entry) {\n    if (entry.isDir || entry.size == null) return '';\n    const bytes = entry.size;\n    if (bytes < 1024) return `${bytes} B`;\n    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n    if (bytes < 1024 * 1024 * 1024) return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n    return `${(bytes / (1024 * 1024 * 1024)).toFixed(1)} GB`;\n  }\n\n  function formatModified(entry) {\n    if (!entry.mtime) {\n      return '';\n    }\n\n    const d = new Date(entry.mtime * 1000);\n    const pad = (n) => String(n).padStart(2, '0');\n    return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;\n  }\n\n  function formatLastUpdated(timestamp) {\n    if (!timestamp) {\n      return '-';\n    }\n\n    return new Date(timestamp * 1000).toLocaleString();\n  }\n\n  function formatElapsed(ms) {\n    const totalSec = Math.floor(ms / 1000);\n    const min = Math.floor(totalSec / 60);\n    const sec = totalSec % 60;\n    return min > 0 ? `${min}m ${sec}s` : `${sec}s`;\n  }\n\n  function updateElapsed() {\n    if (indexingStartTime && indexStatus.state === 'Indexing') {\n      indexingElapsed = formatElapsed(Date.now() - indexingStartTime);\n    }\n  }\n\n  function startElapsedTimer() {\n    clearInterval(elapsedTimer);\n    indexingStartTime = Date.now();\n    indexingElapsed = '0s';\n    indexingFinishedAt = '';\n    elapsedTimer = setInterval(updateElapsed, 1000);\n  }\n\n  function stopElapsedTimer() {\n    clearInterval(elapsedTimer);\n    if (indexingStartTime) {\n      const elapsed = Date.now() - indexingStartTime;\n      indexingFinishedAt = `${formatElapsed(elapsed)}`;\n    }\n    indexingStartTime = null;\n    indexingElapsed = '';\n  }\n\n  function displayPath(path) {\n    if (!path) {\n      return path;\n    }\n\n    if (!homePrefix) {\n      return path;\n    }\n\n    if (path === homePrefix) {\n      return '~';\n    }\n\n    if (path.startsWith(`${homePrefix}/`)) {\n      return `~${path.slice(homePrefix.length)}`;\n    }\n\n    return path;\n  }\n\n  let unlistenFns = [];\n\n  onMount(async () => {\n    const t0 = performance.now();\n    const ms = () => Math.round(performance.now() - t0);\n    const DEBUG_STARTUP = false;\n    const flog = DEBUG_STARTUP ? (msg) => invoke('frontend_log', { msg }).catch(() => {}) : () => {};\n\n    flog(`[startup/fe] onMount entered`);\n\n    updateViewportHeight();\n    flog(`[startup/fe] +${ms()}ms updateViewportHeight done`);\n\n    invoke('set_native_theme', { theme });\n\n    platform = await invoke('get_platform');\n    flog(`[startup/fe] +${ms()}ms get_platform done`);\n\n    const unlistenProgress = await listen('index_progress', (event) => {\n      scanned = event.payload.scanned;\n      if (indexStatus.state !== 'Indexing') {\n        indexStatus = {\n          ...indexStatus,\n          state: 'Indexing'\n        };\n      }\n    });\n    flog(`[startup/fe] +${ms()}ms listen(index_progress) registered`);\n\n    const unlistenState = await listen('index_state', (event) => {\n      flog(`[startup/fe] index_state event received: ${event.payload.state} at +${ms()}ms`);\n      const prevState = indexStatus.state;\n      indexStatus = {\n        ...indexStatus,\n        state: event.payload.state,\n        message: event.payload.message ?? null,\n        isCatchup: event.payload.isCatchup ?? false\n      };\n\n      if (event.payload.state === 'Indexing' && prevState !== 'Indexing') {\n        if (prevState === 'Ready') {\n          lastReadyCount = indexStatus.entriesCount;\n        }\n        startElapsedTimer();\n      } else if (event.payload.state !== 'Indexing' && prevState === 'Indexing') {\n        stopElapsedTimer();\n      }\n\n      if (event.payload.state === 'Ready') {\n        scheduleSearch();\n      }\n    });\n    flog(`[startup/fe] +${ms()}ms listen(index_state) registered`);\n\n    const unlistenUpdated = await listen('index_updated', (event) => {\n      indexStatus = {\n        ...indexStatus,\n        entriesCount: event.payload.entriesCount,\n        lastUpdated: event.payload.lastUpdated,\n        permissionErrors: event.payload.permissionErrors ?? indexStatus.permissionErrors\n      };\n\n      scheduleSearch(true);\n    });\n\n    const unlistenFocus = await listen('focus_search', () => {\n      void focusSearch();\n    });\n\n    const unlistenCtxMenuAction = await listen('context_menu_action', (event) => {\n      switch (event.payload) {\n        case 'open': void openSelected(); break;\n        case 'quick_look': {\n          const e = primaryEntry();\n          if (e) void invoke('quick_look', { path: e.path });\n          break;\n        }\n        case 'open_with': void openWithFallback(); break;\n        case 'reveal': void revealSelected(); break;\n        case 'copy_files': void copyFiles(); break;\n        case 'copy_path': void copySelectedPaths(); break;\n        case 'trash': void trashSelected(); break;\n        case 'rename': void startRename(); break;\n      }\n    });\n\n    unlistenFns = [unlistenProgress, unlistenState, unlistenUpdated, unlistenFocus, unlistenCtxMenuAction];\n    flog(`[startup/fe] +${ms()}ms all listeners registered`);\n\n    // Fetch backend state IMMEDIATELY after listeners are registered.\n    // Events emitted before listener registration are lost, so this\n    // is the only reliable way to get the current state.\n    await refreshStatus();\n    flog(`[startup/fe] +${ms()}ms refreshStatus done (state=${indexStatus.state})`);\n\n    // Show Svelte UI: remove skeleton, focus search input.\n    await tick();\n    document.getElementById('skeleton')?.remove();\n    await focusSearch();\n    flog(`[startup/fe] +${ms()}ms WINDOW VISIBLE â€” skeleton removed`);\n\n    try {\n      homePrefix = await invoke('get_home_dir');\n    } catch {\n      homePrefix = '';\n    }\n    flog(`[startup/fe] +${ms()}ms get_home_dir done`);\n\n    if (!localStorage.getItem('everything-fda-notice-v1')) {\n      showToast('macOS Full Disk Access permission may be required for full disk search.');\n      localStorage.setItem('everything-fda-notice-v1', '1');\n    }\n    flog(`[startup/fe] +${ms()}ms calling runSearch...`);\n    await runSearch();\n    flog(`[startup/fe] +${ms()}ms runSearch done`);\n\n    if (typeof ResizeObserver !== 'undefined') {\n      tableResizeObserver = new ResizeObserver(() => {\n        scheduleViewportHeightUpdate();\n      });\n      if (tableContainer) {\n        tableResizeObserver.observe(tableContainer);\n      } else if (tableAreaEl) {\n        tableResizeObserver.observe(tableAreaEl);\n      }\n    }\n\n    window.addEventListener('resize', scheduleViewportHeightUpdate);\n    window.addEventListener('click', onGlobalClick);\n    statusRefreshTimer = setInterval(() => {\n      if (indexStatus.state === 'Indexing') {\n        void refreshStatus();\n      }\n    }, 1000);\n    console.log(`[startup/fe] +${ms()}ms onMount complete`);\n  });\n\n  onDestroy(async () => {\n    clearTimeout(searchTimer);\n    clearTimeout(toastTimer);\n    clearInterval(statusRefreshTimer);\n    clearInterval(elapsedTimer);\n    resizeCleanup?.();\n\n    for (const unlisten of unlistenFns) {\n      unlisten();\n    }\n\n    tableResizeObserver?.disconnect();\n    tableResizeObserver = null;\n    if (viewportResizeRaf !== null) {\n      cancelAnimationFrame(viewportResizeRaf);\n      viewportResizeRaf = null;\n    }\n    window.removeEventListener('resize', scheduleViewportHeightUpdate);\n    window.removeEventListener('click', onGlobalClick);\n  });\n</script>\n\n<svelte:window on:keydown={handleKeydown} />\n\n<div class=\"app-shell\" data-theme={theme}>\n  <div class=\"title-bar\" role=\"presentation\" data-tauri-drag-region on:mousedown={onTitleBarMouseDown}>\n    <div class=\"title-left\"></div>\n    <div class=\"title-center\">\n      <svg class=\"title-icon\" viewBox=\"0 0 215 205\" fill-rule=\"evenodd\" aria-hidden=\"true\">\n        <path d=\"M85 0c46.9 0 85 38.1 85 85 0 20.1-7.2 38.5-19.2 52.7l40.7 40.8c5.8 5.8 5.8 15.2 0 21-5.8 5.8-15.2 5.8-21 0l-40.7-40.7c-13.6 9.7-30.4 15.2-44.8 15.2-46.9 0-85-42.1-85-89 0-46.9 38.1-85 85-85z m0 32c-29.3 0-53 23.7-53 53 0 29.3 23.7 53 53 53 29.3 0 53-23.7 53-53 0-29.3-23.7-53-53-53z\"/>\n      </svg>\n      <span class=\"title-text\">Everything</span>\n    </div>\n    <div class=\"title-right\"></div>\n  </div>\n\n  <header class=\"search-bar\">\n    <input\n      bind:this={searchInputEl}\n      class=\"search-input\"\n      type=\"text\"\n      bind:value={query}\n      on:input={scheduleSearch}\n      on:focus={clearSelection}\n      placeholder=\"Search file/folder names\"\n      autocomplete=\"off\"\n      spellcheck=\"false\"\n    />\n  </header>\n\n  <section class=\"table-area\" bind:this={tableAreaEl} style={tableGridStyle}>\n    <div class=\"table-header\">\n      <div class=\"table-header-track\">\n        <div class=\"col name\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('name')}>\n            Name{#if sortBy === 'name'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n          <button\n            type=\"button\"\n            class=\"col-resizer\"\n            class:active={resizingColumn === 'name'}\n            on:mousedown={(event) => startColumnResize(event, 'name')}\n            aria-label=\"Resize Name column\"\n          />\n        </div>\n\n        <div class=\"col path\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('dir')}>\n            Path{#if sortBy === 'dir'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n          <button\n            type=\"button\"\n            class=\"col-resizer\"\n            class:active={resizingColumn === 'path'}\n            on:mousedown={(event) => startColumnResize(event, 'path')}\n            aria-label=\"Resize Path column\"\n          />\n        </div>\n\n        <div class=\"col size\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('size')}>\n            Size{#if sortBy === 'size'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n        </div>\n\n        <div class=\"col modified\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('mtime')}>\n            Modified{#if sortBy === 'mtime'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <div\n      class=\"table-body\"\n      bind:this={tableContainer}\n      on:scroll={() => {\n        scrollTop = tableContainer.scrollTop;\n        headerScrollLeft = tableContainer.scrollLeft;\n        if (editing.active) void commitRename();\n        const scrollBottom = scrollTop + tableContainer.clientHeight;\n        if (scrollBottom >= totalHeight - rowHeight * 10) {\n          void loadMore();\n        }\n      }}\n    >\n      <div class=\"spacer\" style={`height:${totalHeight}px`}>\n        <div class=\"rows\" style={`transform: translateY(${translateY}px);`}>\n          {#each visibleRows as entry, localIndex}\n            {@const index = startIndex + localIndex}\n            <div\n              class=\"row {selectedIndices.has(index) ? 'selected' : ''}\"\n              on:mousedown={(event) => handleRowMouseDown(event, index)}\n              on:click={(event) => handleRowClick(event, index)}\n              on:keydown={(event) => handleRowA11yKeydown(event, index)}\n              on:dblclick={() => handleRowDoubleClick(index)}\n              on:contextmenu={(event) => handleRowContextMenu(event, index)}\n              role=\"row\"\n              tabindex=\"0\"\n            >\n              <div class=\"cell name\">\n                <img class=\"file-icon\" src={iconFor(entry)} alt=\"\" />\n                <span class=\"ellipsis\" class:name-editing={editing.active && editing.index === index}>{#each highlightSegments(entry.name, query) as seg}{#if seg.hl}<mark class=\"hl\">{seg.text}</mark>{:else}{seg.text}{/if}{/each}</span>\n              </div>\n              <div class=\"cell path\"><span class=\"ellipsis\">{displayPath(entry.dir)}</span></div>\n              <div class=\"cell size\">{formatSize(entry)}</div>\n              <div class=\"cell modified\">{formatModified(entry)}</div>\n            </div>\n          {/each}\n        </div>\n      </div>\n    </div>\n  </section>\n\n  <footer class=\"status-bar\">\n    <div class=\"status-left\">\n      <span class=\"status-state\">\n        <span class=\"state-dot {indexStatus.state === 'Indexing' ? 'indexing' : indexStatus.state === 'Error' ? 'error' : 'ready'}\"></span>\n        {#if indexStatus.state === 'Indexing'}\n          Indexing{#if lastReadyCount > 0} ({Math.min(99, Math.round((scanned / lastReadyCount) * 100))}%){/if}{#if indexingElapsed} Â· {indexingElapsed}{/if}\n          {#if !indexStatus.isCatchup}\n            Â· {scanned.toLocaleString()} scanned\n          {/if}\n        {:else}\n          Index: {indexStatus.state}\n        {/if}\n      </span>\n      <span>{indexStatus.entriesCount.toLocaleString()} entries</span>\n      {#if indexingFinishedAt && indexStatus.state !== 'Indexing'}\n        <span>in {indexingFinishedAt}</span>\n      {/if}\n      {#if dbLatencyMs !== null && dbLastQuery}\n        <span>\"{dbLastQuery}\" {dbLatencyMs}ms Â· {totalResults} results</span>\n      {/if}\n      {#if searchModeLabel === 'spotlight' || searchModeLabel === 'spotlight_timeout'}\n        <span class=\"status-spotlight\">Spotlight fallback{#if searchModeLabel === 'spotlight_timeout'} (partial){/if}</span>\n      {/if}\n      {#if indexStatus.permissionErrors > 0}\n        <span class=\"status-warning\">{indexStatus.permissionErrors.toLocaleString()} permission errors</span>\n      {/if}\n      {#if indexStatus.message}\n        <span class={indexStatus.isCatchup ? 'index-progress' : 'status-error'}>{indexStatus.message}</span>\n      {/if}\n    </div>\n    <div class=\"status-right\">\n      <button class=\"status-btn theme-btn\" on:click={cycleTheme} title=\"Switch theme\">\n        {theme === 'dark' ? 'â˜€ Light' : 'â—‘ Dark'}\n      </button>\n      <button\n        class=\"status-btn rebuild-btn\"\n        on:click={resetIndex}\n        disabled={indexStatus.state === 'Indexing'}\n        title={indexStatus.state === 'Indexing' ? 'Cannot reset while indexing is in progress.' : 'Reset and rebuild the index.'}\n      >\n        <svg class=\"rebuild-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <path d=\"M23 4v6h-6\"/><path d=\"M20.49 15a9 9 0 1 1-2.12-9.36L23 10\"/>\n        </svg>\n        Rebuild Index\n      </button>\n    </div>\n  </footer>\n\n  {#if editing.active}\n    <div\n      class=\"rename-overlay\"\n      style=\"top:{renameOverlay.top}px; left:{renameOverlay.left}px; width:{renameOverlay.width}px;\"\n      role=\"presentation\"\n      on:mousedown|stopPropagation\n    >\n      <textarea\n        bind:this={renameInputEl}\n        class=\"rename-textarea\"\n        bind:value={editing.draftName}\n        on:input={autoResizeRenameInput}\n        on:click|stopPropagation\n        on:blur={commitRename}\n      />\n    </div>\n  {/if}\n\n  {#if contextMenu.visible}\n    <div class=\"context-menu\" style={`left:${contextMenu.x}px;top:${contextMenu.y}px;`}>\n      <button on:click={() => (closeContextMenu(), openSelected())}>Open</button>\n      <button on:click={async () => { closeContextMenu(); const e = primaryEntry(); if (e) await invoke('quick_look', { path: e.path }); }}>Quick Look</button>\n      <button on:click={() => (closeContextMenu(), openWithFallback())}>Open With... (Reveal in Finder)</button>\n      <button on:click={() => (closeContextMenu(), revealSelected())}>Reveal in Finder</button>\n      <button on:click={() => (closeContextMenu(), copySelectedPaths())}>Copy Path</button>\n      <button on:click={() => (closeContextMenu(), trashSelected())}>Move to Trash</button>\n      {#if selectedIndices.size === 1}\n        <button on:click={() => (closeContextMenu(), startRename())}>Rename</button>\n      {/if}\n    </div>\n  {/if}\n\n  {#if toast}\n    <div class=\"toast\">{toast}</div>\n  {/if}\n</div>\n\n<style>\n  :global(:root) {\n    color-scheme: light dark;\n    --bg-app: transparent;\n    --text-primary: #0d1826;\n    --text-muted: #48596c;\n    --bar-grad-top: rgba(255, 255, 255, 0.48);\n    --bar-grad-bottom: rgba(248, 250, 253, 0.42);\n    --surface-header: rgba(252, 252, 255, 0.40);\n    --surface: rgba(255, 255, 255, 0.22);\n    --border-soft: rgba(0, 0, 0, 0.07);\n    --border-input: rgba(0, 0, 0, 0.13);\n    --focus-ring: #6f96e6;\n    --row-border: rgba(0, 0, 0, 0.032);\n    --row-hover: rgba(0, 0, 0, 0.06);\n    --row-selected: rgba(0, 0, 0, 0.12);\n    --button-bg: rgba(255, 255, 255, 0.62);\n    --button-border: rgba(0, 0, 0, 0.10);\n    --button-text: #2c3e50;\n    --menu-bg: rgba(240, 241, 248, 0.90);\n    --menu-border: rgba(0, 0, 0, 0.06);\n    --menu-hover: rgba(255, 255, 255, 0.62);\n    --menu-text: #1a2a38;\n    --error-text: #b64545;\n    --warning-text: #8f6500;\n    --toast-bg: rgba(18, 22, 32, 0.90);\n    --toast-text: #ffffff;\n  }\n\n  @media (prefers-color-scheme: dark) {\n    :global(:root) {\n      --bg-app: transparent;\n      --text-primary: #e6e6ea;\n      --text-muted: #9494a4;\n      --bar-grad-top: rgba(38, 38, 46, 0.52);\n      --bar-grad-bottom: rgba(30, 30, 38, 0.46);\n      --surface-header: rgba(32, 32, 40, 0.46);\n      --surface: rgba(18, 18, 26, 0.32);\n      --border-soft: rgba(255, 255, 255, 0.065);\n      --border-input: rgba(255, 255, 255, 0.14);\n      --focus-ring: #5b8bd9;\n      --row-border: rgba(255, 255, 255, 0.026);\n      --row-hover: rgba(255, 255, 255, 0.08);\n      --row-selected: rgba(255, 255, 255, 0.14);\n      --button-bg: rgba(255, 255, 255, 0.072);\n      --button-border: rgba(255, 255, 255, 0.11);\n      --button-text: #d6d6e0;\n      --menu-bg: rgba(36, 36, 46, 0.90);\n      --menu-border: rgba(255, 255, 255, 0.066);\n      --menu-hover: rgba(255, 255, 255, 0.062);\n      --menu-text: #e0e0e8;\n      --error-text: #ff9d9d;\n      --warning-text: #e0c670;\n      --toast-bg: rgba(10, 10, 16, 0.93);\n      --toast-text: #f2f2f6;\n    }\n  }\n\n  /* â”€â”€ Theme: Dark â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme=\"dark\"]) {\n    color-scheme: dark;\n    --bg-app: #1E1E21;\n    --text-primary: #E2E8F0;\n    --text-muted: #94A3B8;\n    --bar-grad-top: #1E1E21;\n    --bar-grad-bottom: #1E1E21;\n    --surface-header: #1E1E21;\n    --surface: #1E1E21;\n    --bg-input: #161618;\n    --border-soft: #2A2A2D;\n    --border-input: rgba(255, 255, 255, 0.06);\n    --focus-ring: #4DA8FF;\n    --accent: #4DA8FF;\n    --row-border: rgba(255, 255, 255, 0.02);\n    --row-hover: #282828;\n    --row-selected: rgba(77, 168, 255, 0.10);\n    --button-bg: rgba(255, 255, 255, 0.05);\n    --button-border: #2A2A2D;\n    --button-text: #94A3B8;\n    --menu-bg: #252528;\n    --menu-border: #2A2A2D;\n    --menu-hover: rgba(255, 255, 255, 0.04);\n    --menu-text: #E2E8F0;\n    --error-text: #ff9d9d;\n    --warning-text: #e0c670;\n    --toast-bg: rgba(10, 10, 16, 0.93);\n    --toast-text: #f2f2f6;\n  }\n\n  /* â”€â”€ Theme: Light â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme=\"light\"]) {\n    color-scheme: light;\n    --bg-app: #F5F5F7;\n    --text-primary: #1C1C1E;\n    --text-muted: #6E6E7A;\n    --bar-grad-top: #F5F5F7;\n    --bar-grad-bottom: #F5F5F7;\n    --surface-header: #F5F5F7;\n    --surface: #F5F5F7;\n    --bg-input: #FFFFFF;\n    --border-soft: #D1D1D6;\n    --border-input: rgba(0, 0, 0, 0.10);\n    --focus-ring: #3A8BF5;\n    --accent: #3A8BF5;\n    --row-border: rgba(0, 0, 0, 0.04);\n    --row-hover: rgba(0, 0, 0, 0.04);\n    --row-selected: rgba(58, 139, 245, 0.10);\n    --button-bg: #FFFFFF;\n    --button-border: #D1D1D6;\n    --button-text: #3C3C43;\n    --menu-bg: #FFFFFF;\n    --menu-border: #D1D1D6;\n    --menu-hover: rgba(0, 0, 0, 0.05);\n    --menu-text: #1C1C1E;\n    --error-text: #D93025;\n    --warning-text: #B45309;\n    --toast-bg: rgba(255, 255, 255, 0.95);\n    --toast-text: #1C1C1E;\n  }\n\n  /* â”€â”€ Themed element overrides â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme]) {\n    background: var(--bg-app);\n  }\n\n  /* Search bar: flat, no gradient, no separator */\n  :global([data-theme]) .search-bar {\n    height: 44px;\n    padding: 0 16px;\n    background: var(--bg-app);\n    border-bottom: none;\n  }\n\n  :global([data-theme]) .search-input {\n    backdrop-filter: none;\n    -webkit-backdrop-filter: none;\n    font-family: 'JetBrains Mono', 'SF Mono', monospace;\n    font-size: 12px;\n    height: 34px;\n    border-radius: 8px;\n  }\n\n  /* Table header: flat bg, 16px edge padding */\n  :global([data-theme]) .table-header {\n    background: var(--bg-app);\n  }\n\n  :global([data-theme]) .col-button {\n    padding: 0 8px;\n  }\n\n  :global([data-theme]) .col.name .col-button {\n    padding-left: 16px;\n  }\n\n  /* Row cells: JetBrains Mono, 16px outer edges */\n  :global([data-theme]) .cell {\n    font-family: 'JetBrains Mono', monospace;\n  }\n\n  :global([data-theme]) .cell.name {\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    padding-left: 16px;\n    font-size: 12px;\n    color: var(--text-primary);\n  }\n\n  :global([data-theme]) .cell.path {\n    font-size: 11px;\n  }\n\n  :global([data-theme]) .cell.size {\n    font-size: 11px;\n  }\n\n  :global([data-theme]) .cell.modified {\n    padding-right: 16px;\n    font-size: 11px;\n    white-space: nowrap;\n  }\n\n  :global([data-theme]) .row.selected {\n    box-shadow: inset 3px 0 0 var(--accent);\n  }\n\n  /* Dim path/size/date cells in themed mode */\n  :global([data-theme]) .cell.path,\n  :global([data-theme]) .cell.size,\n  :global([data-theme]) .cell.modified {\n    color: var(--text-muted);\n  }\n\n  :global(:root) {\n    background: transparent;\n  }\n\n  :global(html, body) {\n    margin: 0;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n    background: transparent;\n    color: var(--text-primary);\n    font-family: Inter, 'SF Pro Text', 'Segoe UI', Helvetica, Arial, sans-serif;\n  }\n\n  :global(#app) {\n    width: 100%;\n    height: 100%;\n  }\n\n  .app-shell {\n    display: grid;\n    grid-template-rows: auto auto 1fr auto;\n    height: 100%;\n    min-width: 0;\n  }\n\n  .title-bar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 44px;\n    padding: 0 16px;\n    background: var(--surface-header);\n    cursor: default;\n    flex-shrink: 0;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-left {\n    width: 72px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-center {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-right {\n    width: 72px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-icon {\n    width: 14px;\n    height: 14px;\n    fill: var(--accent);\n    flex-shrink: 0;\n  }\n\n  .title-text {\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--text-primary);\n    letter-spacing: -0.01em;\n  }\n\n  .search-bar {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 8px;\n    background: linear-gradient(180deg, var(--bar-grad-top) 0%, var(--bar-grad-bottom) 100%);\n    border-bottom: 1px solid var(--border-soft);\n    min-width: 0;\n    flex-shrink: 0;\n  }\n\n  .search-input {\n    display: block;\n    box-sizing: border-box;\n    width: 100%;\n    min-width: 0;\n    flex: 1 1 auto;\n    height: 36px;\n    border: 1px solid var(--border-input);\n    border-radius: 14px;\n    padding: 0 10px;\n    font-size: 14px;\n    background: var(--bg-input, var(--surface));\n    color: var(--text-primary);\n    backdrop-filter: blur(12px) saturate(160%);\n    -webkit-backdrop-filter: blur(12px) saturate(160%);\n  }\n\n  .search-input::placeholder {\n    color: var(--text-muted);\n    opacity: 0.85;\n    font-size: 12px;\n  }\n\n  .search-input:focus {\n    outline: none;\n    border-color: var(--focus-ring);\n    box-shadow: 0 0 0 2px rgba(125, 169, 255, 0.25);\n  }\n\n  .table-area {\n    display: grid;\n    grid-template-rows: auto 1fr;\n    min-height: 0;\n    min-width: 0;\n  }\n\n  .table-header-track,\n  .row {\n    display: grid;\n    grid-template-columns: var(--col-name) var(--col-path) var(--col-size) var(--col-modified);\n    align-items: center;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .table-header {\n    height: 32px;\n    border-bottom: 1px solid var(--border-soft);\n    background: var(--surface-header);\n    user-select: none;\n    overflow: hidden;\n    flex-shrink: 0;\n  }\n\n  .table-header-track {\n    height: 100%;\n    transform: translateX(var(--header-offset, 0px));\n    will-change: transform;\n  }\n\n  .table-header .col {\n    position: relative;\n    min-width: 0;\n    height: 100%;\n  }\n\n  .col-button {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: flex-start;\n    gap: 4px;\n    box-sizing: border-box;\n    padding: 0 8px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 11px;\n    font-weight: 600;\n    line-height: 1;\n    color: var(--text-muted);\n    text-align: left;\n    margin: 0;\n    border: none;\n    background: transparent;\n    cursor: pointer;\n  }\n\n  .sort-icon {\n    width: 10px;\n    height: 10px;\n    flex-shrink: 0;\n    color: var(--accent);\n  }\n\n  .col-resizer {\n    position: absolute;\n    top: 0;\n    right: -4px;\n    width: 8px;\n    height: 100%;\n    border: none;\n    padding: 0;\n    background: transparent;\n    cursor: col-resize;\n    z-index: 30;\n  }\n\n  .col-resizer::after {\n    content: '';\n    position: absolute;\n    top: 7px;\n    bottom: 7px;\n    left: 50%;\n    width: 1px;\n    transform: translateX(-50%);\n    background: var(--border-soft);\n    opacity: 0;\n    transition: opacity 0.15s ease;\n  }\n\n  .table-header .col:hover .col-resizer::after,\n  .col-resizer.active::after {\n    opacity: 1;\n  }\n\n  .table-body {\n    overflow: auto;\n    min-height: 0;\n    min-width: 0;\n    background: var(--surface);\n  }\n\n  .spacer {\n    position: relative;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .rows {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .row {\n    height: 30px;\n    border-bottom: 1px solid var(--row-border);\n    cursor: default;\n    -webkit-user-select: none;\n    user-select: none;\n    outline: none;\n  }\n\n  .row:hover {\n    background: var(--row-hover);\n  }\n\n  .row.selected {\n    background: var(--row-selected);\n  }\n\n  .cell {\n    padding: 0 8px;\n    font-size: 12px;\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    min-width: 0;\n  }\n\n  .cell.size {\n    text-align: right;\n    font-variant-numeric: tabular-nums;\n  }\n\n  .ellipsis {\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n\n  .hl {\n    background: none;\n    color: inherit;\n    font-weight: 700;\n  }\n\n  .file-icon {\n    width: 16px;\n    height: 16px;\n    flex: 0 0 auto;\n  }\n\n  .name-editing {\n    opacity: 0.25;\n  }\n\n  .rename-overlay {\n    position: fixed;\n    z-index: 100;\n    min-width: 120px;\n  }\n\n  .rename-textarea {\n    display: block;\n    width: 100%;\n    box-sizing: border-box;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 12px;\n    line-height: 18px;\n    padding: 5px 4px 5px 0;\n    border: 1.5px solid var(--focus-ring);\n    border-radius: 4px;\n    background: var(--bg-input, var(--surface));\n    color: var(--text-primary);\n    outline: none;\n    resize: none;\n    overflow: hidden;\n    box-shadow: 0 2px 14px rgba(0, 0, 0, 0.22), 0 0 0 3px rgba(77, 168, 255, 0.13);\n  }\n\n  .status-bar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 32px;\n    padding: 0 16px;\n    background: var(--surface-header);\n    border-top: 1px solid var(--border-soft);\n    font-family: 'JetBrains Mono', monospace;\n    font-size: 11px;\n    color: var(--text-muted);\n    white-space: nowrap;\n    overflow: hidden;\n    min-width: 0;\n    flex-shrink: 0;\n  }\n\n  .status-left {\n    display: flex;\n    align-items: center;\n    gap: 16px;\n    overflow: hidden;\n    min-width: 0;\n  }\n\n  .status-right {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    flex-shrink: 0;\n  }\n\n  .status-btn {\n    border: 1px solid var(--button-border);\n    border-radius: 5px;\n    background: var(--button-bg);\n    color: var(--button-text);\n    font-size: 11px;\n    height: 22px;\n    padding: 0 8px;\n    cursor: pointer;\n  }\n\n  .status-btn:hover {\n    filter: brightness(1.06);\n  }\n\n  .status-btn:disabled {\n    opacity: 0.55;\n    cursor: not-allowed;\n    filter: none;\n  }\n\n  .status-state {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n  }\n\n  .state-dot {\n    width: 6px;\n    height: 6px;\n    border-radius: 50%;\n    flex-shrink: 0;\n  }\n\n  .state-dot.ready { background: #28C840; }\n  .state-dot.indexing { background: #FEBC2E; }\n  .state-dot.error { background: #FF5F57; }\n\n  .rebuild-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 10px;\n    font-weight: 500;\n    background: var(--button-bg);\n    border: 1px solid var(--button-border);\n    border-radius: 4px;\n    color: var(--button-text);\n    height: 22px;\n    padding: 0 10px;\n    cursor: pointer;\n  }\n\n  .rebuild-btn:hover {\n    filter: brightness(1.1);\n  }\n\n  .rebuild-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    filter: none;\n  }\n\n  .rebuild-icon {\n    width: 11px;\n    height: 11px;\n    color: var(--accent);\n    flex-shrink: 0;\n  }\n\n  .status-error {\n    color: var(--error-text);\n  }\n\n  .status-warning {\n    color: var(--warning-text);\n  }\n\n  .status-spotlight {\n    color: #f59e0b;\n    font-weight: 600;\n  }\n\n  .context-menu {\n    position: fixed;\n    z-index: 200;\n    width: 220px;\n    border: 1px solid var(--menu-border);\n    border-radius: 10px;\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.16), inset 0 0 0 0.5px rgba(255, 255, 255, 0.18);\n    background: var(--menu-bg);\n    backdrop-filter: blur(28px) saturate(180%);\n    -webkit-backdrop-filter: blur(28px) saturate(180%);\n    overflow: hidden;\n  }\n\n  .context-menu button {\n    width: 100%;\n    text-align: left;\n    border: none;\n    background: transparent;\n    padding: 8px 10px;\n    font-size: 12px;\n    color: var(--menu-text);\n  }\n\n  .context-menu button:hover {\n    background: var(--menu-hover);\n  }\n\n  .toast {\n    position: fixed;\n    right: 14px;\n    bottom: 18px;\n    background: var(--toast-bg);\n    color: var(--toast-text);\n    border-radius: 10px;\n    padding: 9px 12px;\n    font-size: 12px;\n    z-index: 250;\n    backdrop-filter: blur(20px) saturate(180%);\n    -webkit-backdrop-filter: blur(20px) saturate(180%);\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);\n  }\n</style>\n","structuredPatch":[{"oldStart":1562,"oldLines":7,"newStart":1562,"newLines":7,"lines":["       {/if}","     </div>","     <div class=\"status-right\">","-      <button class=\"status-btn theme-btn\" on:click={cycleTheme} title=\"Switch theme\">","+      <button class=\"status-btn\" on:click={cycleTheme} title=\"Switch theme\">","         {theme === 'dark' ? 'â˜€ Light' : 'â—‘ Dark'}","       </button>","       <button"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"ba852004-4461-4dc4-b70d-af38b492c147"}
{"parentUuid":"defd8358-40e2-46db-a3d7-ec9964108c9b","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01QLYphvxzmCCLuZgnnb1wub","type":"message","role":"assistant","content":[{"type":"text","text":"ì´ì œ sort icon ì¤‘ë³µ ì œê±°ë¥¼ ìœ„í•œ í—¬í¼ í•¨ìˆ˜ ì¶”ê°€ ë° í…œí”Œë¦¿ êµì²´ë¥¼ í•©ë‹ˆë‹¤."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":341,"cache_read_input_tokens":96108,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":341},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPNEFXkfxM6uNm81U4D","type":"assistant","uuid":"b08ea3aa-b147-4651-baa5-bea96ce9f387","timestamp":"2026-02-21T14:39:25.752Z"}
{"parentUuid":"b08ea3aa-b147-4651-baa5-bea96ce9f387","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01QLYphvxzmCCLuZgnnb1wub","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01MghHh8ShfRNbB3TqC6KD6C","name":"Edit","input":{"replace_all":false,"file_path":"/Users/al02402336/everything/src/App.svelte","old_string":"  let theme = (() => { try { return localStorage.getItem(THEME_KEY) || 'dark'; } catch { return 'dark'; } })();\n  function cycleTheme() {\n    theme = theme === 'dark' ? 'light' : 'dark';\n    try { localStorage.setItem(THEME_KEY, theme); } catch {}\n  }","new_string":"  let theme = (() => { try { return localStorage.getItem(THEME_KEY) || 'dark'; } catch { return 'dark'; } })();\n  function cycleTheme() {\n    theme = theme === 'dark' ? 'light' : 'dark';\n    try { localStorage.setItem(THEME_KEY, theme); } catch {}\n  }\n\n  function sortIconHtml(dir) {\n    const d = dir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5';\n    return `<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"${d}\"/></svg>`;\n  }"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":341,"cache_read_input_tokens":96108,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":341},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPNEFXkfxM6uNm81U4D","type":"assistant","uuid":"f7465ab6-f97a-41a3-be55-b7233de28308","timestamp":"2026-02-21T14:39:30.036Z"}
{"parentUuid":"f7465ab6-f97a-41a3-be55-b7233de28308","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>String to replace not found in file.\nString:   let theme = (() => { try { return localStorage.getItem(THEME_KEY) || 'dark'; } catch { return 'dark'; } })();\n  function cycleTheme() {\n    theme = theme === 'dark' ? 'light' : 'dark';\n    try { localStorage.setItem(THEME_KEY, theme); } catch {}\n  }</tool_use_error>","is_error":true,"tool_use_id":"toolu_01MghHh8ShfRNbB3TqC6KD6C"}]},"uuid":"f555ac3b-8021-47c3-9844-0281c048ba85","timestamp":"2026-02-21T14:39:30.036Z","toolUseResult":"Error: String to replace not found in file.\nString:   let theme = (() => { try { return localStorage.getItem(THEME_KEY) || 'dark'; } catch { return 'dark'; } })();\n  function cycleTheme() {\n    theme = theme === 'dark' ? 'light' : 'dark';\n    try { localStorage.setItem(THEME_KEY, theme); } catch {}\n  }","sourceToolAssistantUUID":"f7465ab6-f97a-41a3-be55-b7233de28308"}
{"parentUuid":"f555ac3b-8021-47c3-9844-0281c048ba85","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_0148etfEssfFK4waqk8D9xz7","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01McoASLGga2qDzzUtMJ5Gcm","name":"Read","input":{"file_path":"/Users/al02402336/everything/src/App.svelte","offset":26,"limit":8},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":618,"cache_read_input_tokens":96449,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":618},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPNmGqB3LwVDXyk9ckF","type":"assistant","uuid":"61f7e024-4dbb-45cc-a5a8-18ea7e7c2cbf","timestamp":"2026-02-21T14:39:32.358Z"}
{"parentUuid":"61f7e024-4dbb-45cc-a5a8-18ea7e7c2cbf","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01McoASLGga2qDzzUtMJ5Gcm","toolUseID":"toolu_01McoASLGga2qDzzUtMJ5Gcm","timestamp":"2026-02-21T14:39:32.365Z","uuid":"9b81df38-c3d3-4e82-b291-5d998f83c47e"}
{"parentUuid":"61f7e024-4dbb-45cc-a5a8-18ea7e7c2cbf","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01McoASLGga2qDzzUtMJ5Gcm","type":"tool_result","content":"    26â†’  const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n    27â†’  let theme = (() => { try { return localStorage.getItem(THEME_KEY) || systemTheme; } catch { return systemTheme; } })();\n    28â†’  function cycleTheme() {\n    29â†’    theme = theme === 'dark' ? 'light' : 'dark';\n    30â†’    try { localStorage.setItem(THEME_KEY, theme); } catch {}\n    31â†’    invoke('set_native_theme', { theme });\n    32â†’  }\n    33â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"b9212728-cf7e-4479-a70b-79ce43957e80","timestamp":"2026-02-21T14:39:32.365Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/al02402336/everything/src/App.svelte","content":"  const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n  let theme = (() => { try { return localStorage.getItem(THEME_KEY) || systemTheme; } catch { return systemTheme; } })();\n  function cycleTheme() {\n    theme = theme === 'dark' ? 'light' : 'dark';\n    try { localStorage.setItem(THEME_KEY, theme); } catch {}\n    invoke('set_native_theme', { theme });\n  }\n","numLines":8,"startLine":26,"totalLines":2277}},"sourceToolAssistantUUID":"61f7e024-4dbb-45cc-a5a8-18ea7e7c2cbf"}
{"parentUuid":"b9212728-cf7e-4479-a70b-79ce43957e80","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01CAG7KccoX9Cf35hzmrZirh","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The file has been modified since I last read it. Let me read the full current state first.","signature":"EoICCkYICxgCKkA0JCRmFOd/WHgB4uXsPZnXWyVpb2zF8ZYo8Yy9aBg15BufTE/UMU+bSbzxjUmWgrbRBFoeG6QiuFhkl6n3SPmkEgw/LT4RKDZIIFMGWjYaDKyb3iWnotd3f9NSZCIwvF5WZph3mzAM9YdLJrC95x5zVdvhNfkkacLuDL7L2eifPbkDh+YoEZ8nYVo9obBUKmo4QaYQQI6Hu8Tfq9FEvyyGdkHqok6SgsVZeH4+TWNoVIvzTR8KM3eE+eCcrvPIB2XAmsS5XJn2Jfex8ID2VE/W/6GWfaM8XhaVcwx7F0wYY4/dnzU/pWb8rfBmtzPJ3HkhRutrItuvFXofGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":354,"cache_read_input_tokens":97067,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":354},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPNwh9NAQAKc9soAvuG","type":"assistant","uuid":"680ae75e-6be5-4002-8bf5-866cef2b41de","timestamp":"2026-02-21T14:39:34.556Z"}
{"parentUuid":"680ae75e-6be5-4002-8bf5-866cef2b41de","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01CAG7KccoX9Cf35hzmrZirh","type":"message","role":"assistant","content":[{"type":"text","text":"íŒŒì¼ì´ ì¤‘ê°„ì— ë³€ê²½ë˜ì—ˆë„¤ìš”. ì „ì²´ë¥¼ ë‹¤ì‹œ ì½ê² ìŠµë‹ˆë‹¤."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":354,"cache_read_input_tokens":97067,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":354},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPNwh9NAQAKc9soAvuG","type":"assistant","uuid":"f0e48127-8deb-4376-86e4-a0723aaa9642","timestamp":"2026-02-21T14:39:35.252Z"}
{"parentUuid":"f0e48127-8deb-4376-86e4-a0723aaa9642","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01CAG7KccoX9Cf35hzmrZirh","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_016eeNhVjfUBFAiCsZv1LBa1","name":"Read","input":{"file_path":"/Users/al02402336/everything/src/App.svelte","offset":26,"limit":15},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":354,"cache_read_input_tokens":97067,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":354},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPNwh9NAQAKc9soAvuG","type":"assistant","uuid":"96d0096c-6301-4ad3-84cc-dae5a033fd90","timestamp":"2026-02-21T14:39:35.825Z"}
{"parentUuid":"96d0096c-6301-4ad3-84cc-dae5a033fd90","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_016eeNhVjfUBFAiCsZv1LBa1","toolUseID":"toolu_016eeNhVjfUBFAiCsZv1LBa1","timestamp":"2026-02-21T14:39:35.832Z","uuid":"552cd4bd-bf9b-45cc-ad0c-ab42c7c8ef41"}
{"parentUuid":"96d0096c-6301-4ad3-84cc-dae5a033fd90","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_016eeNhVjfUBFAiCsZv1LBa1","type":"tool_result","content":"    26â†’  const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n    27â†’  let theme = (() => { try { return localStorage.getItem(THEME_KEY) || systemTheme; } catch { return systemTheme; } })();\n    28â†’  function cycleTheme() {\n    29â†’    theme = theme === 'dark' ? 'light' : 'dark';\n    30â†’    try { localStorage.setItem(THEME_KEY, theme); } catch {}\n    31â†’    invoke('set_native_theme', { theme });\n    32â†’  }\n    33â†’\n    34â†’  let query = '';\n    35â†’  let results = [];\n    36â†’  let totalResults = 0;\n    37â†’  let totalResultsKnown = false;\n    38â†’\n    39â†’  let dbLatencyMs = null;\n    40â†’  let dbLastQuery = '';\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"1b8689c8-9d05-4a3a-8b72-f241d2921cde","timestamp":"2026-02-21T14:39:35.831Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/al02402336/everything/src/App.svelte","content":"  const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n  let theme = (() => { try { return localStorage.getItem(THEME_KEY) || systemTheme; } catch { return systemTheme; } })();\n  function cycleTheme() {\n    theme = theme === 'dark' ? 'light' : 'dark';\n    try { localStorage.setItem(THEME_KEY, theme); } catch {}\n    invoke('set_native_theme', { theme });\n  }\n\n  let query = '';\n  let results = [];\n  let totalResults = 0;\n  let totalResultsKnown = false;\n\n  let dbLatencyMs = null;\n  let dbLastQuery = '';","numLines":15,"startLine":26,"totalLines":2277}},"sourceToolAssistantUUID":"96d0096c-6301-4ad3-84cc-dae5a033fd90"}
{"parentUuid":"1b8689c8-9d05-4a3a-8b72-f241d2921cde","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_015SaASrc23fxv1qUua8gTPb","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Uq8Qt3cz8p3AqmyDbSL2rL","name":"Read","input":{"file_path":"/Users/al02402336/everything/src/App.svelte","offset":670,"limit":8},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":494,"cache_read_input_tokens":97421,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":494},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPPCAnoNhYzndqHu8ZX","type":"assistant","uuid":"dd0d1513-4dcf-43ba-bbe3-237431c99b56","timestamp":"2026-02-21T14:39:38.387Z"}
{"parentUuid":"dd0d1513-4dcf-43ba-bbe3-237431c99b56","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01Uq8Qt3cz8p3AqmyDbSL2rL","toolUseID":"toolu_01Uq8Qt3cz8p3AqmyDbSL2rL","timestamp":"2026-02-21T14:39:38.403Z","uuid":"c0b051a8-4cac-4d70-9685-437451f7a7aa"}
{"parentUuid":"dd0d1513-4dcf-43ba-bbe3-237431c99b56","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Uq8Qt3cz8p3AqmyDbSL2rL","type":"tool_result","content":"   670â†’  }\n   671â†’\n   672â†’  function buildDragPreview(index) {\n   673â†’    const entry = results[index];\n   674â†’    if (!entry) return null;\n   675â†’\n   676â†’    const count = selectedIndices.has(index) ? selectedIndices.size : 1;\n   677â†’    const isDark = theme === 'dark';\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"b5967d4e-91ac-472f-ab82-03c175a5f7cf","timestamp":"2026-02-21T14:39:38.402Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/al02402336/everything/src/App.svelte","content":"  }\n\n  function buildDragPreview(index) {\n    const entry = results[index];\n    if (!entry) return null;\n\n    const count = selectedIndices.has(index) ? selectedIndices.size : 1;\n    const isDark = theme === 'dark';","numLines":8,"startLine":670,"totalLines":2277}},"sourceToolAssistantUUID":"dd0d1513-4dcf-43ba-bbe3-237431c99b56"}
{"parentUuid":"b5967d4e-91ac-472f-ab82-03c175a5f7cf","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01FzSPAEXbNANTZtuv584nVi","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good, the isDark fix is already in the file. Now let me also check: the `systemTheme` added at line 26 uses `window.matchMedia(...)`. Since the `isDark` fix was already applied (line 677 uses `theme === 'dark'`), the `systemTheme` initialization at line 26 still uses `window.matchMedia`. That's fine because `systemTheme` is used as the initial theme value (to start with the OS preference when localStorage is empty), which is correct.\n\nNow let me add the `sortIconHtml` function after `cycleTheme` on line 32.\n\n\nLet me review the current state of the file more carefully to make sure I'm working with the latest version.","signature":"Eq0GCkYICxgCKkAWdUUs7VB9/mJYO6f4m0J/DC2CV6D13XJWFw3FbZvyhIhdjLBnlO6gCUuGD69bZMfzyp0tEugTtGnvqd6NbO+aEgzzCJWM0dbQoMNz1a8aDO+P0adyKy1gUNJU5CIwv5E8AJx0z6HffqfAdr7cgfIiVSS8/KCVtKWRxjY3Rv9ARrBPi/CFRgwyc8Ab3u/zKpQFih2aQfzUUPEum8viaMojujDzJLIAdmRRObjxOArT0A8e3/yMHF1G2Rgudufabw/2KSPwgsBmk4vOXg74vl5p+eS//D9quZt86IDeyJYLx9gaxaQhbunO1EehAXbz4KZPUJWAsOhJP17sa7UNAh+BpvezLpeshKSVAX27S/r+JpDvEvmoCF3iaqkPyNm3zCpbk8FwlEbOSV9AfowDbJjjRto1z0hGdntrrjOm98oXW3b84Nx9JHq+0gT54k4oAhKKWnk31erzOkd7HqdJAd072Ww46VVt3SdT/AWwNr7SWAVSDAhmZbBm0158J1zA+CG7zUucLybyjyvyRIIEdXBu9YseW3+1u1NJJ3uKvuDxWlbfwXU9R+OX3KYfpf+wLv7gjpndBz9R/O1LqlPx4VJFVBBSpNtpaY+u623MH2H8e3ILIZ7F2mVp9mu/P/2Ut9sIX8y3UZHwQUfzqTc8TAwdK4G0VmEQWJ8O98UT9y96EGpKb9AqCJm4Q494kJR+r3HqXhnLRVwYXbEabz9dtomkr/JaohSVv5VjCW7hB4g2fxGvwQ7o0iFl805W/NNlMQlDVujOPz5/fsgHTf8eKXLGtuOpfzgpAhaO5sJRFoqNAJt7rG5ECBGs7xRgvkGlPLG7vgAwIfUqIRKDBL8b05lzUuATbBdX/fuKZd7dIDTNGTXGK94yF/1+c7uou/wPdLB2TTXDmfauSiaxj8pngBA5HXp9Bkc7Eft6s3hB0a4LK4sZ1tdHMk4fLIGhMgcbr+qjYt9mteaPOcYk3VrCV+qdWreqOtsm7V8PBajwmHaREZP4iDHPemBFVTujtx+FlGNmmIdMt61jRckfZmluTH0y72b9AExMksTyVvrLfcgyxKKZ8W/YGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":287,"cache_read_input_tokens":97915,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":287},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPPPEoTa8agkJ5EHZUB","type":"assistant","uuid":"8054b880-18fc-4d94-8fdf-104e91c77e17","timestamp":"2026-02-21T14:39:45.778Z"}
{"parentUuid":"8054b880-18fc-4d94-8fdf-104e91c77e17","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01FzSPAEXbNANTZtuv584nVi","type":"message","role":"assistant","content":[{"type":"text","text":"`isDark` ìˆ˜ì •ì€ ì´ë¯¸ ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤. sort icon í—¬í¼ì™€ CSS ìˆ˜ì •ì„ ê³„ì†í•©ë‹ˆë‹¤."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":287,"cache_read_input_tokens":97915,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":287},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPPPEoTa8agkJ5EHZUB","type":"assistant","uuid":"1a7cfaa1-4664-479a-b75f-079665922386","timestamp":"2026-02-21T14:39:45.789Z"}
{"parentUuid":"1a7cfaa1-4664-479a-b75f-079665922386","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01FzSPAEXbNANTZtuv584nVi","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01BAdTxvoGsovR71sdQF7Xz6","name":"Edit","input":{"replace_all":false,"file_path":"/Users/al02402336/everything/src/App.svelte","old_string":"    invoke('set_native_theme', { theme });\n  }\n\n  let query = '';","new_string":"    invoke('set_native_theme', { theme });\n  }\n\n  function sortIconHtml(dir) {\n    const d = dir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5';\n    return `<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"${d}\"/></svg>`;\n  }\n\n  let query = '';"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":287,"cache_read_input_tokens":97915,"output_tokens":534,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":287,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYMPPPEoTa8agkJ5EHZUB","type":"assistant","uuid":"d824e066-f0fb-4f09-8e84-239fdaca9b3c","timestamp":"2026-02-21T14:39:47.797Z"}
{"parentUuid":"d824e066-f0fb-4f09-8e84-239fdaca9b3c","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01BAdTxvoGsovR71sdQF7Xz6","toolUseID":"toolu_01BAdTxvoGsovR71sdQF7Xz6","timestamp":"2026-02-21T14:39:47.812Z","uuid":"e72a639b-5c5c-4115-9bd9-57bc010db280"}
{"parentUuid":"d824e066-f0fb-4f09-8e84-239fdaca9b3c","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01BAdTxvoGsovR71sdQF7Xz6","type":"tool_result","content":"The file /Users/al02402336/everything/src/App.svelte has been updated successfully."}]},"uuid":"924f6ed6-b88d-4f62-abb0-cc7e4d782cb4","timestamp":"2026-02-21T14:39:47.811Z","toolUseResult":{"filePath":"/Users/al02402336/everything/src/App.svelte","oldString":"    invoke('set_native_theme', { theme });\n  }\n\n  let query = '';","newString":"    invoke('set_native_theme', { theme });\n  }\n\n  function sortIconHtml(dir) {\n    const d = dir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5';\n    return `<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"${d}\"/></svg>`;\n  }\n\n  let query = '';","originalFile":"<script>\n  import { onDestroy, onMount, tick } from 'svelte';\n  import { invoke } from '@tauri-apps/api/core';\n  import { listen } from '@tauri-apps/api/event';\n  import { getCurrentWindow } from '@tauri-apps/api/window';\n  import { startDrag } from '@crabnebula/tauri-plugin-drag';\n\n  const rowHeight = 30;\n  const PAGE_SIZE = 500;\n  let homePrefix = '';\n  const COL_WIDTHS_KEY = 'REDACTED';\n  const THEME_KEY = 'everything-theme';\n  const columnKeys = ['name', 'path', 'size', 'modified'];\n  const minColumnWidth = {\n    name: 180,\n    path: 240,\n    size: 75,\n    modified: 150\n  };\n  const defaultColumnRatios = {\n    name: 0.3,\n    path: 0.45,\n    size: 0.1\n  };\n\n  const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n  let theme = (() => { try { return localStorage.getItem(THEME_KEY) || systemTheme; } catch { return systemTheme; } })();\n  function cycleTheme() {\n    theme = theme === 'dark' ? 'light' : 'dark';\n    try { localStorage.setItem(THEME_KEY, theme); } catch {}\n    invoke('set_native_theme', { theme });\n  }\n\n  let query = '';\n  let results = [];\n  let totalResults = 0;\n  let totalResultsKnown = false;\n\n  let dbLatencyMs = null;\n  let dbLastQuery = '';\n  let searchModeLabel = '';\n  let selectedIndices = new Set();\n  let selectionAnchor = -1;\n  let lastSelectedIndex = -1;\n  let editing = {\n    active: false,\n    path: '',\n    index: -1,\n    draftName: ''\n  };\n\n  let renameOverlay = { top: 0, left: 0, width: 0 };\n\n  let indexStatus = {\n    state: 'Indexing',\n    entriesCount: 0,\n    lastUpdated: null,\n    permissionErrors: 0,\n    message: null,\n    isCatchup: false\n  };\n\n  let indexingStartTime = null;\n  let indexingElapsed = '';\n  let indexingFinishedAt = '';\n\n  let sortBy = 'name';\n  let sortDir = 'asc';\n\n  let hasMore = true;\n  let loadingMore = false;\n  let searchGeneration = 0;\n\n  let scanned = 0;\n\n  let searchInputEl;\n  let renameInputEl;\n  let tableAreaEl;\n  let tableContainer;\n  let tableResizeObserver = null;\n  let viewportResizeRaf = null;\n  let scrollTop = 0;\n  let headerScrollLeft = 0;\n  let viewportHeight = 520;\n  let lastTableWidth = 0;\n  let resizingColumn = '';\n  let resizeCleanup = null;\n  let colWidths = {\n    name: 250,\n    path: 350,\n    size: 75,\n    modified: 150\n  };\n\n  let contextMenu = {\n    visible: false,\n    x: 0,\n    y: 0\n  };\n\n  let platform = '';\n  let toast = '';\n  let searchTimer;\n  let lastSearchFiredAt = 0;\n  let toastTimer;\n  let statusRefreshTimer;\n  let elapsedTimer;\n  let statusRefreshInFlight = false;\n  let lastReadyCount = 0;\n\n  const iconCache = new Map();\n  const iconLoading = new Set();\n\n  let highlightCache = new Map();\n  let highlightCacheQuery = '';\n\n  const folderFallbackIcon =\n    \"data:image/svg+xml;utf8,\" +\n    encodeURIComponent(\n      `<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><rect x='1' y='4' width='14' height='10' rx='2' fill='#d9b34f'/><rect x='1' y='2' width='6' height='4' rx='1' fill='#e6ca7a'/></svg>`\n    );\n  const fileFallbackIcon =\n    \"data:image/svg+xml;utf8,\" +\n    encodeURIComponent(\n      `<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><rect x='3' y='1' width='10' height='14' rx='1.5' fill='#b4bec9'/><rect x='5' y='5' width='6' height='1.2' fill='#8d98a5'/><rect x='5' y='8' width='6' height='1.2' fill='#8d98a5'/></svg>`\n    );\n\n  $: totalHeight = results.length * rowHeight;\n  $: startIndex = Math.max(0, Math.floor(scrollTop / rowHeight) - 10);\n  $: visibleCount = Math.ceil(viewportHeight / rowHeight) + 20;\n  $: endIndex = Math.min(results.length, startIndex + visibleCount);\n  $: visibleRows = results.slice(startIndex, endIndex);\n  $: translateY = startIndex * rowHeight;\n  $: tableMinWidth = colWidths.name + colWidths.path + colWidths.size + colWidths.modified;\n  $: tableGridStyle = `--col-name:${colWidths.name}px;--col-path:${colWidths.path}px;--col-size:${colWidths.size}px;--col-modified:${colWidths.modified}px;--table-min-width:${tableMinWidth}px;--header-offset:${-headerScrollLeft}px;`;\n\n  $: {\n    for (const entry of visibleRows) {\n      void ensureIcon(entry);\n    }\n  }\n\n  function showToast(message) {\n    toast = message;\n    clearTimeout(toastTimer);\n    toastTimer = setTimeout(() => {\n      toast = '';\n    }, 3000);\n  }\n\n  function bytesToBase64(bytes) {\n    let binary = '';\n    const chunk = 0x8000;\n    for (let i = 0; i < bytes.length; i += chunk) {\n      const part = bytes.subarray(i, i + chunk);\n      binary += String.fromCharCode(...part);\n    }\n    return btoa(binary);\n  }\n\n  function highlightSegments(name, q) {\n    q = (q || '').trim();\n    if (!q) return [{ text: name, hl: false }];\n\n    // Reset cache when query changes\n    if (q !== highlightCacheQuery) {\n      highlightCache = new Map();\n      highlightCacheQuery = q;\n    }\n\n    // Check cache\n    const cached = highlightCache.get(name);\n    if (cached) return cached;\n\n    if (q.includes('/')) q = q.slice(q.lastIndexOf('/') + 1);\n    q = q.replace(/[*?]/g, '');\n    const terms = q.split(/\\s+/).filter(Boolean);\n    if (terms.length === 0) return [{ text: name, hl: false }];\n\n    const lower = name.toLowerCase();\n    const marks = new Uint8Array(name.length);\n    for (const t of terms) {\n      const tl = t.toLowerCase();\n      let idx = lower.indexOf(tl);\n      while (idx !== -1) {\n        for (let i = idx; i < idx + tl.length; i++) marks[i] = 1;\n        idx = lower.indexOf(tl, idx + 1);\n      }\n    }\n\n    const segs = [];\n    let i = 0;\n    while (i < name.length) {\n      const m = marks[i];\n      let j = i + 1;\n      while (j < name.length && marks[j] === m) j++;\n      segs.push({ text: name.slice(i, j), hl: m === 1 });\n      i = j;\n    }\n\n    highlightCache.set(name, segs);\n    return segs;\n  }\n\n  const perFileIconExts = new Set(['exe', 'lnk', 'ico', 'url', 'scr', 'appx']);\n\n  function iconKey(entry) {\n    if (entry.isDir) return '__folder__';\n    const ext = (entry.ext || '').toLowerCase();\n    if (perFileIconExts.has(ext)) return entry.path;\n    return ext || '__file__';\n  }\n\n  function iconFor(entry) {\n    return iconCache.get(iconKey(entry)) || (entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n  }\n\n  async function ensureIcon(entry) {\n    const key = iconKey(entry);\n    if (iconCache.has(key) || iconLoading.has(key)) {\n      return;\n    }\n\n    iconLoading.add(key);\n    try {\n      const bytes = await invoke('get_file_icon', {\n        path: entry.path,\n        ext: entry.isDir ? 'folder' : entry.ext || '',\n      });\n      if (Array.isArray(bytes) && bytes.length > 0) {\n        const image = `data:image/png;base64,${bytesToBase64(Uint8Array.from(bytes))}`;\n        iconCache.set(key, image);\n      } else {\n        iconCache.set(key, entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n      }\n    } catch {\n      iconCache.set(key, entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n    } finally {\n      iconLoading.delete(key);\n    }\n  }\n\n  function syncColumnWidthsToContainer() {\n    const width = tableContainer?.clientWidth || tableAreaEl?.clientWidth;\n    if (!width || lastTableWidth !== 0) {\n      return;\n    }\n\n    const saved = loadColWidths();\n    if (saved) {\n      const total = columnKeys.reduce((s, k) => s + saved[k], 0);\n      if (Math.abs(total - width) > 2) {\n        const scale = (width - saved.modified) / (total - saved.modified);\n        let scaledName = Math.max(minColumnWidth.name, Math.round(saved.name * scale));\n        let scaledSize = Math.max(minColumnWidth.size, Math.round(saved.size * scale));\n        let rawPath = width - saved.modified - scaledName - scaledSize;\n        if (rawPath < minColumnWidth.path) {\n          const shortfall = minColumnWidth.path - rawPath;\n          const nameReduction = Math.min(shortfall, scaledName - minColumnWidth.name);\n          scaledName -= nameReduction;\n          const remaining = shortfall - nameReduction;\n          if (remaining > 0) {\n            scaledSize -= Math.min(remaining, scaledSize - minColumnWidth.size);\n          }\n          rawPath = width - saved.modified - scaledName - scaledSize;\n        }\n        const scaledPath = Math.max(minColumnWidth.path, rawPath);\n        colWidths = { name: scaledName, path: scaledPath, size: scaledSize, modified: saved.modified };\n      } else {\n        colWidths = saved;\n      }\n    } else {\n      const fixedModified = minColumnWidth.modified;\n      const rest = width - fixedModified;\n      const ratioSum = defaultColumnRatios.name + defaultColumnRatios.path + defaultColumnRatios.size;\n      colWidths = {\n        name: Math.max(minColumnWidth.name, Math.round(rest * defaultColumnRatios.name / ratioSum)),\n        path: Math.max(minColumnWidth.path, Math.round(rest * defaultColumnRatios.path / ratioSum)),\n        size: Math.max(minColumnWidth.size, Math.round(rest * defaultColumnRatios.size / ratioSum)),\n        modified: fixedModified\n      };\n    }\n    lastTableWidth = width;\n  }\n\n  function loadColWidths() {\n    try {\n      const raw = localStorage.getItem(COL_WIDTHS_KEY);\n      if (!raw) return null;\n      const parsed = JSON.parse(raw);\n      for (const key of columnKeys) {\n        if (typeof parsed[key] !== 'number' || parsed[key] < (minColumnWidth[key] || 0)) return null;\n      }\n      return parsed;\n    } catch {\n      return null;\n    }\n  }\n\n  function saveColWidths() {\n    localStorage.setItem(COL_WIDTHS_KEY, JSON.stringify(colWidths));\n  }\n\n  function updateViewportHeight() {\n    viewportHeight = tableContainer?.clientHeight || 520;\n    syncColumnWidthsToContainer();\n  }\n\n  function scheduleViewportHeightUpdate() {\n    if (viewportResizeRaf !== null) {\n      return;\n    }\n    viewportResizeRaf = requestAnimationFrame(() => {\n      viewportResizeRaf = null;\n      updateViewportHeight();\n    });\n  }\n\n  function startColumnResize(event, leftKey) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    const index = columnKeys.indexOf(leftKey);\n    if (index < 0 || index >= columnKeys.length - 1) {\n      return;\n    }\n\n    const startX = event.clientX;\n    const startLeft = colWidths[leftKey];\n    const rightKey = columnKeys[index + 1];\n    const startRight = colWidths[rightKey];\n\n    resizeCleanup?.();\n    resizingColumn = leftKey;\n\n    const onMove = (moveEvent) => {\n      const delta = Math.round(moveEvent.clientX - startX);\n      if (leftKey === 'name') {\n        // Two-column trade: name and path swap space, each respects its minimum\n        const nextLeft = Math.max(\n          minColumnWidth[leftKey],\n          Math.min(startLeft + delta, startLeft + startRight - minColumnWidth[rightKey])\n        );\n        const nextRight = startLeft + startRight - nextLeft;\n        colWidths = { ...colWidths, [leftKey]: nextLeft, [rightKey]: nextRight };\n      } else {\n        // path splitter: path grows unconstrained (allows horizontal scroll on right drag)\n        const nextLeft = Math.max(minColumnWidth[leftKey], startLeft + delta);\n        colWidths = { ...colWidths, [leftKey]: nextLeft };\n      }\n    };\n\n    const onUp = () => {\n      cleanup();\n    };\n\n    const cleanup = () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n      document.body.style.cursor = '';\n      document.body.style.userSelect = '';\n      resizingColumn = '';\n      saveColWidths();\n      if (resizeCleanup === cleanup) {\n        resizeCleanup = null;\n      }\n    };\n\n    resizeCleanup = cleanup;\n    document.body.style.cursor = 'col-resize';\n    document.body.style.userSelect = 'none';\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n  }\n\n  function selectedPaths() {\n    const sorted = [...selectedIndices].sort((a, b) => a - b);\n    return sorted.map((idx) => results[idx]).filter(Boolean).map((entry) => entry.path);\n  }\n\n  function clearSelection() {\n    selectedIndices = new Set();\n    selectionAnchor = -1;\n    lastSelectedIndex = -1;\n  }\n\n  function selectSingle(index) {\n    selectedIndices = new Set([index]);\n    selectionAnchor = index;\n    lastSelectedIndex = index;\n  }\n\n  function selectToggle(index) {\n    const next = new Set(selectedIndices);\n    if (next.has(index)) {\n      next.delete(index);\n    } else {\n      next.add(index);\n    }\n    selectedIndices = next;\n    selectionAnchor = index;\n    lastSelectedIndex = index;\n  }\n\n  function selectRange(index) {\n    const anchor = selectionAnchor >= 0 ? selectionAnchor : index;\n    const [from, to] = [Math.min(anchor, index), Math.max(anchor, index)];\n    const next = new Set();\n    for (let i = from; i <= to; i += 1) {\n      next.add(i);\n    }\n    selectedIndices = next;\n    lastSelectedIndex = index;\n  }\n\n  function primaryEntry() {\n    const idx = lastSelectedIndex >= 0 ? lastSelectedIndex : -1;\n    return idx >= 0 ? results[idx] : null;\n  }\n\n  async function refreshStatus() {\n    if (statusRefreshInFlight) {\n      return;\n    }\n    statusRefreshInFlight = true;\n    try {\n      const status = await invoke('get_index_status');\n      const prevState = indexStatus.state;\n      indexStatus = {\n        state: status.state,\n        entriesCount: status.entriesCount,\n        lastUpdated: status.lastUpdated,\n        permissionErrors: status.permissionErrors ?? 0,\n        message: status.message\n      };\n      if (status.state === 'Indexing' && prevState !== 'Indexing') {\n        startElapsedTimer();\n      } else if (status.state !== 'Indexing' && prevState === 'Indexing') {\n        stopElapsedTimer();\n      }\n      if (typeof status.scanned === 'number') {\n        scanned = status.scanned;\n      }\n      if (status.state === 'Ready' && prevState !== 'Ready') {\n        scheduleSearch();\n      }\n    } catch (err) {\n      showToast(`Failed to get status: ${String(err)}`);\n    } finally {\n      statusRefreshInFlight = false;\n    }\n  }\n\n  function scheduleSearch(preserveScroll = false) {\n    searchGeneration += 1;\n    const scheduledGen = searchGeneration;\n    clearTimeout(searchTimer);\n\n    const now = performance.now();\n    if (now - lastSearchFiredAt >= 200) {\n      // Leading edge: fire immediately if enough time has passed\n      lastSearchFiredAt = now;\n      void runSearch(preserveScroll);\n    } else {\n      // Trailing edge: debounce\n      searchTimer = setTimeout(() => {\n        if (scheduledGen !== searchGeneration) {\n          return;\n        }\n        lastSearchFiredAt = performance.now();\n        void runSearch(preserveScroll);\n      }, 200);\n    }\n  }\n\n  async function runSearch(preserveScroll = false) {\n    searchGeneration += 1;\n    const gen = searchGeneration;\n    const searchQuery = query;\n    const searchSortBy = sortBy;\n    const searchSortDir = sortDir;\n    const startedAt = performance.now();\n    try {\n      const keepPaths = new Set(selectedPaths());\n      const next = await invoke('search', {\n        query: searchQuery,\n        limit: PAGE_SIZE,\n        offset: 0,\n        sortBy: searchSortBy,\n        sortDir: searchSortDir\n      });\n\n      if (gen !== searchGeneration) return;\n\n      dbLatencyMs = Math.round(performance.now() - startedAt);\n      dbLastQuery = searchQuery;\n      const entries = Array.isArray(next.entries) ? next.entries : [];\n      searchModeLabel = next.modeLabel || '';\n      results = entries;\n      if (next.totalCount > 0) {\n        totalResults = next.totalCount;\n        totalResultsKnown = true;\n      } else {\n        totalResults = entries.length;\n        totalResultsKnown = false;\n      }\n      hasMore = totalResultsKnown ? results.length < totalResults : entries.length >= PAGE_SIZE;\n      if (!preserveScroll && tableContainer) tableContainer.scrollTop = 0;\n\n      const restored = new Set();\n      for (let i = 0; i < results.length; i += 1) {\n        if (keepPaths.has(results[i].path)) {\n          restored.add(i);\n        }\n      }\n      selectedIndices = restored;\n\n      updateViewportHeight();\n    } catch (err) {\n      if (gen !== searchGeneration) return;\n      showToast(`Search failed: ${String(err)}`);\n    }\n  }\n\n  async function loadMore() {\n    if (!hasMore || loadingMore) return;\n    const gen = searchGeneration;\n    loadingMore = true;\n    try {\n      const batch = await invoke('search', {\n        query,\n        limit: PAGE_SIZE,\n        offset: results.length,\n        sortBy: sortBy,\n        sortDir: sortDir\n      });\n      if (gen !== searchGeneration) return;\n      const arr = Array.isArray(batch.entries) ? batch.entries : [];\n      if (arr.length > 0) results = [...results, ...arr];\n      hasMore = totalResultsKnown ? results.length < totalResults : arr.length >= PAGE_SIZE;\n    } catch (err) {\n      showToast(`Failed to load more: ${String(err)}`);\n    } finally {\n      loadingMore = false;\n    }\n  }\n\n  function moveSelection(delta, withRange = false) {\n    if (results.length === 0) {\n      return;\n    }\n\n    const current = lastSelectedIndex >= 0 ? lastSelectedIndex : 0;\n    const next = Math.max(0, Math.min(results.length - 1, current + delta));\n\n    if (withRange) {\n      selectRange(next);\n    } else {\n      selectSingle(next);\n    }\n\n    const top = next * rowHeight;\n    const bottom = top + rowHeight;\n    if (top < scrollTop) {\n      tableContainer.scrollTop = top;\n    } else if (bottom > scrollTop + viewportHeight) {\n      tableContainer.scrollTop = bottom - viewportHeight;\n    }\n  }\n\n  function handleHeaderSort(column) {\n    if (sortBy === column) {\n      sortDir = sortDir === 'asc' ? 'desc' : 'asc';\n    } else {\n      sortBy = column;\n      sortDir = 'asc';\n    }\n    if (tableContainer) tableContainer.scrollTop = 0;\n    void runSearch();\n  }\n\n  function handleRowClick(event, index) {\n    contextMenu.visible = false;\n\n    if (event.shiftKey) {\n      selectRange(index);\n      return;\n    }\n\n    if (event.metaKey || event.ctrlKey) {\n      selectToggle(index);\n      return;\n    }\n\n    selectSingle(index);\n  }\n\n  function handleRowContextMenu(event, index) {\n    event.preventDefault();\n\n    if (!selectedIndices.has(index)) {\n      selectSingle(index);\n    }\n\n    if (platform === 'windows' || platform === 'macos') {\n      contextMenu.visible = false;\n      const paths = selectedPaths();\n      if (paths.length > 0) {\n        invoke('show_context_menu', {\n          paths,\n          x: event.clientX,\n          y: event.clientY,\n          singleSelection: selectedIndices.size === 1\n        });\n      }\n      return;\n    }\n\n    contextMenu = {\n      visible: true,\n      x: event.clientX,\n      y: event.clientY\n    };\n  }\n\n  function handleRowA11yKeydown(event, index) {\n    if (event.key === ' ' || event.key === 'Enter') {\n      event.preventDefault();\n      handleRowClick(event, index);\n    }\n  }\n\n  const DRAG_THRESHOLD = 5;\n  let dragCleanup = null;\n  const dragImgCache = new Map();\n\n  function dragPathsForIndex(index) {\n    const entry = results[index];\n    if (!entry) {\n      return [];\n    }\n\n    if (selectedIndices.has(index) && selectedIndices.size > 0) {\n      return selectedPaths();\n    }\n\n    return [entry.path];\n  }\n\n  function getDragIconEl(entry) {\n    const src = iconFor(entry);\n    let img = dragImgCache.get(src);\n    if (!img) {\n      img = new Image();\n      img.src = src;\n      dragImgCache.set(src, img);\n    }\n    return img.complete && img.naturalWidth > 0 ? img : null;\n  }\n\n  function fillRoundRect(ctx, x, y, w, h, r) {\n    ctx.beginPath();\n    ctx.moveTo(x + r, y);\n    ctx.arcTo(x + w, y, x + w, y + h, r);\n    ctx.arcTo(x + w, y + h, x, y + h, r);\n    ctx.arcTo(x, y + h, x, y, r);\n    ctx.arcTo(x, y, x + w, y, r);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  function buildDragPreview(index) {\n    const entry = results[index];\n    if (!entry) return null;\n\n    const count = selectedIndices.has(index) ? selectedIndices.size : 1;\n    const isDark = theme === 'dark';\n\n    const w = 260;\n    const h = 28;\n    const stackGap = count > 1 ? 4 : 0;\n\n    const canvas = document.createElement('canvas');\n    canvas.width = w;\n    canvas.height = h + stackGap;\n    const ctx = canvas.getContext('2d');\n\n    if (count > 1) {\n      ctx.globalAlpha = 0.35;\n      ctx.fillStyle = isDark ? '#5a6070' : '#b0c4de';\n      fillRoundRect(ctx, 3, 0, w - 3, h, 5);\n      ctx.globalAlpha = 1.0;\n    }\n\n    const ry = stackGap;\n    ctx.fillStyle = isDark ? 'rgba(58, 64, 74, 0.94)' : 'rgba(214, 231, 255, 0.94)';\n    fillRoundRect(ctx, 0, ry, w, h, 5);\n\n    ctx.strokeStyle = isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';\n    ctx.lineWidth = 0.5;\n    ctx.beginPath();\n    ctx.moveTo(5, ry);\n    ctx.arcTo(w, ry, w, ry + h, 5);\n    ctx.arcTo(w, ry + h, 0, ry + h, 5);\n    ctx.arcTo(0, ry + h, 0, ry, 5);\n    ctx.arcTo(0, ry, w, ry, 5);\n    ctx.closePath();\n    ctx.stroke();\n\n    const iconEl = getDragIconEl(entry);\n    if (iconEl) {\n      ctx.drawImage(iconEl, 6, ry + 6, 16, 16);\n    } else {\n      ctx.fillStyle = entry.isDir ? '#d9b34f' : '#8d98a5';\n      fillRoundRect(ctx, 6, ry + 6, 16, 16, 2);\n    }\n\n    ctx.fillStyle = isDark ? '#e6e6e8' : '#1a1a1a';\n    ctx.font = '12px -apple-system, \"SF Pro Text\", system-ui, sans-serif';\n    ctx.textBaseline = 'middle';\n\n    let nameMaxW = w - 34;\n    if (count > 1) nameMaxW -= 34;\n\n    let name = entry.name;\n    if (ctx.measureText(name).width > nameMaxW) {\n      while (name.length > 4 && ctx.measureText(name + '\\u2026').width > nameMaxW) {\n        name = name.slice(0, -1);\n      }\n      name += '\\u2026';\n    }\n    ctx.fillText(name, 28, ry + h / 2 + 1);\n\n    if (count > 1) {\n      const badge = String(count);\n      ctx.font = 'bold 10px -apple-system, system-ui, sans-serif';\n      const tw = ctx.measureText(badge).width;\n      const bw = Math.max(20, tw + 10);\n      const bx = w - bw - 6;\n      const by = ry + (h - 18) / 2;\n\n      ctx.fillStyle = isDark ? '#5b8bd9' : '#007aff';\n      fillRoundRect(ctx, bx, by, bw, 18, 9);\n\n      ctx.fillStyle = '#ffffff';\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(badge, bx + bw / 2, by + 9);\n    }\n\n    return canvas.toDataURL('image/png');\n  }\n\n  function handleRowMouseDown(event, index) {\n    if (event.button !== 0) return;\n    if (event.metaKey || event.ctrlKey || event.shiftKey) return;\n    if (editing.active) return;\n\n    const startX = event.clientX;\n    const startY = event.clientY;\n    let dragging = false;\n\n    dragCleanup?.();\n\n    const onMove = (e) => {\n      if (dragging) return;\n      const dx = e.clientX - startX;\n      const dy = e.clientY - startY;\n      if (dx * dx + dy * dy < DRAG_THRESHOLD * DRAG_THRESHOLD) return;\n\n      dragging = true;\n      cleanup();\n\n      if (!selectedIndices.has(index)) {\n        selectSingle(index);\n      }\n\n      const paths = dragPathsForIndex(index);\n      if (paths.length > 0) {\n        const icon = buildDragPreview(index);\n        startDrag({ item: paths, icon }).catch(() => {});\n      }\n    };\n\n    const onUp = () => cleanup();\n\n    const cleanup = () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n      if (dragCleanup === cleanup) dragCleanup = null;\n    };\n\n    dragCleanup = cleanup;\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n  }\n\n  async function handleRowDoubleClick(index) {\n    if (!selectedIndices.has(index) || selectedIndices.size > 1) {\n      selectSingle(index);\n      await tick();\n    }\n    await invoke('open', { paths: [results[index].path] }).catch((err) => {\n      showToast(`Failed to open: ${String(err)}`);\n    });\n  }\n\n  function closeContextMenu() {\n    contextMenu = {\n      ...contextMenu,\n      visible: false\n    };\n  }\n\n  async function openSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('open', { paths });\n    } catch (err) {\n      showToast(`Failed to open: ${String(err)}`);\n    }\n  }\n\n  async function openWithFallback() {\n    const target = primaryEntry();\n    if (!target) {\n      return;\n    }\n\n    try {\n      await invoke('open_with', { path: target.path });\n    } catch (err) {\n      showToast(`Open With failed: ${String(err)}`);\n    }\n  }\n\n  async function revealSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('reveal_in_finder', { paths });\n    } catch (err) {\n      showToast(`Failed to reveal in Finder: ${String(err)}`);\n    }\n  }\n\n  async function copySelectedPaths() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('copy_paths', { paths });\n      showToast(`Copied ${paths.length} path(s)`);\n    } catch (err) {\n      showToast(`Failed to copy path: ${String(err)}`);\n    }\n  }\n\n  async function copyFiles() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('copy_files', { paths });\n      showToast(`Copied ${paths.length} item(s)`);\n    } catch (err) {\n      showToast(`Failed to copy: ${String(err)}`);\n    }\n  }\n\n  async function trashSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    const message =\n      paths.length === 1\n        ? 'Move selected item to Trash?'\n        : `Move ${paths.length} items to Trash?`;\n\n    if (!window.confirm(message)) {\n      return;\n    }\n\n    try {\n      await invoke('move_to_trash', { paths });\n      showToast('Moved to Trash.');\n      clearSelection();\n      await runSearch();\n    } catch (err) {\n      showToast(`Failed to move to Trash: ${String(err)}`);\n    }\n  }\n\n  async function resetIndex() {\n    if (indexStatus.state === 'Indexing') {\n      showToast('Indexing in progress. Please try again after it completes.');\n      return;\n    }\n\n    results = [];\n    totalResults = 0;\n    totalResultsKnown = false;\n    clearSelection();\n    scanned = 0;\n    dbLatencyMs = null;\n    dbLastQuery = '';\n    indexStatus = { ...indexStatus, state: 'Indexing', entriesCount: 0, message: null };\n    indexingStartTime = Date.now();\n    indexingElapsed = '';\n    indexingFinishedAt = '';\n\n    try {\n      await invoke('reset_index');\n    } catch (err) {\n      showToast(`Failed to reset index: ${String(err)}`);\n      await refreshStatus();\n    }\n  }\n\n  function isMultiSelected() {\n    return selectedIndices.size > 1;\n  }\n\n  function autoResizeRenameInput() {\n    if (!renameInputEl) return;\n    renameInputEl.style.height = '0';\n    renameInputEl.style.height = renameInputEl.scrollHeight + 'px';\n  }\n\n  async function startRename() {\n    if (isMultiSelected()) {\n      return;\n    }\n\n    const idx = lastSelectedIndex;\n    if (idx < 0 || !results[idx]) {\n      return;\n    }\n\n    const entry = results[idx];\n\n    // Calculate overlay position mathematically.\n    // Name cell text starts at: padding-left(16) + icon(16) + gap(6) = 38px from cell left.\n    // Textarea has padding-left: 0 and border: 1.5px, so text starts ~2px from overlay left.\n    if (tableContainer) {\n      const rect = tableContainer.getBoundingClientRect();\n      const cellLeft = rect.left - tableContainer.scrollLeft;\n      const textLeft = cellLeft + 38;\n      const cellRight = cellLeft + colWidths.name;\n      const rowTop = rect.top + idx * rowHeight - tableContainer.scrollTop;\n      renameOverlay = {\n        top: rowTop,\n        left: textLeft - 2,\n        width: cellRight - textLeft + 2 - 4\n      };\n    }\n\n    editing = {\n      active: true,\n      path: entry.path,\n      index: idx,\n      draftName: entry.name\n    };\n\n    await tick();\n\n    if (renameInputEl) {\n      autoResizeRenameInput();\n      renameInputEl.focus();\n      const extPos = !entry.isDir ? entry.name.lastIndexOf('.') : -1;\n      const selectionEnd = extPos > 0 ? extPos : entry.name.length;\n      renameInputEl.setSelectionRange(0, selectionEnd);\n    }\n  }\n\n  function cancelRename() {\n    editing = {\n      active: false,\n      path: '',\n      index: -1,\n      draftName: ''\n    };\n  }\n\n  async function commitRename() {\n    if (!editing.active || editing.index < 0 || !results[editing.index]) {\n      return;\n    }\n\n    const current = results[editing.index];\n    const nextName = editing.draftName;\n\n    try {\n      await invoke('rename', {\n        path: current.path,\n        newName: nextName\n      });\n      cancelRename();\n      await runSearch();\n    } catch (err) {\n      showToast(`Failed to rename: ${String(err)}`);\n      await tick();\n      renameInputEl?.focus();\n    }\n  }\n\n  function onGlobalClick() {\n    closeContextMenu();\n  }\n\n  function onTitleBarMouseDown(event) {\n    if (event.button !== 0) {\n      return;\n    }\n\n    const activeElement = document.activeElement;\n    if (activeElement instanceof HTMLElement && isTextInputTarget(activeElement)) {\n      activeElement.blur();\n    }\n  }\n\n  async function focusSearch() {\n    await getCurrentWindow().show();\n    await getCurrentWindow().setFocus();\n    searchInputEl?.focus();\n    searchInputEl?.select();\n  }\n\n  function isTextInputTarget(target) {\n    return (\n      target instanceof HTMLInputElement ||\n      target instanceof HTMLTextAreaElement ||\n      target?.isContentEditable\n    );\n  }\n\n  async function handleKeydown(event) {\n    const isMetaSelectAll = (event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'a';\n    const isMetaCopy = (event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'c';\n    const target = event.target;\n    const isTextInput = isTextInputTarget(target);\n\n    if (isMetaCopy && isTextInput) {\n      return;\n    }\n\n    if (isMetaSelectAll) {\n      if (isTextInput) {\n        event.preventDefault();\n        if (target instanceof HTMLInputElement || target instanceof HTMLTextAreaElement) {\n          target.select();\n        }\n        return;\n      }\n    }\n\n    if (editing.active) {\n      if (event.key === 'Enter') {\n        event.preventDefault();\n        await commitRename();\n        return;\n      }\n\n      if (event.key === 'Escape') {\n        event.preventDefault();\n        const idx = editing.index;\n        cancelRename();\n        selectSingle(idx);\n        await tick();\n        tableContainer?.querySelector('.row.selected')?.focus();\n        return;\n      }\n      return;\n    }\n\n    if (event.key === 'Escape') {\n      event.preventDefault();\n      clearSelection();\n      return;\n    }\n\n    if (event.key === 'ArrowDown') {\n      event.preventDefault();\n      moveSelection(1, event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'ArrowUp') {\n      event.preventDefault();\n      moveSelection(-1, event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'PageDown') {\n      event.preventDefault();\n      moveSelection(Math.floor(viewportHeight / rowHeight), event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'PageUp') {\n      event.preventDefault();\n      moveSelection(-Math.floor(viewportHeight / rowHeight), event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'Enter') {\n      event.preventDefault();\n      if (platform === 'windows') {\n        await openSelected();\n      } else {\n        await startRename();\n      }\n      return;\n    }\n\n    if (event.key === 'F2') {\n      event.preventDefault();\n      await startRename();\n      return;\n    }\n\n    if (event.key === ' ' && !isTextInput) {\n      event.preventDefault();\n      const entry = primaryEntry();\n      if (entry) {\n        await invoke('quick_look', { path: entry.path });\n      }\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'f') {\n      event.preventDefault();\n      clearSelection();\n      searchInputEl?.focus();\n      searchInputEl?.select();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'o') {\n      event.preventDefault();\n      await openSelected();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key === 'Enter') {\n      event.preventDefault();\n      await revealSelected();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'c') {\n      event.preventDefault();\n      await copySelectedPaths();\n      return;\n    }\n\n    if (isMetaSelectAll) {\n      event.preventDefault();\n      selectedIndices = new Set(Array.from({ length: results.length }, (_, i) => i));\n      return;\n    }\n\n    if (event.key === 'Delete' || ((event.metaKey || event.ctrlKey) && event.key === 'Backspace')) {\n      if (!isTextInput) {\n        event.preventDefault();\n        await trashSelected();\n      }\n      return;\n    }\n  }\n\n  function formatSize(entry) {\n    if (entry.isDir || entry.size == null) return '';\n    const bytes = entry.size;\n    if (bytes < 1024) return `${bytes} B`;\n    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n    if (bytes < 1024 * 1024 * 1024) return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n    return `${(bytes / (1024 * 1024 * 1024)).toFixed(1)} GB`;\n  }\n\n  function formatModified(entry) {\n    if (!entry.mtime) {\n      return '';\n    }\n\n    const d = new Date(entry.mtime * 1000);\n    const pad = (n) => String(n).padStart(2, '0');\n    return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;\n  }\n\n  function formatLastUpdated(timestamp) {\n    if (!timestamp) {\n      return '-';\n    }\n\n    return new Date(timestamp * 1000).toLocaleString();\n  }\n\n  function formatElapsed(ms) {\n    const totalSec = Math.floor(ms / 1000);\n    const min = Math.floor(totalSec / 60);\n    const sec = totalSec % 60;\n    return min > 0 ? `${min}m ${sec}s` : `${sec}s`;\n  }\n\n  function updateElapsed() {\n    if (indexingStartTime && indexStatus.state === 'Indexing') {\n      indexingElapsed = formatElapsed(Date.now() - indexingStartTime);\n    }\n  }\n\n  function startElapsedTimer() {\n    clearInterval(elapsedTimer);\n    indexingStartTime = Date.now();\n    indexingElapsed = '0s';\n    indexingFinishedAt = '';\n    elapsedTimer = setInterval(updateElapsed, 1000);\n  }\n\n  function stopElapsedTimer() {\n    clearInterval(elapsedTimer);\n    if (indexingStartTime) {\n      const elapsed = Date.now() - indexingStartTime;\n      indexingFinishedAt = `${formatElapsed(elapsed)}`;\n    }\n    indexingStartTime = null;\n    indexingElapsed = '';\n  }\n\n  function displayPath(path) {\n    if (!path) {\n      return path;\n    }\n\n    if (!homePrefix) {\n      return path;\n    }\n\n    if (path === homePrefix) {\n      return '~';\n    }\n\n    if (path.startsWith(`${homePrefix}/`)) {\n      return `~${path.slice(homePrefix.length)}`;\n    }\n\n    return path;\n  }\n\n  let unlistenFns = [];\n\n  onMount(async () => {\n    const t0 = performance.now();\n    const ms = () => Math.round(performance.now() - t0);\n    const DEBUG_STARTUP = false;\n    const flog = DEBUG_STARTUP ? (msg) => invoke('frontend_log', { msg }).catch(() => {}) : () => {};\n\n    flog(`[startup/fe] onMount entered`);\n\n    updateViewportHeight();\n    flog(`[startup/fe] +${ms()}ms updateViewportHeight done`);\n\n    invoke('set_native_theme', { theme });\n\n    platform = await invoke('get_platform');\n    flog(`[startup/fe] +${ms()}ms get_platform done`);\n\n    const unlistenProgress = await listen('index_progress', (event) => {\n      scanned = event.payload.scanned;\n      if (indexStatus.state !== 'Indexing') {\n        indexStatus = {\n          ...indexStatus,\n          state: 'Indexing'\n        };\n      }\n    });\n    flog(`[startup/fe] +${ms()}ms listen(index_progress) registered`);\n\n    const unlistenState = await listen('index_state', (event) => {\n      flog(`[startup/fe] index_state event received: ${event.payload.state} at +${ms()}ms`);\n      const prevState = indexStatus.state;\n      indexStatus = {\n        ...indexStatus,\n        state: event.payload.state,\n        message: event.payload.message ?? null,\n        isCatchup: event.payload.isCatchup ?? false\n      };\n\n      if (event.payload.state === 'Indexing' && prevState !== 'Indexing') {\n        if (prevState === 'Ready') {\n          lastReadyCount = indexStatus.entriesCount;\n        }\n        startElapsedTimer();\n      } else if (event.payload.state !== 'Indexing' && prevState === 'Indexing') {\n        stopElapsedTimer();\n      }\n\n      if (event.payload.state === 'Ready') {\n        scheduleSearch();\n      }\n    });\n    flog(`[startup/fe] +${ms()}ms listen(index_state) registered`);\n\n    const unlistenUpdated = await listen('index_updated', (event) => {\n      indexStatus = {\n        ...indexStatus,\n        entriesCount: event.payload.entriesCount,\n        lastUpdated: event.payload.lastUpdated,\n        permissionErrors: event.payload.permissionErrors ?? indexStatus.permissionErrors\n      };\n\n      scheduleSearch(true);\n    });\n\n    const unlistenFocus = await listen('focus_search', () => {\n      void focusSearch();\n    });\n\n    const unlistenCtxMenuAction = await listen('context_menu_action', (event) => {\n      switch (event.payload) {\n        case 'open': void openSelected(); break;\n        case 'quick_look': {\n          const e = primaryEntry();\n          if (e) void invoke('quick_look', { path: e.path });\n          break;\n        }\n        case 'open_with': void openWithFallback(); break;\n        case 'reveal': void revealSelected(); break;\n        case 'copy_files': void copyFiles(); break;\n        case 'copy_path': void copySelectedPaths(); break;\n        case 'trash': void trashSelected(); break;\n        case 'rename': void startRename(); break;\n      }\n    });\n\n    unlistenFns = [unlistenProgress, unlistenState, unlistenUpdated, unlistenFocus, unlistenCtxMenuAction];\n    flog(`[startup/fe] +${ms()}ms all listeners registered`);\n\n    // Fetch backend state IMMEDIATELY after listeners are registered.\n    // Events emitted before listener registration are lost, so this\n    // is the only reliable way to get the current state.\n    await refreshStatus();\n    flog(`[startup/fe] +${ms()}ms refreshStatus done (state=${indexStatus.state})`);\n\n    // Show Svelte UI: remove skeleton, focus search input.\n    await tick();\n    document.getElementById('skeleton')?.remove();\n    await focusSearch();\n    flog(`[startup/fe] +${ms()}ms WINDOW VISIBLE â€” skeleton removed`);\n\n    try {\n      homePrefix = await invoke('get_home_dir');\n    } catch {\n      homePrefix = '';\n    }\n    flog(`[startup/fe] +${ms()}ms get_home_dir done`);\n\n    if (!localStorage.getItem('everything-fda-notice-v1')) {\n      showToast('macOS Full Disk Access permission may be required for full disk search.');\n      localStorage.setItem('everything-fda-notice-v1', '1');\n    }\n    flog(`[startup/fe] +${ms()}ms calling runSearch...`);\n    await runSearch();\n    flog(`[startup/fe] +${ms()}ms runSearch done`);\n\n    if (typeof ResizeObserver !== 'undefined') {\n      tableResizeObserver = new ResizeObserver(() => {\n        scheduleViewportHeightUpdate();\n      });\n      if (tableContainer) {\n        tableResizeObserver.observe(tableContainer);\n      } else if (tableAreaEl) {\n        tableResizeObserver.observe(tableAreaEl);\n      }\n    }\n\n    window.addEventListener('resize', scheduleViewportHeightUpdate);\n    window.addEventListener('click', onGlobalClick);\n    statusRefreshTimer = setInterval(() => {\n      if (indexStatus.state === 'Indexing') {\n        void refreshStatus();\n      }\n    }, 1000);\n    console.log(`[startup/fe] +${ms()}ms onMount complete`);\n  });\n\n  onDestroy(async () => {\n    clearTimeout(searchTimer);\n    clearTimeout(toastTimer);\n    clearInterval(statusRefreshTimer);\n    clearInterval(elapsedTimer);\n    resizeCleanup?.();\n\n    for (const unlisten of unlistenFns) {\n      unlisten();\n    }\n\n    tableResizeObserver?.disconnect();\n    tableResizeObserver = null;\n    if (viewportResizeRaf !== null) {\n      cancelAnimationFrame(viewportResizeRaf);\n      viewportResizeRaf = null;\n    }\n    window.removeEventListener('resize', scheduleViewportHeightUpdate);\n    window.removeEventListener('click', onGlobalClick);\n  });\n</script>\n\n<svelte:window on:keydown={handleKeydown} />\n\n<div class=\"app-shell\" data-theme={theme}>\n  <div class=\"title-bar\" role=\"presentation\" data-tauri-drag-region on:mousedown={onTitleBarMouseDown}>\n    <div class=\"title-left\"></div>\n    <div class=\"title-center\">\n      <svg class=\"title-icon\" viewBox=\"0 0 215 205\" fill-rule=\"evenodd\" aria-hidden=\"true\">\n        <path d=\"M85 0c46.9 0 85 38.1 85 85 0 20.1-7.2 38.5-19.2 52.7l40.7 40.8c5.8 5.8 5.8 15.2 0 21-5.8 5.8-15.2 5.8-21 0l-40.7-40.7c-13.6 9.7-30.4 15.2-44.8 15.2-46.9 0-85-42.1-85-89 0-46.9 38.1-85 85-85z m0 32c-29.3 0-53 23.7-53 53 0 29.3 23.7 53 53 53 29.3 0 53-23.7 53-53 0-29.3-23.7-53-53-53z\"/>\n      </svg>\n      <span class=\"title-text\">Everything</span>\n    </div>\n    <div class=\"title-right\"></div>\n  </div>\n\n  <header class=\"search-bar\">\n    <input\n      bind:this={searchInputEl}\n      class=\"search-input\"\n      type=\"text\"\n      bind:value={query}\n      on:input={scheduleSearch}\n      on:focus={clearSelection}\n      placeholder=\"Search file/folder names\"\n      autocomplete=\"off\"\n      spellcheck=\"false\"\n    />\n  </header>\n\n  <section class=\"table-area\" bind:this={tableAreaEl} style={tableGridStyle}>\n    <div class=\"table-header\">\n      <div class=\"table-header-track\">\n        <div class=\"col name\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('name')}>\n            Name{#if sortBy === 'name'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n          <button\n            type=\"button\"\n            class=\"col-resizer\"\n            class:active={resizingColumn === 'name'}\n            on:mousedown={(event) => startColumnResize(event, 'name')}\n            aria-label=\"Resize Name column\"\n          />\n        </div>\n\n        <div class=\"col path\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('dir')}>\n            Path{#if sortBy === 'dir'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n          <button\n            type=\"button\"\n            class=\"col-resizer\"\n            class:active={resizingColumn === 'path'}\n            on:mousedown={(event) => startColumnResize(event, 'path')}\n            aria-label=\"Resize Path column\"\n          />\n        </div>\n\n        <div class=\"col size\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('size')}>\n            Size{#if sortBy === 'size'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n        </div>\n\n        <div class=\"col modified\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('mtime')}>\n            Modified{#if sortBy === 'mtime'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <div\n      class=\"table-body\"\n      bind:this={tableContainer}\n      on:scroll={() => {\n        scrollTop = tableContainer.scrollTop;\n        headerScrollLeft = tableContainer.scrollLeft;\n        if (editing.active) void commitRename();\n        const scrollBottom = scrollTop + tableContainer.clientHeight;\n        if (scrollBottom >= totalHeight - rowHeight * 10) {\n          void loadMore();\n        }\n      }}\n    >\n      <div class=\"spacer\" style={`height:${totalHeight}px`}>\n        <div class=\"rows\" style={`transform: translateY(${translateY}px);`}>\n          {#each visibleRows as entry, localIndex}\n            {@const index = startIndex + localIndex}\n            <div\n              class=\"row {selectedIndices.has(index) ? 'selected' : ''}\"\n              on:mousedown={(event) => handleRowMouseDown(event, index)}\n              on:click={(event) => handleRowClick(event, index)}\n              on:keydown={(event) => handleRowA11yKeydown(event, index)}\n              on:dblclick={() => handleRowDoubleClick(index)}\n              on:contextmenu={(event) => handleRowContextMenu(event, index)}\n              role=\"row\"\n              tabindex=\"0\"\n            >\n              <div class=\"cell name\">\n                <img class=\"file-icon\" src={iconFor(entry)} alt=\"\" />\n                <span class=\"ellipsis\" class:name-editing={editing.active && editing.index === index}>{#each highlightSegments(entry.name, query) as seg}{#if seg.hl}<mark class=\"hl\">{seg.text}</mark>{:else}{seg.text}{/if}{/each}</span>\n              </div>\n              <div class=\"cell path\"><span class=\"ellipsis\">{displayPath(entry.dir)}</span></div>\n              <div class=\"cell size\">{formatSize(entry)}</div>\n              <div class=\"cell modified\">{formatModified(entry)}</div>\n            </div>\n          {/each}\n        </div>\n      </div>\n    </div>\n  </section>\n\n  <footer class=\"status-bar\">\n    <div class=\"status-left\">\n      <span class=\"status-state\">\n        <span class=\"state-dot {indexStatus.state === 'Indexing' ? 'indexing' : indexStatus.state === 'Error' ? 'error' : 'ready'}\"></span>\n        {#if indexStatus.state === 'Indexing'}\n          Indexing{#if lastReadyCount > 0} ({Math.min(99, Math.round((scanned / lastReadyCount) * 100))}%){/if}{#if indexingElapsed} Â· {indexingElapsed}{/if}\n          {#if !indexStatus.isCatchup}\n            Â· {scanned.toLocaleString()} scanned\n          {/if}\n        {:else}\n          Index: {indexStatus.state}\n        {/if}\n      </span>\n      <span>{indexStatus.entriesCount.toLocaleString()} entries</span>\n      {#if indexingFinishedAt && indexStatus.state !== 'Indexing'}\n        <span>in {indexingFinishedAt}</span>\n      {/if}\n      {#if dbLatencyMs !== null && dbLastQuery}\n        <span>\"{dbLastQuery}\" {dbLatencyMs}ms Â· {totalResults} results</span>\n      {/if}\n      {#if searchModeLabel === 'spotlight' || searchModeLabel === 'spotlight_timeout'}\n        <span class=\"status-spotlight\">Spotlight fallback{#if searchModeLabel === 'spotlight_timeout'} (partial){/if}</span>\n      {/if}\n      {#if indexStatus.permissionErrors > 0}\n        <span class=\"status-warning\">{indexStatus.permissionErrors.toLocaleString()} permission errors</span>\n      {/if}\n      {#if indexStatus.message}\n        <span class={indexStatus.isCatchup ? 'index-progress' : 'status-error'}>{indexStatus.message}</span>\n      {/if}\n    </div>\n    <div class=\"status-right\">\n      <button class=\"status-btn\" on:click={cycleTheme} title=\"Switch theme\">\n        {theme === 'dark' ? 'â˜€ Light' : 'â—‘ Dark'}\n      </button>\n      <button\n        class=\"status-btn rebuild-btn\"\n        on:click={resetIndex}\n        disabled={indexStatus.state === 'Indexing'}\n        title={indexStatus.state === 'Indexing' ? 'Cannot reset while indexing is in progress.' : 'Reset and rebuild the index.'}\n      >\n        <svg class=\"rebuild-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <path d=\"M23 4v6h-6\"/><path d=\"M20.49 15a9 9 0 1 1-2.12-9.36L23 10\"/>\n        </svg>\n        Rebuild Index\n      </button>\n    </div>\n  </footer>\n\n  {#if editing.active}\n    <div\n      class=\"rename-overlay\"\n      style=\"top:{renameOverlay.top}px; left:{renameOverlay.left}px; width:{renameOverlay.width}px;\"\n      role=\"presentation\"\n      on:mousedown|stopPropagation\n    >\n      <textarea\n        bind:this={renameInputEl}\n        class=\"rename-textarea\"\n        bind:value={editing.draftName}\n        on:input={autoResizeRenameInput}\n        on:click|stopPropagation\n        on:blur={commitRename}\n      />\n    </div>\n  {/if}\n\n  {#if contextMenu.visible}\n    <div class=\"context-menu\" style={`left:${contextMenu.x}px;top:${contextMenu.y}px;`}>\n      <button on:click={() => (closeContextMenu(), openSelected())}>Open</button>\n      <button on:click={async () => { closeContextMenu(); const e = primaryEntry(); if (e) await invoke('quick_look', { path: e.path }); }}>Quick Look</button>\n      <button on:click={() => (closeContextMenu(), openWithFallback())}>Open With... (Reveal in Finder)</button>\n      <button on:click={() => (closeContextMenu(), revealSelected())}>Reveal in Finder</button>\n      <button on:click={() => (closeContextMenu(), copySelectedPaths())}>Copy Path</button>\n      <button on:click={() => (closeContextMenu(), trashSelected())}>Move to Trash</button>\n      {#if selectedIndices.size === 1}\n        <button on:click={() => (closeContextMenu(), startRename())}>Rename</button>\n      {/if}\n    </div>\n  {/if}\n\n  {#if toast}\n    <div class=\"toast\">{toast}</div>\n  {/if}\n</div>\n\n<style>\n  :global(:root) {\n    color-scheme: light dark;\n    --bg-app: transparent;\n    --text-primary: #0d1826;\n    --text-muted: #48596c;\n    --bar-grad-top: rgba(255, 255, 255, 0.48);\n    --bar-grad-bottom: rgba(248, 250, 253, 0.42);\n    --surface-header: rgba(252, 252, 255, 0.40);\n    --surface: rgba(255, 255, 255, 0.22);\n    --border-soft: rgba(0, 0, 0, 0.07);\n    --border-input: rgba(0, 0, 0, 0.13);\n    --focus-ring: #6f96e6;\n    --row-border: rgba(0, 0, 0, 0.032);\n    --row-hover: rgba(0, 0, 0, 0.06);\n    --row-selected: rgba(0, 0, 0, 0.12);\n    --button-bg: rgba(255, 255, 255, 0.62);\n    --button-border: rgba(0, 0, 0, 0.10);\n    --button-text: #2c3e50;\n    --menu-bg: rgba(240, 241, 248, 0.90);\n    --menu-border: rgba(0, 0, 0, 0.06);\n    --menu-hover: rgba(255, 255, 255, 0.62);\n    --menu-text: #1a2a38;\n    --error-text: #b64545;\n    --warning-text: #8f6500;\n    --toast-bg: rgba(18, 22, 32, 0.90);\n    --toast-text: #ffffff;\n  }\n\n  @media (prefers-color-scheme: dark) {\n    :global(:root) {\n      --bg-app: transparent;\n      --text-primary: #e6e6ea;\n      --text-muted: #9494a4;\n      --bar-grad-top: rgba(38, 38, 46, 0.52);\n      --bar-grad-bottom: rgba(30, 30, 38, 0.46);\n      --surface-header: rgba(32, 32, 40, 0.46);\n      --surface: rgba(18, 18, 26, 0.32);\n      --border-soft: rgba(255, 255, 255, 0.065);\n      --border-input: rgba(255, 255, 255, 0.14);\n      --focus-ring: #5b8bd9;\n      --row-border: rgba(255, 255, 255, 0.026);\n      --row-hover: rgba(255, 255, 255, 0.08);\n      --row-selected: rgba(255, 255, 255, 0.14);\n      --button-bg: rgba(255, 255, 255, 0.072);\n      --button-border: rgba(255, 255, 255, 0.11);\n      --button-text: #d6d6e0;\n      --menu-bg: rgba(36, 36, 46, 0.90);\n      --menu-border: rgba(255, 255, 255, 0.066);\n      --menu-hover: rgba(255, 255, 255, 0.062);\n      --menu-text: #e0e0e8;\n      --error-text: #ff9d9d;\n      --warning-text: #e0c670;\n      --toast-bg: rgba(10, 10, 16, 0.93);\n      --toast-text: #f2f2f6;\n    }\n  }\n\n  /* â”€â”€ Theme: Dark â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme=\"dark\"]) {\n    color-scheme: dark;\n    --bg-app: #1E1E21;\n    --text-primary: #E2E8F0;\n    --text-muted: #94A3B8;\n    --bar-grad-top: #1E1E21;\n    --bar-grad-bottom: #1E1E21;\n    --surface-header: #1E1E21;\n    --surface: #1E1E21;\n    --bg-input: #161618;\n    --border-soft: #2A2A2D;\n    --border-input: rgba(255, 255, 255, 0.06);\n    --focus-ring: #4DA8FF;\n    --accent: #4DA8FF;\n    --row-border: rgba(255, 255, 255, 0.02);\n    --row-hover: #282828;\n    --row-selected: rgba(77, 168, 255, 0.10);\n    --button-bg: rgba(255, 255, 255, 0.05);\n    --button-border: #2A2A2D;\n    --button-text: #94A3B8;\n    --menu-bg: #252528;\n    --menu-border: #2A2A2D;\n    --menu-hover: rgba(255, 255, 255, 0.04);\n    --menu-text: #E2E8F0;\n    --error-text: #ff9d9d;\n    --warning-text: #e0c670;\n    --toast-bg: rgba(10, 10, 16, 0.93);\n    --toast-text: #f2f2f6;\n  }\n\n  /* â”€â”€ Theme: Light â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme=\"light\"]) {\n    color-scheme: light;\n    --bg-app: #F5F5F7;\n    --text-primary: #1C1C1E;\n    --text-muted: #6E6E7A;\n    --bar-grad-top: #F5F5F7;\n    --bar-grad-bottom: #F5F5F7;\n    --surface-header: #F5F5F7;\n    --surface: #F5F5F7;\n    --bg-input: #FFFFFF;\n    --border-soft: #D1D1D6;\n    --border-input: rgba(0, 0, 0, 0.10);\n    --focus-ring: #3A8BF5;\n    --accent: #3A8BF5;\n    --row-border: rgba(0, 0, 0, 0.04);\n    --row-hover: rgba(0, 0, 0, 0.04);\n    --row-selected: rgba(58, 139, 245, 0.10);\n    --button-bg: #FFFFFF;\n    --button-border: #D1D1D6;\n    --button-text: #3C3C43;\n    --menu-bg: #FFFFFF;\n    --menu-border: #D1D1D6;\n    --menu-hover: rgba(0, 0, 0, 0.05);\n    --menu-text: #1C1C1E;\n    --error-text: #D93025;\n    --warning-text: #B45309;\n    --toast-bg: rgba(255, 255, 255, 0.95);\n    --toast-text: #1C1C1E;\n  }\n\n  /* â”€â”€ Themed element overrides â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme]) {\n    background: var(--bg-app);\n  }\n\n  /* Search bar: flat, no gradient, no separator */\n  :global([data-theme]) .search-bar {\n    height: 44px;\n    padding: 0 16px;\n    background: var(--bg-app);\n    border-bottom: none;\n  }\n\n  :global([data-theme]) .search-input {\n    backdrop-filter: none;\n    -webkit-backdrop-filter: none;\n    font-family: 'JetBrains Mono', 'SF Mono', monospace;\n    font-size: 12px;\n    height: 34px;\n    border-radius: 8px;\n  }\n\n  /* Table header: flat bg, 16px edge padding */\n  :global([data-theme]) .table-header {\n    background: var(--bg-app);\n  }\n\n  :global([data-theme]) .col-button {\n    padding: 0 8px;\n  }\n\n  :global([data-theme]) .col.name .col-button {\n    padding-left: 16px;\n  }\n\n  /* Row cells: JetBrains Mono, 16px outer edges */\n  :global([data-theme]) .cell {\n    font-family: 'JetBrains Mono', monospace;\n  }\n\n  :global([data-theme]) .cell.name {\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    padding-left: 16px;\n    font-size: 12px;\n    color: var(--text-primary);\n  }\n\n  :global([data-theme]) .cell.path {\n    font-size: 11px;\n  }\n\n  :global([data-theme]) .cell.size {\n    font-size: 11px;\n  }\n\n  :global([data-theme]) .cell.modified {\n    padding-right: 16px;\n    font-size: 11px;\n    white-space: nowrap;\n  }\n\n  :global([data-theme]) .row.selected {\n    box-shadow: inset 3px 0 0 var(--accent);\n  }\n\n  /* Dim path/size/date cells in themed mode */\n  :global([data-theme]) .cell.path,\n  :global([data-theme]) .cell.size,\n  :global([data-theme]) .cell.modified {\n    color: var(--text-muted);\n  }\n\n  :global(:root) {\n    background: transparent;\n  }\n\n  :global(html, body) {\n    margin: 0;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n    background: transparent;\n    color: var(--text-primary);\n    font-family: Inter, 'SF Pro Text', 'Segoe UI', Helvetica, Arial, sans-serif;\n  }\n\n  :global(#app) {\n    width: 100%;\n    height: 100%;\n  }\n\n  .app-shell {\n    display: grid;\n    grid-template-rows: auto auto 1fr auto;\n    height: 100%;\n    min-width: 0;\n  }\n\n  .title-bar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 44px;\n    padding: 0 16px;\n    background: var(--surface-header);\n    cursor: default;\n    flex-shrink: 0;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-left {\n    width: 72px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-center {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-right {\n    width: 72px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-icon {\n    width: 14px;\n    height: 14px;\n    fill: var(--accent);\n    flex-shrink: 0;\n  }\n\n  .title-text {\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--text-primary);\n    letter-spacing: -0.01em;\n  }\n\n  .search-bar {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 8px;\n    background: linear-gradient(180deg, var(--bar-grad-top) 0%, var(--bar-grad-bottom) 100%);\n    border-bottom: 1px solid var(--border-soft);\n    min-width: 0;\n    flex-shrink: 0;\n  }\n\n  .search-input {\n    display: block;\n    box-sizing: border-box;\n    width: 100%;\n    min-width: 0;\n    flex: 1 1 auto;\n    height: 36px;\n    border: 1px solid var(--border-input);\n    border-radius: 14px;\n    padding: 0 10px;\n    font-size: 14px;\n    background: var(--bg-input, var(--surface));\n    color: var(--text-primary);\n    backdrop-filter: blur(12px) saturate(160%);\n    -webkit-backdrop-filter: blur(12px) saturate(160%);\n  }\n\n  .search-input::placeholder {\n    color: var(--text-muted);\n    opacity: 0.85;\n    font-size: 12px;\n  }\n\n  .search-input:focus {\n    outline: none;\n    border-color: var(--focus-ring);\n    box-shadow: 0 0 0 2px rgba(125, 169, 255, 0.25);\n  }\n\n  .table-area {\n    display: grid;\n    grid-template-rows: auto 1fr;\n    min-height: 0;\n    min-width: 0;\n  }\n\n  .table-header-track,\n  .row {\n    display: grid;\n    grid-template-columns: var(--col-name) var(--col-path) var(--col-size) var(--col-modified);\n    align-items: center;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .table-header {\n    height: 32px;\n    border-bottom: 1px solid var(--border-soft);\n    background: var(--surface-header);\n    user-select: none;\n    overflow: hidden;\n    flex-shrink: 0;\n  }\n\n  .table-header-track {\n    height: 100%;\n    transform: translateX(var(--header-offset, 0px));\n    will-change: transform;\n  }\n\n  .table-header .col {\n    position: relative;\n    min-width: 0;\n    height: 100%;\n  }\n\n  .col-button {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: flex-start;\n    gap: 4px;\n    box-sizing: border-box;\n    padding: 0 8px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 11px;\n    font-weight: 600;\n    line-height: 1;\n    color: var(--text-muted);\n    text-align: left;\n    margin: 0;\n    border: none;\n    background: transparent;\n    cursor: pointer;\n  }\n\n  .sort-icon {\n    width: 10px;\n    height: 10px;\n    flex-shrink: 0;\n    color: var(--accent);\n  }\n\n  .col-resizer {\n    position: absolute;\n    top: 0;\n    right: -4px;\n    width: 8px;\n    height: 100%;\n    border: none;\n    padding: 0;\n    background: transparent;\n    cursor: col-resize;\n    z-index: 30;\n  }\n\n  .col-resizer::after {\n    content: '';\n    position: absolute;\n    top: 7px;\n    bottom: 7px;\n    left: 50%;\n    width: 1px;\n    transform: translateX(-50%);\n    background: var(--border-soft);\n    opacity: 0;\n    transition: opacity 0.15s ease;\n  }\n\n  .table-header .col:hover .col-resizer::after,\n  .col-resizer.active::after {\n    opacity: 1;\n  }\n\n  .table-body {\n    overflow: auto;\n    min-height: 0;\n    min-width: 0;\n    background: var(--surface);\n  }\n\n  .spacer {\n    position: relative;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .rows {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .row {\n    height: 30px;\n    border-bottom: 1px solid var(--row-border);\n    cursor: default;\n    -webkit-user-select: none;\n    user-select: none;\n    outline: none;\n  }\n\n  .row:hover {\n    background: var(--row-hover);\n  }\n\n  .row.selected {\n    background: var(--row-selected);\n  }\n\n  .cell {\n    padding: 0 8px;\n    font-size: 12px;\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    min-width: 0;\n  }\n\n  .cell.size {\n    text-align: right;\n    font-variant-numeric: tabular-nums;\n  }\n\n  .ellipsis {\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n\n  .hl {\n    background: none;\n    color: inherit;\n    font-weight: 700;\n  }\n\n  .file-icon {\n    width: 16px;\n    height: 16px;\n    flex: 0 0 auto;\n  }\n\n  .name-editing {\n    opacity: 0.25;\n  }\n\n  .rename-overlay {\n    position: fixed;\n    z-index: 100;\n    min-width: 120px;\n  }\n\n  .rename-textarea {\n    display: block;\n    width: 100%;\n    box-sizing: border-box;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 12px;\n    line-height: 18px;\n    padding: 5px 4px 5px 0;\n    border: 1.5px solid var(--focus-ring);\n    border-radius: 4px;\n    background: var(--bg-input, var(--surface));\n    color: var(--text-primary);\n    outline: none;\n    resize: none;\n    overflow: hidden;\n    box-shadow: 0 2px 14px rgba(0, 0, 0, 0.22), 0 0 0 3px rgba(77, 168, 255, 0.13);\n  }\n\n  .status-bar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 32px;\n    padding: 0 16px;\n    background: var(--surface-header);\n    border-top: 1px solid var(--border-soft);\n    font-family: 'JetBrains Mono', monospace;\n    font-size: 11px;\n    color: var(--text-muted);\n    white-space: nowrap;\n    overflow: hidden;\n    min-width: 0;\n    flex-shrink: 0;\n  }\n\n  .status-left {\n    display: flex;\n    align-items: center;\n    gap: 16px;\n    overflow: hidden;\n    min-width: 0;\n  }\n\n  .status-right {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    flex-shrink: 0;\n  }\n\n  .status-btn {\n    border: 1px solid var(--button-border);\n    border-radius: 5px;\n    background: var(--button-bg);\n    color: var(--button-text);\n    font-size: 11px;\n    height: 22px;\n    padding: 0 8px;\n    cursor: pointer;\n  }\n\n  .status-btn:hover {\n    filter: brightness(1.06);\n  }\n\n  .status-btn:disabled {\n    opacity: 0.55;\n    cursor: not-allowed;\n    filter: none;\n  }\n\n  .status-state {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n  }\n\n  .state-dot {\n    width: 6px;\n    height: 6px;\n    border-radius: 50%;\n    flex-shrink: 0;\n  }\n\n  .state-dot.ready { background: #28C840; }\n  .state-dot.indexing { background: #FEBC2E; }\n  .state-dot.error { background: #FF5F57; }\n\n  .rebuild-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 10px;\n    font-weight: 500;\n    background: var(--button-bg);\n    border: 1px solid var(--button-border);\n    border-radius: 4px;\n    color: var(--button-text);\n    height: 22px;\n    padding: 0 10px;\n    cursor: pointer;\n  }\n\n  .rebuild-btn:hover {\n    filter: brightness(1.1);\n  }\n\n  .rebuild-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    filter: none;\n  }\n\n  .rebuild-icon {\n    width: 11px;\n    height: 11px;\n    color: var(--accent);\n    flex-shrink: 0;\n  }\n\n  .status-error {\n    color: var(--error-text);\n  }\n\n  .status-warning {\n    color: var(--warning-text);\n  }\n\n  .status-spotlight {\n    color: #f59e0b;\n    font-weight: 600;\n  }\n\n  .context-menu {\n    position: fixed;\n    z-index: 200;\n    width: 220px;\n    border: 1px solid var(--menu-border);\n    border-radius: 10px;\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.16), inset 0 0 0 0.5px rgba(255, 255, 255, 0.18);\n    background: var(--menu-bg);\n    backdrop-filter: blur(28px) saturate(180%);\n    -webkit-backdrop-filter: blur(28px) saturate(180%);\n    overflow: hidden;\n  }\n\n  .context-menu button {\n    width: 100%;\n    text-align: left;\n    border: none;\n    background: transparent;\n    padding: 8px 10px;\n    font-size: 12px;\n    color: var(--menu-text);\n  }\n\n  .context-menu button:hover {\n    background: var(--menu-hover);\n  }\n\n  .toast {\n    position: fixed;\n    right: 14px;\n    bottom: 18px;\n    background: var(--toast-bg);\n    color: var(--toast-text);\n    border-radius: 10px;\n    padding: 9px 12px;\n    font-size: 12px;\n    z-index: 250;\n    backdrop-filter: blur(20px) saturate(180%);\n    -webkit-backdrop-filter: blur(20px) saturate(180%);\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);\n  }\n</style>\n","structuredPatch":[{"oldStart":31,"oldLines":6,"newStart":31,"newLines":11,"lines":["     invoke('set_native_theme', { theme });","   }"," ","+  function sortIconHtml(dir) {","+    const d = dir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5';","+    return `<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"${d}\"/></svg>`;","+  }","+","   let query = '';","   let results = [];","   let totalResults = 0;"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"d824e066-f0fb-4f09-8e84-239fdaca9b3c"}
{"parentUuid":"924f6ed6-b88d-4f62-abb0-cc7e4d782cb4","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01EW74dmGkjxgkgbGG4LMUK4","type":"message","role":"assistant","content":[{"type":"text","text":"ì´ì œ í…œí”Œë¦¿ì˜ 4ê°œ sort icon SVGë¥¼ `{@html}` í˜¸ì¶œë¡œ êµì²´í•©ë‹ˆë‹¤."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":568,"cache_read_input_tokens":98202,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":568},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPQ5HaiJ4HuaLAvcF8e","type":"assistant","uuid":"15e8a2ab-7b7e-4fb0-a822-aa3428c57335","timestamp":"2026-02-21T14:39:50.831Z"}
{"parentUuid":"15e8a2ab-7b7e-4fb0-a822-aa3428c57335","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01EW74dmGkjxgkgbGG4LMUK4","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01SZEumr9fKdyYDJt1ARZ3NR","name":"Read","input":{"file_path":"/Users/al02402336/everything/src/App.svelte","offset":1455,"limit":40},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":568,"cache_read_input_tokens":98202,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":568},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPQ5HaiJ4HuaLAvcF8e","type":"assistant","uuid":"08a8b385-c8e6-41fc-bfd9-315bd197d9c6","timestamp":"2026-02-21T14:39:51.336Z"}
{"parentUuid":"08a8b385-c8e6-41fc-bfd9-315bd197d9c6","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01SZEumr9fKdyYDJt1ARZ3NR","toolUseID":"toolu_01SZEumr9fKdyYDJt1ARZ3NR","timestamp":"2026-02-21T14:39:51.365Z","uuid":"111a29ca-0b07-4a2c-852e-cdae5dfc39e4"}
{"parentUuid":"08a8b385-c8e6-41fc-bfd9-315bd197d9c6","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01SZEumr9fKdyYDJt1ARZ3NR","type":"tool_result","content":"  1455â†’  <section class=\"table-area\" bind:this={tableAreaEl} style={tableGridStyle}>\n  1456â†’    <div class=\"table-header\">\n  1457â†’      <div class=\"table-header-track\">\n  1458â†’        <div class=\"col name\">\n  1459â†’          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('name')}>\n  1460â†’            Name{#if sortBy === 'name'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n  1461â†’          </button>\n  1462â†’          <button\n  1463â†’            type=\"button\"\n  1464â†’            class=\"col-resizer\"\n  1465â†’            class:active={resizingColumn === 'name'}\n  1466â†’            on:mousedown={(event) => startColumnResize(event, 'name')}\n  1467â†’            aria-label=\"Resize Name column\"\n  1468â†’          />\n  1469â†’        </div>\n  1470â†’\n  1471â†’        <div class=\"col path\">\n  1472â†’          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('dir')}>\n  1473â†’            Path{#if sortBy === 'dir'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n  1474â†’          </button>\n  1475â†’          <button\n  1476â†’            type=\"button\"\n  1477â†’            class=\"col-resizer\"\n  1478â†’            class:active={resizingColumn === 'path'}\n  1479â†’            on:mousedown={(event) => startColumnResize(event, 'path')}\n  1480â†’            aria-label=\"Resize Path column\"\n  1481â†’          />\n  1482â†’        </div>\n  1483â†’\n  1484â†’        <div class=\"col size\">\n  1485â†’          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('size')}>\n  1486â†’            Size{#if sortBy === 'size'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n  1487â†’          </button>\n  1488â†’        </div>\n  1489â†’\n  1490â†’        <div class=\"col modified\">\n  1491â†’          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('mtime')}>\n  1492â†’            Modified{#if sortBy === 'mtime'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n  1493â†’          </button>\n  1494â†’        </div>\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"7e72f974-4ae8-4b72-a2c4-02a55e545ceb","timestamp":"2026-02-21T14:39:51.363Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/al02402336/everything/src/App.svelte","content":"  <section class=\"table-area\" bind:this={tableAreaEl} style={tableGridStyle}>\n    <div class=\"table-header\">\n      <div class=\"table-header-track\">\n        <div class=\"col name\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('name')}>\n            Name{#if sortBy === 'name'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n          <button\n            type=\"button\"\n            class=\"col-resizer\"\n            class:active={resizingColumn === 'name'}\n            on:mousedown={(event) => startColumnResize(event, 'name')}\n            aria-label=\"Resize Name column\"\n          />\n        </div>\n\n        <div class=\"col path\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('dir')}>\n            Path{#if sortBy === 'dir'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n          <button\n            type=\"button\"\n            class=\"col-resizer\"\n            class:active={resizingColumn === 'path'}\n            on:mousedown={(event) => startColumnResize(event, 'path')}\n            aria-label=\"Resize Path column\"\n          />\n        </div>\n\n        <div class=\"col size\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('size')}>\n            Size{#if sortBy === 'size'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n        </div>\n\n        <div class=\"col modified\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('mtime')}>\n            Modified{#if sortBy === 'mtime'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n        </div>","numLines":40,"startLine":1455,"totalLines":2282}},"sourceToolAssistantUUID":"08a8b385-c8e6-41fc-bfd9-315bd197d9c6"}
{"parentUuid":"7e72f974-4ae8-4b72-a2c4-02a55e545ceb","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01NPYsULnAda7vpGEEVAGjhy","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01BacV41sSnBPJAXtz7JN3Li","name":"Edit","input":{"replace_all":false,"file_path":"/Users/al02402336/everything/src/App.svelte","old_string":"            Name{#if sortBy === 'name'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}","new_string":"            Name{#if sortBy === 'name'}{@html sortIconHtml(sortDir)}{/if}"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1435,"cache_read_input_tokens":98770,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1435},"output_tokens":18,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPQLnVDZCzGuW7t68jL","type":"assistant","uuid":"35e77e68-fd1f-4210-aa25-bd25781f9ebc","timestamp":"2026-02-21T14:39:55.518Z"}
{"parentUuid":"35e77e68-fd1f-4210-aa25-bd25781f9ebc","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01BacV41sSnBPJAXtz7JN3Li","toolUseID":"toolu_01BacV41sSnBPJAXtz7JN3Li","timestamp":"2026-02-21T14:39:55.524Z","uuid":"fe2c38b4-9152-4e3c-83c6-32180de85a45"}
{"parentUuid":"35e77e68-fd1f-4210-aa25-bd25781f9ebc","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01BacV41sSnBPJAXtz7JN3Li","type":"tool_result","content":"The file /Users/al02402336/everything/src/App.svelte has been updated successfully."}]},"uuid":"91a3ab9a-2bb1-423d-af4f-00cf07186447","timestamp":"2026-02-21T14:39:55.524Z","toolUseResult":{"filePath":"/Users/al02402336/everything/src/App.svelte","oldString":"            Name{#if sortBy === 'name'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}","newString":"            Name{#if sortBy === 'name'}{@html sortIconHtml(sortDir)}{/if}","originalFile":"<script>\n  import { onDestroy, onMount, tick } from 'svelte';\n  import { invoke } from '@tauri-apps/api/core';\n  import { listen } from '@tauri-apps/api/event';\n  import { getCurrentWindow } from '@tauri-apps/api/window';\n  import { startDrag } from '@crabnebula/tauri-plugin-drag';\n\n  const rowHeight = 30;\n  const PAGE_SIZE = 500;\n  let homePrefix = '';\n  const COL_WIDTHS_KEY = 'REDACTED';\n  const THEME_KEY = 'everything-theme';\n  const columnKeys = ['name', 'path', 'size', 'modified'];\n  const minColumnWidth = {\n    name: 180,\n    path: 240,\n    size: 75,\n    modified: 150\n  };\n  const defaultColumnRatios = {\n    name: 0.3,\n    path: 0.45,\n    size: 0.1\n  };\n\n  const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n  let theme = (() => { try { return localStorage.getItem(THEME_KEY) || systemTheme; } catch { return systemTheme; } })();\n  function cycleTheme() {\n    theme = theme === 'dark' ? 'light' : 'dark';\n    try { localStorage.setItem(THEME_KEY, theme); } catch {}\n    invoke('set_native_theme', { theme });\n  }\n\n  function sortIconHtml(dir) {\n    const d = dir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5';\n    return `<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"${d}\"/></svg>`;\n  }\n\n  let query = '';\n  let results = [];\n  let totalResults = 0;\n  let totalResultsKnown = false;\n\n  let dbLatencyMs = null;\n  let dbLastQuery = '';\n  let searchModeLabel = '';\n  let selectedIndices = new Set();\n  let selectionAnchor = -1;\n  let lastSelectedIndex = -1;\n  let editing = {\n    active: false,\n    path: '',\n    index: -1,\n    draftName: ''\n  };\n\n  let renameOverlay = { top: 0, left: 0, width: 0 };\n\n  let indexStatus = {\n    state: 'Indexing',\n    entriesCount: 0,\n    lastUpdated: null,\n    permissionErrors: 0,\n    message: null,\n    isCatchup: false\n  };\n\n  let indexingStartTime = null;\n  let indexingElapsed = '';\n  let indexingFinishedAt = '';\n\n  let sortBy = 'name';\n  let sortDir = 'asc';\n\n  let hasMore = true;\n  let loadingMore = false;\n  let searchGeneration = 0;\n\n  let scanned = 0;\n\n  let searchInputEl;\n  let renameInputEl;\n  let tableAreaEl;\n  let tableContainer;\n  let tableResizeObserver = null;\n  let viewportResizeRaf = null;\n  let scrollTop = 0;\n  let headerScrollLeft = 0;\n  let viewportHeight = 520;\n  let lastTableWidth = 0;\n  let resizingColumn = '';\n  let resizeCleanup = null;\n  let colWidths = {\n    name: 250,\n    path: 350,\n    size: 75,\n    modified: 150\n  };\n\n  let contextMenu = {\n    visible: false,\n    x: 0,\n    y: 0\n  };\n\n  let platform = '';\n  let toast = '';\n  let searchTimer;\n  let lastSearchFiredAt = 0;\n  let toastTimer;\n  let statusRefreshTimer;\n  let elapsedTimer;\n  let statusRefreshInFlight = false;\n  let lastReadyCount = 0;\n\n  const iconCache = new Map();\n  const iconLoading = new Set();\n\n  let highlightCache = new Map();\n  let highlightCacheQuery = '';\n\n  const folderFallbackIcon =\n    \"data:image/svg+xml;utf8,\" +\n    encodeURIComponent(\n      `<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><rect x='1' y='4' width='14' height='10' rx='2' fill='#d9b34f'/><rect x='1' y='2' width='6' height='4' rx='1' fill='#e6ca7a'/></svg>`\n    );\n  const fileFallbackIcon =\n    \"data:image/svg+xml;utf8,\" +\n    encodeURIComponent(\n      `<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><rect x='3' y='1' width='10' height='14' rx='1.5' fill='#b4bec9'/><rect x='5' y='5' width='6' height='1.2' fill='#8d98a5'/><rect x='5' y='8' width='6' height='1.2' fill='#8d98a5'/></svg>`\n    );\n\n  $: totalHeight = results.length * rowHeight;\n  $: startIndex = Math.max(0, Math.floor(scrollTop / rowHeight) - 10);\n  $: visibleCount = Math.ceil(viewportHeight / rowHeight) + 20;\n  $: endIndex = Math.min(results.length, startIndex + visibleCount);\n  $: visibleRows = results.slice(startIndex, endIndex);\n  $: translateY = startIndex * rowHeight;\n  $: tableMinWidth = colWidths.name + colWidths.path + colWidths.size + colWidths.modified;\n  $: tableGridStyle = `--col-name:${colWidths.name}px;--col-path:${colWidths.path}px;--col-size:${colWidths.size}px;--col-modified:${colWidths.modified}px;--table-min-width:${tableMinWidth}px;--header-offset:${-headerScrollLeft}px;`;\n\n  $: {\n    for (const entry of visibleRows) {\n      void ensureIcon(entry);\n    }\n  }\n\n  function showToast(message) {\n    toast = message;\n    clearTimeout(toastTimer);\n    toastTimer = setTimeout(() => {\n      toast = '';\n    }, 3000);\n  }\n\n  function bytesToBase64(bytes) {\n    let binary = '';\n    const chunk = 0x8000;\n    for (let i = 0; i < bytes.length; i += chunk) {\n      const part = bytes.subarray(i, i + chunk);\n      binary += String.fromCharCode(...part);\n    }\n    return btoa(binary);\n  }\n\n  function highlightSegments(name, q) {\n    q = (q || '').trim();\n    if (!q) return [{ text: name, hl: false }];\n\n    // Reset cache when query changes\n    if (q !== highlightCacheQuery) {\n      highlightCache = new Map();\n      highlightCacheQuery = q;\n    }\n\n    // Check cache\n    const cached = highlightCache.get(name);\n    if (cached) return cached;\n\n    if (q.includes('/')) q = q.slice(q.lastIndexOf('/') + 1);\n    q = q.replace(/[*?]/g, '');\n    const terms = q.split(/\\s+/).filter(Boolean);\n    if (terms.length === 0) return [{ text: name, hl: false }];\n\n    const lower = name.toLowerCase();\n    const marks = new Uint8Array(name.length);\n    for (const t of terms) {\n      const tl = t.toLowerCase();\n      let idx = lower.indexOf(tl);\n      while (idx !== -1) {\n        for (let i = idx; i < idx + tl.length; i++) marks[i] = 1;\n        idx = lower.indexOf(tl, idx + 1);\n      }\n    }\n\n    const segs = [];\n    let i = 0;\n    while (i < name.length) {\n      const m = marks[i];\n      let j = i + 1;\n      while (j < name.length && marks[j] === m) j++;\n      segs.push({ text: name.slice(i, j), hl: m === 1 });\n      i = j;\n    }\n\n    highlightCache.set(name, segs);\n    return segs;\n  }\n\n  const perFileIconExts = new Set(['exe', 'lnk', 'ico', 'url', 'scr', 'appx']);\n\n  function iconKey(entry) {\n    if (entry.isDir) return '__folder__';\n    const ext = (entry.ext || '').toLowerCase();\n    if (perFileIconExts.has(ext)) return entry.path;\n    return ext || '__file__';\n  }\n\n  function iconFor(entry) {\n    return iconCache.get(iconKey(entry)) || (entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n  }\n\n  async function ensureIcon(entry) {\n    const key = iconKey(entry);\n    if (iconCache.has(key) || iconLoading.has(key)) {\n      return;\n    }\n\n    iconLoading.add(key);\n    try {\n      const bytes = await invoke('get_file_icon', {\n        path: entry.path,\n        ext: entry.isDir ? 'folder' : entry.ext || '',\n      });\n      if (Array.isArray(bytes) && bytes.length > 0) {\n        const image = `data:image/png;base64,${bytesToBase64(Uint8Array.from(bytes))}`;\n        iconCache.set(key, image);\n      } else {\n        iconCache.set(key, entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n      }\n    } catch {\n      iconCache.set(key, entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n    } finally {\n      iconLoading.delete(key);\n    }\n  }\n\n  function syncColumnWidthsToContainer() {\n    const width = tableContainer?.clientWidth || tableAreaEl?.clientWidth;\n    if (!width || lastTableWidth !== 0) {\n      return;\n    }\n\n    const saved = loadColWidths();\n    if (saved) {\n      const total = columnKeys.reduce((s, k) => s + saved[k], 0);\n      if (Math.abs(total - width) > 2) {\n        const scale = (width - saved.modified) / (total - saved.modified);\n        let scaledName = Math.max(minColumnWidth.name, Math.round(saved.name * scale));\n        let scaledSize = Math.max(minColumnWidth.size, Math.round(saved.size * scale));\n        let rawPath = width - saved.modified - scaledName - scaledSize;\n        if (rawPath < minColumnWidth.path) {\n          const shortfall = minColumnWidth.path - rawPath;\n          const nameReduction = Math.min(shortfall, scaledName - minColumnWidth.name);\n          scaledName -= nameReduction;\n          const remaining = shortfall - nameReduction;\n          if (remaining > 0) {\n            scaledSize -= Math.min(remaining, scaledSize - minColumnWidth.size);\n          }\n          rawPath = width - saved.modified - scaledName - scaledSize;\n        }\n        const scaledPath = Math.max(minColumnWidth.path, rawPath);\n        colWidths = { name: scaledName, path: scaledPath, size: scaledSize, modified: saved.modified };\n      } else {\n        colWidths = saved;\n      }\n    } else {\n      const fixedModified = minColumnWidth.modified;\n      const rest = width - fixedModified;\n      const ratioSum = defaultColumnRatios.name + defaultColumnRatios.path + defaultColumnRatios.size;\n      colWidths = {\n        name: Math.max(minColumnWidth.name, Math.round(rest * defaultColumnRatios.name / ratioSum)),\n        path: Math.max(minColumnWidth.path, Math.round(rest * defaultColumnRatios.path / ratioSum)),\n        size: Math.max(minColumnWidth.size, Math.round(rest * defaultColumnRatios.size / ratioSum)),\n        modified: fixedModified\n      };\n    }\n    lastTableWidth = width;\n  }\n\n  function loadColWidths() {\n    try {\n      const raw = localStorage.getItem(COL_WIDTHS_KEY);\n      if (!raw) return null;\n      const parsed = JSON.parse(raw);\n      for (const key of columnKeys) {\n        if (typeof parsed[key] !== 'number' || parsed[key] < (minColumnWidth[key] || 0)) return null;\n      }\n      return parsed;\n    } catch {\n      return null;\n    }\n  }\n\n  function saveColWidths() {\n    localStorage.setItem(COL_WIDTHS_KEY, JSON.stringify(colWidths));\n  }\n\n  function updateViewportHeight() {\n    viewportHeight = tableContainer?.clientHeight || 520;\n    syncColumnWidthsToContainer();\n  }\n\n  function scheduleViewportHeightUpdate() {\n    if (viewportResizeRaf !== null) {\n      return;\n    }\n    viewportResizeRaf = requestAnimationFrame(() => {\n      viewportResizeRaf = null;\n      updateViewportHeight();\n    });\n  }\n\n  function startColumnResize(event, leftKey) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    const index = columnKeys.indexOf(leftKey);\n    if (index < 0 || index >= columnKeys.length - 1) {\n      return;\n    }\n\n    const startX = event.clientX;\n    const startLeft = colWidths[leftKey];\n    const rightKey = columnKeys[index + 1];\n    const startRight = colWidths[rightKey];\n\n    resizeCleanup?.();\n    resizingColumn = leftKey;\n\n    const onMove = (moveEvent) => {\n      const delta = Math.round(moveEvent.clientX - startX);\n      if (leftKey === 'name') {\n        // Two-column trade: name and path swap space, each respects its minimum\n        const nextLeft = Math.max(\n          minColumnWidth[leftKey],\n          Math.min(startLeft + delta, startLeft + startRight - minColumnWidth[rightKey])\n        );\n        const nextRight = startLeft + startRight - nextLeft;\n        colWidths = { ...colWidths, [leftKey]: nextLeft, [rightKey]: nextRight };\n      } else {\n        // path splitter: path grows unconstrained (allows horizontal scroll on right drag)\n        const nextLeft = Math.max(minColumnWidth[leftKey], startLeft + delta);\n        colWidths = { ...colWidths, [leftKey]: nextLeft };\n      }\n    };\n\n    const onUp = () => {\n      cleanup();\n    };\n\n    const cleanup = () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n      document.body.style.cursor = '';\n      document.body.style.userSelect = '';\n      resizingColumn = '';\n      saveColWidths();\n      if (resizeCleanup === cleanup) {\n        resizeCleanup = null;\n      }\n    };\n\n    resizeCleanup = cleanup;\n    document.body.style.cursor = 'col-resize';\n    document.body.style.userSelect = 'none';\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n  }\n\n  function selectedPaths() {\n    const sorted = [...selectedIndices].sort((a, b) => a - b);\n    return sorted.map((idx) => results[idx]).filter(Boolean).map((entry) => entry.path);\n  }\n\n  function clearSelection() {\n    selectedIndices = new Set();\n    selectionAnchor = -1;\n    lastSelectedIndex = -1;\n  }\n\n  function selectSingle(index) {\n    selectedIndices = new Set([index]);\n    selectionAnchor = index;\n    lastSelectedIndex = index;\n  }\n\n  function selectToggle(index) {\n    const next = new Set(selectedIndices);\n    if (next.has(index)) {\n      next.delete(index);\n    } else {\n      next.add(index);\n    }\n    selectedIndices = next;\n    selectionAnchor = index;\n    lastSelectedIndex = index;\n  }\n\n  function selectRange(index) {\n    const anchor = selectionAnchor >= 0 ? selectionAnchor : index;\n    const [from, to] = [Math.min(anchor, index), Math.max(anchor, index)];\n    const next = new Set();\n    for (let i = from; i <= to; i += 1) {\n      next.add(i);\n    }\n    selectedIndices = next;\n    lastSelectedIndex = index;\n  }\n\n  function primaryEntry() {\n    const idx = lastSelectedIndex >= 0 ? lastSelectedIndex : -1;\n    return idx >= 0 ? results[idx] : null;\n  }\n\n  async function refreshStatus() {\n    if (statusRefreshInFlight) {\n      return;\n    }\n    statusRefreshInFlight = true;\n    try {\n      const status = await invoke('get_index_status');\n      const prevState = indexStatus.state;\n      indexStatus = {\n        state: status.state,\n        entriesCount: status.entriesCount,\n        lastUpdated: status.lastUpdated,\n        permissionErrors: status.permissionErrors ?? 0,\n        message: status.message\n      };\n      if (status.state === 'Indexing' && prevState !== 'Indexing') {\n        startElapsedTimer();\n      } else if (status.state !== 'Indexing' && prevState === 'Indexing') {\n        stopElapsedTimer();\n      }\n      if (typeof status.scanned === 'number') {\n        scanned = status.scanned;\n      }\n      if (status.state === 'Ready' && prevState !== 'Ready') {\n        scheduleSearch();\n      }\n    } catch (err) {\n      showToast(`Failed to get status: ${String(err)}`);\n    } finally {\n      statusRefreshInFlight = false;\n    }\n  }\n\n  function scheduleSearch(preserveScroll = false) {\n    searchGeneration += 1;\n    const scheduledGen = searchGeneration;\n    clearTimeout(searchTimer);\n\n    const now = performance.now();\n    if (now - lastSearchFiredAt >= 200) {\n      // Leading edge: fire immediately if enough time has passed\n      lastSearchFiredAt = now;\n      void runSearch(preserveScroll);\n    } else {\n      // Trailing edge: debounce\n      searchTimer = setTimeout(() => {\n        if (scheduledGen !== searchGeneration) {\n          return;\n        }\n        lastSearchFiredAt = performance.now();\n        void runSearch(preserveScroll);\n      }, 200);\n    }\n  }\n\n  async function runSearch(preserveScroll = false) {\n    searchGeneration += 1;\n    const gen = searchGeneration;\n    const searchQuery = query;\n    const searchSortBy = sortBy;\n    const searchSortDir = sortDir;\n    const startedAt = performance.now();\n    try {\n      const keepPaths = new Set(selectedPaths());\n      const next = await invoke('search', {\n        query: searchQuery,\n        limit: PAGE_SIZE,\n        offset: 0,\n        sortBy: searchSortBy,\n        sortDir: searchSortDir\n      });\n\n      if (gen !== searchGeneration) return;\n\n      dbLatencyMs = Math.round(performance.now() - startedAt);\n      dbLastQuery = searchQuery;\n      const entries = Array.isArray(next.entries) ? next.entries : [];\n      searchModeLabel = next.modeLabel || '';\n      results = entries;\n      if (next.totalCount > 0) {\n        totalResults = next.totalCount;\n        totalResultsKnown = true;\n      } else {\n        totalResults = entries.length;\n        totalResultsKnown = false;\n      }\n      hasMore = totalResultsKnown ? results.length < totalResults : entries.length >= PAGE_SIZE;\n      if (!preserveScroll && tableContainer) tableContainer.scrollTop = 0;\n\n      const restored = new Set();\n      for (let i = 0; i < results.length; i += 1) {\n        if (keepPaths.has(results[i].path)) {\n          restored.add(i);\n        }\n      }\n      selectedIndices = restored;\n\n      updateViewportHeight();\n    } catch (err) {\n      if (gen !== searchGeneration) return;\n      showToast(`Search failed: ${String(err)}`);\n    }\n  }\n\n  async function loadMore() {\n    if (!hasMore || loadingMore) return;\n    const gen = searchGeneration;\n    loadingMore = true;\n    try {\n      const batch = await invoke('search', {\n        query,\n        limit: PAGE_SIZE,\n        offset: results.length,\n        sortBy: sortBy,\n        sortDir: sortDir\n      });\n      if (gen !== searchGeneration) return;\n      const arr = Array.isArray(batch.entries) ? batch.entries : [];\n      if (arr.length > 0) results = [...results, ...arr];\n      hasMore = totalResultsKnown ? results.length < totalResults : arr.length >= PAGE_SIZE;\n    } catch (err) {\n      showToast(`Failed to load more: ${String(err)}`);\n    } finally {\n      loadingMore = false;\n    }\n  }\n\n  function moveSelection(delta, withRange = false) {\n    if (results.length === 0) {\n      return;\n    }\n\n    const current = lastSelectedIndex >= 0 ? lastSelectedIndex : 0;\n    const next = Math.max(0, Math.min(results.length - 1, current + delta));\n\n    if (withRange) {\n      selectRange(next);\n    } else {\n      selectSingle(next);\n    }\n\n    const top = next * rowHeight;\n    const bottom = top + rowHeight;\n    if (top < scrollTop) {\n      tableContainer.scrollTop = top;\n    } else if (bottom > scrollTop + viewportHeight) {\n      tableContainer.scrollTop = bottom - viewportHeight;\n    }\n  }\n\n  function handleHeaderSort(column) {\n    if (sortBy === column) {\n      sortDir = sortDir === 'asc' ? 'desc' : 'asc';\n    } else {\n      sortBy = column;\n      sortDir = 'asc';\n    }\n    if (tableContainer) tableContainer.scrollTop = 0;\n    void runSearch();\n  }\n\n  function handleRowClick(event, index) {\n    contextMenu.visible = false;\n\n    if (event.shiftKey) {\n      selectRange(index);\n      return;\n    }\n\n    if (event.metaKey || event.ctrlKey) {\n      selectToggle(index);\n      return;\n    }\n\n    selectSingle(index);\n  }\n\n  function handleRowContextMenu(event, index) {\n    event.preventDefault();\n\n    if (!selectedIndices.has(index)) {\n      selectSingle(index);\n    }\n\n    if (platform === 'windows' || platform === 'macos') {\n      contextMenu.visible = false;\n      const paths = selectedPaths();\n      if (paths.length > 0) {\n        invoke('show_context_menu', {\n          paths,\n          x: event.clientX,\n          y: event.clientY,\n          singleSelection: selectedIndices.size === 1\n        });\n      }\n      return;\n    }\n\n    contextMenu = {\n      visible: true,\n      x: event.clientX,\n      y: event.clientY\n    };\n  }\n\n  function handleRowA11yKeydown(event, index) {\n    if (event.key === ' ' || event.key === 'Enter') {\n      event.preventDefault();\n      handleRowClick(event, index);\n    }\n  }\n\n  const DRAG_THRESHOLD = 5;\n  let dragCleanup = null;\n  const dragImgCache = new Map();\n\n  function dragPathsForIndex(index) {\n    const entry = results[index];\n    if (!entry) {\n      return [];\n    }\n\n    if (selectedIndices.has(index) && selectedIndices.size > 0) {\n      return selectedPaths();\n    }\n\n    return [entry.path];\n  }\n\n  function getDragIconEl(entry) {\n    const src = iconFor(entry);\n    let img = dragImgCache.get(src);\n    if (!img) {\n      img = new Image();\n      img.src = src;\n      dragImgCache.set(src, img);\n    }\n    return img.complete && img.naturalWidth > 0 ? img : null;\n  }\n\n  function fillRoundRect(ctx, x, y, w, h, r) {\n    ctx.beginPath();\n    ctx.moveTo(x + r, y);\n    ctx.arcTo(x + w, y, x + w, y + h, r);\n    ctx.arcTo(x + w, y + h, x, y + h, r);\n    ctx.arcTo(x, y + h, x, y, r);\n    ctx.arcTo(x, y, x + w, y, r);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  function buildDragPreview(index) {\n    const entry = results[index];\n    if (!entry) return null;\n\n    const count = selectedIndices.has(index) ? selectedIndices.size : 1;\n    const isDark = theme === 'dark';\n\n    const w = 260;\n    const h = 28;\n    const stackGap = count > 1 ? 4 : 0;\n\n    const canvas = document.createElement('canvas');\n    canvas.width = w;\n    canvas.height = h + stackGap;\n    const ctx = canvas.getContext('2d');\n\n    if (count > 1) {\n      ctx.globalAlpha = 0.35;\n      ctx.fillStyle = isDark ? '#5a6070' : '#b0c4de';\n      fillRoundRect(ctx, 3, 0, w - 3, h, 5);\n      ctx.globalAlpha = 1.0;\n    }\n\n    const ry = stackGap;\n    ctx.fillStyle = isDark ? 'rgba(58, 64, 74, 0.94)' : 'rgba(214, 231, 255, 0.94)';\n    fillRoundRect(ctx, 0, ry, w, h, 5);\n\n    ctx.strokeStyle = isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';\n    ctx.lineWidth = 0.5;\n    ctx.beginPath();\n    ctx.moveTo(5, ry);\n    ctx.arcTo(w, ry, w, ry + h, 5);\n    ctx.arcTo(w, ry + h, 0, ry + h, 5);\n    ctx.arcTo(0, ry + h, 0, ry, 5);\n    ctx.arcTo(0, ry, w, ry, 5);\n    ctx.closePath();\n    ctx.stroke();\n\n    const iconEl = getDragIconEl(entry);\n    if (iconEl) {\n      ctx.drawImage(iconEl, 6, ry + 6, 16, 16);\n    } else {\n      ctx.fillStyle = entry.isDir ? '#d9b34f' : '#8d98a5';\n      fillRoundRect(ctx, 6, ry + 6, 16, 16, 2);\n    }\n\n    ctx.fillStyle = isDark ? '#e6e6e8' : '#1a1a1a';\n    ctx.font = '12px -apple-system, \"SF Pro Text\", system-ui, sans-serif';\n    ctx.textBaseline = 'middle';\n\n    let nameMaxW = w - 34;\n    if (count > 1) nameMaxW -= 34;\n\n    let name = entry.name;\n    if (ctx.measureText(name).width > nameMaxW) {\n      while (name.length > 4 && ctx.measureText(name + '\\u2026').width > nameMaxW) {\n        name = name.slice(0, -1);\n      }\n      name += '\\u2026';\n    }\n    ctx.fillText(name, 28, ry + h / 2 + 1);\n\n    if (count > 1) {\n      const badge = String(count);\n      ctx.font = 'bold 10px -apple-system, system-ui, sans-serif';\n      const tw = ctx.measureText(badge).width;\n      const bw = Math.max(20, tw + 10);\n      const bx = w - bw - 6;\n      const by = ry + (h - 18) / 2;\n\n      ctx.fillStyle = isDark ? '#5b8bd9' : '#007aff';\n      fillRoundRect(ctx, bx, by, bw, 18, 9);\n\n      ctx.fillStyle = '#ffffff';\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(badge, bx + bw / 2, by + 9);\n    }\n\n    return canvas.toDataURL('image/png');\n  }\n\n  function handleRowMouseDown(event, index) {\n    if (event.button !== 0) return;\n    if (event.metaKey || event.ctrlKey || event.shiftKey) return;\n    if (editing.active) return;\n\n    const startX = event.clientX;\n    const startY = event.clientY;\n    let dragging = false;\n\n    dragCleanup?.();\n\n    const onMove = (e) => {\n      if (dragging) return;\n      const dx = e.clientX - startX;\n      const dy = e.clientY - startY;\n      if (dx * dx + dy * dy < DRAG_THRESHOLD * DRAG_THRESHOLD) return;\n\n      dragging = true;\n      cleanup();\n\n      if (!selectedIndices.has(index)) {\n        selectSingle(index);\n      }\n\n      const paths = dragPathsForIndex(index);\n      if (paths.length > 0) {\n        const icon = buildDragPreview(index);\n        startDrag({ item: paths, icon }).catch(() => {});\n      }\n    };\n\n    const onUp = () => cleanup();\n\n    const cleanup = () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n      if (dragCleanup === cleanup) dragCleanup = null;\n    };\n\n    dragCleanup = cleanup;\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n  }\n\n  async function handleRowDoubleClick(index) {\n    if (!selectedIndices.has(index) || selectedIndices.size > 1) {\n      selectSingle(index);\n      await tick();\n    }\n    await invoke('open', { paths: [results[index].path] }).catch((err) => {\n      showToast(`Failed to open: ${String(err)}`);\n    });\n  }\n\n  function closeContextMenu() {\n    contextMenu = {\n      ...contextMenu,\n      visible: false\n    };\n  }\n\n  async function openSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('open', { paths });\n    } catch (err) {\n      showToast(`Failed to open: ${String(err)}`);\n    }\n  }\n\n  async function openWithFallback() {\n    const target = primaryEntry();\n    if (!target) {\n      return;\n    }\n\n    try {\n      await invoke('open_with', { path: target.path });\n    } catch (err) {\n      showToast(`Open With failed: ${String(err)}`);\n    }\n  }\n\n  async function revealSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('reveal_in_finder', { paths });\n    } catch (err) {\n      showToast(`Failed to reveal in Finder: ${String(err)}`);\n    }\n  }\n\n  async function copySelectedPaths() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('copy_paths', { paths });\n      showToast(`Copied ${paths.length} path(s)`);\n    } catch (err) {\n      showToast(`Failed to copy path: ${String(err)}`);\n    }\n  }\n\n  async function copyFiles() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('copy_files', { paths });\n      showToast(`Copied ${paths.length} item(s)`);\n    } catch (err) {\n      showToast(`Failed to copy: ${String(err)}`);\n    }\n  }\n\n  async function trashSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    const message =\n      paths.length === 1\n        ? 'Move selected item to Trash?'\n        : `Move ${paths.length} items to Trash?`;\n\n    if (!window.confirm(message)) {\n      return;\n    }\n\n    try {\n      await invoke('move_to_trash', { paths });\n      showToast('Moved to Trash.');\n      clearSelection();\n      await runSearch();\n    } catch (err) {\n      showToast(`Failed to move to Trash: ${String(err)}`);\n    }\n  }\n\n  async function resetIndex() {\n    if (indexStatus.state === 'Indexing') {\n      showToast('Indexing in progress. Please try again after it completes.');\n      return;\n    }\n\n    results = [];\n    totalResults = 0;\n    totalResultsKnown = false;\n    clearSelection();\n    scanned = 0;\n    dbLatencyMs = null;\n    dbLastQuery = '';\n    indexStatus = { ...indexStatus, state: 'Indexing', entriesCount: 0, message: null };\n    indexingStartTime = Date.now();\n    indexingElapsed = '';\n    indexingFinishedAt = '';\n\n    try {\n      await invoke('reset_index');\n    } catch (err) {\n      showToast(`Failed to reset index: ${String(err)}`);\n      await refreshStatus();\n    }\n  }\n\n  function isMultiSelected() {\n    return selectedIndices.size > 1;\n  }\n\n  function autoResizeRenameInput() {\n    if (!renameInputEl) return;\n    renameInputEl.style.height = '0';\n    renameInputEl.style.height = renameInputEl.scrollHeight + 'px';\n  }\n\n  async function startRename() {\n    if (isMultiSelected()) {\n      return;\n    }\n\n    const idx = lastSelectedIndex;\n    if (idx < 0 || !results[idx]) {\n      return;\n    }\n\n    const entry = results[idx];\n\n    // Calculate overlay position mathematically.\n    // Name cell text starts at: padding-left(16) + icon(16) + gap(6) = 38px from cell left.\n    // Textarea has padding-left: 0 and border: 1.5px, so text starts ~2px from overlay left.\n    if (tableContainer) {\n      const rect = tableContainer.getBoundingClientRect();\n      const cellLeft = rect.left - tableContainer.scrollLeft;\n      const textLeft = cellLeft + 38;\n      const cellRight = cellLeft + colWidths.name;\n      const rowTop = rect.top + idx * rowHeight - tableContainer.scrollTop;\n      renameOverlay = {\n        top: rowTop,\n        left: textLeft - 2,\n        width: cellRight - textLeft + 2 - 4\n      };\n    }\n\n    editing = {\n      active: true,\n      path: entry.path,\n      index: idx,\n      draftName: entry.name\n    };\n\n    await tick();\n\n    if (renameInputEl) {\n      autoResizeRenameInput();\n      renameInputEl.focus();\n      const extPos = !entry.isDir ? entry.name.lastIndexOf('.') : -1;\n      const selectionEnd = extPos > 0 ? extPos : entry.name.length;\n      renameInputEl.setSelectionRange(0, selectionEnd);\n    }\n  }\n\n  function cancelRename() {\n    editing = {\n      active: false,\n      path: '',\n      index: -1,\n      draftName: ''\n    };\n  }\n\n  async function commitRename() {\n    if (!editing.active || editing.index < 0 || !results[editing.index]) {\n      return;\n    }\n\n    const current = results[editing.index];\n    const nextName = editing.draftName;\n\n    try {\n      await invoke('rename', {\n        path: current.path,\n        newName: nextName\n      });\n      cancelRename();\n      await runSearch();\n    } catch (err) {\n      showToast(`Failed to rename: ${String(err)}`);\n      await tick();\n      renameInputEl?.focus();\n    }\n  }\n\n  function onGlobalClick() {\n    closeContextMenu();\n  }\n\n  function onTitleBarMouseDown(event) {\n    if (event.button !== 0) {\n      return;\n    }\n\n    const activeElement = document.activeElement;\n    if (activeElement instanceof HTMLElement && isTextInputTarget(activeElement)) {\n      activeElement.blur();\n    }\n  }\n\n  async function focusSearch() {\n    await getCurrentWindow().show();\n    await getCurrentWindow().setFocus();\n    searchInputEl?.focus();\n    searchInputEl?.select();\n  }\n\n  function isTextInputTarget(target) {\n    return (\n      target instanceof HTMLInputElement ||\n      target instanceof HTMLTextAreaElement ||\n      target?.isContentEditable\n    );\n  }\n\n  async function handleKeydown(event) {\n    const isMetaSelectAll = (event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'a';\n    const isMetaCopy = (event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'c';\n    const target = event.target;\n    const isTextInput = isTextInputTarget(target);\n\n    if (isMetaCopy && isTextInput) {\n      return;\n    }\n\n    if (isMetaSelectAll) {\n      if (isTextInput) {\n        event.preventDefault();\n        if (target instanceof HTMLInputElement || target instanceof HTMLTextAreaElement) {\n          target.select();\n        }\n        return;\n      }\n    }\n\n    if (editing.active) {\n      if (event.key === 'Enter') {\n        event.preventDefault();\n        await commitRename();\n        return;\n      }\n\n      if (event.key === 'Escape') {\n        event.preventDefault();\n        const idx = editing.index;\n        cancelRename();\n        selectSingle(idx);\n        await tick();\n        tableContainer?.querySelector('.row.selected')?.focus();\n        return;\n      }\n      return;\n    }\n\n    if (event.key === 'Escape') {\n      event.preventDefault();\n      clearSelection();\n      return;\n    }\n\n    if (event.key === 'ArrowDown') {\n      event.preventDefault();\n      moveSelection(1, event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'ArrowUp') {\n      event.preventDefault();\n      moveSelection(-1, event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'PageDown') {\n      event.preventDefault();\n      moveSelection(Math.floor(viewportHeight / rowHeight), event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'PageUp') {\n      event.preventDefault();\n      moveSelection(-Math.floor(viewportHeight / rowHeight), event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'Enter') {\n      event.preventDefault();\n      if (platform === 'windows') {\n        await openSelected();\n      } else {\n        await startRename();\n      }\n      return;\n    }\n\n    if (event.key === 'F2') {\n      event.preventDefault();\n      await startRename();\n      return;\n    }\n\n    if (event.key === ' ' && !isTextInput) {\n      event.preventDefault();\n      const entry = primaryEntry();\n      if (entry) {\n        await invoke('quick_look', { path: entry.path });\n      }\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'f') {\n      event.preventDefault();\n      clearSelection();\n      searchInputEl?.focus();\n      searchInputEl?.select();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'o') {\n      event.preventDefault();\n      await openSelected();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key === 'Enter') {\n      event.preventDefault();\n      await revealSelected();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'c') {\n      event.preventDefault();\n      await copySelectedPaths();\n      return;\n    }\n\n    if (isMetaSelectAll) {\n      event.preventDefault();\n      selectedIndices = new Set(Array.from({ length: results.length }, (_, i) => i));\n      return;\n    }\n\n    if (event.key === 'Delete' || ((event.metaKey || event.ctrlKey) && event.key === 'Backspace')) {\n      if (!isTextInput) {\n        event.preventDefault();\n        await trashSelected();\n      }\n      return;\n    }\n  }\n\n  function formatSize(entry) {\n    if (entry.isDir || entry.size == null) return '';\n    const bytes = entry.size;\n    if (bytes < 1024) return `${bytes} B`;\n    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n    if (bytes < 1024 * 1024 * 1024) return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n    return `${(bytes / (1024 * 1024 * 1024)).toFixed(1)} GB`;\n  }\n\n  function formatModified(entry) {\n    if (!entry.mtime) {\n      return '';\n    }\n\n    const d = new Date(entry.mtime * 1000);\n    const pad = (n) => String(n).padStart(2, '0');\n    return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;\n  }\n\n  function formatLastUpdated(timestamp) {\n    if (!timestamp) {\n      return '-';\n    }\n\n    return new Date(timestamp * 1000).toLocaleString();\n  }\n\n  function formatElapsed(ms) {\n    const totalSec = Math.floor(ms / 1000);\n    const min = Math.floor(totalSec / 60);\n    const sec = totalSec % 60;\n    return min > 0 ? `${min}m ${sec}s` : `${sec}s`;\n  }\n\n  function updateElapsed() {\n    if (indexingStartTime && indexStatus.state === 'Indexing') {\n      indexingElapsed = formatElapsed(Date.now() - indexingStartTime);\n    }\n  }\n\n  function startElapsedTimer() {\n    clearInterval(elapsedTimer);\n    indexingStartTime = Date.now();\n    indexingElapsed = '0s';\n    indexingFinishedAt = '';\n    elapsedTimer = setInterval(updateElapsed, 1000);\n  }\n\n  function stopElapsedTimer() {\n    clearInterval(elapsedTimer);\n    if (indexingStartTime) {\n      const elapsed = Date.now() - indexingStartTime;\n      indexingFinishedAt = `${formatElapsed(elapsed)}`;\n    }\n    indexingStartTime = null;\n    indexingElapsed = '';\n  }\n\n  function displayPath(path) {\n    if (!path) {\n      return path;\n    }\n\n    if (!homePrefix) {\n      return path;\n    }\n\n    if (path === homePrefix) {\n      return '~';\n    }\n\n    if (path.startsWith(`${homePrefix}/`)) {\n      return `~${path.slice(homePrefix.length)}`;\n    }\n\n    return path;\n  }\n\n  let unlistenFns = [];\n\n  onMount(async () => {\n    const t0 = performance.now();\n    const ms = () => Math.round(performance.now() - t0);\n    const DEBUG_STARTUP = false;\n    const flog = DEBUG_STARTUP ? (msg) => invoke('frontend_log', { msg }).catch(() => {}) : () => {};\n\n    flog(`[startup/fe] onMount entered`);\n\n    updateViewportHeight();\n    flog(`[startup/fe] +${ms()}ms updateViewportHeight done`);\n\n    invoke('set_native_theme', { theme });\n\n    platform = await invoke('get_platform');\n    flog(`[startup/fe] +${ms()}ms get_platform done`);\n\n    const unlistenProgress = await listen('index_progress', (event) => {\n      scanned = event.payload.scanned;\n      if (indexStatus.state !== 'Indexing') {\n        indexStatus = {\n          ...indexStatus,\n          state: 'Indexing'\n        };\n      }\n    });\n    flog(`[startup/fe] +${ms()}ms listen(index_progress) registered`);\n\n    const unlistenState = await listen('index_state', (event) => {\n      flog(`[startup/fe] index_state event received: ${event.payload.state} at +${ms()}ms`);\n      const prevState = indexStatus.state;\n      indexStatus = {\n        ...indexStatus,\n        state: event.payload.state,\n        message: event.payload.message ?? null,\n        isCatchup: event.payload.isCatchup ?? false\n      };\n\n      if (event.payload.state === 'Indexing' && prevState !== 'Indexing') {\n        if (prevState === 'Ready') {\n          lastReadyCount = indexStatus.entriesCount;\n        }\n        startElapsedTimer();\n      } else if (event.payload.state !== 'Indexing' && prevState === 'Indexing') {\n        stopElapsedTimer();\n      }\n\n      if (event.payload.state === 'Ready') {\n        scheduleSearch();\n      }\n    });\n    flog(`[startup/fe] +${ms()}ms listen(index_state) registered`);\n\n    const unlistenUpdated = await listen('index_updated', (event) => {\n      indexStatus = {\n        ...indexStatus,\n        entriesCount: event.payload.entriesCount,\n        lastUpdated: event.payload.lastUpdated,\n        permissionErrors: event.payload.permissionErrors ?? indexStatus.permissionErrors\n      };\n\n      scheduleSearch(true);\n    });\n\n    const unlistenFocus = await listen('focus_search', () => {\n      void focusSearch();\n    });\n\n    const unlistenCtxMenuAction = await listen('context_menu_action', (event) => {\n      switch (event.payload) {\n        case 'open': void openSelected(); break;\n        case 'quick_look': {\n          const e = primaryEntry();\n          if (e) void invoke('quick_look', { path: e.path });\n          break;\n        }\n        case 'open_with': void openWithFallback(); break;\n        case 'reveal': void revealSelected(); break;\n        case 'copy_files': void copyFiles(); break;\n        case 'copy_path': void copySelectedPaths(); break;\n        case 'trash': void trashSelected(); break;\n        case 'rename': void startRename(); break;\n      }\n    });\n\n    unlistenFns = [unlistenProgress, unlistenState, unlistenUpdated, unlistenFocus, unlistenCtxMenuAction];\n    flog(`[startup/fe] +${ms()}ms all listeners registered`);\n\n    // Fetch backend state IMMEDIATELY after listeners are registered.\n    // Events emitted before listener registration are lost, so this\n    // is the only reliable way to get the current state.\n    await refreshStatus();\n    flog(`[startup/fe] +${ms()}ms refreshStatus done (state=${indexStatus.state})`);\n\n    // Show Svelte UI: remove skeleton, focus search input.\n    await tick();\n    document.getElementById('skeleton')?.remove();\n    await focusSearch();\n    flog(`[startup/fe] +${ms()}ms WINDOW VISIBLE â€” skeleton removed`);\n\n    try {\n      homePrefix = await invoke('get_home_dir');\n    } catch {\n      homePrefix = '';\n    }\n    flog(`[startup/fe] +${ms()}ms get_home_dir done`);\n\n    if (!localStorage.getItem('everything-fda-notice-v1')) {\n      showToast('macOS Full Disk Access permission may be required for full disk search.');\n      localStorage.setItem('everything-fda-notice-v1', '1');\n    }\n    flog(`[startup/fe] +${ms()}ms calling runSearch...`);\n    await runSearch();\n    flog(`[startup/fe] +${ms()}ms runSearch done`);\n\n    if (typeof ResizeObserver !== 'undefined') {\n      tableResizeObserver = new ResizeObserver(() => {\n        scheduleViewportHeightUpdate();\n      });\n      if (tableContainer) {\n        tableResizeObserver.observe(tableContainer);\n      } else if (tableAreaEl) {\n        tableResizeObserver.observe(tableAreaEl);\n      }\n    }\n\n    window.addEventListener('resize', scheduleViewportHeightUpdate);\n    window.addEventListener('click', onGlobalClick);\n    statusRefreshTimer = setInterval(() => {\n      if (indexStatus.state === 'Indexing') {\n        void refreshStatus();\n      }\n    }, 1000);\n    console.log(`[startup/fe] +${ms()}ms onMount complete`);\n  });\n\n  onDestroy(async () => {\n    clearTimeout(searchTimer);\n    clearTimeout(toastTimer);\n    clearInterval(statusRefreshTimer);\n    clearInterval(elapsedTimer);\n    resizeCleanup?.();\n\n    for (const unlisten of unlistenFns) {\n      unlisten();\n    }\n\n    tableResizeObserver?.disconnect();\n    tableResizeObserver = null;\n    if (viewportResizeRaf !== null) {\n      cancelAnimationFrame(viewportResizeRaf);\n      viewportResizeRaf = null;\n    }\n    window.removeEventListener('resize', scheduleViewportHeightUpdate);\n    window.removeEventListener('click', onGlobalClick);\n  });\n</script>\n\n<svelte:window on:keydown={handleKeydown} />\n\n<div class=\"app-shell\" data-theme={theme}>\n  <div class=\"title-bar\" role=\"presentation\" data-tauri-drag-region on:mousedown={onTitleBarMouseDown}>\n    <div class=\"title-left\"></div>\n    <div class=\"title-center\">\n      <svg class=\"title-icon\" viewBox=\"0 0 215 205\" fill-rule=\"evenodd\" aria-hidden=\"true\">\n        <path d=\"M85 0c46.9 0 85 38.1 85 85 0 20.1-7.2 38.5-19.2 52.7l40.7 40.8c5.8 5.8 5.8 15.2 0 21-5.8 5.8-15.2 5.8-21 0l-40.7-40.7c-13.6 9.7-30.4 15.2-44.8 15.2-46.9 0-85-42.1-85-89 0-46.9 38.1-85 85-85z m0 32c-29.3 0-53 23.7-53 53 0 29.3 23.7 53 53 53 29.3 0 53-23.7 53-53 0-29.3-23.7-53-53-53z\"/>\n      </svg>\n      <span class=\"title-text\">Everything</span>\n    </div>\n    <div class=\"title-right\"></div>\n  </div>\n\n  <header class=\"search-bar\">\n    <input\n      bind:this={searchInputEl}\n      class=\"search-input\"\n      type=\"text\"\n      bind:value={query}\n      on:input={scheduleSearch}\n      on:focus={clearSelection}\n      placeholder=\"Search file/folder names\"\n      autocomplete=\"off\"\n      spellcheck=\"false\"\n    />\n  </header>\n\n  <section class=\"table-area\" bind:this={tableAreaEl} style={tableGridStyle}>\n    <div class=\"table-header\">\n      <div class=\"table-header-track\">\n        <div class=\"col name\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('name')}>\n            Name{#if sortBy === 'name'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n          <button\n            type=\"button\"\n            class=\"col-resizer\"\n            class:active={resizingColumn === 'name'}\n            on:mousedown={(event) => startColumnResize(event, 'name')}\n            aria-label=\"Resize Name column\"\n          />\n        </div>\n\n        <div class=\"col path\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('dir')}>\n            Path{#if sortBy === 'dir'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n          <button\n            type=\"button\"\n            class=\"col-resizer\"\n            class:active={resizingColumn === 'path'}\n            on:mousedown={(event) => startColumnResize(event, 'path')}\n            aria-label=\"Resize Path column\"\n          />\n        </div>\n\n        <div class=\"col size\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('size')}>\n            Size{#if sortBy === 'size'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n        </div>\n\n        <div class=\"col modified\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('mtime')}>\n            Modified{#if sortBy === 'mtime'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <div\n      class=\"table-body\"\n      bind:this={tableContainer}\n      on:scroll={() => {\n        scrollTop = tableContainer.scrollTop;\n        headerScrollLeft = tableContainer.scrollLeft;\n        if (editing.active) void commitRename();\n        const scrollBottom = scrollTop + tableContainer.clientHeight;\n        if (scrollBottom >= totalHeight - rowHeight * 10) {\n          void loadMore();\n        }\n      }}\n    >\n      <div class=\"spacer\" style={`height:${totalHeight}px`}>\n        <div class=\"rows\" style={`transform: translateY(${translateY}px);`}>\n          {#each visibleRows as entry, localIndex}\n            {@const index = startIndex + localIndex}\n            <div\n              class=\"row {selectedIndices.has(index) ? 'selected' : ''}\"\n              on:mousedown={(event) => handleRowMouseDown(event, index)}\n              on:click={(event) => handleRowClick(event, index)}\n              on:keydown={(event) => handleRowA11yKeydown(event, index)}\n              on:dblclick={() => handleRowDoubleClick(index)}\n              on:contextmenu={(event) => handleRowContextMenu(event, index)}\n              role=\"row\"\n              tabindex=\"0\"\n            >\n              <div class=\"cell name\">\n                <img class=\"file-icon\" src={iconFor(entry)} alt=\"\" />\n                <span class=\"ellipsis\" class:name-editing={editing.active && editing.index === index}>{#each highlightSegments(entry.name, query) as seg}{#if seg.hl}<mark class=\"hl\">{seg.text}</mark>{:else}{seg.text}{/if}{/each}</span>\n              </div>\n              <div class=\"cell path\"><span class=\"ellipsis\">{displayPath(entry.dir)}</span></div>\n              <div class=\"cell size\">{formatSize(entry)}</div>\n              <div class=\"cell modified\">{formatModified(entry)}</div>\n            </div>\n          {/each}\n        </div>\n      </div>\n    </div>\n  </section>\n\n  <footer class=\"status-bar\">\n    <div class=\"status-left\">\n      <span class=\"status-state\">\n        <span class=\"state-dot {indexStatus.state === 'Indexing' ? 'indexing' : indexStatus.state === 'Error' ? 'error' : 'ready'}\"></span>\n        {#if indexStatus.state === 'Indexing'}\n          Indexing{#if lastReadyCount > 0} ({Math.min(99, Math.round((scanned / lastReadyCount) * 100))}%){/if}{#if indexingElapsed} Â· {indexingElapsed}{/if}\n          {#if !indexStatus.isCatchup}\n            Â· {scanned.toLocaleString()} scanned\n          {/if}\n        {:else}\n          Index: {indexStatus.state}\n        {/if}\n      </span>\n      <span>{indexStatus.entriesCount.toLocaleString()} entries</span>\n      {#if indexingFinishedAt && indexStatus.state !== 'Indexing'}\n        <span>in {indexingFinishedAt}</span>\n      {/if}\n      {#if dbLatencyMs !== null && dbLastQuery}\n        <span>\"{dbLastQuery}\" {dbLatencyMs}ms Â· {totalResults} results</span>\n      {/if}\n      {#if searchModeLabel === 'spotlight' || searchModeLabel === 'spotlight_timeout'}\n        <span class=\"status-spotlight\">Spotlight fallback{#if searchModeLabel === 'spotlight_timeout'} (partial){/if}</span>\n      {/if}\n      {#if indexStatus.permissionErrors > 0}\n        <span class=\"status-warning\">{indexStatus.permissionErrors.toLocaleString()} permission errors</span>\n      {/if}\n      {#if indexStatus.message}\n        <span class={indexStatus.isCatchup ? 'index-progress' : 'status-error'}>{indexStatus.message}</span>\n      {/if}\n    </div>\n    <div class=\"status-right\">\n      <button class=\"status-btn\" on:click={cycleTheme} title=\"Switch theme\">\n        {theme === 'dark' ? 'â˜€ Light' : 'â—‘ Dark'}\n      </button>\n      <button\n        class=\"status-btn rebuild-btn\"\n        on:click={resetIndex}\n        disabled={indexStatus.state === 'Indexing'}\n        title={indexStatus.state === 'Indexing' ? 'Cannot reset while indexing is in progress.' : 'Reset and rebuild the index.'}\n      >\n        <svg class=\"rebuild-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <path d=\"M23 4v6h-6\"/><path d=\"M20.49 15a9 9 0 1 1-2.12-9.36L23 10\"/>\n        </svg>\n        Rebuild Index\n      </button>\n    </div>\n  </footer>\n\n  {#if editing.active}\n    <div\n      class=\"rename-overlay\"\n      style=\"top:{renameOverlay.top}px; left:{renameOverlay.left}px; width:{renameOverlay.width}px;\"\n      role=\"presentation\"\n      on:mousedown|stopPropagation\n    >\n      <textarea\n        bind:this={renameInputEl}\n        class=\"rename-textarea\"\n        bind:value={editing.draftName}\n        on:input={autoResizeRenameInput}\n        on:click|stopPropagation\n        on:blur={commitRename}\n      />\n    </div>\n  {/if}\n\n  {#if contextMenu.visible}\n    <div class=\"context-menu\" style={`left:${contextMenu.x}px;top:${contextMenu.y}px;`}>\n      <button on:click={() => (closeContextMenu(), openSelected())}>Open</button>\n      <button on:click={async () => { closeContextMenu(); const e = primaryEntry(); if (e) await invoke('quick_look', { path: e.path }); }}>Quick Look</button>\n      <button on:click={() => (closeContextMenu(), openWithFallback())}>Open With... (Reveal in Finder)</button>\n      <button on:click={() => (closeContextMenu(), revealSelected())}>Reveal in Finder</button>\n      <button on:click={() => (closeContextMenu(), copySelectedPaths())}>Copy Path</button>\n      <button on:click={() => (closeContextMenu(), trashSelected())}>Move to Trash</button>\n      {#if selectedIndices.size === 1}\n        <button on:click={() => (closeContextMenu(), startRename())}>Rename</button>\n      {/if}\n    </div>\n  {/if}\n\n  {#if toast}\n    <div class=\"toast\">{toast}</div>\n  {/if}\n</div>\n\n<style>\n  :global(:root) {\n    color-scheme: light dark;\n    --bg-app: transparent;\n    --text-primary: #0d1826;\n    --text-muted: #48596c;\n    --bar-grad-top: rgba(255, 255, 255, 0.48);\n    --bar-grad-bottom: rgba(248, 250, 253, 0.42);\n    --surface-header: rgba(252, 252, 255, 0.40);\n    --surface: rgba(255, 255, 255, 0.22);\n    --border-soft: rgba(0, 0, 0, 0.07);\n    --border-input: rgba(0, 0, 0, 0.13);\n    --focus-ring: #6f96e6;\n    --row-border: rgba(0, 0, 0, 0.032);\n    --row-hover: rgba(0, 0, 0, 0.06);\n    --row-selected: rgba(0, 0, 0, 0.12);\n    --button-bg: rgba(255, 255, 255, 0.62);\n    --button-border: rgba(0, 0, 0, 0.10);\n    --button-text: #2c3e50;\n    --menu-bg: rgba(240, 241, 248, 0.90);\n    --menu-border: rgba(0, 0, 0, 0.06);\n    --menu-hover: rgba(255, 255, 255, 0.62);\n    --menu-text: #1a2a38;\n    --error-text: #b64545;\n    --warning-text: #8f6500;\n    --toast-bg: rgba(18, 22, 32, 0.90);\n    --toast-text: #ffffff;\n  }\n\n  @media (prefers-color-scheme: dark) {\n    :global(:root) {\n      --bg-app: transparent;\n      --text-primary: #e6e6ea;\n      --text-muted: #9494a4;\n      --bar-grad-top: rgba(38, 38, 46, 0.52);\n      --bar-grad-bottom: rgba(30, 30, 38, 0.46);\n      --surface-header: rgba(32, 32, 40, 0.46);\n      --surface: rgba(18, 18, 26, 0.32);\n      --border-soft: rgba(255, 255, 255, 0.065);\n      --border-input: rgba(255, 255, 255, 0.14);\n      --focus-ring: #5b8bd9;\n      --row-border: rgba(255, 255, 255, 0.026);\n      --row-hover: rgba(255, 255, 255, 0.08);\n      --row-selected: rgba(255, 255, 255, 0.14);\n      --button-bg: rgba(255, 255, 255, 0.072);\n      --button-border: rgba(255, 255, 255, 0.11);\n      --button-text: #d6d6e0;\n      --menu-bg: rgba(36, 36, 46, 0.90);\n      --menu-border: rgba(255, 255, 255, 0.066);\n      --menu-hover: rgba(255, 255, 255, 0.062);\n      --menu-text: #e0e0e8;\n      --error-text: #ff9d9d;\n      --warning-text: #e0c670;\n      --toast-bg: rgba(10, 10, 16, 0.93);\n      --toast-text: #f2f2f6;\n    }\n  }\n\n  /* â”€â”€ Theme: Dark â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme=\"dark\"]) {\n    color-scheme: dark;\n    --bg-app: #1E1E21;\n    --text-primary: #E2E8F0;\n    --text-muted: #94A3B8;\n    --bar-grad-top: #1E1E21;\n    --bar-grad-bottom: #1E1E21;\n    --surface-header: #1E1E21;\n    --surface: #1E1E21;\n    --bg-input: #161618;\n    --border-soft: #2A2A2D;\n    --border-input: rgba(255, 255, 255, 0.06);\n    --focus-ring: #4DA8FF;\n    --accent: #4DA8FF;\n    --row-border: rgba(255, 255, 255, 0.02);\n    --row-hover: #282828;\n    --row-selected: rgba(77, 168, 255, 0.10);\n    --button-bg: rgba(255, 255, 255, 0.05);\n    --button-border: #2A2A2D;\n    --button-text: #94A3B8;\n    --menu-bg: #252528;\n    --menu-border: #2A2A2D;\n    --menu-hover: rgba(255, 255, 255, 0.04);\n    --menu-text: #E2E8F0;\n    --error-text: #ff9d9d;\n    --warning-text: #e0c670;\n    --toast-bg: rgba(10, 10, 16, 0.93);\n    --toast-text: #f2f2f6;\n  }\n\n  /* â”€â”€ Theme: Light â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme=\"light\"]) {\n    color-scheme: light;\n    --bg-app: #F5F5F7;\n    --text-primary: #1C1C1E;\n    --text-muted: #6E6E7A;\n    --bar-grad-top: #F5F5F7;\n    --bar-grad-bottom: #F5F5F7;\n    --surface-header: #F5F5F7;\n    --surface: #F5F5F7;\n    --bg-input: #FFFFFF;\n    --border-soft: #D1D1D6;\n    --border-input: rgba(0, 0, 0, 0.10);\n    --focus-ring: #3A8BF5;\n    --accent: #3A8BF5;\n    --row-border: rgba(0, 0, 0, 0.04);\n    --row-hover: rgba(0, 0, 0, 0.04);\n    --row-selected: rgba(58, 139, 245, 0.10);\n    --button-bg: #FFFFFF;\n    --button-border: #D1D1D6;\n    --button-text: #3C3C43;\n    --menu-bg: #FFFFFF;\n    --menu-border: #D1D1D6;\n    --menu-hover: rgba(0, 0, 0, 0.05);\n    --menu-text: #1C1C1E;\n    --error-text: #D93025;\n    --warning-text: #B45309;\n    --toast-bg: rgba(255, 255, 255, 0.95);\n    --toast-text: #1C1C1E;\n  }\n\n  /* â”€â”€ Themed element overrides â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme]) {\n    background: var(--bg-app);\n  }\n\n  /* Search bar: flat, no gradient, no separator */\n  :global([data-theme]) .search-bar {\n    height: 44px;\n    padding: 0 16px;\n    background: var(--bg-app);\n    border-bottom: none;\n  }\n\n  :global([data-theme]) .search-input {\n    backdrop-filter: none;\n    -webkit-backdrop-filter: none;\n    font-family: 'JetBrains Mono', 'SF Mono', monospace;\n    font-size: 12px;\n    height: 34px;\n    border-radius: 8px;\n  }\n\n  /* Table header: flat bg, 16px edge padding */\n  :global([data-theme]) .table-header {\n    background: var(--bg-app);\n  }\n\n  :global([data-theme]) .col-button {\n    padding: 0 8px;\n  }\n\n  :global([data-theme]) .col.name .col-button {\n    padding-left: 16px;\n  }\n\n  /* Row cells: JetBrains Mono, 16px outer edges */\n  :global([data-theme]) .cell {\n    font-family: 'JetBrains Mono', monospace;\n  }\n\n  :global([data-theme]) .cell.name {\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    padding-left: 16px;\n    font-size: 12px;\n    color: var(--text-primary);\n  }\n\n  :global([data-theme]) .cell.path {\n    font-size: 11px;\n  }\n\n  :global([data-theme]) .cell.size {\n    font-size: 11px;\n  }\n\n  :global([data-theme]) .cell.modified {\n    padding-right: 16px;\n    font-size: 11px;\n    white-space: nowrap;\n  }\n\n  :global([data-theme]) .row.selected {\n    box-shadow: inset 3px 0 0 var(--accent);\n  }\n\n  /* Dim path/size/date cells in themed mode */\n  :global([data-theme]) .cell.path,\n  :global([data-theme]) .cell.size,\n  :global([data-theme]) .cell.modified {\n    color: var(--text-muted);\n  }\n\n  :global(:root) {\n    background: transparent;\n  }\n\n  :global(html, body) {\n    margin: 0;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n    background: transparent;\n    color: var(--text-primary);\n    font-family: Inter, 'SF Pro Text', 'Segoe UI', Helvetica, Arial, sans-serif;\n  }\n\n  :global(#app) {\n    width: 100%;\n    height: 100%;\n  }\n\n  .app-shell {\n    display: grid;\n    grid-template-rows: auto auto 1fr auto;\n    height: 100%;\n    min-width: 0;\n  }\n\n  .title-bar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 44px;\n    padding: 0 16px;\n    background: var(--surface-header);\n    cursor: default;\n    flex-shrink: 0;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-left {\n    width: 72px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-center {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-right {\n    width: 72px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-icon {\n    width: 14px;\n    height: 14px;\n    fill: var(--accent);\n    flex-shrink: 0;\n  }\n\n  .title-text {\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--text-primary);\n    letter-spacing: -0.01em;\n  }\n\n  .search-bar {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 8px;\n    background: linear-gradient(180deg, var(--bar-grad-top) 0%, var(--bar-grad-bottom) 100%);\n    border-bottom: 1px solid var(--border-soft);\n    min-width: 0;\n    flex-shrink: 0;\n  }\n\n  .search-input {\n    display: block;\n    box-sizing: border-box;\n    width: 100%;\n    min-width: 0;\n    flex: 1 1 auto;\n    height: 36px;\n    border: 1px solid var(--border-input);\n    border-radius: 14px;\n    padding: 0 10px;\n    font-size: 14px;\n    background: var(--bg-input, var(--surface));\n    color: var(--text-primary);\n    backdrop-filter: blur(12px) saturate(160%);\n    -webkit-backdrop-filter: blur(12px) saturate(160%);\n  }\n\n  .search-input::placeholder {\n    color: var(--text-muted);\n    opacity: 0.85;\n    font-size: 12px;\n  }\n\n  .search-input:focus {\n    outline: none;\n    border-color: var(--focus-ring);\n    box-shadow: 0 0 0 2px rgba(125, 169, 255, 0.25);\n  }\n\n  .table-area {\n    display: grid;\n    grid-template-rows: auto 1fr;\n    min-height: 0;\n    min-width: 0;\n  }\n\n  .table-header-track,\n  .row {\n    display: grid;\n    grid-template-columns: var(--col-name) var(--col-path) var(--col-size) var(--col-modified);\n    align-items: center;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .table-header {\n    height: 32px;\n    border-bottom: 1px solid var(--border-soft);\n    background: var(--surface-header);\n    user-select: none;\n    overflow: hidden;\n    flex-shrink: 0;\n  }\n\n  .table-header-track {\n    height: 100%;\n    transform: translateX(var(--header-offset, 0px));\n    will-change: transform;\n  }\n\n  .table-header .col {\n    position: relative;\n    min-width: 0;\n    height: 100%;\n  }\n\n  .col-button {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: flex-start;\n    gap: 4px;\n    box-sizing: border-box;\n    padding: 0 8px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 11px;\n    font-weight: 600;\n    line-height: 1;\n    color: var(--text-muted);\n    text-align: left;\n    margin: 0;\n    border: none;\n    background: transparent;\n    cursor: pointer;\n  }\n\n  .sort-icon {\n    width: 10px;\n    height: 10px;\n    flex-shrink: 0;\n    color: var(--accent);\n  }\n\n  .col-resizer {\n    position: absolute;\n    top: 0;\n    right: -4px;\n    width: 8px;\n    height: 100%;\n    border: none;\n    padding: 0;\n    background: transparent;\n    cursor: col-resize;\n    z-index: 30;\n  }\n\n  .col-resizer::after {\n    content: '';\n    position: absolute;\n    top: 7px;\n    bottom: 7px;\n    left: 50%;\n    width: 1px;\n    transform: translateX(-50%);\n    background: var(--border-soft);\n    opacity: 0;\n    transition: opacity 0.15s ease;\n  }\n\n  .table-header .col:hover .col-resizer::after,\n  .col-resizer.active::after {\n    opacity: 1;\n  }\n\n  .table-body {\n    overflow: auto;\n    min-height: 0;\n    min-width: 0;\n    background: var(--surface);\n  }\n\n  .spacer {\n    position: relative;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .rows {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .row {\n    height: 30px;\n    border-bottom: 1px solid var(--row-border);\n    cursor: default;\n    -webkit-user-select: none;\n    user-select: none;\n    outline: none;\n  }\n\n  .row:hover {\n    background: var(--row-hover);\n  }\n\n  .row.selected {\n    background: var(--row-selected);\n  }\n\n  .cell {\n    padding: 0 8px;\n    font-size: 12px;\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    min-width: 0;\n  }\n\n  .cell.size {\n    text-align: right;\n    font-variant-numeric: tabular-nums;\n  }\n\n  .ellipsis {\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n\n  .hl {\n    background: none;\n    color: inherit;\n    font-weight: 700;\n  }\n\n  .file-icon {\n    width: 16px;\n    height: 16px;\n    flex: 0 0 auto;\n  }\n\n  .name-editing {\n    opacity: 0.25;\n  }\n\n  .rename-overlay {\n    position: fixed;\n    z-index: 100;\n    min-width: 120px;\n  }\n\n  .rename-textarea {\n    display: block;\n    width: 100%;\n    box-sizing: border-box;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 12px;\n    line-height: 18px;\n    padding: 5px 4px 5px 0;\n    border: 1.5px solid var(--focus-ring);\n    border-radius: 4px;\n    background: var(--bg-input, var(--surface));\n    color: var(--text-primary);\n    outline: none;\n    resize: none;\n    overflow: hidden;\n    box-shadow: 0 2px 14px rgba(0, 0, 0, 0.22), 0 0 0 3px rgba(77, 168, 255, 0.13);\n  }\n\n  .status-bar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 32px;\n    padding: 0 16px;\n    background: var(--surface-header);\n    border-top: 1px solid var(--border-soft);\n    font-family: 'JetBrains Mono', monospace;\n    font-size: 11px;\n    color: var(--text-muted);\n    white-space: nowrap;\n    overflow: hidden;\n    min-width: 0;\n    flex-shrink: 0;\n  }\n\n  .status-left {\n    display: flex;\n    align-items: center;\n    gap: 16px;\n    overflow: hidden;\n    min-width: 0;\n  }\n\n  .status-right {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    flex-shrink: 0;\n  }\n\n  .status-btn {\n    border: 1px solid var(--button-border);\n    border-radius: 5px;\n    background: var(--button-bg);\n    color: var(--button-text);\n    font-size: 11px;\n    height: 22px;\n    padding: 0 8px;\n    cursor: pointer;\n  }\n\n  .status-btn:hover {\n    filter: brightness(1.06);\n  }\n\n  .status-btn:disabled {\n    opacity: 0.55;\n    cursor: not-allowed;\n    filter: none;\n  }\n\n  .status-state {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n  }\n\n  .state-dot {\n    width: 6px;\n    height: 6px;\n    border-radius: 50%;\n    flex-shrink: 0;\n  }\n\n  .state-dot.ready { background: #28C840; }\n  .state-dot.indexing { background: #FEBC2E; }\n  .state-dot.error { background: #FF5F57; }\n\n  .rebuild-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 10px;\n    font-weight: 500;\n    background: var(--button-bg);\n    border: 1px solid var(--button-border);\n    border-radius: 4px;\n    color: var(--button-text);\n    height: 22px;\n    padding: 0 10px;\n    cursor: pointer;\n  }\n\n  .rebuild-btn:hover {\n    filter: brightness(1.1);\n  }\n\n  .rebuild-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    filter: none;\n  }\n\n  .rebuild-icon {\n    width: 11px;\n    height: 11px;\n    color: var(--accent);\n    flex-shrink: 0;\n  }\n\n  .status-error {\n    color: var(--error-text);\n  }\n\n  .status-warning {\n    color: var(--warning-text);\n  }\n\n  .status-spotlight {\n    color: #f59e0b;\n    font-weight: 600;\n  }\n\n  .context-menu {\n    position: fixed;\n    z-index: 200;\n    width: 220px;\n    border: 1px solid var(--menu-border);\n    border-radius: 10px;\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.16), inset 0 0 0 0.5px rgba(255, 255, 255, 0.18);\n    background: var(--menu-bg);\n    backdrop-filter: blur(28px) saturate(180%);\n    -webkit-backdrop-filter: blur(28px) saturate(180%);\n    overflow: hidden;\n  }\n\n  .context-menu button {\n    width: 100%;\n    text-align: left;\n    border: none;\n    background: transparent;\n    padding: 8px 10px;\n    font-size: 12px;\n    color: var(--menu-text);\n  }\n\n  .context-menu button:hover {\n    background: var(--menu-hover);\n  }\n\n  .toast {\n    position: fixed;\n    right: 14px;\n    bottom: 18px;\n    background: var(--toast-bg);\n    color: var(--toast-text);\n    border-radius: 10px;\n    padding: 9px 12px;\n    font-size: 12px;\n    z-index: 250;\n    backdrop-filter: blur(20px) saturate(180%);\n    -webkit-backdrop-filter: blur(20px) saturate(180%);\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);\n  }\n</style>\n","structuredPatch":[{"oldStart":1457,"oldLines":7,"newStart":1457,"newLines":7,"lines":["       <div class=\"table-header-track\">","         <div class=\"col name\">","           <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('name')}>","-            Name{#if sortBy === 'name'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}","+            Name{#if sortBy === 'name'}{@html sortIconHtml(sortDir)}{/if}","           </button>","           <button","             type=\"button\""]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"35e77e68-fd1f-4210-aa25-bd25781f9ebc"}
{"parentUuid":"91a3ab9a-2bb1-423d-af4f-00cf07186447","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01NHXmwfvQ3L7wUf1PthkAu7","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_013ZScsiTm3J8z2Jm7D1u6HF","name":"Edit","input":{"replace_all":false,"file_path":"/Users/al02402336/everything/src/App.svelte","old_string":"            Path{#if sortBy === 'dir'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}","new_string":"            Path{#if sortBy === 'dir'}{@html sortIconHtml(sortDir)}{/if}"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":316,"cache_read_input_tokens":100205,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":316},"output_tokens":24,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPQesvBbaDkmJTqgDdQ","type":"assistant","uuid":"5c81ebff-1bd8-4271-ba47-7aff2ad2b2de","timestamp":"2026-02-21T14:39:59.654Z"}
{"parentUuid":"5c81ebff-1bd8-4271-ba47-7aff2ad2b2de","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_013ZScsiTm3J8z2Jm7D1u6HF","toolUseID":"toolu_013ZScsiTm3J8z2Jm7D1u6HF","timestamp":"2026-02-21T14:39:59.664Z","uuid":"1e2df77d-52bd-4610-919b-36dc7216c6f1"}
{"parentUuid":"5c81ebff-1bd8-4271-ba47-7aff2ad2b2de","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_013ZScsiTm3J8z2Jm7D1u6HF","type":"tool_result","content":"The file /Users/al02402336/everything/src/App.svelte has been updated successfully."}]},"uuid":"ce88a12a-2ca0-4805-9f25-bdfaf85f040b","timestamp":"2026-02-21T14:39:59.663Z","toolUseResult":{"filePath":"/Users/al02402336/everything/src/App.svelte","oldString":"            Path{#if sortBy === 'dir'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}","newString":"            Path{#if sortBy === 'dir'}{@html sortIconHtml(sortDir)}{/if}","originalFile":"<script>\n  import { onDestroy, onMount, tick } from 'svelte';\n  import { invoke } from '@tauri-apps/api/core';\n  import { listen } from '@tauri-apps/api/event';\n  import { getCurrentWindow } from '@tauri-apps/api/window';\n  import { startDrag } from '@crabnebula/tauri-plugin-drag';\n\n  const rowHeight = 30;\n  const PAGE_SIZE = 500;\n  let homePrefix = '';\n  const COL_WIDTHS_KEY = 'REDACTED';\n  const THEME_KEY = 'everything-theme';\n  const columnKeys = ['name', 'path', 'size', 'modified'];\n  const minColumnWidth = {\n    name: 180,\n    path: 240,\n    size: 75,\n    modified: 150\n  };\n  const defaultColumnRatios = {\n    name: 0.3,\n    path: 0.45,\n    size: 0.1\n  };\n\n  const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n  let theme = (() => { try { return localStorage.getItem(THEME_KEY) || systemTheme; } catch { return systemTheme; } })();\n  function cycleTheme() {\n    theme = theme === 'dark' ? 'light' : 'dark';\n    try { localStorage.setItem(THEME_KEY, theme); } catch {}\n    invoke('set_native_theme', { theme });\n  }\n\n  function sortIconHtml(dir) {\n    const d = dir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5';\n    return `<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"${d}\"/></svg>`;\n  }\n\n  let query = '';\n  let results = [];\n  let totalResults = 0;\n  let totalResultsKnown = false;\n\n  let dbLatencyMs = null;\n  let dbLastQuery = '';\n  let searchModeLabel = '';\n  let selectedIndices = new Set();\n  let selectionAnchor = -1;\n  let lastSelectedIndex = -1;\n  let editing = {\n    active: false,\n    path: '',\n    index: -1,\n    draftName: ''\n  };\n\n  let renameOverlay = { top: 0, left: 0, width: 0 };\n\n  let indexStatus = {\n    state: 'Indexing',\n    entriesCount: 0,\n    lastUpdated: null,\n    permissionErrors: 0,\n    message: null,\n    isCatchup: false\n  };\n\n  let indexingStartTime = null;\n  let indexingElapsed = '';\n  let indexingFinishedAt = '';\n\n  let sortBy = 'name';\n  let sortDir = 'asc';\n\n  let hasMore = true;\n  let loadingMore = false;\n  let searchGeneration = 0;\n\n  let scanned = 0;\n\n  let searchInputEl;\n  let renameInputEl;\n  let tableAreaEl;\n  let tableContainer;\n  let tableResizeObserver = null;\n  let viewportResizeRaf = null;\n  let scrollTop = 0;\n  let headerScrollLeft = 0;\n  let viewportHeight = 520;\n  let lastTableWidth = 0;\n  let resizingColumn = '';\n  let resizeCleanup = null;\n  let colWidths = {\n    name: 250,\n    path: 350,\n    size: 75,\n    modified: 150\n  };\n\n  let contextMenu = {\n    visible: false,\n    x: 0,\n    y: 0\n  };\n\n  let platform = '';\n  let toast = '';\n  let searchTimer;\n  let lastSearchFiredAt = 0;\n  let toastTimer;\n  let statusRefreshTimer;\n  let elapsedTimer;\n  let statusRefreshInFlight = false;\n  let lastReadyCount = 0;\n\n  const iconCache = new Map();\n  const iconLoading = new Set();\n\n  let highlightCache = new Map();\n  let highlightCacheQuery = '';\n\n  const folderFallbackIcon =\n    \"data:image/svg+xml;utf8,\" +\n    encodeURIComponent(\n      `<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><rect x='1' y='4' width='14' height='10' rx='2' fill='#d9b34f'/><rect x='1' y='2' width='6' height='4' rx='1' fill='#e6ca7a'/></svg>`\n    );\n  const fileFallbackIcon =\n    \"data:image/svg+xml;utf8,\" +\n    encodeURIComponent(\n      `<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><rect x='3' y='1' width='10' height='14' rx='1.5' fill='#b4bec9'/><rect x='5' y='5' width='6' height='1.2' fill='#8d98a5'/><rect x='5' y='8' width='6' height='1.2' fill='#8d98a5'/></svg>`\n    );\n\n  $: totalHeight = results.length * rowHeight;\n  $: startIndex = Math.max(0, Math.floor(scrollTop / rowHeight) - 10);\n  $: visibleCount = Math.ceil(viewportHeight / rowHeight) + 20;\n  $: endIndex = Math.min(results.length, startIndex + visibleCount);\n  $: visibleRows = results.slice(startIndex, endIndex);\n  $: translateY = startIndex * rowHeight;\n  $: tableMinWidth = colWidths.name + colWidths.path + colWidths.size + colWidths.modified;\n  $: tableGridStyle = `--col-name:${colWidths.name}px;--col-path:${colWidths.path}px;--col-size:${colWidths.size}px;--col-modified:${colWidths.modified}px;--table-min-width:${tableMinWidth}px;--header-offset:${-headerScrollLeft}px;`;\n\n  $: {\n    for (const entry of visibleRows) {\n      void ensureIcon(entry);\n    }\n  }\n\n  function showToast(message) {\n    toast = message;\n    clearTimeout(toastTimer);\n    toastTimer = setTimeout(() => {\n      toast = '';\n    }, 3000);\n  }\n\n  function bytesToBase64(bytes) {\n    let binary = '';\n    const chunk = 0x8000;\n    for (let i = 0; i < bytes.length; i += chunk) {\n      const part = bytes.subarray(i, i + chunk);\n      binary += String.fromCharCode(...part);\n    }\n    return btoa(binary);\n  }\n\n  function highlightSegments(name, q) {\n    q = (q || '').trim();\n    if (!q) return [{ text: name, hl: false }];\n\n    // Reset cache when query changes\n    if (q !== highlightCacheQuery) {\n      highlightCache = new Map();\n      highlightCacheQuery = q;\n    }\n\n    // Check cache\n    const cached = highlightCache.get(name);\n    if (cached) return cached;\n\n    if (q.includes('/')) q = q.slice(q.lastIndexOf('/') + 1);\n    q = q.replace(/[*?]/g, '');\n    const terms = q.split(/\\s+/).filter(Boolean);\n    if (terms.length === 0) return [{ text: name, hl: false }];\n\n    const lower = name.toLowerCase();\n    const marks = new Uint8Array(name.length);\n    for (const t of terms) {\n      const tl = t.toLowerCase();\n      let idx = lower.indexOf(tl);\n      while (idx !== -1) {\n        for (let i = idx; i < idx + tl.length; i++) marks[i] = 1;\n        idx = lower.indexOf(tl, idx + 1);\n      }\n    }\n\n    const segs = [];\n    let i = 0;\n    while (i < name.length) {\n      const m = marks[i];\n      let j = i + 1;\n      while (j < name.length && marks[j] === m) j++;\n      segs.push({ text: name.slice(i, j), hl: m === 1 });\n      i = j;\n    }\n\n    highlightCache.set(name, segs);\n    return segs;\n  }\n\n  const perFileIconExts = new Set(['exe', 'lnk', 'ico', 'url', 'scr', 'appx']);\n\n  function iconKey(entry) {\n    if (entry.isDir) return '__folder__';\n    const ext = (entry.ext || '').toLowerCase();\n    if (perFileIconExts.has(ext)) return entry.path;\n    return ext || '__file__';\n  }\n\n  function iconFor(entry) {\n    return iconCache.get(iconKey(entry)) || (entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n  }\n\n  async function ensureIcon(entry) {\n    const key = iconKey(entry);\n    if (iconCache.has(key) || iconLoading.has(key)) {\n      return;\n    }\n\n    iconLoading.add(key);\n    try {\n      const bytes = await invoke('get_file_icon', {\n        path: entry.path,\n        ext: entry.isDir ? 'folder' : entry.ext || '',\n      });\n      if (Array.isArray(bytes) && bytes.length > 0) {\n        const image = `data:image/png;base64,${bytesToBase64(Uint8Array.from(bytes))}`;\n        iconCache.set(key, image);\n      } else {\n        iconCache.set(key, entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n      }\n    } catch {\n      iconCache.set(key, entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n    } finally {\n      iconLoading.delete(key);\n    }\n  }\n\n  function syncColumnWidthsToContainer() {\n    const width = tableContainer?.clientWidth || tableAreaEl?.clientWidth;\n    if (!width || lastTableWidth !== 0) {\n      return;\n    }\n\n    const saved = loadColWidths();\n    if (saved) {\n      const total = columnKeys.reduce((s, k) => s + saved[k], 0);\n      if (Math.abs(total - width) > 2) {\n        const scale = (width - saved.modified) / (total - saved.modified);\n        let scaledName = Math.max(minColumnWidth.name, Math.round(saved.name * scale));\n        let scaledSize = Math.max(minColumnWidth.size, Math.round(saved.size * scale));\n        let rawPath = width - saved.modified - scaledName - scaledSize;\n        if (rawPath < minColumnWidth.path) {\n          const shortfall = minColumnWidth.path - rawPath;\n          const nameReduction = Math.min(shortfall, scaledName - minColumnWidth.name);\n          scaledName -= nameReduction;\n          const remaining = shortfall - nameReduction;\n          if (remaining > 0) {\n            scaledSize -= Math.min(remaining, scaledSize - minColumnWidth.size);\n          }\n          rawPath = width - saved.modified - scaledName - scaledSize;\n        }\n        const scaledPath = Math.max(minColumnWidth.path, rawPath);\n        colWidths = { name: scaledName, path: scaledPath, size: scaledSize, modified: saved.modified };\n      } else {\n        colWidths = saved;\n      }\n    } else {\n      const fixedModified = minColumnWidth.modified;\n      const rest = width - fixedModified;\n      const ratioSum = defaultColumnRatios.name + defaultColumnRatios.path + defaultColumnRatios.size;\n      colWidths = {\n        name: Math.max(minColumnWidth.name, Math.round(rest * defaultColumnRatios.name / ratioSum)),\n        path: Math.max(minColumnWidth.path, Math.round(rest * defaultColumnRatios.path / ratioSum)),\n        size: Math.max(minColumnWidth.size, Math.round(rest * defaultColumnRatios.size / ratioSum)),\n        modified: fixedModified\n      };\n    }\n    lastTableWidth = width;\n  }\n\n  function loadColWidths() {\n    try {\n      const raw = localStorage.getItem(COL_WIDTHS_KEY);\n      if (!raw) return null;\n      const parsed = JSON.parse(raw);\n      for (const key of columnKeys) {\n        if (typeof parsed[key] !== 'number' || parsed[key] < (minColumnWidth[key] || 0)) return null;\n      }\n      return parsed;\n    } catch {\n      return null;\n    }\n  }\n\n  function saveColWidths() {\n    localStorage.setItem(COL_WIDTHS_KEY, JSON.stringify(colWidths));\n  }\n\n  function updateViewportHeight() {\n    viewportHeight = tableContainer?.clientHeight || 520;\n    syncColumnWidthsToContainer();\n  }\n\n  function scheduleViewportHeightUpdate() {\n    if (viewportResizeRaf !== null) {\n      return;\n    }\n    viewportResizeRaf = requestAnimationFrame(() => {\n      viewportResizeRaf = null;\n      updateViewportHeight();\n    });\n  }\n\n  function startColumnResize(event, leftKey) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    const index = columnKeys.indexOf(leftKey);\n    if (index < 0 || index >= columnKeys.length - 1) {\n      return;\n    }\n\n    const startX = event.clientX;\n    const startLeft = colWidths[leftKey];\n    const rightKey = columnKeys[index + 1];\n    const startRight = colWidths[rightKey];\n\n    resizeCleanup?.();\n    resizingColumn = leftKey;\n\n    const onMove = (moveEvent) => {\n      const delta = Math.round(moveEvent.clientX - startX);\n      if (leftKey === 'name') {\n        // Two-column trade: name and path swap space, each respects its minimum\n        const nextLeft = Math.max(\n          minColumnWidth[leftKey],\n          Math.min(startLeft + delta, startLeft + startRight - minColumnWidth[rightKey])\n        );\n        const nextRight = startLeft + startRight - nextLeft;\n        colWidths = { ...colWidths, [leftKey]: nextLeft, [rightKey]: nextRight };\n      } else {\n        // path splitter: path grows unconstrained (allows horizontal scroll on right drag)\n        const nextLeft = Math.max(minColumnWidth[leftKey], startLeft + delta);\n        colWidths = { ...colWidths, [leftKey]: nextLeft };\n      }\n    };\n\n    const onUp = () => {\n      cleanup();\n    };\n\n    const cleanup = () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n      document.body.style.cursor = '';\n      document.body.style.userSelect = '';\n      resizingColumn = '';\n      saveColWidths();\n      if (resizeCleanup === cleanup) {\n        resizeCleanup = null;\n      }\n    };\n\n    resizeCleanup = cleanup;\n    document.body.style.cursor = 'col-resize';\n    document.body.style.userSelect = 'none';\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n  }\n\n  function selectedPaths() {\n    const sorted = [...selectedIndices].sort((a, b) => a - b);\n    return sorted.map((idx) => results[idx]).filter(Boolean).map((entry) => entry.path);\n  }\n\n  function clearSelection() {\n    selectedIndices = new Set();\n    selectionAnchor = -1;\n    lastSelectedIndex = -1;\n  }\n\n  function selectSingle(index) {\n    selectedIndices = new Set([index]);\n    selectionAnchor = index;\n    lastSelectedIndex = index;\n  }\n\n  function selectToggle(index) {\n    const next = new Set(selectedIndices);\n    if (next.has(index)) {\n      next.delete(index);\n    } else {\n      next.add(index);\n    }\n    selectedIndices = next;\n    selectionAnchor = index;\n    lastSelectedIndex = index;\n  }\n\n  function selectRange(index) {\n    const anchor = selectionAnchor >= 0 ? selectionAnchor : index;\n    const [from, to] = [Math.min(anchor, index), Math.max(anchor, index)];\n    const next = new Set();\n    for (let i = from; i <= to; i += 1) {\n      next.add(i);\n    }\n    selectedIndices = next;\n    lastSelectedIndex = index;\n  }\n\n  function primaryEntry() {\n    const idx = lastSelectedIndex >= 0 ? lastSelectedIndex : -1;\n    return idx >= 0 ? results[idx] : null;\n  }\n\n  async function refreshStatus() {\n    if (statusRefreshInFlight) {\n      return;\n    }\n    statusRefreshInFlight = true;\n    try {\n      const status = await invoke('get_index_status');\n      const prevState = indexStatus.state;\n      indexStatus = {\n        state: status.state,\n        entriesCount: status.entriesCount,\n        lastUpdated: status.lastUpdated,\n        permissionErrors: status.permissionErrors ?? 0,\n        message: status.message\n      };\n      if (status.state === 'Indexing' && prevState !== 'Indexing') {\n        startElapsedTimer();\n      } else if (status.state !== 'Indexing' && prevState === 'Indexing') {\n        stopElapsedTimer();\n      }\n      if (typeof status.scanned === 'number') {\n        scanned = status.scanned;\n      }\n      if (status.state === 'Ready' && prevState !== 'Ready') {\n        scheduleSearch();\n      }\n    } catch (err) {\n      showToast(`Failed to get status: ${String(err)}`);\n    } finally {\n      statusRefreshInFlight = false;\n    }\n  }\n\n  function scheduleSearch(preserveScroll = false) {\n    searchGeneration += 1;\n    const scheduledGen = searchGeneration;\n    clearTimeout(searchTimer);\n\n    const now = performance.now();\n    if (now - lastSearchFiredAt >= 200) {\n      // Leading edge: fire immediately if enough time has passed\n      lastSearchFiredAt = now;\n      void runSearch(preserveScroll);\n    } else {\n      // Trailing edge: debounce\n      searchTimer = setTimeout(() => {\n        if (scheduledGen !== searchGeneration) {\n          return;\n        }\n        lastSearchFiredAt = performance.now();\n        void runSearch(preserveScroll);\n      }, 200);\n    }\n  }\n\n  async function runSearch(preserveScroll = false) {\n    searchGeneration += 1;\n    const gen = searchGeneration;\n    const searchQuery = query;\n    const searchSortBy = sortBy;\n    const searchSortDir = sortDir;\n    const startedAt = performance.now();\n    try {\n      const keepPaths = new Set(selectedPaths());\n      const next = await invoke('search', {\n        query: searchQuery,\n        limit: PAGE_SIZE,\n        offset: 0,\n        sortBy: searchSortBy,\n        sortDir: searchSortDir\n      });\n\n      if (gen !== searchGeneration) return;\n\n      dbLatencyMs = Math.round(performance.now() - startedAt);\n      dbLastQuery = searchQuery;\n      const entries = Array.isArray(next.entries) ? next.entries : [];\n      searchModeLabel = next.modeLabel || '';\n      results = entries;\n      if (next.totalCount > 0) {\n        totalResults = next.totalCount;\n        totalResultsKnown = true;\n      } else {\n        totalResults = entries.length;\n        totalResultsKnown = false;\n      }\n      hasMore = totalResultsKnown ? results.length < totalResults : entries.length >= PAGE_SIZE;\n      if (!preserveScroll && tableContainer) tableContainer.scrollTop = 0;\n\n      const restored = new Set();\n      for (let i = 0; i < results.length; i += 1) {\n        if (keepPaths.has(results[i].path)) {\n          restored.add(i);\n        }\n      }\n      selectedIndices = restored;\n\n      updateViewportHeight();\n    } catch (err) {\n      if (gen !== searchGeneration) return;\n      showToast(`Search failed: ${String(err)}`);\n    }\n  }\n\n  async function loadMore() {\n    if (!hasMore || loadingMore) return;\n    const gen = searchGeneration;\n    loadingMore = true;\n    try {\n      const batch = await invoke('search', {\n        query,\n        limit: PAGE_SIZE,\n        offset: results.length,\n        sortBy: sortBy,\n        sortDir: sortDir\n      });\n      if (gen !== searchGeneration) return;\n      const arr = Array.isArray(batch.entries) ? batch.entries : [];\n      if (arr.length > 0) results = [...results, ...arr];\n      hasMore = totalResultsKnown ? results.length < totalResults : arr.length >= PAGE_SIZE;\n    } catch (err) {\n      showToast(`Failed to load more: ${String(err)}`);\n    } finally {\n      loadingMore = false;\n    }\n  }\n\n  function moveSelection(delta, withRange = false) {\n    if (results.length === 0) {\n      return;\n    }\n\n    const current = lastSelectedIndex >= 0 ? lastSelectedIndex : 0;\n    const next = Math.max(0, Math.min(results.length - 1, current + delta));\n\n    if (withRange) {\n      selectRange(next);\n    } else {\n      selectSingle(next);\n    }\n\n    const top = next * rowHeight;\n    const bottom = top + rowHeight;\n    if (top < scrollTop) {\n      tableContainer.scrollTop = top;\n    } else if (bottom > scrollTop + viewportHeight) {\n      tableContainer.scrollTop = bottom - viewportHeight;\n    }\n  }\n\n  function handleHeaderSort(column) {\n    if (sortBy === column) {\n      sortDir = sortDir === 'asc' ? 'desc' : 'asc';\n    } else {\n      sortBy = column;\n      sortDir = 'asc';\n    }\n    if (tableContainer) tableContainer.scrollTop = 0;\n    void runSearch();\n  }\n\n  function handleRowClick(event, index) {\n    contextMenu.visible = false;\n\n    if (event.shiftKey) {\n      selectRange(index);\n      return;\n    }\n\n    if (event.metaKey || event.ctrlKey) {\n      selectToggle(index);\n      return;\n    }\n\n    selectSingle(index);\n  }\n\n  function handleRowContextMenu(event, index) {\n    event.preventDefault();\n\n    if (!selectedIndices.has(index)) {\n      selectSingle(index);\n    }\n\n    if (platform === 'windows' || platform === 'macos') {\n      contextMenu.visible = false;\n      const paths = selectedPaths();\n      if (paths.length > 0) {\n        invoke('show_context_menu', {\n          paths,\n          x: event.clientX,\n          y: event.clientY,\n          singleSelection: selectedIndices.size === 1\n        });\n      }\n      return;\n    }\n\n    contextMenu = {\n      visible: true,\n      x: event.clientX,\n      y: event.clientY\n    };\n  }\n\n  function handleRowA11yKeydown(event, index) {\n    if (event.key === ' ' || event.key === 'Enter') {\n      event.preventDefault();\n      handleRowClick(event, index);\n    }\n  }\n\n  const DRAG_THRESHOLD = 5;\n  let dragCleanup = null;\n  const dragImgCache = new Map();\n\n  function dragPathsForIndex(index) {\n    const entry = results[index];\n    if (!entry) {\n      return [];\n    }\n\n    if (selectedIndices.has(index) && selectedIndices.size > 0) {\n      return selectedPaths();\n    }\n\n    return [entry.path];\n  }\n\n  function getDragIconEl(entry) {\n    const src = iconFor(entry);\n    let img = dragImgCache.get(src);\n    if (!img) {\n      img = new Image();\n      img.src = src;\n      dragImgCache.set(src, img);\n    }\n    return img.complete && img.naturalWidth > 0 ? img : null;\n  }\n\n  function fillRoundRect(ctx, x, y, w, h, r) {\n    ctx.beginPath();\n    ctx.moveTo(x + r, y);\n    ctx.arcTo(x + w, y, x + w, y + h, r);\n    ctx.arcTo(x + w, y + h, x, y + h, r);\n    ctx.arcTo(x, y + h, x, y, r);\n    ctx.arcTo(x, y, x + w, y, r);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  function buildDragPreview(index) {\n    const entry = results[index];\n    if (!entry) return null;\n\n    const count = selectedIndices.has(index) ? selectedIndices.size : 1;\n    const isDark = theme === 'dark';\n\n    const w = 260;\n    const h = 28;\n    const stackGap = count > 1 ? 4 : 0;\n\n    const canvas = document.createElement('canvas');\n    canvas.width = w;\n    canvas.height = h + stackGap;\n    const ctx = canvas.getContext('2d');\n\n    if (count > 1) {\n      ctx.globalAlpha = 0.35;\n      ctx.fillStyle = isDark ? '#5a6070' : '#b0c4de';\n      fillRoundRect(ctx, 3, 0, w - 3, h, 5);\n      ctx.globalAlpha = 1.0;\n    }\n\n    const ry = stackGap;\n    ctx.fillStyle = isDark ? 'rgba(58, 64, 74, 0.94)' : 'rgba(214, 231, 255, 0.94)';\n    fillRoundRect(ctx, 0, ry, w, h, 5);\n\n    ctx.strokeStyle = isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';\n    ctx.lineWidth = 0.5;\n    ctx.beginPath();\n    ctx.moveTo(5, ry);\n    ctx.arcTo(w, ry, w, ry + h, 5);\n    ctx.arcTo(w, ry + h, 0, ry + h, 5);\n    ctx.arcTo(0, ry + h, 0, ry, 5);\n    ctx.arcTo(0, ry, w, ry, 5);\n    ctx.closePath();\n    ctx.stroke();\n\n    const iconEl = getDragIconEl(entry);\n    if (iconEl) {\n      ctx.drawImage(iconEl, 6, ry + 6, 16, 16);\n    } else {\n      ctx.fillStyle = entry.isDir ? '#d9b34f' : '#8d98a5';\n      fillRoundRect(ctx, 6, ry + 6, 16, 16, 2);\n    }\n\n    ctx.fillStyle = isDark ? '#e6e6e8' : '#1a1a1a';\n    ctx.font = '12px -apple-system, \"SF Pro Text\", system-ui, sans-serif';\n    ctx.textBaseline = 'middle';\n\n    let nameMaxW = w - 34;\n    if (count > 1) nameMaxW -= 34;\n\n    let name = entry.name;\n    if (ctx.measureText(name).width > nameMaxW) {\n      while (name.length > 4 && ctx.measureText(name + '\\u2026').width > nameMaxW) {\n        name = name.slice(0, -1);\n      }\n      name += '\\u2026';\n    }\n    ctx.fillText(name, 28, ry + h / 2 + 1);\n\n    if (count > 1) {\n      const badge = String(count);\n      ctx.font = 'bold 10px -apple-system, system-ui, sans-serif';\n      const tw = ctx.measureText(badge).width;\n      const bw = Math.max(20, tw + 10);\n      const bx = w - bw - 6;\n      const by = ry + (h - 18) / 2;\n\n      ctx.fillStyle = isDark ? '#5b8bd9' : '#007aff';\n      fillRoundRect(ctx, bx, by, bw, 18, 9);\n\n      ctx.fillStyle = '#ffffff';\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(badge, bx + bw / 2, by + 9);\n    }\n\n    return canvas.toDataURL('image/png');\n  }\n\n  function handleRowMouseDown(event, index) {\n    if (event.button !== 0) return;\n    if (event.metaKey || event.ctrlKey || event.shiftKey) return;\n    if (editing.active) return;\n\n    const startX = event.clientX;\n    const startY = event.clientY;\n    let dragging = false;\n\n    dragCleanup?.();\n\n    const onMove = (e) => {\n      if (dragging) return;\n      const dx = e.clientX - startX;\n      const dy = e.clientY - startY;\n      if (dx * dx + dy * dy < DRAG_THRESHOLD * DRAG_THRESHOLD) return;\n\n      dragging = true;\n      cleanup();\n\n      if (!selectedIndices.has(index)) {\n        selectSingle(index);\n      }\n\n      const paths = dragPathsForIndex(index);\n      if (paths.length > 0) {\n        const icon = buildDragPreview(index);\n        startDrag({ item: paths, icon }).catch(() => {});\n      }\n    };\n\n    const onUp = () => cleanup();\n\n    const cleanup = () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n      if (dragCleanup === cleanup) dragCleanup = null;\n    };\n\n    dragCleanup = cleanup;\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n  }\n\n  async function handleRowDoubleClick(index) {\n    if (!selectedIndices.has(index) || selectedIndices.size > 1) {\n      selectSingle(index);\n      await tick();\n    }\n    await invoke('open', { paths: [results[index].path] }).catch((err) => {\n      showToast(`Failed to open: ${String(err)}`);\n    });\n  }\n\n  function closeContextMenu() {\n    contextMenu = {\n      ...contextMenu,\n      visible: false\n    };\n  }\n\n  async function openSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('open', { paths });\n    } catch (err) {\n      showToast(`Failed to open: ${String(err)}`);\n    }\n  }\n\n  async function openWithFallback() {\n    const target = primaryEntry();\n    if (!target) {\n      return;\n    }\n\n    try {\n      await invoke('open_with', { path: target.path });\n    } catch (err) {\n      showToast(`Open With failed: ${String(err)}`);\n    }\n  }\n\n  async function revealSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('reveal_in_finder', { paths });\n    } catch (err) {\n      showToast(`Failed to reveal in Finder: ${String(err)}`);\n    }\n  }\n\n  async function copySelectedPaths() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('copy_paths', { paths });\n      showToast(`Copied ${paths.length} path(s)`);\n    } catch (err) {\n      showToast(`Failed to copy path: ${String(err)}`);\n    }\n  }\n\n  async function copyFiles() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('copy_files', { paths });\n      showToast(`Copied ${paths.length} item(s)`);\n    } catch (err) {\n      showToast(`Failed to copy: ${String(err)}`);\n    }\n  }\n\n  async function trashSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    const message =\n      paths.length === 1\n        ? 'Move selected item to Trash?'\n        : `Move ${paths.length} items to Trash?`;\n\n    if (!window.confirm(message)) {\n      return;\n    }\n\n    try {\n      await invoke('move_to_trash', { paths });\n      showToast('Moved to Trash.');\n      clearSelection();\n      await runSearch();\n    } catch (err) {\n      showToast(`Failed to move to Trash: ${String(err)}`);\n    }\n  }\n\n  async function resetIndex() {\n    if (indexStatus.state === 'Indexing') {\n      showToast('Indexing in progress. Please try again after it completes.');\n      return;\n    }\n\n    results = [];\n    totalResults = 0;\n    totalResultsKnown = false;\n    clearSelection();\n    scanned = 0;\n    dbLatencyMs = null;\n    dbLastQuery = '';\n    indexStatus = { ...indexStatus, state: 'Indexing', entriesCount: 0, message: null };\n    indexingStartTime = Date.now();\n    indexingElapsed = '';\n    indexingFinishedAt = '';\n\n    try {\n      await invoke('reset_index');\n    } catch (err) {\n      showToast(`Failed to reset index: ${String(err)}`);\n      await refreshStatus();\n    }\n  }\n\n  function isMultiSelected() {\n    return selectedIndices.size > 1;\n  }\n\n  function autoResizeRenameInput() {\n    if (!renameInputEl) return;\n    renameInputEl.style.height = '0';\n    renameInputEl.style.height = renameInputEl.scrollHeight + 'px';\n  }\n\n  async function startRename() {\n    if (isMultiSelected()) {\n      return;\n    }\n\n    const idx = lastSelectedIndex;\n    if (idx < 0 || !results[idx]) {\n      return;\n    }\n\n    const entry = results[idx];\n\n    // Calculate overlay position mathematically.\n    // Name cell text starts at: padding-left(16) + icon(16) + gap(6) = 38px from cell left.\n    // Textarea has padding-left: 0 and border: 1.5px, so text starts ~2px from overlay left.\n    if (tableContainer) {\n      const rect = tableContainer.getBoundingClientRect();\n      const cellLeft = rect.left - tableContainer.scrollLeft;\n      const textLeft = cellLeft + 38;\n      const cellRight = cellLeft + colWidths.name;\n      const rowTop = rect.top + idx * rowHeight - tableContainer.scrollTop;\n      renameOverlay = {\n        top: rowTop,\n        left: textLeft - 2,\n        width: cellRight - textLeft + 2 - 4\n      };\n    }\n\n    editing = {\n      active: true,\n      path: entry.path,\n      index: idx,\n      draftName: entry.name\n    };\n\n    await tick();\n\n    if (renameInputEl) {\n      autoResizeRenameInput();\n      renameInputEl.focus();\n      const extPos = !entry.isDir ? entry.name.lastIndexOf('.') : -1;\n      const selectionEnd = extPos > 0 ? extPos : entry.name.length;\n      renameInputEl.setSelectionRange(0, selectionEnd);\n    }\n  }\n\n  function cancelRename() {\n    editing = {\n      active: false,\n      path: '',\n      index: -1,\n      draftName: ''\n    };\n  }\n\n  async function commitRename() {\n    if (!editing.active || editing.index < 0 || !results[editing.index]) {\n      return;\n    }\n\n    const current = results[editing.index];\n    const nextName = editing.draftName;\n\n    try {\n      await invoke('rename', {\n        path: current.path,\n        newName: nextName\n      });\n      cancelRename();\n      await runSearch();\n    } catch (err) {\n      showToast(`Failed to rename: ${String(err)}`);\n      await tick();\n      renameInputEl?.focus();\n    }\n  }\n\n  function onGlobalClick() {\n    closeContextMenu();\n  }\n\n  function onTitleBarMouseDown(event) {\n    if (event.button !== 0) {\n      return;\n    }\n\n    const activeElement = document.activeElement;\n    if (activeElement instanceof HTMLElement && isTextInputTarget(activeElement)) {\n      activeElement.blur();\n    }\n  }\n\n  async function focusSearch() {\n    await getCurrentWindow().show();\n    await getCurrentWindow().setFocus();\n    searchInputEl?.focus();\n    searchInputEl?.select();\n  }\n\n  function isTextInputTarget(target) {\n    return (\n      target instanceof HTMLInputElement ||\n      target instanceof HTMLTextAreaElement ||\n      target?.isContentEditable\n    );\n  }\n\n  async function handleKeydown(event) {\n    const isMetaSelectAll = (event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'a';\n    const isMetaCopy = (event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'c';\n    const target = event.target;\n    const isTextInput = isTextInputTarget(target);\n\n    if (isMetaCopy && isTextInput) {\n      return;\n    }\n\n    if (isMetaSelectAll) {\n      if (isTextInput) {\n        event.preventDefault();\n        if (target instanceof HTMLInputElement || target instanceof HTMLTextAreaElement) {\n          target.select();\n        }\n        return;\n      }\n    }\n\n    if (editing.active) {\n      if (event.key === 'Enter') {\n        event.preventDefault();\n        await commitRename();\n        return;\n      }\n\n      if (event.key === 'Escape') {\n        event.preventDefault();\n        const idx = editing.index;\n        cancelRename();\n        selectSingle(idx);\n        await tick();\n        tableContainer?.querySelector('.row.selected')?.focus();\n        return;\n      }\n      return;\n    }\n\n    if (event.key === 'Escape') {\n      event.preventDefault();\n      clearSelection();\n      return;\n    }\n\n    if (event.key === 'ArrowDown') {\n      event.preventDefault();\n      moveSelection(1, event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'ArrowUp') {\n      event.preventDefault();\n      moveSelection(-1, event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'PageDown') {\n      event.preventDefault();\n      moveSelection(Math.floor(viewportHeight / rowHeight), event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'PageUp') {\n      event.preventDefault();\n      moveSelection(-Math.floor(viewportHeight / rowHeight), event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'Enter') {\n      event.preventDefault();\n      if (platform === 'windows') {\n        await openSelected();\n      } else {\n        await startRename();\n      }\n      return;\n    }\n\n    if (event.key === 'F2') {\n      event.preventDefault();\n      await startRename();\n      return;\n    }\n\n    if (event.key === ' ' && !isTextInput) {\n      event.preventDefault();\n      const entry = primaryEntry();\n      if (entry) {\n        await invoke('quick_look', { path: entry.path });\n      }\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'f') {\n      event.preventDefault();\n      clearSelection();\n      searchInputEl?.focus();\n      searchInputEl?.select();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'o') {\n      event.preventDefault();\n      await openSelected();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key === 'Enter') {\n      event.preventDefault();\n      await revealSelected();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'c') {\n      event.preventDefault();\n      await copySelectedPaths();\n      return;\n    }\n\n    if (isMetaSelectAll) {\n      event.preventDefault();\n      selectedIndices = new Set(Array.from({ length: results.length }, (_, i) => i));\n      return;\n    }\n\n    if (event.key === 'Delete' || ((event.metaKey || event.ctrlKey) && event.key === 'Backspace')) {\n      if (!isTextInput) {\n        event.preventDefault();\n        await trashSelected();\n      }\n      return;\n    }\n  }\n\n  function formatSize(entry) {\n    if (entry.isDir || entry.size == null) return '';\n    const bytes = entry.size;\n    if (bytes < 1024) return `${bytes} B`;\n    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n    if (bytes < 1024 * 1024 * 1024) return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n    return `${(bytes / (1024 * 1024 * 1024)).toFixed(1)} GB`;\n  }\n\n  function formatModified(entry) {\n    if (!entry.mtime) {\n      return '';\n    }\n\n    const d = new Date(entry.mtime * 1000);\n    const pad = (n) => String(n).padStart(2, '0');\n    return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;\n  }\n\n  function formatLastUpdated(timestamp) {\n    if (!timestamp) {\n      return '-';\n    }\n\n    return new Date(timestamp * 1000).toLocaleString();\n  }\n\n  function formatElapsed(ms) {\n    const totalSec = Math.floor(ms / 1000);\n    const min = Math.floor(totalSec / 60);\n    const sec = totalSec % 60;\n    return min > 0 ? `${min}m ${sec}s` : `${sec}s`;\n  }\n\n  function updateElapsed() {\n    if (indexingStartTime && indexStatus.state === 'Indexing') {\n      indexingElapsed = formatElapsed(Date.now() - indexingStartTime);\n    }\n  }\n\n  function startElapsedTimer() {\n    clearInterval(elapsedTimer);\n    indexingStartTime = Date.now();\n    indexingElapsed = '0s';\n    indexingFinishedAt = '';\n    elapsedTimer = setInterval(updateElapsed, 1000);\n  }\n\n  function stopElapsedTimer() {\n    clearInterval(elapsedTimer);\n    if (indexingStartTime) {\n      const elapsed = Date.now() - indexingStartTime;\n      indexingFinishedAt = `${formatElapsed(elapsed)}`;\n    }\n    indexingStartTime = null;\n    indexingElapsed = '';\n  }\n\n  function displayPath(path) {\n    if (!path) {\n      return path;\n    }\n\n    if (!homePrefix) {\n      return path;\n    }\n\n    if (path === homePrefix) {\n      return '~';\n    }\n\n    if (path.startsWith(`${homePrefix}/`)) {\n      return `~${path.slice(homePrefix.length)}`;\n    }\n\n    return path;\n  }\n\n  let unlistenFns = [];\n\n  onMount(async () => {\n    const t0 = performance.now();\n    const ms = () => Math.round(performance.now() - t0);\n    const DEBUG_STARTUP = false;\n    const flog = DEBUG_STARTUP ? (msg) => invoke('frontend_log', { msg }).catch(() => {}) : () => {};\n\n    flog(`[startup/fe] onMount entered`);\n\n    updateViewportHeight();\n    flog(`[startup/fe] +${ms()}ms updateViewportHeight done`);\n\n    invoke('set_native_theme', { theme });\n\n    platform = await invoke('get_platform');\n    flog(`[startup/fe] +${ms()}ms get_platform done`);\n\n    const unlistenProgress = await listen('index_progress', (event) => {\n      scanned = event.payload.scanned;\n      if (indexStatus.state !== 'Indexing') {\n        indexStatus = {\n          ...indexStatus,\n          state: 'Indexing'\n        };\n      }\n    });\n    flog(`[startup/fe] +${ms()}ms listen(index_progress) registered`);\n\n    const unlistenState = await listen('index_state', (event) => {\n      flog(`[startup/fe] index_state event received: ${event.payload.state} at +${ms()}ms`);\n      const prevState = indexStatus.state;\n      indexStatus = {\n        ...indexStatus,\n        state: event.payload.state,\n        message: event.payload.message ?? null,\n        isCatchup: event.payload.isCatchup ?? false\n      };\n\n      if (event.payload.state === 'Indexing' && prevState !== 'Indexing') {\n        if (prevState === 'Ready') {\n          lastReadyCount = indexStatus.entriesCount;\n        }\n        startElapsedTimer();\n      } else if (event.payload.state !== 'Indexing' && prevState === 'Indexing') {\n        stopElapsedTimer();\n      }\n\n      if (event.payload.state === 'Ready') {\n        scheduleSearch();\n      }\n    });\n    flog(`[startup/fe] +${ms()}ms listen(index_state) registered`);\n\n    const unlistenUpdated = await listen('index_updated', (event) => {\n      indexStatus = {\n        ...indexStatus,\n        entriesCount: event.payload.entriesCount,\n        lastUpdated: event.payload.lastUpdated,\n        permissionErrors: event.payload.permissionErrors ?? indexStatus.permissionErrors\n      };\n\n      scheduleSearch(true);\n    });\n\n    const unlistenFocus = await listen('focus_search', () => {\n      void focusSearch();\n    });\n\n    const unlistenCtxMenuAction = await listen('context_menu_action', (event) => {\n      switch (event.payload) {\n        case 'open': void openSelected(); break;\n        case 'quick_look': {\n          const e = primaryEntry();\n          if (e) void invoke('quick_look', { path: e.path });\n          break;\n        }\n        case 'open_with': void openWithFallback(); break;\n        case 'reveal': void revealSelected(); break;\n        case 'copy_files': void copyFiles(); break;\n        case 'copy_path': void copySelectedPaths(); break;\n        case 'trash': void trashSelected(); break;\n        case 'rename': void startRename(); break;\n      }\n    });\n\n    unlistenFns = [unlistenProgress, unlistenState, unlistenUpdated, unlistenFocus, unlistenCtxMenuAction];\n    flog(`[startup/fe] +${ms()}ms all listeners registered`);\n\n    // Fetch backend state IMMEDIATELY after listeners are registered.\n    // Events emitted before listener registration are lost, so this\n    // is the only reliable way to get the current state.\n    await refreshStatus();\n    flog(`[startup/fe] +${ms()}ms refreshStatus done (state=${indexStatus.state})`);\n\n    // Show Svelte UI: remove skeleton, focus search input.\n    await tick();\n    document.getElementById('skeleton')?.remove();\n    await focusSearch();\n    flog(`[startup/fe] +${ms()}ms WINDOW VISIBLE â€” skeleton removed`);\n\n    try {\n      homePrefix = await invoke('get_home_dir');\n    } catch {\n      homePrefix = '';\n    }\n    flog(`[startup/fe] +${ms()}ms get_home_dir done`);\n\n    if (!localStorage.getItem('everything-fda-notice-v1')) {\n      showToast('macOS Full Disk Access permission may be required for full disk search.');\n      localStorage.setItem('everything-fda-notice-v1', '1');\n    }\n    flog(`[startup/fe] +${ms()}ms calling runSearch...`);\n    await runSearch();\n    flog(`[startup/fe] +${ms()}ms runSearch done`);\n\n    if (typeof ResizeObserver !== 'undefined') {\n      tableResizeObserver = new ResizeObserver(() => {\n        scheduleViewportHeightUpdate();\n      });\n      if (tableContainer) {\n        tableResizeObserver.observe(tableContainer);\n      } else if (tableAreaEl) {\n        tableResizeObserver.observe(tableAreaEl);\n      }\n    }\n\n    window.addEventListener('resize', scheduleViewportHeightUpdate);\n    window.addEventListener('click', onGlobalClick);\n    statusRefreshTimer = setInterval(() => {\n      if (indexStatus.state === 'Indexing') {\n        void refreshStatus();\n      }\n    }, 1000);\n    console.log(`[startup/fe] +${ms()}ms onMount complete`);\n  });\n\n  onDestroy(async () => {\n    clearTimeout(searchTimer);\n    clearTimeout(toastTimer);\n    clearInterval(statusRefreshTimer);\n    clearInterval(elapsedTimer);\n    resizeCleanup?.();\n\n    for (const unlisten of unlistenFns) {\n      unlisten();\n    }\n\n    tableResizeObserver?.disconnect();\n    tableResizeObserver = null;\n    if (viewportResizeRaf !== null) {\n      cancelAnimationFrame(viewportResizeRaf);\n      viewportResizeRaf = null;\n    }\n    window.removeEventListener('resize', scheduleViewportHeightUpdate);\n    window.removeEventListener('click', onGlobalClick);\n  });\n</script>\n\n<svelte:window on:keydown={handleKeydown} />\n\n<div class=\"app-shell\" data-theme={theme}>\n  <div class=\"title-bar\" role=\"presentation\" data-tauri-drag-region on:mousedown={onTitleBarMouseDown}>\n    <div class=\"title-left\"></div>\n    <div class=\"title-center\">\n      <svg class=\"title-icon\" viewBox=\"0 0 215 205\" fill-rule=\"evenodd\" aria-hidden=\"true\">\n        <path d=\"M85 0c46.9 0 85 38.1 85 85 0 20.1-7.2 38.5-19.2 52.7l40.7 40.8c5.8 5.8 5.8 15.2 0 21-5.8 5.8-15.2 5.8-21 0l-40.7-40.7c-13.6 9.7-30.4 15.2-44.8 15.2-46.9 0-85-42.1-85-89 0-46.9 38.1-85 85-85z m0 32c-29.3 0-53 23.7-53 53 0 29.3 23.7 53 53 53 29.3 0 53-23.7 53-53 0-29.3-23.7-53-53-53z\"/>\n      </svg>\n      <span class=\"title-text\">Everything</span>\n    </div>\n    <div class=\"title-right\"></div>\n  </div>\n\n  <header class=\"search-bar\">\n    <input\n      bind:this={searchInputEl}\n      class=\"search-input\"\n      type=\"text\"\n      bind:value={query}\n      on:input={scheduleSearch}\n      on:focus={clearSelection}\n      placeholder=\"Search file/folder names\"\n      autocomplete=\"off\"\n      spellcheck=\"false\"\n    />\n  </header>\n\n  <section class=\"table-area\" bind:this={tableAreaEl} style={tableGridStyle}>\n    <div class=\"table-header\">\n      <div class=\"table-header-track\">\n        <div class=\"col name\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('name')}>\n            Name{#if sortBy === 'name'}{@html sortIconHtml(sortDir)}{/if}\n          </button>\n          <button\n            type=\"button\"\n            class=\"col-resizer\"\n            class:active={resizingColumn === 'name'}\n            on:mousedown={(event) => startColumnResize(event, 'name')}\n            aria-label=\"Resize Name column\"\n          />\n        </div>\n\n        <div class=\"col path\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('dir')}>\n            Path{#if sortBy === 'dir'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n          <button\n            type=\"button\"\n            class=\"col-resizer\"\n            class:active={resizingColumn === 'path'}\n            on:mousedown={(event) => startColumnResize(event, 'path')}\n            aria-label=\"Resize Path column\"\n          />\n        </div>\n\n        <div class=\"col size\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('size')}>\n            Size{#if sortBy === 'size'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n        </div>\n\n        <div class=\"col modified\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('mtime')}>\n            Modified{#if sortBy === 'mtime'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <div\n      class=\"table-body\"\n      bind:this={tableContainer}\n      on:scroll={() => {\n        scrollTop = tableContainer.scrollTop;\n        headerScrollLeft = tableContainer.scrollLeft;\n        if (editing.active) void commitRename();\n        const scrollBottom = scrollTop + tableContainer.clientHeight;\n        if (scrollBottom >= totalHeight - rowHeight * 10) {\n          void loadMore();\n        }\n      }}\n    >\n      <div class=\"spacer\" style={`height:${totalHeight}px`}>\n        <div class=\"rows\" style={`transform: translateY(${translateY}px);`}>\n          {#each visibleRows as entry, localIndex}\n            {@const index = startIndex + localIndex}\n            <div\n              class=\"row {selectedIndices.has(index) ? 'selected' : ''}\"\n              on:mousedown={(event) => handleRowMouseDown(event, index)}\n              on:click={(event) => handleRowClick(event, index)}\n              on:keydown={(event) => handleRowA11yKeydown(event, index)}\n              on:dblclick={() => handleRowDoubleClick(index)}\n              on:contextmenu={(event) => handleRowContextMenu(event, index)}\n              role=\"row\"\n              tabindex=\"0\"\n            >\n              <div class=\"cell name\">\n                <img class=\"file-icon\" src={iconFor(entry)} alt=\"\" />\n                <span class=\"ellipsis\" class:name-editing={editing.active && editing.index === index}>{#each highlightSegments(entry.name, query) as seg}{#if seg.hl}<mark class=\"hl\">{seg.text}</mark>{:else}{seg.text}{/if}{/each}</span>\n              </div>\n              <div class=\"cell path\"><span class=\"ellipsis\">{displayPath(entry.dir)}</span></div>\n              <div class=\"cell size\">{formatSize(entry)}</div>\n              <div class=\"cell modified\">{formatModified(entry)}</div>\n            </div>\n          {/each}\n        </div>\n      </div>\n    </div>\n  </section>\n\n  <footer class=\"status-bar\">\n    <div class=\"status-left\">\n      <span class=\"status-state\">\n        <span class=\"state-dot {indexStatus.state === 'Indexing' ? 'indexing' : indexStatus.state === 'Error' ? 'error' : 'ready'}\"></span>\n        {#if indexStatus.state === 'Indexing'}\n          Indexing{#if lastReadyCount > 0} ({Math.min(99, Math.round((scanned / lastReadyCount) * 100))}%){/if}{#if indexingElapsed} Â· {indexingElapsed}{/if}\n          {#if !indexStatus.isCatchup}\n            Â· {scanned.toLocaleString()} scanned\n          {/if}\n        {:else}\n          Index: {indexStatus.state}\n        {/if}\n      </span>\n      <span>{indexStatus.entriesCount.toLocaleString()} entries</span>\n      {#if indexingFinishedAt && indexStatus.state !== 'Indexing'}\n        <span>in {indexingFinishedAt}</span>\n      {/if}\n      {#if dbLatencyMs !== null && dbLastQuery}\n        <span>\"{dbLastQuery}\" {dbLatencyMs}ms Â· {totalResults} results</span>\n      {/if}\n      {#if searchModeLabel === 'spotlight' || searchModeLabel === 'spotlight_timeout'}\n        <span class=\"status-spotlight\">Spotlight fallback{#if searchModeLabel === 'spotlight_timeout'} (partial){/if}</span>\n      {/if}\n      {#if indexStatus.permissionErrors > 0}\n        <span class=\"status-warning\">{indexStatus.permissionErrors.toLocaleString()} permission errors</span>\n      {/if}\n      {#if indexStatus.message}\n        <span class={indexStatus.isCatchup ? 'index-progress' : 'status-error'}>{indexStatus.message}</span>\n      {/if}\n    </div>\n    <div class=\"status-right\">\n      <button class=\"status-btn\" on:click={cycleTheme} title=\"Switch theme\">\n        {theme === 'dark' ? 'â˜€ Light' : 'â—‘ Dark'}\n      </button>\n      <button\n        class=\"status-btn rebuild-btn\"\n        on:click={resetIndex}\n        disabled={indexStatus.state === 'Indexing'}\n        title={indexStatus.state === 'Indexing' ? 'Cannot reset while indexing is in progress.' : 'Reset and rebuild the index.'}\n      >\n        <svg class=\"rebuild-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <path d=\"M23 4v6h-6\"/><path d=\"M20.49 15a9 9 0 1 1-2.12-9.36L23 10\"/>\n        </svg>\n        Rebuild Index\n      </button>\n    </div>\n  </footer>\n\n  {#if editing.active}\n    <div\n      class=\"rename-overlay\"\n      style=\"top:{renameOverlay.top}px; left:{renameOverlay.left}px; width:{renameOverlay.width}px;\"\n      role=\"presentation\"\n      on:mousedown|stopPropagation\n    >\n      <textarea\n        bind:this={renameInputEl}\n        class=\"rename-textarea\"\n        bind:value={editing.draftName}\n        on:input={autoResizeRenameInput}\n        on:click|stopPropagation\n        on:blur={commitRename}\n      />\n    </div>\n  {/if}\n\n  {#if contextMenu.visible}\n    <div class=\"context-menu\" style={`left:${contextMenu.x}px;top:${contextMenu.y}px;`}>\n      <button on:click={() => (closeContextMenu(), openSelected())}>Open</button>\n      <button on:click={async () => { closeContextMenu(); const e = primaryEntry(); if (e) await invoke('quick_look', { path: e.path }); }}>Quick Look</button>\n      <button on:click={() => (closeContextMenu(), openWithFallback())}>Open With... (Reveal in Finder)</button>\n      <button on:click={() => (closeContextMenu(), revealSelected())}>Reveal in Finder</button>\n      <button on:click={() => (closeContextMenu(), copySelectedPaths())}>Copy Path</button>\n      <button on:click={() => (closeContextMenu(), trashSelected())}>Move to Trash</button>\n      {#if selectedIndices.size === 1}\n        <button on:click={() => (closeContextMenu(), startRename())}>Rename</button>\n      {/if}\n    </div>\n  {/if}\n\n  {#if toast}\n    <div class=\"toast\">{toast}</div>\n  {/if}\n</div>\n\n<style>\n  :global(:root) {\n    color-scheme: light dark;\n    --bg-app: transparent;\n    --text-primary: #0d1826;\n    --text-muted: #48596c;\n    --bar-grad-top: rgba(255, 255, 255, 0.48);\n    --bar-grad-bottom: rgba(248, 250, 253, 0.42);\n    --surface-header: rgba(252, 252, 255, 0.40);\n    --surface: rgba(255, 255, 255, 0.22);\n    --border-soft: rgba(0, 0, 0, 0.07);\n    --border-input: rgba(0, 0, 0, 0.13);\n    --focus-ring: #6f96e6;\n    --row-border: rgba(0, 0, 0, 0.032);\n    --row-hover: rgba(0, 0, 0, 0.06);\n    --row-selected: rgba(0, 0, 0, 0.12);\n    --button-bg: rgba(255, 255, 255, 0.62);\n    --button-border: rgba(0, 0, 0, 0.10);\n    --button-text: #2c3e50;\n    --menu-bg: rgba(240, 241, 248, 0.90);\n    --menu-border: rgba(0, 0, 0, 0.06);\n    --menu-hover: rgba(255, 255, 255, 0.62);\n    --menu-text: #1a2a38;\n    --error-text: #b64545;\n    --warning-text: #8f6500;\n    --toast-bg: rgba(18, 22, 32, 0.90);\n    --toast-text: #ffffff;\n  }\n\n  @media (prefers-color-scheme: dark) {\n    :global(:root) {\n      --bg-app: transparent;\n      --text-primary: #e6e6ea;\n      --text-muted: #9494a4;\n      --bar-grad-top: rgba(38, 38, 46, 0.52);\n      --bar-grad-bottom: rgba(30, 30, 38, 0.46);\n      --surface-header: rgba(32, 32, 40, 0.46);\n      --surface: rgba(18, 18, 26, 0.32);\n      --border-soft: rgba(255, 255, 255, 0.065);\n      --border-input: rgba(255, 255, 255, 0.14);\n      --focus-ring: #5b8bd9;\n      --row-border: rgba(255, 255, 255, 0.026);\n      --row-hover: rgba(255, 255, 255, 0.08);\n      --row-selected: rgba(255, 255, 255, 0.14);\n      --button-bg: rgba(255, 255, 255, 0.072);\n      --button-border: rgba(255, 255, 255, 0.11);\n      --button-text: #d6d6e0;\n      --menu-bg: rgba(36, 36, 46, 0.90);\n      --menu-border: rgba(255, 255, 255, 0.066);\n      --menu-hover: rgba(255, 255, 255, 0.062);\n      --menu-text: #e0e0e8;\n      --error-text: #ff9d9d;\n      --warning-text: #e0c670;\n      --toast-bg: rgba(10, 10, 16, 0.93);\n      --toast-text: #f2f2f6;\n    }\n  }\n\n  /* â”€â”€ Theme: Dark â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme=\"dark\"]) {\n    color-scheme: dark;\n    --bg-app: #1E1E21;\n    --text-primary: #E2E8F0;\n    --text-muted: #94A3B8;\n    --bar-grad-top: #1E1E21;\n    --bar-grad-bottom: #1E1E21;\n    --surface-header: #1E1E21;\n    --surface: #1E1E21;\n    --bg-input: #161618;\n    --border-soft: #2A2A2D;\n    --border-input: rgba(255, 255, 255, 0.06);\n    --focus-ring: #4DA8FF;\n    --accent: #4DA8FF;\n    --row-border: rgba(255, 255, 255, 0.02);\n    --row-hover: #282828;\n    --row-selected: rgba(77, 168, 255, 0.10);\n    --button-bg: rgba(255, 255, 255, 0.05);\n    --button-border: #2A2A2D;\n    --button-text: #94A3B8;\n    --menu-bg: #252528;\n    --menu-border: #2A2A2D;\n    --menu-hover: rgba(255, 255, 255, 0.04);\n    --menu-text: #E2E8F0;\n    --error-text: #ff9d9d;\n    --warning-text: #e0c670;\n    --toast-bg: rgba(10, 10, 16, 0.93);\n    --toast-text: #f2f2f6;\n  }\n\n  /* â”€â”€ Theme: Light â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme=\"light\"]) {\n    color-scheme: light;\n    --bg-app: #F5F5F7;\n    --text-primary: #1C1C1E;\n    --text-muted: #6E6E7A;\n    --bar-grad-top: #F5F5F7;\n    --bar-grad-bottom: #F5F5F7;\n    --surface-header: #F5F5F7;\n    --surface: #F5F5F7;\n    --bg-input: #FFFFFF;\n    --border-soft: #D1D1D6;\n    --border-input: rgba(0, 0, 0, 0.10);\n    --focus-ring: #3A8BF5;\n    --accent: #3A8BF5;\n    --row-border: rgba(0, 0, 0, 0.04);\n    --row-hover: rgba(0, 0, 0, 0.04);\n    --row-selected: rgba(58, 139, 245, 0.10);\n    --button-bg: #FFFFFF;\n    --button-border: #D1D1D6;\n    --button-text: #3C3C43;\n    --menu-bg: #FFFFFF;\n    --menu-border: #D1D1D6;\n    --menu-hover: rgba(0, 0, 0, 0.05);\n    --menu-text: #1C1C1E;\n    --error-text: #D93025;\n    --warning-text: #B45309;\n    --toast-bg: rgba(255, 255, 255, 0.95);\n    --toast-text: #1C1C1E;\n  }\n\n  /* â”€â”€ Themed element overrides â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme]) {\n    background: var(--bg-app);\n  }\n\n  /* Search bar: flat, no gradient, no separator */\n  :global([data-theme]) .search-bar {\n    height: 44px;\n    padding: 0 16px;\n    background: var(--bg-app);\n    border-bottom: none;\n  }\n\n  :global([data-theme]) .search-input {\n    backdrop-filter: none;\n    -webkit-backdrop-filter: none;\n    font-family: 'JetBrains Mono', 'SF Mono', monospace;\n    font-size: 12px;\n    height: 34px;\n    border-radius: 8px;\n  }\n\n  /* Table header: flat bg, 16px edge padding */\n  :global([data-theme]) .table-header {\n    background: var(--bg-app);\n  }\n\n  :global([data-theme]) .col-button {\n    padding: 0 8px;\n  }\n\n  :global([data-theme]) .col.name .col-button {\n    padding-left: 16px;\n  }\n\n  /* Row cells: JetBrains Mono, 16px outer edges */\n  :global([data-theme]) .cell {\n    font-family: 'JetBrains Mono', monospace;\n  }\n\n  :global([data-theme]) .cell.name {\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    padding-left: 16px;\n    font-size: 12px;\n    color: var(--text-primary);\n  }\n\n  :global([data-theme]) .cell.path {\n    font-size: 11px;\n  }\n\n  :global([data-theme]) .cell.size {\n    font-size: 11px;\n  }\n\n  :global([data-theme]) .cell.modified {\n    padding-right: 16px;\n    font-size: 11px;\n    white-space: nowrap;\n  }\n\n  :global([data-theme]) .row.selected {\n    box-shadow: inset 3px 0 0 var(--accent);\n  }\n\n  /* Dim path/size/date cells in themed mode */\n  :global([data-theme]) .cell.path,\n  :global([data-theme]) .cell.size,\n  :global([data-theme]) .cell.modified {\n    color: var(--text-muted);\n  }\n\n  :global(:root) {\n    background: transparent;\n  }\n\n  :global(html, body) {\n    margin: 0;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n    background: transparent;\n    color: var(--text-primary);\n    font-family: Inter, 'SF Pro Text', 'Segoe UI', Helvetica, Arial, sans-serif;\n  }\n\n  :global(#app) {\n    width: 100%;\n    height: 100%;\n  }\n\n  .app-shell {\n    display: grid;\n    grid-template-rows: auto auto 1fr auto;\n    height: 100%;\n    min-width: 0;\n  }\n\n  .title-bar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 44px;\n    padding: 0 16px;\n    background: var(--surface-header);\n    cursor: default;\n    flex-shrink: 0;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-left {\n    width: 72px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-center {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-right {\n    width: 72px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-icon {\n    width: 14px;\n    height: 14px;\n    fill: var(--accent);\n    flex-shrink: 0;\n  }\n\n  .title-text {\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--text-primary);\n    letter-spacing: -0.01em;\n  }\n\n  .search-bar {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 8px;\n    background: linear-gradient(180deg, var(--bar-grad-top) 0%, var(--bar-grad-bottom) 100%);\n    border-bottom: 1px solid var(--border-soft);\n    min-width: 0;\n    flex-shrink: 0;\n  }\n\n  .search-input {\n    display: block;\n    box-sizing: border-box;\n    width: 100%;\n    min-width: 0;\n    flex: 1 1 auto;\n    height: 36px;\n    border: 1px solid var(--border-input);\n    border-radius: 14px;\n    padding: 0 10px;\n    font-size: 14px;\n    background: var(--bg-input, var(--surface));\n    color: var(--text-primary);\n    backdrop-filter: blur(12px) saturate(160%);\n    -webkit-backdrop-filter: blur(12px) saturate(160%);\n  }\n\n  .search-input::placeholder {\n    color: var(--text-muted);\n    opacity: 0.85;\n    font-size: 12px;\n  }\n\n  .search-input:focus {\n    outline: none;\n    border-color: var(--focus-ring);\n    box-shadow: 0 0 0 2px rgba(125, 169, 255, 0.25);\n  }\n\n  .table-area {\n    display: grid;\n    grid-template-rows: auto 1fr;\n    min-height: 0;\n    min-width: 0;\n  }\n\n  .table-header-track,\n  .row {\n    display: grid;\n    grid-template-columns: var(--col-name) var(--col-path) var(--col-size) var(--col-modified);\n    align-items: center;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .table-header {\n    height: 32px;\n    border-bottom: 1px solid var(--border-soft);\n    background: var(--surface-header);\n    user-select: none;\n    overflow: hidden;\n    flex-shrink: 0;\n  }\n\n  .table-header-track {\n    height: 100%;\n    transform: translateX(var(--header-offset, 0px));\n    will-change: transform;\n  }\n\n  .table-header .col {\n    position: relative;\n    min-width: 0;\n    height: 100%;\n  }\n\n  .col-button {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: flex-start;\n    gap: 4px;\n    box-sizing: border-box;\n    padding: 0 8px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 11px;\n    font-weight: 600;\n    line-height: 1;\n    color: var(--text-muted);\n    text-align: left;\n    margin: 0;\n    border: none;\n    background: transparent;\n    cursor: pointer;\n  }\n\n  .sort-icon {\n    width: 10px;\n    height: 10px;\n    flex-shrink: 0;\n    color: var(--accent);\n  }\n\n  .col-resizer {\n    position: absolute;\n    top: 0;\n    right: -4px;\n    width: 8px;\n    height: 100%;\n    border: none;\n    padding: 0;\n    background: transparent;\n    cursor: col-resize;\n    z-index: 30;\n  }\n\n  .col-resizer::after {\n    content: '';\n    position: absolute;\n    top: 7px;\n    bottom: 7px;\n    left: 50%;\n    width: 1px;\n    transform: translateX(-50%);\n    background: var(--border-soft);\n    opacity: 0;\n    transition: opacity 0.15s ease;\n  }\n\n  .table-header .col:hover .col-resizer::after,\n  .col-resizer.active::after {\n    opacity: 1;\n  }\n\n  .table-body {\n    overflow: auto;\n    min-height: 0;\n    min-width: 0;\n    background: var(--surface);\n  }\n\n  .spacer {\n    position: relative;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .rows {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .row {\n    height: 30px;\n    border-bottom: 1px solid var(--row-border);\n    cursor: default;\n    -webkit-user-select: none;\n    user-select: none;\n    outline: none;\n  }\n\n  .row:hover {\n    background: var(--row-hover);\n  }\n\n  .row.selected {\n    background: var(--row-selected);\n  }\n\n  .cell {\n    padding: 0 8px;\n    font-size: 12px;\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    min-width: 0;\n  }\n\n  .cell.size {\n    text-align: right;\n    font-variant-numeric: tabular-nums;\n  }\n\n  .ellipsis {\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n\n  .hl {\n    background: none;\n    color: inherit;\n    font-weight: 700;\n  }\n\n  .file-icon {\n    width: 16px;\n    height: 16px;\n    flex: 0 0 auto;\n  }\n\n  .name-editing {\n    opacity: 0.25;\n  }\n\n  .rename-overlay {\n    position: fixed;\n    z-index: 100;\n    min-width: 120px;\n  }\n\n  .rename-textarea {\n    display: block;\n    width: 100%;\n    box-sizing: border-box;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 12px;\n    line-height: 18px;\n    padding: 5px 4px 5px 0;\n    border: 1.5px solid var(--focus-ring);\n    border-radius: 4px;\n    background: var(--bg-input, var(--surface));\n    color: var(--text-primary);\n    outline: none;\n    resize: none;\n    overflow: hidden;\n    box-shadow: 0 2px 14px rgba(0, 0, 0, 0.22), 0 0 0 3px rgba(77, 168, 255, 0.13);\n  }\n\n  .status-bar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 32px;\n    padding: 0 16px;\n    background: var(--surface-header);\n    border-top: 1px solid var(--border-soft);\n    font-family: 'JetBrains Mono', monospace;\n    font-size: 11px;\n    color: var(--text-muted);\n    white-space: nowrap;\n    overflow: hidden;\n    min-width: 0;\n    flex-shrink: 0;\n  }\n\n  .status-left {\n    display: flex;\n    align-items: center;\n    gap: 16px;\n    overflow: hidden;\n    min-width: 0;\n  }\n\n  .status-right {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    flex-shrink: 0;\n  }\n\n  .status-btn {\n    border: 1px solid var(--button-border);\n    border-radius: 5px;\n    background: var(--button-bg);\n    color: var(--button-text);\n    font-size: 11px;\n    height: 22px;\n    padding: 0 8px;\n    cursor: pointer;\n  }\n\n  .status-btn:hover {\n    filter: brightness(1.06);\n  }\n\n  .status-btn:disabled {\n    opacity: 0.55;\n    cursor: not-allowed;\n    filter: none;\n  }\n\n  .status-state {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n  }\n\n  .state-dot {\n    width: 6px;\n    height: 6px;\n    border-radius: 50%;\n    flex-shrink: 0;\n  }\n\n  .state-dot.ready { background: #28C840; }\n  .state-dot.indexing { background: #FEBC2E; }\n  .state-dot.error { background: #FF5F57; }\n\n  .rebuild-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 10px;\n    font-weight: 500;\n    background: var(--button-bg);\n    border: 1px solid var(--button-border);\n    border-radius: 4px;\n    color: var(--button-text);\n    height: 22px;\n    padding: 0 10px;\n    cursor: pointer;\n  }\n\n  .rebuild-btn:hover {\n    filter: brightness(1.1);\n  }\n\n  .rebuild-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    filter: none;\n  }\n\n  .rebuild-icon {\n    width: 11px;\n    height: 11px;\n    color: var(--accent);\n    flex-shrink: 0;\n  }\n\n  .status-error {\n    color: var(--error-text);\n  }\n\n  .status-warning {\n    color: var(--warning-text);\n  }\n\n  .status-spotlight {\n    color: #f59e0b;\n    font-weight: 600;\n  }\n\n  .context-menu {\n    position: fixed;\n    z-index: 200;\n    width: 220px;\n    border: 1px solid var(--menu-border);\n    border-radius: 10px;\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.16), inset 0 0 0 0.5px rgba(255, 255, 255, 0.18);\n    background: var(--menu-bg);\n    backdrop-filter: blur(28px) saturate(180%);\n    -webkit-backdrop-filter: blur(28px) saturate(180%);\n    overflow: hidden;\n  }\n\n  .context-menu button {\n    width: 100%;\n    text-align: left;\n    border: none;\n    background: transparent;\n    padding: 8px 10px;\n    font-size: 12px;\n    color: var(--menu-text);\n  }\n\n  .context-menu button:hover {\n    background: var(--menu-hover);\n  }\n\n  .toast {\n    position: fixed;\n    right: 14px;\n    bottom: 18px;\n    background: var(--toast-bg);\n    color: var(--toast-text);\n    border-radius: 10px;\n    padding: 9px 12px;\n    font-size: 12px;\n    z-index: 250;\n    backdrop-filter: blur(20px) saturate(180%);\n    -webkit-backdrop-filter: blur(20px) saturate(180%);\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);\n  }\n</style>\n","structuredPatch":[{"oldStart":1470,"oldLines":7,"newStart":1470,"newLines":7,"lines":[" ","         <div class=\"col path\">","           <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('dir')}>","-            Path{#if sortBy === 'dir'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}","+            Path{#if sortBy === 'dir'}{@html sortIconHtml(sortDir)}{/if}","           </button>","           <button","             type=\"button\""]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"5c81ebff-1bd8-4271-ba47-7aff2ad2b2de"}
{"parentUuid":"ce88a12a-2ca0-4805-9f25-bdfaf85f040b","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01DctzV9JDeAoDWdU5LrjnB5","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01YbSYCid7paDwRdnCiMz3Rq","name":"Edit","input":{"replace_all":false,"file_path":"/Users/al02402336/everything/src/App.svelte","old_string":"            Size{#if sortBy === 'size'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}","new_string":"            Size{#if sortBy === 'size'}{@html sortIconHtml(sortDir)}{/if}"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":316,"cache_read_input_tokens":100521,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":316},"output_tokens":24,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPQwv6fqHvxeUuizshh","type":"assistant","uuid":"b7d7c7c8-fd3d-4c82-bcc4-2400059f6ce5","timestamp":"2026-02-21T14:40:03.207Z"}
{"parentUuid":"b7d7c7c8-fd3d-4c82-bcc4-2400059f6ce5","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01YbSYCid7paDwRdnCiMz3Rq","toolUseID":"toolu_01YbSYCid7paDwRdnCiMz3Rq","timestamp":"2026-02-21T14:40:03.214Z","uuid":"4b3f482d-dd8c-40db-890e-ec7743962038"}
{"parentUuid":"b7d7c7c8-fd3d-4c82-bcc4-2400059f6ce5","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01YbSYCid7paDwRdnCiMz3Rq","type":"tool_result","content":"The file /Users/al02402336/everything/src/App.svelte has been updated successfully."}]},"uuid":"c6a00b27-07ce-46c8-b66a-a3d3b0295ad3","timestamp":"2026-02-21T14:40:03.213Z","toolUseResult":{"filePath":"/Users/al02402336/everything/src/App.svelte","oldString":"            Size{#if sortBy === 'size'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}","newString":"            Size{#if sortBy === 'size'}{@html sortIconHtml(sortDir)}{/if}","originalFile":"<script>\n  import { onDestroy, onMount, tick } from 'svelte';\n  import { invoke } from '@tauri-apps/api/core';\n  import { listen } from '@tauri-apps/api/event';\n  import { getCurrentWindow } from '@tauri-apps/api/window';\n  import { startDrag } from '@crabnebula/tauri-plugin-drag';\n\n  const rowHeight = 30;\n  const PAGE_SIZE = 500;\n  let homePrefix = '';\n  const COL_WIDTHS_KEY = 'REDACTED';\n  const THEME_KEY = 'everything-theme';\n  const columnKeys = ['name', 'path', 'size', 'modified'];\n  const minColumnWidth = {\n    name: 180,\n    path: 240,\n    size: 75,\n    modified: 150\n  };\n  const defaultColumnRatios = {\n    name: 0.3,\n    path: 0.45,\n    size: 0.1\n  };\n\n  const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n  let theme = (() => { try { return localStorage.getItem(THEME_KEY) || systemTheme; } catch { return systemTheme; } })();\n  function cycleTheme() {\n    theme = theme === 'dark' ? 'light' : 'dark';\n    try { localStorage.setItem(THEME_KEY, theme); } catch {}\n    invoke('set_native_theme', { theme });\n  }\n\n  function sortIconHtml(dir) {\n    const d = dir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5';\n    return `<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"${d}\"/></svg>`;\n  }\n\n  let query = '';\n  let results = [];\n  let totalResults = 0;\n  let totalResultsKnown = false;\n\n  let dbLatencyMs = null;\n  let dbLastQuery = '';\n  let searchModeLabel = '';\n  let selectedIndices = new Set();\n  let selectionAnchor = -1;\n  let lastSelectedIndex = -1;\n  let editing = {\n    active: false,\n    path: '',\n    index: -1,\n    draftName: ''\n  };\n\n  let renameOverlay = { top: 0, left: 0, width: 0 };\n\n  let indexStatus = {\n    state: 'Indexing',\n    entriesCount: 0,\n    lastUpdated: null,\n    permissionErrors: 0,\n    message: null,\n    isCatchup: false\n  };\n\n  let indexingStartTime = null;\n  let indexingElapsed = '';\n  let indexingFinishedAt = '';\n\n  let sortBy = 'name';\n  let sortDir = 'asc';\n\n  let hasMore = true;\n  let loadingMore = false;\n  let searchGeneration = 0;\n\n  let scanned = 0;\n\n  let searchInputEl;\n  let renameInputEl;\n  let tableAreaEl;\n  let tableContainer;\n  let tableResizeObserver = null;\n  let viewportResizeRaf = null;\n  let scrollTop = 0;\n  let headerScrollLeft = 0;\n  let viewportHeight = 520;\n  let lastTableWidth = 0;\n  let resizingColumn = '';\n  let resizeCleanup = null;\n  let colWidths = {\n    name: 250,\n    path: 350,\n    size: 75,\n    modified: 150\n  };\n\n  let contextMenu = {\n    visible: false,\n    x: 0,\n    y: 0\n  };\n\n  let platform = '';\n  let toast = '';\n  let searchTimer;\n  let lastSearchFiredAt = 0;\n  let toastTimer;\n  let statusRefreshTimer;\n  let elapsedTimer;\n  let statusRefreshInFlight = false;\n  let lastReadyCount = 0;\n\n  const iconCache = new Map();\n  const iconLoading = new Set();\n\n  let highlightCache = new Map();\n  let highlightCacheQuery = '';\n\n  const folderFallbackIcon =\n    \"data:image/svg+xml;utf8,\" +\n    encodeURIComponent(\n      `<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><rect x='1' y='4' width='14' height='10' rx='2' fill='#d9b34f'/><rect x='1' y='2' width='6' height='4' rx='1' fill='#e6ca7a'/></svg>`\n    );\n  const fileFallbackIcon =\n    \"data:image/svg+xml;utf8,\" +\n    encodeURIComponent(\n      `<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><rect x='3' y='1' width='10' height='14' rx='1.5' fill='#b4bec9'/><rect x='5' y='5' width='6' height='1.2' fill='#8d98a5'/><rect x='5' y='8' width='6' height='1.2' fill='#8d98a5'/></svg>`\n    );\n\n  $: totalHeight = results.length * rowHeight;\n  $: startIndex = Math.max(0, Math.floor(scrollTop / rowHeight) - 10);\n  $: visibleCount = Math.ceil(viewportHeight / rowHeight) + 20;\n  $: endIndex = Math.min(results.length, startIndex + visibleCount);\n  $: visibleRows = results.slice(startIndex, endIndex);\n  $: translateY = startIndex * rowHeight;\n  $: tableMinWidth = colWidths.name + colWidths.path + colWidths.size + colWidths.modified;\n  $: tableGridStyle = `--col-name:${colWidths.name}px;--col-path:${colWidths.path}px;--col-size:${colWidths.size}px;--col-modified:${colWidths.modified}px;--table-min-width:${tableMinWidth}px;--header-offset:${-headerScrollLeft}px;`;\n\n  $: {\n    for (const entry of visibleRows) {\n      void ensureIcon(entry);\n    }\n  }\n\n  function showToast(message) {\n    toast = message;\n    clearTimeout(toastTimer);\n    toastTimer = setTimeout(() => {\n      toast = '';\n    }, 3000);\n  }\n\n  function bytesToBase64(bytes) {\n    let binary = '';\n    const chunk = 0x8000;\n    for (let i = 0; i < bytes.length; i += chunk) {\n      const part = bytes.subarray(i, i + chunk);\n      binary += String.fromCharCode(...part);\n    }\n    return btoa(binary);\n  }\n\n  function highlightSegments(name, q) {\n    q = (q || '').trim();\n    if (!q) return [{ text: name, hl: false }];\n\n    // Reset cache when query changes\n    if (q !== highlightCacheQuery) {\n      highlightCache = new Map();\n      highlightCacheQuery = q;\n    }\n\n    // Check cache\n    const cached = highlightCache.get(name);\n    if (cached) return cached;\n\n    if (q.includes('/')) q = q.slice(q.lastIndexOf('/') + 1);\n    q = q.replace(/[*?]/g, '');\n    const terms = q.split(/\\s+/).filter(Boolean);\n    if (terms.length === 0) return [{ text: name, hl: false }];\n\n    const lower = name.toLowerCase();\n    const marks = new Uint8Array(name.length);\n    for (const t of terms) {\n      const tl = t.toLowerCase();\n      let idx = lower.indexOf(tl);\n      while (idx !== -1) {\n        for (let i = idx; i < idx + tl.length; i++) marks[i] = 1;\n        idx = lower.indexOf(tl, idx + 1);\n      }\n    }\n\n    const segs = [];\n    let i = 0;\n    while (i < name.length) {\n      const m = marks[i];\n      let j = i + 1;\n      while (j < name.length && marks[j] === m) j++;\n      segs.push({ text: name.slice(i, j), hl: m === 1 });\n      i = j;\n    }\n\n    highlightCache.set(name, segs);\n    return segs;\n  }\n\n  const perFileIconExts = new Set(['exe', 'lnk', 'ico', 'url', 'scr', 'appx']);\n\n  function iconKey(entry) {\n    if (entry.isDir) return '__folder__';\n    const ext = (entry.ext || '').toLowerCase();\n    if (perFileIconExts.has(ext)) return entry.path;\n    return ext || '__file__';\n  }\n\n  function iconFor(entry) {\n    return iconCache.get(iconKey(entry)) || (entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n  }\n\n  async function ensureIcon(entry) {\n    const key = iconKey(entry);\n    if (iconCache.has(key) || iconLoading.has(key)) {\n      return;\n    }\n\n    iconLoading.add(key);\n    try {\n      const bytes = await invoke('get_file_icon', {\n        path: entry.path,\n        ext: entry.isDir ? 'folder' : entry.ext || '',\n      });\n      if (Array.isArray(bytes) && bytes.length > 0) {\n        const image = `data:image/png;base64,${bytesToBase64(Uint8Array.from(bytes))}`;\n        iconCache.set(key, image);\n      } else {\n        iconCache.set(key, entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n      }\n    } catch {\n      iconCache.set(key, entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n    } finally {\n      iconLoading.delete(key);\n    }\n  }\n\n  function syncColumnWidthsToContainer() {\n    const width = tableContainer?.clientWidth || tableAreaEl?.clientWidth;\n    if (!width || lastTableWidth !== 0) {\n      return;\n    }\n\n    const saved = loadColWidths();\n    if (saved) {\n      const total = columnKeys.reduce((s, k) => s + saved[k], 0);\n      if (Math.abs(total - width) > 2) {\n        const scale = (width - saved.modified) / (total - saved.modified);\n        let scaledName = Math.max(minColumnWidth.name, Math.round(saved.name * scale));\n        let scaledSize = Math.max(minColumnWidth.size, Math.round(saved.size * scale));\n        let rawPath = width - saved.modified - scaledName - scaledSize;\n        if (rawPath < minColumnWidth.path) {\n          const shortfall = minColumnWidth.path - rawPath;\n          const nameReduction = Math.min(shortfall, scaledName - minColumnWidth.name);\n          scaledName -= nameReduction;\n          const remaining = shortfall - nameReduction;\n          if (remaining > 0) {\n            scaledSize -= Math.min(remaining, scaledSize - minColumnWidth.size);\n          }\n          rawPath = width - saved.modified - scaledName - scaledSize;\n        }\n        const scaledPath = Math.max(minColumnWidth.path, rawPath);\n        colWidths = { name: scaledName, path: scaledPath, size: scaledSize, modified: saved.modified };\n      } else {\n        colWidths = saved;\n      }\n    } else {\n      const fixedModified = minColumnWidth.modified;\n      const rest = width - fixedModified;\n      const ratioSum = defaultColumnRatios.name + defaultColumnRatios.path + defaultColumnRatios.size;\n      colWidths = {\n        name: Math.max(minColumnWidth.name, Math.round(rest * defaultColumnRatios.name / ratioSum)),\n        path: Math.max(minColumnWidth.path, Math.round(rest * defaultColumnRatios.path / ratioSum)),\n        size: Math.max(minColumnWidth.size, Math.round(rest * defaultColumnRatios.size / ratioSum)),\n        modified: fixedModified\n      };\n    }\n    lastTableWidth = width;\n  }\n\n  function loadColWidths() {\n    try {\n      const raw = localStorage.getItem(COL_WIDTHS_KEY);\n      if (!raw) return null;\n      const parsed = JSON.parse(raw);\n      for (const key of columnKeys) {\n        if (typeof parsed[key] !== 'number' || parsed[key] < (minColumnWidth[key] || 0)) return null;\n      }\n      return parsed;\n    } catch {\n      return null;\n    }\n  }\n\n  function saveColWidths() {\n    localStorage.setItem(COL_WIDTHS_KEY, JSON.stringify(colWidths));\n  }\n\n  function updateViewportHeight() {\n    viewportHeight = tableContainer?.clientHeight || 520;\n    syncColumnWidthsToContainer();\n  }\n\n  function scheduleViewportHeightUpdate() {\n    if (viewportResizeRaf !== null) {\n      return;\n    }\n    viewportResizeRaf = requestAnimationFrame(() => {\n      viewportResizeRaf = null;\n      updateViewportHeight();\n    });\n  }\n\n  function startColumnResize(event, leftKey) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    const index = columnKeys.indexOf(leftKey);\n    if (index < 0 || index >= columnKeys.length - 1) {\n      return;\n    }\n\n    const startX = event.clientX;\n    const startLeft = colWidths[leftKey];\n    const rightKey = columnKeys[index + 1];\n    const startRight = colWidths[rightKey];\n\n    resizeCleanup?.();\n    resizingColumn = leftKey;\n\n    const onMove = (moveEvent) => {\n      const delta = Math.round(moveEvent.clientX - startX);\n      if (leftKey === 'name') {\n        // Two-column trade: name and path swap space, each respects its minimum\n        const nextLeft = Math.max(\n          minColumnWidth[leftKey],\n          Math.min(startLeft + delta, startLeft + startRight - minColumnWidth[rightKey])\n        );\n        const nextRight = startLeft + startRight - nextLeft;\n        colWidths = { ...colWidths, [leftKey]: nextLeft, [rightKey]: nextRight };\n      } else {\n        // path splitter: path grows unconstrained (allows horizontal scroll on right drag)\n        const nextLeft = Math.max(minColumnWidth[leftKey], startLeft + delta);\n        colWidths = { ...colWidths, [leftKey]: nextLeft };\n      }\n    };\n\n    const onUp = () => {\n      cleanup();\n    };\n\n    const cleanup = () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n      document.body.style.cursor = '';\n      document.body.style.userSelect = '';\n      resizingColumn = '';\n      saveColWidths();\n      if (resizeCleanup === cleanup) {\n        resizeCleanup = null;\n      }\n    };\n\n    resizeCleanup = cleanup;\n    document.body.style.cursor = 'col-resize';\n    document.body.style.userSelect = 'none';\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n  }\n\n  function selectedPaths() {\n    const sorted = [...selectedIndices].sort((a, b) => a - b);\n    return sorted.map((idx) => results[idx]).filter(Boolean).map((entry) => entry.path);\n  }\n\n  function clearSelection() {\n    selectedIndices = new Set();\n    selectionAnchor = -1;\n    lastSelectedIndex = -1;\n  }\n\n  function selectSingle(index) {\n    selectedIndices = new Set([index]);\n    selectionAnchor = index;\n    lastSelectedIndex = index;\n  }\n\n  function selectToggle(index) {\n    const next = new Set(selectedIndices);\n    if (next.has(index)) {\n      next.delete(index);\n    } else {\n      next.add(index);\n    }\n    selectedIndices = next;\n    selectionAnchor = index;\n    lastSelectedIndex = index;\n  }\n\n  function selectRange(index) {\n    const anchor = selectionAnchor >= 0 ? selectionAnchor : index;\n    const [from, to] = [Math.min(anchor, index), Math.max(anchor, index)];\n    const next = new Set();\n    for (let i = from; i <= to; i += 1) {\n      next.add(i);\n    }\n    selectedIndices = next;\n    lastSelectedIndex = index;\n  }\n\n  function primaryEntry() {\n    const idx = lastSelectedIndex >= 0 ? lastSelectedIndex : -1;\n    return idx >= 0 ? results[idx] : null;\n  }\n\n  async function refreshStatus() {\n    if (statusRefreshInFlight) {\n      return;\n    }\n    statusRefreshInFlight = true;\n    try {\n      const status = await invoke('get_index_status');\n      const prevState = indexStatus.state;\n      indexStatus = {\n        state: status.state,\n        entriesCount: status.entriesCount,\n        lastUpdated: status.lastUpdated,\n        permissionErrors: status.permissionErrors ?? 0,\n        message: status.message\n      };\n      if (status.state === 'Indexing' && prevState !== 'Indexing') {\n        startElapsedTimer();\n      } else if (status.state !== 'Indexing' && prevState === 'Indexing') {\n        stopElapsedTimer();\n      }\n      if (typeof status.scanned === 'number') {\n        scanned = status.scanned;\n      }\n      if (status.state === 'Ready' && prevState !== 'Ready') {\n        scheduleSearch();\n      }\n    } catch (err) {\n      showToast(`Failed to get status: ${String(err)}`);\n    } finally {\n      statusRefreshInFlight = false;\n    }\n  }\n\n  function scheduleSearch(preserveScroll = false) {\n    searchGeneration += 1;\n    const scheduledGen = searchGeneration;\n    clearTimeout(searchTimer);\n\n    const now = performance.now();\n    if (now - lastSearchFiredAt >= 200) {\n      // Leading edge: fire immediately if enough time has passed\n      lastSearchFiredAt = now;\n      void runSearch(preserveScroll);\n    } else {\n      // Trailing edge: debounce\n      searchTimer = setTimeout(() => {\n        if (scheduledGen !== searchGeneration) {\n          return;\n        }\n        lastSearchFiredAt = performance.now();\n        void runSearch(preserveScroll);\n      }, 200);\n    }\n  }\n\n  async function runSearch(preserveScroll = false) {\n    searchGeneration += 1;\n    const gen = searchGeneration;\n    const searchQuery = query;\n    const searchSortBy = sortBy;\n    const searchSortDir = sortDir;\n    const startedAt = performance.now();\n    try {\n      const keepPaths = new Set(selectedPaths());\n      const next = await invoke('search', {\n        query: searchQuery,\n        limit: PAGE_SIZE,\n        offset: 0,\n        sortBy: searchSortBy,\n        sortDir: searchSortDir\n      });\n\n      if (gen !== searchGeneration) return;\n\n      dbLatencyMs = Math.round(performance.now() - startedAt);\n      dbLastQuery = searchQuery;\n      const entries = Array.isArray(next.entries) ? next.entries : [];\n      searchModeLabel = next.modeLabel || '';\n      results = entries;\n      if (next.totalCount > 0) {\n        totalResults = next.totalCount;\n        totalResultsKnown = true;\n      } else {\n        totalResults = entries.length;\n        totalResultsKnown = false;\n      }\n      hasMore = totalResultsKnown ? results.length < totalResults : entries.length >= PAGE_SIZE;\n      if (!preserveScroll && tableContainer) tableContainer.scrollTop = 0;\n\n      const restored = new Set();\n      for (let i = 0; i < results.length; i += 1) {\n        if (keepPaths.has(results[i].path)) {\n          restored.add(i);\n        }\n      }\n      selectedIndices = restored;\n\n      updateViewportHeight();\n    } catch (err) {\n      if (gen !== searchGeneration) return;\n      showToast(`Search failed: ${String(err)}`);\n    }\n  }\n\n  async function loadMore() {\n    if (!hasMore || loadingMore) return;\n    const gen = searchGeneration;\n    loadingMore = true;\n    try {\n      const batch = await invoke('search', {\n        query,\n        limit: PAGE_SIZE,\n        offset: results.length,\n        sortBy: sortBy,\n        sortDir: sortDir\n      });\n      if (gen !== searchGeneration) return;\n      const arr = Array.isArray(batch.entries) ? batch.entries : [];\n      if (arr.length > 0) results = [...results, ...arr];\n      hasMore = totalResultsKnown ? results.length < totalResults : arr.length >= PAGE_SIZE;\n    } catch (err) {\n      showToast(`Failed to load more: ${String(err)}`);\n    } finally {\n      loadingMore = false;\n    }\n  }\n\n  function moveSelection(delta, withRange = false) {\n    if (results.length === 0) {\n      return;\n    }\n\n    const current = lastSelectedIndex >= 0 ? lastSelectedIndex : 0;\n    const next = Math.max(0, Math.min(results.length - 1, current + delta));\n\n    if (withRange) {\n      selectRange(next);\n    } else {\n      selectSingle(next);\n    }\n\n    const top = next * rowHeight;\n    const bottom = top + rowHeight;\n    if (top < scrollTop) {\n      tableContainer.scrollTop = top;\n    } else if (bottom > scrollTop + viewportHeight) {\n      tableContainer.scrollTop = bottom - viewportHeight;\n    }\n  }\n\n  function handleHeaderSort(column) {\n    if (sortBy === column) {\n      sortDir = sortDir === 'asc' ? 'desc' : 'asc';\n    } else {\n      sortBy = column;\n      sortDir = 'asc';\n    }\n    if (tableContainer) tableContainer.scrollTop = 0;\n    void runSearch();\n  }\n\n  function handleRowClick(event, index) {\n    contextMenu.visible = false;\n\n    if (event.shiftKey) {\n      selectRange(index);\n      return;\n    }\n\n    if (event.metaKey || event.ctrlKey) {\n      selectToggle(index);\n      return;\n    }\n\n    selectSingle(index);\n  }\n\n  function handleRowContextMenu(event, index) {\n    event.preventDefault();\n\n    if (!selectedIndices.has(index)) {\n      selectSingle(index);\n    }\n\n    if (platform === 'windows' || platform === 'macos') {\n      contextMenu.visible = false;\n      const paths = selectedPaths();\n      if (paths.length > 0) {\n        invoke('show_context_menu', {\n          paths,\n          x: event.clientX,\n          y: event.clientY,\n          singleSelection: selectedIndices.size === 1\n        });\n      }\n      return;\n    }\n\n    contextMenu = {\n      visible: true,\n      x: event.clientX,\n      y: event.clientY\n    };\n  }\n\n  function handleRowA11yKeydown(event, index) {\n    if (event.key === ' ' || event.key === 'Enter') {\n      event.preventDefault();\n      handleRowClick(event, index);\n    }\n  }\n\n  const DRAG_THRESHOLD = 5;\n  let dragCleanup = null;\n  const dragImgCache = new Map();\n\n  function dragPathsForIndex(index) {\n    const entry = results[index];\n    if (!entry) {\n      return [];\n    }\n\n    if (selectedIndices.has(index) && selectedIndices.size > 0) {\n      return selectedPaths();\n    }\n\n    return [entry.path];\n  }\n\n  function getDragIconEl(entry) {\n    const src = iconFor(entry);\n    let img = dragImgCache.get(src);\n    if (!img) {\n      img = new Image();\n      img.src = src;\n      dragImgCache.set(src, img);\n    }\n    return img.complete && img.naturalWidth > 0 ? img : null;\n  }\n\n  function fillRoundRect(ctx, x, y, w, h, r) {\n    ctx.beginPath();\n    ctx.moveTo(x + r, y);\n    ctx.arcTo(x + w, y, x + w, y + h, r);\n    ctx.arcTo(x + w, y + h, x, y + h, r);\n    ctx.arcTo(x, y + h, x, y, r);\n    ctx.arcTo(x, y, x + w, y, r);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  function buildDragPreview(index) {\n    const entry = results[index];\n    if (!entry) return null;\n\n    const count = selectedIndices.has(index) ? selectedIndices.size : 1;\n    const isDark = theme === 'dark';\n\n    const w = 260;\n    const h = 28;\n    const stackGap = count > 1 ? 4 : 0;\n\n    const canvas = document.createElement('canvas');\n    canvas.width = w;\n    canvas.height = h + stackGap;\n    const ctx = canvas.getContext('2d');\n\n    if (count > 1) {\n      ctx.globalAlpha = 0.35;\n      ctx.fillStyle = isDark ? '#5a6070' : '#b0c4de';\n      fillRoundRect(ctx, 3, 0, w - 3, h, 5);\n      ctx.globalAlpha = 1.0;\n    }\n\n    const ry = stackGap;\n    ctx.fillStyle = isDark ? 'rgba(58, 64, 74, 0.94)' : 'rgba(214, 231, 255, 0.94)';\n    fillRoundRect(ctx, 0, ry, w, h, 5);\n\n    ctx.strokeStyle = isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';\n    ctx.lineWidth = 0.5;\n    ctx.beginPath();\n    ctx.moveTo(5, ry);\n    ctx.arcTo(w, ry, w, ry + h, 5);\n    ctx.arcTo(w, ry + h, 0, ry + h, 5);\n    ctx.arcTo(0, ry + h, 0, ry, 5);\n    ctx.arcTo(0, ry, w, ry, 5);\n    ctx.closePath();\n    ctx.stroke();\n\n    const iconEl = getDragIconEl(entry);\n    if (iconEl) {\n      ctx.drawImage(iconEl, 6, ry + 6, 16, 16);\n    } else {\n      ctx.fillStyle = entry.isDir ? '#d9b34f' : '#8d98a5';\n      fillRoundRect(ctx, 6, ry + 6, 16, 16, 2);\n    }\n\n    ctx.fillStyle = isDark ? '#e6e6e8' : '#1a1a1a';\n    ctx.font = '12px -apple-system, \"SF Pro Text\", system-ui, sans-serif';\n    ctx.textBaseline = 'middle';\n\n    let nameMaxW = w - 34;\n    if (count > 1) nameMaxW -= 34;\n\n    let name = entry.name;\n    if (ctx.measureText(name).width > nameMaxW) {\n      while (name.length > 4 && ctx.measureText(name + '\\u2026').width > nameMaxW) {\n        name = name.slice(0, -1);\n      }\n      name += '\\u2026';\n    }\n    ctx.fillText(name, 28, ry + h / 2 + 1);\n\n    if (count > 1) {\n      const badge = String(count);\n      ctx.font = 'bold 10px -apple-system, system-ui, sans-serif';\n      const tw = ctx.measureText(badge).width;\n      const bw = Math.max(20, tw + 10);\n      const bx = w - bw - 6;\n      const by = ry + (h - 18) / 2;\n\n      ctx.fillStyle = isDark ? '#5b8bd9' : '#007aff';\n      fillRoundRect(ctx, bx, by, bw, 18, 9);\n\n      ctx.fillStyle = '#ffffff';\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(badge, bx + bw / 2, by + 9);\n    }\n\n    return canvas.toDataURL('image/png');\n  }\n\n  function handleRowMouseDown(event, index) {\n    if (event.button !== 0) return;\n    if (event.metaKey || event.ctrlKey || event.shiftKey) return;\n    if (editing.active) return;\n\n    const startX = event.clientX;\n    const startY = event.clientY;\n    let dragging = false;\n\n    dragCleanup?.();\n\n    const onMove = (e) => {\n      if (dragging) return;\n      const dx = e.clientX - startX;\n      const dy = e.clientY - startY;\n      if (dx * dx + dy * dy < DRAG_THRESHOLD * DRAG_THRESHOLD) return;\n\n      dragging = true;\n      cleanup();\n\n      if (!selectedIndices.has(index)) {\n        selectSingle(index);\n      }\n\n      const paths = dragPathsForIndex(index);\n      if (paths.length > 0) {\n        const icon = buildDragPreview(index);\n        startDrag({ item: paths, icon }).catch(() => {});\n      }\n    };\n\n    const onUp = () => cleanup();\n\n    const cleanup = () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n      if (dragCleanup === cleanup) dragCleanup = null;\n    };\n\n    dragCleanup = cleanup;\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n  }\n\n  async function handleRowDoubleClick(index) {\n    if (!selectedIndices.has(index) || selectedIndices.size > 1) {\n      selectSingle(index);\n      await tick();\n    }\n    await invoke('open', { paths: [results[index].path] }).catch((err) => {\n      showToast(`Failed to open: ${String(err)}`);\n    });\n  }\n\n  function closeContextMenu() {\n    contextMenu = {\n      ...contextMenu,\n      visible: false\n    };\n  }\n\n  async function openSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('open', { paths });\n    } catch (err) {\n      showToast(`Failed to open: ${String(err)}`);\n    }\n  }\n\n  async function openWithFallback() {\n    const target = primaryEntry();\n    if (!target) {\n      return;\n    }\n\n    try {\n      await invoke('open_with', { path: target.path });\n    } catch (err) {\n      showToast(`Open With failed: ${String(err)}`);\n    }\n  }\n\n  async function revealSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('reveal_in_finder', { paths });\n    } catch (err) {\n      showToast(`Failed to reveal in Finder: ${String(err)}`);\n    }\n  }\n\n  async function copySelectedPaths() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('copy_paths', { paths });\n      showToast(`Copied ${paths.length} path(s)`);\n    } catch (err) {\n      showToast(`Failed to copy path: ${String(err)}`);\n    }\n  }\n\n  async function copyFiles() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('copy_files', { paths });\n      showToast(`Copied ${paths.length} item(s)`);\n    } catch (err) {\n      showToast(`Failed to copy: ${String(err)}`);\n    }\n  }\n\n  async function trashSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    const message =\n      paths.length === 1\n        ? 'Move selected item to Trash?'\n        : `Move ${paths.length} items to Trash?`;\n\n    if (!window.confirm(message)) {\n      return;\n    }\n\n    try {\n      await invoke('move_to_trash', { paths });\n      showToast('Moved to Trash.');\n      clearSelection();\n      await runSearch();\n    } catch (err) {\n      showToast(`Failed to move to Trash: ${String(err)}`);\n    }\n  }\n\n  async function resetIndex() {\n    if (indexStatus.state === 'Indexing') {\n      showToast('Indexing in progress. Please try again after it completes.');\n      return;\n    }\n\n    results = [];\n    totalResults = 0;\n    totalResultsKnown = false;\n    clearSelection();\n    scanned = 0;\n    dbLatencyMs = null;\n    dbLastQuery = '';\n    indexStatus = { ...indexStatus, state: 'Indexing', entriesCount: 0, message: null };\n    indexingStartTime = Date.now();\n    indexingElapsed = '';\n    indexingFinishedAt = '';\n\n    try {\n      await invoke('reset_index');\n    } catch (err) {\n      showToast(`Failed to reset index: ${String(err)}`);\n      await refreshStatus();\n    }\n  }\n\n  function isMultiSelected() {\n    return selectedIndices.size > 1;\n  }\n\n  function autoResizeRenameInput() {\n    if (!renameInputEl) return;\n    renameInputEl.style.height = '0';\n    renameInputEl.style.height = renameInputEl.scrollHeight + 'px';\n  }\n\n  async function startRename() {\n    if (isMultiSelected()) {\n      return;\n    }\n\n    const idx = lastSelectedIndex;\n    if (idx < 0 || !results[idx]) {\n      return;\n    }\n\n    const entry = results[idx];\n\n    // Calculate overlay position mathematically.\n    // Name cell text starts at: padding-left(16) + icon(16) + gap(6) = 38px from cell left.\n    // Textarea has padding-left: 0 and border: 1.5px, so text starts ~2px from overlay left.\n    if (tableContainer) {\n      const rect = tableContainer.getBoundingClientRect();\n      const cellLeft = rect.left - tableContainer.scrollLeft;\n      const textLeft = cellLeft + 38;\n      const cellRight = cellLeft + colWidths.name;\n      const rowTop = rect.top + idx * rowHeight - tableContainer.scrollTop;\n      renameOverlay = {\n        top: rowTop,\n        left: textLeft - 2,\n        width: cellRight - textLeft + 2 - 4\n      };\n    }\n\n    editing = {\n      active: true,\n      path: entry.path,\n      index: idx,\n      draftName: entry.name\n    };\n\n    await tick();\n\n    if (renameInputEl) {\n      autoResizeRenameInput();\n      renameInputEl.focus();\n      const extPos = !entry.isDir ? entry.name.lastIndexOf('.') : -1;\n      const selectionEnd = extPos > 0 ? extPos : entry.name.length;\n      renameInputEl.setSelectionRange(0, selectionEnd);\n    }\n  }\n\n  function cancelRename() {\n    editing = {\n      active: false,\n      path: '',\n      index: -1,\n      draftName: ''\n    };\n  }\n\n  async function commitRename() {\n    if (!editing.active || editing.index < 0 || !results[editing.index]) {\n      return;\n    }\n\n    const current = results[editing.index];\n    const nextName = editing.draftName;\n\n    try {\n      await invoke('rename', {\n        path: current.path,\n        newName: nextName\n      });\n      cancelRename();\n      await runSearch();\n    } catch (err) {\n      showToast(`Failed to rename: ${String(err)}`);\n      await tick();\n      renameInputEl?.focus();\n    }\n  }\n\n  function onGlobalClick() {\n    closeContextMenu();\n  }\n\n  function onTitleBarMouseDown(event) {\n    if (event.button !== 0) {\n      return;\n    }\n\n    const activeElement = document.activeElement;\n    if (activeElement instanceof HTMLElement && isTextInputTarget(activeElement)) {\n      activeElement.blur();\n    }\n  }\n\n  async function focusSearch() {\n    await getCurrentWindow().show();\n    await getCurrentWindow().setFocus();\n    searchInputEl?.focus();\n    searchInputEl?.select();\n  }\n\n  function isTextInputTarget(target) {\n    return (\n      target instanceof HTMLInputElement ||\n      target instanceof HTMLTextAreaElement ||\n      target?.isContentEditable\n    );\n  }\n\n  async function handleKeydown(event) {\n    const isMetaSelectAll = (event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'a';\n    const isMetaCopy = (event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'c';\n    const target = event.target;\n    const isTextInput = isTextInputTarget(target);\n\n    if (isMetaCopy && isTextInput) {\n      return;\n    }\n\n    if (isMetaSelectAll) {\n      if (isTextInput) {\n        event.preventDefault();\n        if (target instanceof HTMLInputElement || target instanceof HTMLTextAreaElement) {\n          target.select();\n        }\n        return;\n      }\n    }\n\n    if (editing.active) {\n      if (event.key === 'Enter') {\n        event.preventDefault();\n        await commitRename();\n        return;\n      }\n\n      if (event.key === 'Escape') {\n        event.preventDefault();\n        const idx = editing.index;\n        cancelRename();\n        selectSingle(idx);\n        await tick();\n        tableContainer?.querySelector('.row.selected')?.focus();\n        return;\n      }\n      return;\n    }\n\n    if (event.key === 'Escape') {\n      event.preventDefault();\n      clearSelection();\n      return;\n    }\n\n    if (event.key === 'ArrowDown') {\n      event.preventDefault();\n      moveSelection(1, event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'ArrowUp') {\n      event.preventDefault();\n      moveSelection(-1, event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'PageDown') {\n      event.preventDefault();\n      moveSelection(Math.floor(viewportHeight / rowHeight), event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'PageUp') {\n      event.preventDefault();\n      moveSelection(-Math.floor(viewportHeight / rowHeight), event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'Enter') {\n      event.preventDefault();\n      if (platform === 'windows') {\n        await openSelected();\n      } else {\n        await startRename();\n      }\n      return;\n    }\n\n    if (event.key === 'F2') {\n      event.preventDefault();\n      await startRename();\n      return;\n    }\n\n    if (event.key === ' ' && !isTextInput) {\n      event.preventDefault();\n      const entry = primaryEntry();\n      if (entry) {\n        await invoke('quick_look', { path: entry.path });\n      }\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'f') {\n      event.preventDefault();\n      clearSelection();\n      searchInputEl?.focus();\n      searchInputEl?.select();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'o') {\n      event.preventDefault();\n      await openSelected();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key === 'Enter') {\n      event.preventDefault();\n      await revealSelected();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'c') {\n      event.preventDefault();\n      await copySelectedPaths();\n      return;\n    }\n\n    if (isMetaSelectAll) {\n      event.preventDefault();\n      selectedIndices = new Set(Array.from({ length: results.length }, (_, i) => i));\n      return;\n    }\n\n    if (event.key === 'Delete' || ((event.metaKey || event.ctrlKey) && event.key === 'Backspace')) {\n      if (!isTextInput) {\n        event.preventDefault();\n        await trashSelected();\n      }\n      return;\n    }\n  }\n\n  function formatSize(entry) {\n    if (entry.isDir || entry.size == null) return '';\n    const bytes = entry.size;\n    if (bytes < 1024) return `${bytes} B`;\n    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n    if (bytes < 1024 * 1024 * 1024) return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n    return `${(bytes / (1024 * 1024 * 1024)).toFixed(1)} GB`;\n  }\n\n  function formatModified(entry) {\n    if (!entry.mtime) {\n      return '';\n    }\n\n    const d = new Date(entry.mtime * 1000);\n    const pad = (n) => String(n).padStart(2, '0');\n    return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;\n  }\n\n  function formatLastUpdated(timestamp) {\n    if (!timestamp) {\n      return '-';\n    }\n\n    return new Date(timestamp * 1000).toLocaleString();\n  }\n\n  function formatElapsed(ms) {\n    const totalSec = Math.floor(ms / 1000);\n    const min = Math.floor(totalSec / 60);\n    const sec = totalSec % 60;\n    return min > 0 ? `${min}m ${sec}s` : `${sec}s`;\n  }\n\n  function updateElapsed() {\n    if (indexingStartTime && indexStatus.state === 'Indexing') {\n      indexingElapsed = formatElapsed(Date.now() - indexingStartTime);\n    }\n  }\n\n  function startElapsedTimer() {\n    clearInterval(elapsedTimer);\n    indexingStartTime = Date.now();\n    indexingElapsed = '0s';\n    indexingFinishedAt = '';\n    elapsedTimer = setInterval(updateElapsed, 1000);\n  }\n\n  function stopElapsedTimer() {\n    clearInterval(elapsedTimer);\n    if (indexingStartTime) {\n      const elapsed = Date.now() - indexingStartTime;\n      indexingFinishedAt = `${formatElapsed(elapsed)}`;\n    }\n    indexingStartTime = null;\n    indexingElapsed = '';\n  }\n\n  function displayPath(path) {\n    if (!path) {\n      return path;\n    }\n\n    if (!homePrefix) {\n      return path;\n    }\n\n    if (path === homePrefix) {\n      return '~';\n    }\n\n    if (path.startsWith(`${homePrefix}/`)) {\n      return `~${path.slice(homePrefix.length)}`;\n    }\n\n    return path;\n  }\n\n  let unlistenFns = [];\n\n  onMount(async () => {\n    const t0 = performance.now();\n    const ms = () => Math.round(performance.now() - t0);\n    const DEBUG_STARTUP = false;\n    const flog = DEBUG_STARTUP ? (msg) => invoke('frontend_log', { msg }).catch(() => {}) : () => {};\n\n    flog(`[startup/fe] onMount entered`);\n\n    updateViewportHeight();\n    flog(`[startup/fe] +${ms()}ms updateViewportHeight done`);\n\n    invoke('set_native_theme', { theme });\n\n    platform = await invoke('get_platform');\n    flog(`[startup/fe] +${ms()}ms get_platform done`);\n\n    const unlistenProgress = await listen('index_progress', (event) => {\n      scanned = event.payload.scanned;\n      if (indexStatus.state !== 'Indexing') {\n        indexStatus = {\n          ...indexStatus,\n          state: 'Indexing'\n        };\n      }\n    });\n    flog(`[startup/fe] +${ms()}ms listen(index_progress) registered`);\n\n    const unlistenState = await listen('index_state', (event) => {\n      flog(`[startup/fe] index_state event received: ${event.payload.state} at +${ms()}ms`);\n      const prevState = indexStatus.state;\n      indexStatus = {\n        ...indexStatus,\n        state: event.payload.state,\n        message: event.payload.message ?? null,\n        isCatchup: event.payload.isCatchup ?? false\n      };\n\n      if (event.payload.state === 'Indexing' && prevState !== 'Indexing') {\n        if (prevState === 'Ready') {\n          lastReadyCount = indexStatus.entriesCount;\n        }\n        startElapsedTimer();\n      } else if (event.payload.state !== 'Indexing' && prevState === 'Indexing') {\n        stopElapsedTimer();\n      }\n\n      if (event.payload.state === 'Ready') {\n        scheduleSearch();\n      }\n    });\n    flog(`[startup/fe] +${ms()}ms listen(index_state) registered`);\n\n    const unlistenUpdated = await listen('index_updated', (event) => {\n      indexStatus = {\n        ...indexStatus,\n        entriesCount: event.payload.entriesCount,\n        lastUpdated: event.payload.lastUpdated,\n        permissionErrors: event.payload.permissionErrors ?? indexStatus.permissionErrors\n      };\n\n      scheduleSearch(true);\n    });\n\n    const unlistenFocus = await listen('focus_search', () => {\n      void focusSearch();\n    });\n\n    const unlistenCtxMenuAction = await listen('context_menu_action', (event) => {\n      switch (event.payload) {\n        case 'open': void openSelected(); break;\n        case 'quick_look': {\n          const e = primaryEntry();\n          if (e) void invoke('quick_look', { path: e.path });\n          break;\n        }\n        case 'open_with': void openWithFallback(); break;\n        case 'reveal': void revealSelected(); break;\n        case 'copy_files': void copyFiles(); break;\n        case 'copy_path': void copySelectedPaths(); break;\n        case 'trash': void trashSelected(); break;\n        case 'rename': void startRename(); break;\n      }\n    });\n\n    unlistenFns = [unlistenProgress, unlistenState, unlistenUpdated, unlistenFocus, unlistenCtxMenuAction];\n    flog(`[startup/fe] +${ms()}ms all listeners registered`);\n\n    // Fetch backend state IMMEDIATELY after listeners are registered.\n    // Events emitted before listener registration are lost, so this\n    // is the only reliable way to get the current state.\n    await refreshStatus();\n    flog(`[startup/fe] +${ms()}ms refreshStatus done (state=${indexStatus.state})`);\n\n    // Show Svelte UI: remove skeleton, focus search input.\n    await tick();\n    document.getElementById('skeleton')?.remove();\n    await focusSearch();\n    flog(`[startup/fe] +${ms()}ms WINDOW VISIBLE â€” skeleton removed`);\n\n    try {\n      homePrefix = await invoke('get_home_dir');\n    } catch {\n      homePrefix = '';\n    }\n    flog(`[startup/fe] +${ms()}ms get_home_dir done`);\n\n    if (!localStorage.getItem('everything-fda-notice-v1')) {\n      showToast('macOS Full Disk Access permission may be required for full disk search.');\n      localStorage.setItem('everything-fda-notice-v1', '1');\n    }\n    flog(`[startup/fe] +${ms()}ms calling runSearch...`);\n    await runSearch();\n    flog(`[startup/fe] +${ms()}ms runSearch done`);\n\n    if (typeof ResizeObserver !== 'undefined') {\n      tableResizeObserver = new ResizeObserver(() => {\n        scheduleViewportHeightUpdate();\n      });\n      if (tableContainer) {\n        tableResizeObserver.observe(tableContainer);\n      } else if (tableAreaEl) {\n        tableResizeObserver.observe(tableAreaEl);\n      }\n    }\n\n    window.addEventListener('resize', scheduleViewportHeightUpdate);\n    window.addEventListener('click', onGlobalClick);\n    statusRefreshTimer = setInterval(() => {\n      if (indexStatus.state === 'Indexing') {\n        void refreshStatus();\n      }\n    }, 1000);\n    console.log(`[startup/fe] +${ms()}ms onMount complete`);\n  });\n\n  onDestroy(async () => {\n    clearTimeout(searchTimer);\n    clearTimeout(toastTimer);\n    clearInterval(statusRefreshTimer);\n    clearInterval(elapsedTimer);\n    resizeCleanup?.();\n\n    for (const unlisten of unlistenFns) {\n      unlisten();\n    }\n\n    tableResizeObserver?.disconnect();\n    tableResizeObserver = null;\n    if (viewportResizeRaf !== null) {\n      cancelAnimationFrame(viewportResizeRaf);\n      viewportResizeRaf = null;\n    }\n    window.removeEventListener('resize', scheduleViewportHeightUpdate);\n    window.removeEventListener('click', onGlobalClick);\n  });\n</script>\n\n<svelte:window on:keydown={handleKeydown} />\n\n<div class=\"app-shell\" data-theme={theme}>\n  <div class=\"title-bar\" role=\"presentation\" data-tauri-drag-region on:mousedown={onTitleBarMouseDown}>\n    <div class=\"title-left\"></div>\n    <div class=\"title-center\">\n      <svg class=\"title-icon\" viewBox=\"0 0 215 205\" fill-rule=\"evenodd\" aria-hidden=\"true\">\n        <path d=\"M85 0c46.9 0 85 38.1 85 85 0 20.1-7.2 38.5-19.2 52.7l40.7 40.8c5.8 5.8 5.8 15.2 0 21-5.8 5.8-15.2 5.8-21 0l-40.7-40.7c-13.6 9.7-30.4 15.2-44.8 15.2-46.9 0-85-42.1-85-89 0-46.9 38.1-85 85-85z m0 32c-29.3 0-53 23.7-53 53 0 29.3 23.7 53 53 53 29.3 0 53-23.7 53-53 0-29.3-23.7-53-53-53z\"/>\n      </svg>\n      <span class=\"title-text\">Everything</span>\n    </div>\n    <div class=\"title-right\"></div>\n  </div>\n\n  <header class=\"search-bar\">\n    <input\n      bind:this={searchInputEl}\n      class=\"search-input\"\n      type=\"text\"\n      bind:value={query}\n      on:input={scheduleSearch}\n      on:focus={clearSelection}\n      placeholder=\"Search file/folder names\"\n      autocomplete=\"off\"\n      spellcheck=\"false\"\n    />\n  </header>\n\n  <section class=\"table-area\" bind:this={tableAreaEl} style={tableGridStyle}>\n    <div class=\"table-header\">\n      <div class=\"table-header-track\">\n        <div class=\"col name\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('name')}>\n            Name{#if sortBy === 'name'}{@html sortIconHtml(sortDir)}{/if}\n          </button>\n          <button\n            type=\"button\"\n            class=\"col-resizer\"\n            class:active={resizingColumn === 'name'}\n            on:mousedown={(event) => startColumnResize(event, 'name')}\n            aria-label=\"Resize Name column\"\n          />\n        </div>\n\n        <div class=\"col path\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('dir')}>\n            Path{#if sortBy === 'dir'}{@html sortIconHtml(sortDir)}{/if}\n          </button>\n          <button\n            type=\"button\"\n            class=\"col-resizer\"\n            class:active={resizingColumn === 'path'}\n            on:mousedown={(event) => startColumnResize(event, 'path')}\n            aria-label=\"Resize Path column\"\n          />\n        </div>\n\n        <div class=\"col size\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('size')}>\n            Size{#if sortBy === 'size'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n        </div>\n\n        <div class=\"col modified\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('mtime')}>\n            Modified{#if sortBy === 'mtime'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <div\n      class=\"table-body\"\n      bind:this={tableContainer}\n      on:scroll={() => {\n        scrollTop = tableContainer.scrollTop;\n        headerScrollLeft = tableContainer.scrollLeft;\n        if (editing.active) void commitRename();\n        const scrollBottom = scrollTop + tableContainer.clientHeight;\n        if (scrollBottom >= totalHeight - rowHeight * 10) {\n          void loadMore();\n        }\n      }}\n    >\n      <div class=\"spacer\" style={`height:${totalHeight}px`}>\n        <div class=\"rows\" style={`transform: translateY(${translateY}px);`}>\n          {#each visibleRows as entry, localIndex}\n            {@const index = startIndex + localIndex}\n            <div\n              class=\"row {selectedIndices.has(index) ? 'selected' : ''}\"\n              on:mousedown={(event) => handleRowMouseDown(event, index)}\n              on:click={(event) => handleRowClick(event, index)}\n              on:keydown={(event) => handleRowA11yKeydown(event, index)}\n              on:dblclick={() => handleRowDoubleClick(index)}\n              on:contextmenu={(event) => handleRowContextMenu(event, index)}\n              role=\"row\"\n              tabindex=\"0\"\n            >\n              <div class=\"cell name\">\n                <img class=\"file-icon\" src={iconFor(entry)} alt=\"\" />\n                <span class=\"ellipsis\" class:name-editing={editing.active && editing.index === index}>{#each highlightSegments(entry.name, query) as seg}{#if seg.hl}<mark class=\"hl\">{seg.text}</mark>{:else}{seg.text}{/if}{/each}</span>\n              </div>\n              <div class=\"cell path\"><span class=\"ellipsis\">{displayPath(entry.dir)}</span></div>\n              <div class=\"cell size\">{formatSize(entry)}</div>\n              <div class=\"cell modified\">{formatModified(entry)}</div>\n            </div>\n          {/each}\n        </div>\n      </div>\n    </div>\n  </section>\n\n  <footer class=\"status-bar\">\n    <div class=\"status-left\">\n      <span class=\"status-state\">\n        <span class=\"state-dot {indexStatus.state === 'Indexing' ? 'indexing' : indexStatus.state === 'Error' ? 'error' : 'ready'}\"></span>\n        {#if indexStatus.state === 'Indexing'}\n          Indexing{#if lastReadyCount > 0} ({Math.min(99, Math.round((scanned / lastReadyCount) * 100))}%){/if}{#if indexingElapsed} Â· {indexingElapsed}{/if}\n          {#if !indexStatus.isCatchup}\n            Â· {scanned.toLocaleString()} scanned\n          {/if}\n        {:else}\n          Index: {indexStatus.state}\n        {/if}\n      </span>\n      <span>{indexStatus.entriesCount.toLocaleString()} entries</span>\n      {#if indexingFinishedAt && indexStatus.state !== 'Indexing'}\n        <span>in {indexingFinishedAt}</span>\n      {/if}\n      {#if dbLatencyMs !== null && dbLastQuery}\n        <span>\"{dbLastQuery}\" {dbLatencyMs}ms Â· {totalResults} results</span>\n      {/if}\n      {#if searchModeLabel === 'spotlight' || searchModeLabel === 'spotlight_timeout'}\n        <span class=\"status-spotlight\">Spotlight fallback{#if searchModeLabel === 'spotlight_timeout'} (partial){/if}</span>\n      {/if}\n      {#if indexStatus.permissionErrors > 0}\n        <span class=\"status-warning\">{indexStatus.permissionErrors.toLocaleString()} permission errors</span>\n      {/if}\n      {#if indexStatus.message}\n        <span class={indexStatus.isCatchup ? 'index-progress' : 'status-error'}>{indexStatus.message}</span>\n      {/if}\n    </div>\n    <div class=\"status-right\">\n      <button class=\"status-btn\" on:click={cycleTheme} title=\"Switch theme\">\n        {theme === 'dark' ? 'â˜€ Light' : 'â—‘ Dark'}\n      </button>\n      <button\n        class=\"status-btn rebuild-btn\"\n        on:click={resetIndex}\n        disabled={indexStatus.state === 'Indexing'}\n        title={indexStatus.state === 'Indexing' ? 'Cannot reset while indexing is in progress.' : 'Reset and rebuild the index.'}\n      >\n        <svg class=\"rebuild-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <path d=\"M23 4v6h-6\"/><path d=\"M20.49 15a9 9 0 1 1-2.12-9.36L23 10\"/>\n        </svg>\n        Rebuild Index\n      </button>\n    </div>\n  </footer>\n\n  {#if editing.active}\n    <div\n      class=\"rename-overlay\"\n      style=\"top:{renameOverlay.top}px; left:{renameOverlay.left}px; width:{renameOverlay.width}px;\"\n      role=\"presentation\"\n      on:mousedown|stopPropagation\n    >\n      <textarea\n        bind:this={renameInputEl}\n        class=\"rename-textarea\"\n        bind:value={editing.draftName}\n        on:input={autoResizeRenameInput}\n        on:click|stopPropagation\n        on:blur={commitRename}\n      />\n    </div>\n  {/if}\n\n  {#if contextMenu.visible}\n    <div class=\"context-menu\" style={`left:${contextMenu.x}px;top:${contextMenu.y}px;`}>\n      <button on:click={() => (closeContextMenu(), openSelected())}>Open</button>\n      <button on:click={async () => { closeContextMenu(); const e = primaryEntry(); if (e) await invoke('quick_look', { path: e.path }); }}>Quick Look</button>\n      <button on:click={() => (closeContextMenu(), openWithFallback())}>Open With... (Reveal in Finder)</button>\n      <button on:click={() => (closeContextMenu(), revealSelected())}>Reveal in Finder</button>\n      <button on:click={() => (closeContextMenu(), copySelectedPaths())}>Copy Path</button>\n      <button on:click={() => (closeContextMenu(), trashSelected())}>Move to Trash</button>\n      {#if selectedIndices.size === 1}\n        <button on:click={() => (closeContextMenu(), startRename())}>Rename</button>\n      {/if}\n    </div>\n  {/if}\n\n  {#if toast}\n    <div class=\"toast\">{toast}</div>\n  {/if}\n</div>\n\n<style>\n  :global(:root) {\n    color-scheme: light dark;\n    --bg-app: transparent;\n    --text-primary: #0d1826;\n    --text-muted: #48596c;\n    --bar-grad-top: rgba(255, 255, 255, 0.48);\n    --bar-grad-bottom: rgba(248, 250, 253, 0.42);\n    --surface-header: rgba(252, 252, 255, 0.40);\n    --surface: rgba(255, 255, 255, 0.22);\n    --border-soft: rgba(0, 0, 0, 0.07);\n    --border-input: rgba(0, 0, 0, 0.13);\n    --focus-ring: #6f96e6;\n    --row-border: rgba(0, 0, 0, 0.032);\n    --row-hover: rgba(0, 0, 0, 0.06);\n    --row-selected: rgba(0, 0, 0, 0.12);\n    --button-bg: rgba(255, 255, 255, 0.62);\n    --button-border: rgba(0, 0, 0, 0.10);\n    --button-text: #2c3e50;\n    --menu-bg: rgba(240, 241, 248, 0.90);\n    --menu-border: rgba(0, 0, 0, 0.06);\n    --menu-hover: rgba(255, 255, 255, 0.62);\n    --menu-text: #1a2a38;\n    --error-text: #b64545;\n    --warning-text: #8f6500;\n    --toast-bg: rgba(18, 22, 32, 0.90);\n    --toast-text: #ffffff;\n  }\n\n  @media (prefers-color-scheme: dark) {\n    :global(:root) {\n      --bg-app: transparent;\n      --text-primary: #e6e6ea;\n      --text-muted: #9494a4;\n      --bar-grad-top: rgba(38, 38, 46, 0.52);\n      --bar-grad-bottom: rgba(30, 30, 38, 0.46);\n      --surface-header: rgba(32, 32, 40, 0.46);\n      --surface: rgba(18, 18, 26, 0.32);\n      --border-soft: rgba(255, 255, 255, 0.065);\n      --border-input: rgba(255, 255, 255, 0.14);\n      --focus-ring: #5b8bd9;\n      --row-border: rgba(255, 255, 255, 0.026);\n      --row-hover: rgba(255, 255, 255, 0.08);\n      --row-selected: rgba(255, 255, 255, 0.14);\n      --button-bg: rgba(255, 255, 255, 0.072);\n      --button-border: rgba(255, 255, 255, 0.11);\n      --button-text: #d6d6e0;\n      --menu-bg: rgba(36, 36, 46, 0.90);\n      --menu-border: rgba(255, 255, 255, 0.066);\n      --menu-hover: rgba(255, 255, 255, 0.062);\n      --menu-text: #e0e0e8;\n      --error-text: #ff9d9d;\n      --warning-text: #e0c670;\n      --toast-bg: rgba(10, 10, 16, 0.93);\n      --toast-text: #f2f2f6;\n    }\n  }\n\n  /* â”€â”€ Theme: Dark â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme=\"dark\"]) {\n    color-scheme: dark;\n    --bg-app: #1E1E21;\n    --text-primary: #E2E8F0;\n    --text-muted: #94A3B8;\n    --bar-grad-top: #1E1E21;\n    --bar-grad-bottom: #1E1E21;\n    --surface-header: #1E1E21;\n    --surface: #1E1E21;\n    --bg-input: #161618;\n    --border-soft: #2A2A2D;\n    --border-input: rgba(255, 255, 255, 0.06);\n    --focus-ring: #4DA8FF;\n    --accent: #4DA8FF;\n    --row-border: rgba(255, 255, 255, 0.02);\n    --row-hover: #282828;\n    --row-selected: rgba(77, 168, 255, 0.10);\n    --button-bg: rgba(255, 255, 255, 0.05);\n    --button-border: #2A2A2D;\n    --button-text: #94A3B8;\n    --menu-bg: #252528;\n    --menu-border: #2A2A2D;\n    --menu-hover: rgba(255, 255, 255, 0.04);\n    --menu-text: #E2E8F0;\n    --error-text: #ff9d9d;\n    --warning-text: #e0c670;\n    --toast-bg: rgba(10, 10, 16, 0.93);\n    --toast-text: #f2f2f6;\n  }\n\n  /* â”€â”€ Theme: Light â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme=\"light\"]) {\n    color-scheme: light;\n    --bg-app: #F5F5F7;\n    --text-primary: #1C1C1E;\n    --text-muted: #6E6E7A;\n    --bar-grad-top: #F5F5F7;\n    --bar-grad-bottom: #F5F5F7;\n    --surface-header: #F5F5F7;\n    --surface: #F5F5F7;\n    --bg-input: #FFFFFF;\n    --border-soft: #D1D1D6;\n    --border-input: rgba(0, 0, 0, 0.10);\n    --focus-ring: #3A8BF5;\n    --accent: #3A8BF5;\n    --row-border: rgba(0, 0, 0, 0.04);\n    --row-hover: rgba(0, 0, 0, 0.04);\n    --row-selected: rgba(58, 139, 245, 0.10);\n    --button-bg: #FFFFFF;\n    --button-border: #D1D1D6;\n    --button-text: #3C3C43;\n    --menu-bg: #FFFFFF;\n    --menu-border: #D1D1D6;\n    --menu-hover: rgba(0, 0, 0, 0.05);\n    --menu-text: #1C1C1E;\n    --error-text: #D93025;\n    --warning-text: #B45309;\n    --toast-bg: rgba(255, 255, 255, 0.95);\n    --toast-text: #1C1C1E;\n  }\n\n  /* â”€â”€ Themed element overrides â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme]) {\n    background: var(--bg-app);\n  }\n\n  /* Search bar: flat, no gradient, no separator */\n  :global([data-theme]) .search-bar {\n    height: 44px;\n    padding: 0 16px;\n    background: var(--bg-app);\n    border-bottom: none;\n  }\n\n  :global([data-theme]) .search-input {\n    backdrop-filter: none;\n    -webkit-backdrop-filter: none;\n    font-family: 'JetBrains Mono', 'SF Mono', monospace;\n    font-size: 12px;\n    height: 34px;\n    border-radius: 8px;\n  }\n\n  /* Table header: flat bg, 16px edge padding */\n  :global([data-theme]) .table-header {\n    background: var(--bg-app);\n  }\n\n  :global([data-theme]) .col-button {\n    padding: 0 8px;\n  }\n\n  :global([data-theme]) .col.name .col-button {\n    padding-left: 16px;\n  }\n\n  /* Row cells: JetBrains Mono, 16px outer edges */\n  :global([data-theme]) .cell {\n    font-family: 'JetBrains Mono', monospace;\n  }\n\n  :global([data-theme]) .cell.name {\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    padding-left: 16px;\n    font-size: 12px;\n    color: var(--text-primary);\n  }\n\n  :global([data-theme]) .cell.path {\n    font-size: 11px;\n  }\n\n  :global([data-theme]) .cell.size {\n    font-size: 11px;\n  }\n\n  :global([data-theme]) .cell.modified {\n    padding-right: 16px;\n    font-size: 11px;\n    white-space: nowrap;\n  }\n\n  :global([data-theme]) .row.selected {\n    box-shadow: inset 3px 0 0 var(--accent);\n  }\n\n  /* Dim path/size/date cells in themed mode */\n  :global([data-theme]) .cell.path,\n  :global([data-theme]) .cell.size,\n  :global([data-theme]) .cell.modified {\n    color: var(--text-muted);\n  }\n\n  :global(:root) {\n    background: transparent;\n  }\n\n  :global(html, body) {\n    margin: 0;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n    background: transparent;\n    color: var(--text-primary);\n    font-family: Inter, 'SF Pro Text', 'Segoe UI', Helvetica, Arial, sans-serif;\n  }\n\n  :global(#app) {\n    width: 100%;\n    height: 100%;\n  }\n\n  .app-shell {\n    display: grid;\n    grid-template-rows: auto auto 1fr auto;\n    height: 100%;\n    min-width: 0;\n  }\n\n  .title-bar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 44px;\n    padding: 0 16px;\n    background: var(--surface-header);\n    cursor: default;\n    flex-shrink: 0;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-left {\n    width: 72px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-center {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-right {\n    width: 72px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-icon {\n    width: 14px;\n    height: 14px;\n    fill: var(--accent);\n    flex-shrink: 0;\n  }\n\n  .title-text {\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--text-primary);\n    letter-spacing: -0.01em;\n  }\n\n  .search-bar {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 8px;\n    background: linear-gradient(180deg, var(--bar-grad-top) 0%, var(--bar-grad-bottom) 100%);\n    border-bottom: 1px solid var(--border-soft);\n    min-width: 0;\n    flex-shrink: 0;\n  }\n\n  .search-input {\n    display: block;\n    box-sizing: border-box;\n    width: 100%;\n    min-width: 0;\n    flex: 1 1 auto;\n    height: 36px;\n    border: 1px solid var(--border-input);\n    border-radius: 14px;\n    padding: 0 10px;\n    font-size: 14px;\n    background: var(--bg-input, var(--surface));\n    color: var(--text-primary);\n    backdrop-filter: blur(12px) saturate(160%);\n    -webkit-backdrop-filter: blur(12px) saturate(160%);\n  }\n\n  .search-input::placeholder {\n    color: var(--text-muted);\n    opacity: 0.85;\n    font-size: 12px;\n  }\n\n  .search-input:focus {\n    outline: none;\n    border-color: var(--focus-ring);\n    box-shadow: 0 0 0 2px rgba(125, 169, 255, 0.25);\n  }\n\n  .table-area {\n    display: grid;\n    grid-template-rows: auto 1fr;\n    min-height: 0;\n    min-width: 0;\n  }\n\n  .table-header-track,\n  .row {\n    display: grid;\n    grid-template-columns: var(--col-name) var(--col-path) var(--col-size) var(--col-modified);\n    align-items: center;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .table-header {\n    height: 32px;\n    border-bottom: 1px solid var(--border-soft);\n    background: var(--surface-header);\n    user-select: none;\n    overflow: hidden;\n    flex-shrink: 0;\n  }\n\n  .table-header-track {\n    height: 100%;\n    transform: translateX(var(--header-offset, 0px));\n    will-change: transform;\n  }\n\n  .table-header .col {\n    position: relative;\n    min-width: 0;\n    height: 100%;\n  }\n\n  .col-button {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: flex-start;\n    gap: 4px;\n    box-sizing: border-box;\n    padding: 0 8px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 11px;\n    font-weight: 600;\n    line-height: 1;\n    color: var(--text-muted);\n    text-align: left;\n    margin: 0;\n    border: none;\n    background: transparent;\n    cursor: pointer;\n  }\n\n  .sort-icon {\n    width: 10px;\n    height: 10px;\n    flex-shrink: 0;\n    color: var(--accent);\n  }\n\n  .col-resizer {\n    position: absolute;\n    top: 0;\n    right: -4px;\n    width: 8px;\n    height: 100%;\n    border: none;\n    padding: 0;\n    background: transparent;\n    cursor: col-resize;\n    z-index: 30;\n  }\n\n  .col-resizer::after {\n    content: '';\n    position: absolute;\n    top: 7px;\n    bottom: 7px;\n    left: 50%;\n    width: 1px;\n    transform: translateX(-50%);\n    background: var(--border-soft);\n    opacity: 0;\n    transition: opacity 0.15s ease;\n  }\n\n  .table-header .col:hover .col-resizer::after,\n  .col-resizer.active::after {\n    opacity: 1;\n  }\n\n  .table-body {\n    overflow: auto;\n    min-height: 0;\n    min-width: 0;\n    background: var(--surface);\n  }\n\n  .spacer {\n    position: relative;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .rows {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .row {\n    height: 30px;\n    border-bottom: 1px solid var(--row-border);\n    cursor: default;\n    -webkit-user-select: none;\n    user-select: none;\n    outline: none;\n  }\n\n  .row:hover {\n    background: var(--row-hover);\n  }\n\n  .row.selected {\n    background: var(--row-selected);\n  }\n\n  .cell {\n    padding: 0 8px;\n    font-size: 12px;\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    min-width: 0;\n  }\n\n  .cell.size {\n    text-align: right;\n    font-variant-numeric: tabular-nums;\n  }\n\n  .ellipsis {\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n\n  .hl {\n    background: none;\n    color: inherit;\n    font-weight: 700;\n  }\n\n  .file-icon {\n    width: 16px;\n    height: 16px;\n    flex: 0 0 auto;\n  }\n\n  .name-editing {\n    opacity: 0.25;\n  }\n\n  .rename-overlay {\n    position: fixed;\n    z-index: 100;\n    min-width: 120px;\n  }\n\n  .rename-textarea {\n    display: block;\n    width: 100%;\n    box-sizing: border-box;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 12px;\n    line-height: 18px;\n    padding: 5px 4px 5px 0;\n    border: 1.5px solid var(--focus-ring);\n    border-radius: 4px;\n    background: var(--bg-input, var(--surface));\n    color: var(--text-primary);\n    outline: none;\n    resize: none;\n    overflow: hidden;\n    box-shadow: 0 2px 14px rgba(0, 0, 0, 0.22), 0 0 0 3px rgba(77, 168, 255, 0.13);\n  }\n\n  .status-bar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 32px;\n    padding: 0 16px;\n    background: var(--surface-header);\n    border-top: 1px solid var(--border-soft);\n    font-family: 'JetBrains Mono', monospace;\n    font-size: 11px;\n    color: var(--text-muted);\n    white-space: nowrap;\n    overflow: hidden;\n    min-width: 0;\n    flex-shrink: 0;\n  }\n\n  .status-left {\n    display: flex;\n    align-items: center;\n    gap: 16px;\n    overflow: hidden;\n    min-width: 0;\n  }\n\n  .status-right {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    flex-shrink: 0;\n  }\n\n  .status-btn {\n    border: 1px solid var(--button-border);\n    border-radius: 5px;\n    background: var(--button-bg);\n    color: var(--button-text);\n    font-size: 11px;\n    height: 22px;\n    padding: 0 8px;\n    cursor: pointer;\n  }\n\n  .status-btn:hover {\n    filter: brightness(1.06);\n  }\n\n  .status-btn:disabled {\n    opacity: 0.55;\n    cursor: not-allowed;\n    filter: none;\n  }\n\n  .status-state {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n  }\n\n  .state-dot {\n    width: 6px;\n    height: 6px;\n    border-radius: 50%;\n    flex-shrink: 0;\n  }\n\n  .state-dot.ready { background: #28C840; }\n  .state-dot.indexing { background: #FEBC2E; }\n  .state-dot.error { background: #FF5F57; }\n\n  .rebuild-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 10px;\n    font-weight: 500;\n    background: var(--button-bg);\n    border: 1px solid var(--button-border);\n    border-radius: 4px;\n    color: var(--button-text);\n    height: 22px;\n    padding: 0 10px;\n    cursor: pointer;\n  }\n\n  .rebuild-btn:hover {\n    filter: brightness(1.1);\n  }\n\n  .rebuild-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    filter: none;\n  }\n\n  .rebuild-icon {\n    width: 11px;\n    height: 11px;\n    color: var(--accent);\n    flex-shrink: 0;\n  }\n\n  .status-error {\n    color: var(--error-text);\n  }\n\n  .status-warning {\n    color: var(--warning-text);\n  }\n\n  .status-spotlight {\n    color: #f59e0b;\n    font-weight: 600;\n  }\n\n  .context-menu {\n    position: fixed;\n    z-index: 200;\n    width: 220px;\n    border: 1px solid var(--menu-border);\n    border-radius: 10px;\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.16), inset 0 0 0 0.5px rgba(255, 255, 255, 0.18);\n    background: var(--menu-bg);\n    backdrop-filter: blur(28px) saturate(180%);\n    -webkit-backdrop-filter: blur(28px) saturate(180%);\n    overflow: hidden;\n  }\n\n  .context-menu button {\n    width: 100%;\n    text-align: left;\n    border: none;\n    background: transparent;\n    padding: 8px 10px;\n    font-size: 12px;\n    color: var(--menu-text);\n  }\n\n  .context-menu button:hover {\n    background: var(--menu-hover);\n  }\n\n  .toast {\n    position: fixed;\n    right: 14px;\n    bottom: 18px;\n    background: var(--toast-bg);\n    color: var(--toast-text);\n    border-radius: 10px;\n    padding: 9px 12px;\n    font-size: 12px;\n    z-index: 250;\n    backdrop-filter: blur(20px) saturate(180%);\n    -webkit-backdrop-filter: blur(20px) saturate(180%);\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);\n  }\n</style>\n","structuredPatch":[{"oldStart":1483,"oldLines":7,"newStart":1483,"newLines":7,"lines":[" ","         <div class=\"col size\">","           <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('size')}>","-            Size{#if sortBy === 'size'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}","+            Size{#if sortBy === 'size'}{@html sortIconHtml(sortDir)}{/if}","           </button>","         </div>"," "]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"b7d7c7c8-fd3d-4c82-bcc4-2400059f6ce5"}
{"parentUuid":"c6a00b27-07ce-46c8-b66a-a3d3b0295ad3","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01RstBxzfU7jyK5CqkumZdLM","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01KN2cyeUgNd5QiRiXebftJM","name":"Edit","input":{"replace_all":false,"file_path":"/Users/al02402336/everything/src/App.svelte","old_string":"            Modified{#if sortBy === 'mtime'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}","new_string":"            Modified{#if sortBy === 'mtime'}{@html sortIconHtml(sortDir)}{/if}"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":316,"cache_read_input_tokens":100837,"output_tokens":284,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":316,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYMPRDJoiu2eJ74XRDeLv","type":"assistant","uuid":"c528aef1-eb51-495e-a665-e20a26ac3baf","timestamp":"2026-02-21T14:40:06.745Z"}
{"parentUuid":"c528aef1-eb51-495e-a665-e20a26ac3baf","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01KN2cyeUgNd5QiRiXebftJM","toolUseID":"toolu_01KN2cyeUgNd5QiRiXebftJM","timestamp":"2026-02-21T14:40:06.754Z","uuid":"3abfbe87-6f3e-4964-8a8f-d890712fec32"}
{"parentUuid":"c528aef1-eb51-495e-a665-e20a26ac3baf","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01KN2cyeUgNd5QiRiXebftJM","type":"tool_result","content":"The file /Users/al02402336/everything/src/App.svelte has been updated successfully."}]},"uuid":"9683dbd2-d5db-46e6-b74b-d95a7dc1b02f","timestamp":"2026-02-21T14:40:06.753Z","toolUseResult":{"filePath":"/Users/al02402336/everything/src/App.svelte","oldString":"            Modified{#if sortBy === 'mtime'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}","newString":"            Modified{#if sortBy === 'mtime'}{@html sortIconHtml(sortDir)}{/if}","originalFile":"<script>\n  import { onDestroy, onMount, tick } from 'svelte';\n  import { invoke } from '@tauri-apps/api/core';\n  import { listen } from '@tauri-apps/api/event';\n  import { getCurrentWindow } from '@tauri-apps/api/window';\n  import { startDrag } from '@crabnebula/tauri-plugin-drag';\n\n  const rowHeight = 30;\n  const PAGE_SIZE = 500;\n  let homePrefix = '';\n  const COL_WIDTHS_KEY = 'REDACTED';\n  const THEME_KEY = 'everything-theme';\n  const columnKeys = ['name', 'path', 'size', 'modified'];\n  const minColumnWidth = {\n    name: 180,\n    path: 240,\n    size: 75,\n    modified: 150\n  };\n  const defaultColumnRatios = {\n    name: 0.3,\n    path: 0.45,\n    size: 0.1\n  };\n\n  const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n  let theme = (() => { try { return localStorage.getItem(THEME_KEY) || systemTheme; } catch { return systemTheme; } })();\n  function cycleTheme() {\n    theme = theme === 'dark' ? 'light' : 'dark';\n    try { localStorage.setItem(THEME_KEY, theme); } catch {}\n    invoke('set_native_theme', { theme });\n  }\n\n  function sortIconHtml(dir) {\n    const d = dir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5';\n    return `<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"${d}\"/></svg>`;\n  }\n\n  let query = '';\n  let results = [];\n  let totalResults = 0;\n  let totalResultsKnown = false;\n\n  let dbLatencyMs = null;\n  let dbLastQuery = '';\n  let searchModeLabel = '';\n  let selectedIndices = new Set();\n  let selectionAnchor = -1;\n  let lastSelectedIndex = -1;\n  let editing = {\n    active: false,\n    path: '',\n    index: -1,\n    draftName: ''\n  };\n\n  let renameOverlay = { top: 0, left: 0, width: 0 };\n\n  let indexStatus = {\n    state: 'Indexing',\n    entriesCount: 0,\n    lastUpdated: null,\n    permissionErrors: 0,\n    message: null,\n    isCatchup: false\n  };\n\n  let indexingStartTime = null;\n  let indexingElapsed = '';\n  let indexingFinishedAt = '';\n\n  let sortBy = 'name';\n  let sortDir = 'asc';\n\n  let hasMore = true;\n  let loadingMore = false;\n  let searchGeneration = 0;\n\n  let scanned = 0;\n\n  let searchInputEl;\n  let renameInputEl;\n  let tableAreaEl;\n  let tableContainer;\n  let tableResizeObserver = null;\n  let viewportResizeRaf = null;\n  let scrollTop = 0;\n  let headerScrollLeft = 0;\n  let viewportHeight = 520;\n  let lastTableWidth = 0;\n  let resizingColumn = '';\n  let resizeCleanup = null;\n  let colWidths = {\n    name: 250,\n    path: 350,\n    size: 75,\n    modified: 150\n  };\n\n  let contextMenu = {\n    visible: false,\n    x: 0,\n    y: 0\n  };\n\n  let platform = '';\n  let toast = '';\n  let searchTimer;\n  let lastSearchFiredAt = 0;\n  let toastTimer;\n  let statusRefreshTimer;\n  let elapsedTimer;\n  let statusRefreshInFlight = false;\n  let lastReadyCount = 0;\n\n  const iconCache = new Map();\n  const iconLoading = new Set();\n\n  let highlightCache = new Map();\n  let highlightCacheQuery = '';\n\n  const folderFallbackIcon =\n    \"data:image/svg+xml;utf8,\" +\n    encodeURIComponent(\n      `<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><rect x='1' y='4' width='14' height='10' rx='2' fill='#d9b34f'/><rect x='1' y='2' width='6' height='4' rx='1' fill='#e6ca7a'/></svg>`\n    );\n  const fileFallbackIcon =\n    \"data:image/svg+xml;utf8,\" +\n    encodeURIComponent(\n      `<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><rect x='3' y='1' width='10' height='14' rx='1.5' fill='#b4bec9'/><rect x='5' y='5' width='6' height='1.2' fill='#8d98a5'/><rect x='5' y='8' width='6' height='1.2' fill='#8d98a5'/></svg>`\n    );\n\n  $: totalHeight = results.length * rowHeight;\n  $: startIndex = Math.max(0, Math.floor(scrollTop / rowHeight) - 10);\n  $: visibleCount = Math.ceil(viewportHeight / rowHeight) + 20;\n  $: endIndex = Math.min(results.length, startIndex + visibleCount);\n  $: visibleRows = results.slice(startIndex, endIndex);\n  $: translateY = startIndex * rowHeight;\n  $: tableMinWidth = colWidths.name + colWidths.path + colWidths.size + colWidths.modified;\n  $: tableGridStyle = `--col-name:${colWidths.name}px;--col-path:${colWidths.path}px;--col-size:${colWidths.size}px;--col-modified:${colWidths.modified}px;--table-min-width:${tableMinWidth}px;--header-offset:${-headerScrollLeft}px;`;\n\n  $: {\n    for (const entry of visibleRows) {\n      void ensureIcon(entry);\n    }\n  }\n\n  function showToast(message) {\n    toast = message;\n    clearTimeout(toastTimer);\n    toastTimer = setTimeout(() => {\n      toast = '';\n    }, 3000);\n  }\n\n  function bytesToBase64(bytes) {\n    let binary = '';\n    const chunk = 0x8000;\n    for (let i = 0; i < bytes.length; i += chunk) {\n      const part = bytes.subarray(i, i + chunk);\n      binary += String.fromCharCode(...part);\n    }\n    return btoa(binary);\n  }\n\n  function highlightSegments(name, q) {\n    q = (q || '').trim();\n    if (!q) return [{ text: name, hl: false }];\n\n    // Reset cache when query changes\n    if (q !== highlightCacheQuery) {\n      highlightCache = new Map();\n      highlightCacheQuery = q;\n    }\n\n    // Check cache\n    const cached = highlightCache.get(name);\n    if (cached) return cached;\n\n    if (q.includes('/')) q = q.slice(q.lastIndexOf('/') + 1);\n    q = q.replace(/[*?]/g, '');\n    const terms = q.split(/\\s+/).filter(Boolean);\n    if (terms.length === 0) return [{ text: name, hl: false }];\n\n    const lower = name.toLowerCase();\n    const marks = new Uint8Array(name.length);\n    for (const t of terms) {\n      const tl = t.toLowerCase();\n      let idx = lower.indexOf(tl);\n      while (idx !== -1) {\n        for (let i = idx; i < idx + tl.length; i++) marks[i] = 1;\n        idx = lower.indexOf(tl, idx + 1);\n      }\n    }\n\n    const segs = [];\n    let i = 0;\n    while (i < name.length) {\n      const m = marks[i];\n      let j = i + 1;\n      while (j < name.length && marks[j] === m) j++;\n      segs.push({ text: name.slice(i, j), hl: m === 1 });\n      i = j;\n    }\n\n    highlightCache.set(name, segs);\n    return segs;\n  }\n\n  const perFileIconExts = new Set(['exe', 'lnk', 'ico', 'url', 'scr', 'appx']);\n\n  function iconKey(entry) {\n    if (entry.isDir) return '__folder__';\n    const ext = (entry.ext || '').toLowerCase();\n    if (perFileIconExts.has(ext)) return entry.path;\n    return ext || '__file__';\n  }\n\n  function iconFor(entry) {\n    return iconCache.get(iconKey(entry)) || (entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n  }\n\n  async function ensureIcon(entry) {\n    const key = iconKey(entry);\n    if (iconCache.has(key) || iconLoading.has(key)) {\n      return;\n    }\n\n    iconLoading.add(key);\n    try {\n      const bytes = await invoke('get_file_icon', {\n        path: entry.path,\n        ext: entry.isDir ? 'folder' : entry.ext || '',\n      });\n      if (Array.isArray(bytes) && bytes.length > 0) {\n        const image = `data:image/png;base64,${bytesToBase64(Uint8Array.from(bytes))}`;\n        iconCache.set(key, image);\n      } else {\n        iconCache.set(key, entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n      }\n    } catch {\n      iconCache.set(key, entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n    } finally {\n      iconLoading.delete(key);\n    }\n  }\n\n  function syncColumnWidthsToContainer() {\n    const width = tableContainer?.clientWidth || tableAreaEl?.clientWidth;\n    if (!width || lastTableWidth !== 0) {\n      return;\n    }\n\n    const saved = loadColWidths();\n    if (saved) {\n      const total = columnKeys.reduce((s, k) => s + saved[k], 0);\n      if (Math.abs(total - width) > 2) {\n        const scale = (width - saved.modified) / (total - saved.modified);\n        let scaledName = Math.max(minColumnWidth.name, Math.round(saved.name * scale));\n        let scaledSize = Math.max(minColumnWidth.size, Math.round(saved.size * scale));\n        let rawPath = width - saved.modified - scaledName - scaledSize;\n        if (rawPath < minColumnWidth.path) {\n          const shortfall = minColumnWidth.path - rawPath;\n          const nameReduction = Math.min(shortfall, scaledName - minColumnWidth.name);\n          scaledName -= nameReduction;\n          const remaining = shortfall - nameReduction;\n          if (remaining > 0) {\n            scaledSize -= Math.min(remaining, scaledSize - minColumnWidth.size);\n          }\n          rawPath = width - saved.modified - scaledName - scaledSize;\n        }\n        const scaledPath = Math.max(minColumnWidth.path, rawPath);\n        colWidths = { name: scaledName, path: scaledPath, size: scaledSize, modified: saved.modified };\n      } else {\n        colWidths = saved;\n      }\n    } else {\n      const fixedModified = minColumnWidth.modified;\n      const rest = width - fixedModified;\n      const ratioSum = defaultColumnRatios.name + defaultColumnRatios.path + defaultColumnRatios.size;\n      colWidths = {\n        name: Math.max(minColumnWidth.name, Math.round(rest * defaultColumnRatios.name / ratioSum)),\n        path: Math.max(minColumnWidth.path, Math.round(rest * defaultColumnRatios.path / ratioSum)),\n        size: Math.max(minColumnWidth.size, Math.round(rest * defaultColumnRatios.size / ratioSum)),\n        modified: fixedModified\n      };\n    }\n    lastTableWidth = width;\n  }\n\n  function loadColWidths() {\n    try {\n      const raw = localStorage.getItem(COL_WIDTHS_KEY);\n      if (!raw) return null;\n      const parsed = JSON.parse(raw);\n      for (const key of columnKeys) {\n        if (typeof parsed[key] !== 'number' || parsed[key] < (minColumnWidth[key] || 0)) return null;\n      }\n      return parsed;\n    } catch {\n      return null;\n    }\n  }\n\n  function saveColWidths() {\n    localStorage.setItem(COL_WIDTHS_KEY, JSON.stringify(colWidths));\n  }\n\n  function updateViewportHeight() {\n    viewportHeight = tableContainer?.clientHeight || 520;\n    syncColumnWidthsToContainer();\n  }\n\n  function scheduleViewportHeightUpdate() {\n    if (viewportResizeRaf !== null) {\n      return;\n    }\n    viewportResizeRaf = requestAnimationFrame(() => {\n      viewportResizeRaf = null;\n      updateViewportHeight();\n    });\n  }\n\n  function startColumnResize(event, leftKey) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    const index = columnKeys.indexOf(leftKey);\n    if (index < 0 || index >= columnKeys.length - 1) {\n      return;\n    }\n\n    const startX = event.clientX;\n    const startLeft = colWidths[leftKey];\n    const rightKey = columnKeys[index + 1];\n    const startRight = colWidths[rightKey];\n\n    resizeCleanup?.();\n    resizingColumn = leftKey;\n\n    const onMove = (moveEvent) => {\n      const delta = Math.round(moveEvent.clientX - startX);\n      if (leftKey === 'name') {\n        // Two-column trade: name and path swap space, each respects its minimum\n        const nextLeft = Math.max(\n          minColumnWidth[leftKey],\n          Math.min(startLeft + delta, startLeft + startRight - minColumnWidth[rightKey])\n        );\n        const nextRight = startLeft + startRight - nextLeft;\n        colWidths = { ...colWidths, [leftKey]: nextLeft, [rightKey]: nextRight };\n      } else {\n        // path splitter: path grows unconstrained (allows horizontal scroll on right drag)\n        const nextLeft = Math.max(minColumnWidth[leftKey], startLeft + delta);\n        colWidths = { ...colWidths, [leftKey]: nextLeft };\n      }\n    };\n\n    const onUp = () => {\n      cleanup();\n    };\n\n    const cleanup = () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n      document.body.style.cursor = '';\n      document.body.style.userSelect = '';\n      resizingColumn = '';\n      saveColWidths();\n      if (resizeCleanup === cleanup) {\n        resizeCleanup = null;\n      }\n    };\n\n    resizeCleanup = cleanup;\n    document.body.style.cursor = 'col-resize';\n    document.body.style.userSelect = 'none';\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n  }\n\n  function selectedPaths() {\n    const sorted = [...selectedIndices].sort((a, b) => a - b);\n    return sorted.map((idx) => results[idx]).filter(Boolean).map((entry) => entry.path);\n  }\n\n  function clearSelection() {\n    selectedIndices = new Set();\n    selectionAnchor = -1;\n    lastSelectedIndex = -1;\n  }\n\n  function selectSingle(index) {\n    selectedIndices = new Set([index]);\n    selectionAnchor = index;\n    lastSelectedIndex = index;\n  }\n\n  function selectToggle(index) {\n    const next = new Set(selectedIndices);\n    if (next.has(index)) {\n      next.delete(index);\n    } else {\n      next.add(index);\n    }\n    selectedIndices = next;\n    selectionAnchor = index;\n    lastSelectedIndex = index;\n  }\n\n  function selectRange(index) {\n    const anchor = selectionAnchor >= 0 ? selectionAnchor : index;\n    const [from, to] = [Math.min(anchor, index), Math.max(anchor, index)];\n    const next = new Set();\n    for (let i = from; i <= to; i += 1) {\n      next.add(i);\n    }\n    selectedIndices = next;\n    lastSelectedIndex = index;\n  }\n\n  function primaryEntry() {\n    const idx = lastSelectedIndex >= 0 ? lastSelectedIndex : -1;\n    return idx >= 0 ? results[idx] : null;\n  }\n\n  async function refreshStatus() {\n    if (statusRefreshInFlight) {\n      return;\n    }\n    statusRefreshInFlight = true;\n    try {\n      const status = await invoke('get_index_status');\n      const prevState = indexStatus.state;\n      indexStatus = {\n        state: status.state,\n        entriesCount: status.entriesCount,\n        lastUpdated: status.lastUpdated,\n        permissionErrors: status.permissionErrors ?? 0,\n        message: status.message\n      };\n      if (status.state === 'Indexing' && prevState !== 'Indexing') {\n        startElapsedTimer();\n      } else if (status.state !== 'Indexing' && prevState === 'Indexing') {\n        stopElapsedTimer();\n      }\n      if (typeof status.scanned === 'number') {\n        scanned = status.scanned;\n      }\n      if (status.state === 'Ready' && prevState !== 'Ready') {\n        scheduleSearch();\n      }\n    } catch (err) {\n      showToast(`Failed to get status: ${String(err)}`);\n    } finally {\n      statusRefreshInFlight = false;\n    }\n  }\n\n  function scheduleSearch(preserveScroll = false) {\n    searchGeneration += 1;\n    const scheduledGen = searchGeneration;\n    clearTimeout(searchTimer);\n\n    const now = performance.now();\n    if (now - lastSearchFiredAt >= 200) {\n      // Leading edge: fire immediately if enough time has passed\n      lastSearchFiredAt = now;\n      void runSearch(preserveScroll);\n    } else {\n      // Trailing edge: debounce\n      searchTimer = setTimeout(() => {\n        if (scheduledGen !== searchGeneration) {\n          return;\n        }\n        lastSearchFiredAt = performance.now();\n        void runSearch(preserveScroll);\n      }, 200);\n    }\n  }\n\n  async function runSearch(preserveScroll = false) {\n    searchGeneration += 1;\n    const gen = searchGeneration;\n    const searchQuery = query;\n    const searchSortBy = sortBy;\n    const searchSortDir = sortDir;\n    const startedAt = performance.now();\n    try {\n      const keepPaths = new Set(selectedPaths());\n      const next = await invoke('search', {\n        query: searchQuery,\n        limit: PAGE_SIZE,\n        offset: 0,\n        sortBy: searchSortBy,\n        sortDir: searchSortDir\n      });\n\n      if (gen !== searchGeneration) return;\n\n      dbLatencyMs = Math.round(performance.now() - startedAt);\n      dbLastQuery = searchQuery;\n      const entries = Array.isArray(next.entries) ? next.entries : [];\n      searchModeLabel = next.modeLabel || '';\n      results = entries;\n      if (next.totalCount > 0) {\n        totalResults = next.totalCount;\n        totalResultsKnown = true;\n      } else {\n        totalResults = entries.length;\n        totalResultsKnown = false;\n      }\n      hasMore = totalResultsKnown ? results.length < totalResults : entries.length >= PAGE_SIZE;\n      if (!preserveScroll && tableContainer) tableContainer.scrollTop = 0;\n\n      const restored = new Set();\n      for (let i = 0; i < results.length; i += 1) {\n        if (keepPaths.has(results[i].path)) {\n          restored.add(i);\n        }\n      }\n      selectedIndices = restored;\n\n      updateViewportHeight();\n    } catch (err) {\n      if (gen !== searchGeneration) return;\n      showToast(`Search failed: ${String(err)}`);\n    }\n  }\n\n  async function loadMore() {\n    if (!hasMore || loadingMore) return;\n    const gen = searchGeneration;\n    loadingMore = true;\n    try {\n      const batch = await invoke('search', {\n        query,\n        limit: PAGE_SIZE,\n        offset: results.length,\n        sortBy: sortBy,\n        sortDir: sortDir\n      });\n      if (gen !== searchGeneration) return;\n      const arr = Array.isArray(batch.entries) ? batch.entries : [];\n      if (arr.length > 0) results = [...results, ...arr];\n      hasMore = totalResultsKnown ? results.length < totalResults : arr.length >= PAGE_SIZE;\n    } catch (err) {\n      showToast(`Failed to load more: ${String(err)}`);\n    } finally {\n      loadingMore = false;\n    }\n  }\n\n  function moveSelection(delta, withRange = false) {\n    if (results.length === 0) {\n      return;\n    }\n\n    const current = lastSelectedIndex >= 0 ? lastSelectedIndex : 0;\n    const next = Math.max(0, Math.min(results.length - 1, current + delta));\n\n    if (withRange) {\n      selectRange(next);\n    } else {\n      selectSingle(next);\n    }\n\n    const top = next * rowHeight;\n    const bottom = top + rowHeight;\n    if (top < scrollTop) {\n      tableContainer.scrollTop = top;\n    } else if (bottom > scrollTop + viewportHeight) {\n      tableContainer.scrollTop = bottom - viewportHeight;\n    }\n  }\n\n  function handleHeaderSort(column) {\n    if (sortBy === column) {\n      sortDir = sortDir === 'asc' ? 'desc' : 'asc';\n    } else {\n      sortBy = column;\n      sortDir = 'asc';\n    }\n    if (tableContainer) tableContainer.scrollTop = 0;\n    void runSearch();\n  }\n\n  function handleRowClick(event, index) {\n    contextMenu.visible = false;\n\n    if (event.shiftKey) {\n      selectRange(index);\n      return;\n    }\n\n    if (event.metaKey || event.ctrlKey) {\n      selectToggle(index);\n      return;\n    }\n\n    selectSingle(index);\n  }\n\n  function handleRowContextMenu(event, index) {\n    event.preventDefault();\n\n    if (!selectedIndices.has(index)) {\n      selectSingle(index);\n    }\n\n    if (platform === 'windows' || platform === 'macos') {\n      contextMenu.visible = false;\n      const paths = selectedPaths();\n      if (paths.length > 0) {\n        invoke('show_context_menu', {\n          paths,\n          x: event.clientX,\n          y: event.clientY,\n          singleSelection: selectedIndices.size === 1\n        });\n      }\n      return;\n    }\n\n    contextMenu = {\n      visible: true,\n      x: event.clientX,\n      y: event.clientY\n    };\n  }\n\n  function handleRowA11yKeydown(event, index) {\n    if (event.key === ' ' || event.key === 'Enter') {\n      event.preventDefault();\n      handleRowClick(event, index);\n    }\n  }\n\n  const DRAG_THRESHOLD = 5;\n  let dragCleanup = null;\n  const dragImgCache = new Map();\n\n  function dragPathsForIndex(index) {\n    const entry = results[index];\n    if (!entry) {\n      return [];\n    }\n\n    if (selectedIndices.has(index) && selectedIndices.size > 0) {\n      return selectedPaths();\n    }\n\n    return [entry.path];\n  }\n\n  function getDragIconEl(entry) {\n    const src = iconFor(entry);\n    let img = dragImgCache.get(src);\n    if (!img) {\n      img = new Image();\n      img.src = src;\n      dragImgCache.set(src, img);\n    }\n    return img.complete && img.naturalWidth > 0 ? img : null;\n  }\n\n  function fillRoundRect(ctx, x, y, w, h, r) {\n    ctx.beginPath();\n    ctx.moveTo(x + r, y);\n    ctx.arcTo(x + w, y, x + w, y + h, r);\n    ctx.arcTo(x + w, y + h, x, y + h, r);\n    ctx.arcTo(x, y + h, x, y, r);\n    ctx.arcTo(x, y, x + w, y, r);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  function buildDragPreview(index) {\n    const entry = results[index];\n    if (!entry) return null;\n\n    const count = selectedIndices.has(index) ? selectedIndices.size : 1;\n    const isDark = theme === 'dark';\n\n    const w = 260;\n    const h = 28;\n    const stackGap = count > 1 ? 4 : 0;\n\n    const canvas = document.createElement('canvas');\n    canvas.width = w;\n    canvas.height = h + stackGap;\n    const ctx = canvas.getContext('2d');\n\n    if (count > 1) {\n      ctx.globalAlpha = 0.35;\n      ctx.fillStyle = isDark ? '#5a6070' : '#b0c4de';\n      fillRoundRect(ctx, 3, 0, w - 3, h, 5);\n      ctx.globalAlpha = 1.0;\n    }\n\n    const ry = stackGap;\n    ctx.fillStyle = isDark ? 'rgba(58, 64, 74, 0.94)' : 'rgba(214, 231, 255, 0.94)';\n    fillRoundRect(ctx, 0, ry, w, h, 5);\n\n    ctx.strokeStyle = isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';\n    ctx.lineWidth = 0.5;\n    ctx.beginPath();\n    ctx.moveTo(5, ry);\n    ctx.arcTo(w, ry, w, ry + h, 5);\n    ctx.arcTo(w, ry + h, 0, ry + h, 5);\n    ctx.arcTo(0, ry + h, 0, ry, 5);\n    ctx.arcTo(0, ry, w, ry, 5);\n    ctx.closePath();\n    ctx.stroke();\n\n    const iconEl = getDragIconEl(entry);\n    if (iconEl) {\n      ctx.drawImage(iconEl, 6, ry + 6, 16, 16);\n    } else {\n      ctx.fillStyle = entry.isDir ? '#d9b34f' : '#8d98a5';\n      fillRoundRect(ctx, 6, ry + 6, 16, 16, 2);\n    }\n\n    ctx.fillStyle = isDark ? '#e6e6e8' : '#1a1a1a';\n    ctx.font = '12px -apple-system, \"SF Pro Text\", system-ui, sans-serif';\n    ctx.textBaseline = 'middle';\n\n    let nameMaxW = w - 34;\n    if (count > 1) nameMaxW -= 34;\n\n    let name = entry.name;\n    if (ctx.measureText(name).width > nameMaxW) {\n      while (name.length > 4 && ctx.measureText(name + '\\u2026').width > nameMaxW) {\n        name = name.slice(0, -1);\n      }\n      name += '\\u2026';\n    }\n    ctx.fillText(name, 28, ry + h / 2 + 1);\n\n    if (count > 1) {\n      const badge = String(count);\n      ctx.font = 'bold 10px -apple-system, system-ui, sans-serif';\n      const tw = ctx.measureText(badge).width;\n      const bw = Math.max(20, tw + 10);\n      const bx = w - bw - 6;\n      const by = ry + (h - 18) / 2;\n\n      ctx.fillStyle = isDark ? '#5b8bd9' : '#007aff';\n      fillRoundRect(ctx, bx, by, bw, 18, 9);\n\n      ctx.fillStyle = '#ffffff';\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(badge, bx + bw / 2, by + 9);\n    }\n\n    return canvas.toDataURL('image/png');\n  }\n\n  function handleRowMouseDown(event, index) {\n    if (event.button !== 0) return;\n    if (event.metaKey || event.ctrlKey || event.shiftKey) return;\n    if (editing.active) return;\n\n    const startX = event.clientX;\n    const startY = event.clientY;\n    let dragging = false;\n\n    dragCleanup?.();\n\n    const onMove = (e) => {\n      if (dragging) return;\n      const dx = e.clientX - startX;\n      const dy = e.clientY - startY;\n      if (dx * dx + dy * dy < DRAG_THRESHOLD * DRAG_THRESHOLD) return;\n\n      dragging = true;\n      cleanup();\n\n      if (!selectedIndices.has(index)) {\n        selectSingle(index);\n      }\n\n      const paths = dragPathsForIndex(index);\n      if (paths.length > 0) {\n        const icon = buildDragPreview(index);\n        startDrag({ item: paths, icon }).catch(() => {});\n      }\n    };\n\n    const onUp = () => cleanup();\n\n    const cleanup = () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n      if (dragCleanup === cleanup) dragCleanup = null;\n    };\n\n    dragCleanup = cleanup;\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n  }\n\n  async function handleRowDoubleClick(index) {\n    if (!selectedIndices.has(index) || selectedIndices.size > 1) {\n      selectSingle(index);\n      await tick();\n    }\n    await invoke('open', { paths: [results[index].path] }).catch((err) => {\n      showToast(`Failed to open: ${String(err)}`);\n    });\n  }\n\n  function closeContextMenu() {\n    contextMenu = {\n      ...contextMenu,\n      visible: false\n    };\n  }\n\n  async function openSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('open', { paths });\n    } catch (err) {\n      showToast(`Failed to open: ${String(err)}`);\n    }\n  }\n\n  async function openWithFallback() {\n    const target = primaryEntry();\n    if (!target) {\n      return;\n    }\n\n    try {\n      await invoke('open_with', { path: target.path });\n    } catch (err) {\n      showToast(`Open With failed: ${String(err)}`);\n    }\n  }\n\n  async function revealSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('reveal_in_finder', { paths });\n    } catch (err) {\n      showToast(`Failed to reveal in Finder: ${String(err)}`);\n    }\n  }\n\n  async function copySelectedPaths() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('copy_paths', { paths });\n      showToast(`Copied ${paths.length} path(s)`);\n    } catch (err) {\n      showToast(`Failed to copy path: ${String(err)}`);\n    }\n  }\n\n  async function copyFiles() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('copy_files', { paths });\n      showToast(`Copied ${paths.length} item(s)`);\n    } catch (err) {\n      showToast(`Failed to copy: ${String(err)}`);\n    }\n  }\n\n  async function trashSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    const message =\n      paths.length === 1\n        ? 'Move selected item to Trash?'\n        : `Move ${paths.length} items to Trash?`;\n\n    if (!window.confirm(message)) {\n      return;\n    }\n\n    try {\n      await invoke('move_to_trash', { paths });\n      showToast('Moved to Trash.');\n      clearSelection();\n      await runSearch();\n    } catch (err) {\n      showToast(`Failed to move to Trash: ${String(err)}`);\n    }\n  }\n\n  async function resetIndex() {\n    if (indexStatus.state === 'Indexing') {\n      showToast('Indexing in progress. Please try again after it completes.');\n      return;\n    }\n\n    results = [];\n    totalResults = 0;\n    totalResultsKnown = false;\n    clearSelection();\n    scanned = 0;\n    dbLatencyMs = null;\n    dbLastQuery = '';\n    indexStatus = { ...indexStatus, state: 'Indexing', entriesCount: 0, message: null };\n    indexingStartTime = Date.now();\n    indexingElapsed = '';\n    indexingFinishedAt = '';\n\n    try {\n      await invoke('reset_index');\n    } catch (err) {\n      showToast(`Failed to reset index: ${String(err)}`);\n      await refreshStatus();\n    }\n  }\n\n  function isMultiSelected() {\n    return selectedIndices.size > 1;\n  }\n\n  function autoResizeRenameInput() {\n    if (!renameInputEl) return;\n    renameInputEl.style.height = '0';\n    renameInputEl.style.height = renameInputEl.scrollHeight + 'px';\n  }\n\n  async function startRename() {\n    if (isMultiSelected()) {\n      return;\n    }\n\n    const idx = lastSelectedIndex;\n    if (idx < 0 || !results[idx]) {\n      return;\n    }\n\n    const entry = results[idx];\n\n    // Calculate overlay position mathematically.\n    // Name cell text starts at: padding-left(16) + icon(16) + gap(6) = 38px from cell left.\n    // Textarea has padding-left: 0 and border: 1.5px, so text starts ~2px from overlay left.\n    if (tableContainer) {\n      const rect = tableContainer.getBoundingClientRect();\n      const cellLeft = rect.left - tableContainer.scrollLeft;\n      const textLeft = cellLeft + 38;\n      const cellRight = cellLeft + colWidths.name;\n      const rowTop = rect.top + idx * rowHeight - tableContainer.scrollTop;\n      renameOverlay = {\n        top: rowTop,\n        left: textLeft - 2,\n        width: cellRight - textLeft + 2 - 4\n      };\n    }\n\n    editing = {\n      active: true,\n      path: entry.path,\n      index: idx,\n      draftName: entry.name\n    };\n\n    await tick();\n\n    if (renameInputEl) {\n      autoResizeRenameInput();\n      renameInputEl.focus();\n      const extPos = !entry.isDir ? entry.name.lastIndexOf('.') : -1;\n      const selectionEnd = extPos > 0 ? extPos : entry.name.length;\n      renameInputEl.setSelectionRange(0, selectionEnd);\n    }\n  }\n\n  function cancelRename() {\n    editing = {\n      active: false,\n      path: '',\n      index: -1,\n      draftName: ''\n    };\n  }\n\n  async function commitRename() {\n    if (!editing.active || editing.index < 0 || !results[editing.index]) {\n      return;\n    }\n\n    const current = results[editing.index];\n    const nextName = editing.draftName;\n\n    try {\n      await invoke('rename', {\n        path: current.path,\n        newName: nextName\n      });\n      cancelRename();\n      await runSearch();\n    } catch (err) {\n      showToast(`Failed to rename: ${String(err)}`);\n      await tick();\n      renameInputEl?.focus();\n    }\n  }\n\n  function onGlobalClick() {\n    closeContextMenu();\n  }\n\n  function onTitleBarMouseDown(event) {\n    if (event.button !== 0) {\n      return;\n    }\n\n    const activeElement = document.activeElement;\n    if (activeElement instanceof HTMLElement && isTextInputTarget(activeElement)) {\n      activeElement.blur();\n    }\n  }\n\n  async function focusSearch() {\n    await getCurrentWindow().show();\n    await getCurrentWindow().setFocus();\n    searchInputEl?.focus();\n    searchInputEl?.select();\n  }\n\n  function isTextInputTarget(target) {\n    return (\n      target instanceof HTMLInputElement ||\n      target instanceof HTMLTextAreaElement ||\n      target?.isContentEditable\n    );\n  }\n\n  async function handleKeydown(event) {\n    const isMetaSelectAll = (event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'a';\n    const isMetaCopy = (event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'c';\n    const target = event.target;\n    const isTextInput = isTextInputTarget(target);\n\n    if (isMetaCopy && isTextInput) {\n      return;\n    }\n\n    if (isMetaSelectAll) {\n      if (isTextInput) {\n        event.preventDefault();\n        if (target instanceof HTMLInputElement || target instanceof HTMLTextAreaElement) {\n          target.select();\n        }\n        return;\n      }\n    }\n\n    if (editing.active) {\n      if (event.key === 'Enter') {\n        event.preventDefault();\n        await commitRename();\n        return;\n      }\n\n      if (event.key === 'Escape') {\n        event.preventDefault();\n        const idx = editing.index;\n        cancelRename();\n        selectSingle(idx);\n        await tick();\n        tableContainer?.querySelector('.row.selected')?.focus();\n        return;\n      }\n      return;\n    }\n\n    if (event.key === 'Escape') {\n      event.preventDefault();\n      clearSelection();\n      return;\n    }\n\n    if (event.key === 'ArrowDown') {\n      event.preventDefault();\n      moveSelection(1, event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'ArrowUp') {\n      event.preventDefault();\n      moveSelection(-1, event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'PageDown') {\n      event.preventDefault();\n      moveSelection(Math.floor(viewportHeight / rowHeight), event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'PageUp') {\n      event.preventDefault();\n      moveSelection(-Math.floor(viewportHeight / rowHeight), event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'Enter') {\n      event.preventDefault();\n      if (platform === 'windows') {\n        await openSelected();\n      } else {\n        await startRename();\n      }\n      return;\n    }\n\n    if (event.key === 'F2') {\n      event.preventDefault();\n      await startRename();\n      return;\n    }\n\n    if (event.key === ' ' && !isTextInput) {\n      event.preventDefault();\n      const entry = primaryEntry();\n      if (entry) {\n        await invoke('quick_look', { path: entry.path });\n      }\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'f') {\n      event.preventDefault();\n      clearSelection();\n      searchInputEl?.focus();\n      searchInputEl?.select();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'o') {\n      event.preventDefault();\n      await openSelected();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key === 'Enter') {\n      event.preventDefault();\n      await revealSelected();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'c') {\n      event.preventDefault();\n      await copySelectedPaths();\n      return;\n    }\n\n    if (isMetaSelectAll) {\n      event.preventDefault();\n      selectedIndices = new Set(Array.from({ length: results.length }, (_, i) => i));\n      return;\n    }\n\n    if (event.key === 'Delete' || ((event.metaKey || event.ctrlKey) && event.key === 'Backspace')) {\n      if (!isTextInput) {\n        event.preventDefault();\n        await trashSelected();\n      }\n      return;\n    }\n  }\n\n  function formatSize(entry) {\n    if (entry.isDir || entry.size == null) return '';\n    const bytes = entry.size;\n    if (bytes < 1024) return `${bytes} B`;\n    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n    if (bytes < 1024 * 1024 * 1024) return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n    return `${(bytes / (1024 * 1024 * 1024)).toFixed(1)} GB`;\n  }\n\n  function formatModified(entry) {\n    if (!entry.mtime) {\n      return '';\n    }\n\n    const d = new Date(entry.mtime * 1000);\n    const pad = (n) => String(n).padStart(2, '0');\n    return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;\n  }\n\n  function formatLastUpdated(timestamp) {\n    if (!timestamp) {\n      return '-';\n    }\n\n    return new Date(timestamp * 1000).toLocaleString();\n  }\n\n  function formatElapsed(ms) {\n    const totalSec = Math.floor(ms / 1000);\n    const min = Math.floor(totalSec / 60);\n    const sec = totalSec % 60;\n    return min > 0 ? `${min}m ${sec}s` : `${sec}s`;\n  }\n\n  function updateElapsed() {\n    if (indexingStartTime && indexStatus.state === 'Indexing') {\n      indexingElapsed = formatElapsed(Date.now() - indexingStartTime);\n    }\n  }\n\n  function startElapsedTimer() {\n    clearInterval(elapsedTimer);\n    indexingStartTime = Date.now();\n    indexingElapsed = '0s';\n    indexingFinishedAt = '';\n    elapsedTimer = setInterval(updateElapsed, 1000);\n  }\n\n  function stopElapsedTimer() {\n    clearInterval(elapsedTimer);\n    if (indexingStartTime) {\n      const elapsed = Date.now() - indexingStartTime;\n      indexingFinishedAt = `${formatElapsed(elapsed)}`;\n    }\n    indexingStartTime = null;\n    indexingElapsed = '';\n  }\n\n  function displayPath(path) {\n    if (!path) {\n      return path;\n    }\n\n    if (!homePrefix) {\n      return path;\n    }\n\n    if (path === homePrefix) {\n      return '~';\n    }\n\n    if (path.startsWith(`${homePrefix}/`)) {\n      return `~${path.slice(homePrefix.length)}`;\n    }\n\n    return path;\n  }\n\n  let unlistenFns = [];\n\n  onMount(async () => {\n    const t0 = performance.now();\n    const ms = () => Math.round(performance.now() - t0);\n    const DEBUG_STARTUP = false;\n    const flog = DEBUG_STARTUP ? (msg) => invoke('frontend_log', { msg }).catch(() => {}) : () => {};\n\n    flog(`[startup/fe] onMount entered`);\n\n    updateViewportHeight();\n    flog(`[startup/fe] +${ms()}ms updateViewportHeight done`);\n\n    invoke('set_native_theme', { theme });\n\n    platform = await invoke('get_platform');\n    flog(`[startup/fe] +${ms()}ms get_platform done`);\n\n    const unlistenProgress = await listen('index_progress', (event) => {\n      scanned = event.payload.scanned;\n      if (indexStatus.state !== 'Indexing') {\n        indexStatus = {\n          ...indexStatus,\n          state: 'Indexing'\n        };\n      }\n    });\n    flog(`[startup/fe] +${ms()}ms listen(index_progress) registered`);\n\n    const unlistenState = await listen('index_state', (event) => {\n      flog(`[startup/fe] index_state event received: ${event.payload.state} at +${ms()}ms`);\n      const prevState = indexStatus.state;\n      indexStatus = {\n        ...indexStatus,\n        state: event.payload.state,\n        message: event.payload.message ?? null,\n        isCatchup: event.payload.isCatchup ?? false\n      };\n\n      if (event.payload.state === 'Indexing' && prevState !== 'Indexing') {\n        if (prevState === 'Ready') {\n          lastReadyCount = indexStatus.entriesCount;\n        }\n        startElapsedTimer();\n      } else if (event.payload.state !== 'Indexing' && prevState === 'Indexing') {\n        stopElapsedTimer();\n      }\n\n      if (event.payload.state === 'Ready') {\n        scheduleSearch();\n      }\n    });\n    flog(`[startup/fe] +${ms()}ms listen(index_state) registered`);\n\n    const unlistenUpdated = await listen('index_updated', (event) => {\n      indexStatus = {\n        ...indexStatus,\n        entriesCount: event.payload.entriesCount,\n        lastUpdated: event.payload.lastUpdated,\n        permissionErrors: event.payload.permissionErrors ?? indexStatus.permissionErrors\n      };\n\n      scheduleSearch(true);\n    });\n\n    const unlistenFocus = await listen('focus_search', () => {\n      void focusSearch();\n    });\n\n    const unlistenCtxMenuAction = await listen('context_menu_action', (event) => {\n      switch (event.payload) {\n        case 'open': void openSelected(); break;\n        case 'quick_look': {\n          const e = primaryEntry();\n          if (e) void invoke('quick_look', { path: e.path });\n          break;\n        }\n        case 'open_with': void openWithFallback(); break;\n        case 'reveal': void revealSelected(); break;\n        case 'copy_files': void copyFiles(); break;\n        case 'copy_path': void copySelectedPaths(); break;\n        case 'trash': void trashSelected(); break;\n        case 'rename': void startRename(); break;\n      }\n    });\n\n    unlistenFns = [unlistenProgress, unlistenState, unlistenUpdated, unlistenFocus, unlistenCtxMenuAction];\n    flog(`[startup/fe] +${ms()}ms all listeners registered`);\n\n    // Fetch backend state IMMEDIATELY after listeners are registered.\n    // Events emitted before listener registration are lost, so this\n    // is the only reliable way to get the current state.\n    await refreshStatus();\n    flog(`[startup/fe] +${ms()}ms refreshStatus done (state=${indexStatus.state})`);\n\n    // Show Svelte UI: remove skeleton, focus search input.\n    await tick();\n    document.getElementById('skeleton')?.remove();\n    await focusSearch();\n    flog(`[startup/fe] +${ms()}ms WINDOW VISIBLE â€” skeleton removed`);\n\n    try {\n      homePrefix = await invoke('get_home_dir');\n    } catch {\n      homePrefix = '';\n    }\n    flog(`[startup/fe] +${ms()}ms get_home_dir done`);\n\n    if (!localStorage.getItem('everything-fda-notice-v1')) {\n      showToast('macOS Full Disk Access permission may be required for full disk search.');\n      localStorage.setItem('everything-fda-notice-v1', '1');\n    }\n    flog(`[startup/fe] +${ms()}ms calling runSearch...`);\n    await runSearch();\n    flog(`[startup/fe] +${ms()}ms runSearch done`);\n\n    if (typeof ResizeObserver !== 'undefined') {\n      tableResizeObserver = new ResizeObserver(() => {\n        scheduleViewportHeightUpdate();\n      });\n      if (tableContainer) {\n        tableResizeObserver.observe(tableContainer);\n      } else if (tableAreaEl) {\n        tableResizeObserver.observe(tableAreaEl);\n      }\n    }\n\n    window.addEventListener('resize', scheduleViewportHeightUpdate);\n    window.addEventListener('click', onGlobalClick);\n    statusRefreshTimer = setInterval(() => {\n      if (indexStatus.state === 'Indexing') {\n        void refreshStatus();\n      }\n    }, 1000);\n    console.log(`[startup/fe] +${ms()}ms onMount complete`);\n  });\n\n  onDestroy(async () => {\n    clearTimeout(searchTimer);\n    clearTimeout(toastTimer);\n    clearInterval(statusRefreshTimer);\n    clearInterval(elapsedTimer);\n    resizeCleanup?.();\n\n    for (const unlisten of unlistenFns) {\n      unlisten();\n    }\n\n    tableResizeObserver?.disconnect();\n    tableResizeObserver = null;\n    if (viewportResizeRaf !== null) {\n      cancelAnimationFrame(viewportResizeRaf);\n      viewportResizeRaf = null;\n    }\n    window.removeEventListener('resize', scheduleViewportHeightUpdate);\n    window.removeEventListener('click', onGlobalClick);\n  });\n</script>\n\n<svelte:window on:keydown={handleKeydown} />\n\n<div class=\"app-shell\" data-theme={theme}>\n  <div class=\"title-bar\" role=\"presentation\" data-tauri-drag-region on:mousedown={onTitleBarMouseDown}>\n    <div class=\"title-left\"></div>\n    <div class=\"title-center\">\n      <svg class=\"title-icon\" viewBox=\"0 0 215 205\" fill-rule=\"evenodd\" aria-hidden=\"true\">\n        <path d=\"M85 0c46.9 0 85 38.1 85 85 0 20.1-7.2 38.5-19.2 52.7l40.7 40.8c5.8 5.8 5.8 15.2 0 21-5.8 5.8-15.2 5.8-21 0l-40.7-40.7c-13.6 9.7-30.4 15.2-44.8 15.2-46.9 0-85-42.1-85-89 0-46.9 38.1-85 85-85z m0 32c-29.3 0-53 23.7-53 53 0 29.3 23.7 53 53 53 29.3 0 53-23.7 53-53 0-29.3-23.7-53-53-53z\"/>\n      </svg>\n      <span class=\"title-text\">Everything</span>\n    </div>\n    <div class=\"title-right\"></div>\n  </div>\n\n  <header class=\"search-bar\">\n    <input\n      bind:this={searchInputEl}\n      class=\"search-input\"\n      type=\"text\"\n      bind:value={query}\n      on:input={scheduleSearch}\n      on:focus={clearSelection}\n      placeholder=\"Search file/folder names\"\n      autocomplete=\"off\"\n      spellcheck=\"false\"\n    />\n  </header>\n\n  <section class=\"table-area\" bind:this={tableAreaEl} style={tableGridStyle}>\n    <div class=\"table-header\">\n      <div class=\"table-header-track\">\n        <div class=\"col name\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('name')}>\n            Name{#if sortBy === 'name'}{@html sortIconHtml(sortDir)}{/if}\n          </button>\n          <button\n            type=\"button\"\n            class=\"col-resizer\"\n            class:active={resizingColumn === 'name'}\n            on:mousedown={(event) => startColumnResize(event, 'name')}\n            aria-label=\"Resize Name column\"\n          />\n        </div>\n\n        <div class=\"col path\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('dir')}>\n            Path{#if sortBy === 'dir'}{@html sortIconHtml(sortDir)}{/if}\n          </button>\n          <button\n            type=\"button\"\n            class=\"col-resizer\"\n            class:active={resizingColumn === 'path'}\n            on:mousedown={(event) => startColumnResize(event, 'path')}\n            aria-label=\"Resize Path column\"\n          />\n        </div>\n\n        <div class=\"col size\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('size')}>\n            Size{#if sortBy === 'size'}{@html sortIconHtml(sortDir)}{/if}\n          </button>\n        </div>\n\n        <div class=\"col modified\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('mtime')}>\n            Modified{#if sortBy === 'mtime'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <div\n      class=\"table-body\"\n      bind:this={tableContainer}\n      on:scroll={() => {\n        scrollTop = tableContainer.scrollTop;\n        headerScrollLeft = tableContainer.scrollLeft;\n        if (editing.active) void commitRename();\n        const scrollBottom = scrollTop + tableContainer.clientHeight;\n        if (scrollBottom >= totalHeight - rowHeight * 10) {\n          void loadMore();\n        }\n      }}\n    >\n      <div class=\"spacer\" style={`height:${totalHeight}px`}>\n        <div class=\"rows\" style={`transform: translateY(${translateY}px);`}>\n          {#each visibleRows as entry, localIndex}\n            {@const index = startIndex + localIndex}\n            <div\n              class=\"row {selectedIndices.has(index) ? 'selected' : ''}\"\n              on:mousedown={(event) => handleRowMouseDown(event, index)}\n              on:click={(event) => handleRowClick(event, index)}\n              on:keydown={(event) => handleRowA11yKeydown(event, index)}\n              on:dblclick={() => handleRowDoubleClick(index)}\n              on:contextmenu={(event) => handleRowContextMenu(event, index)}\n              role=\"row\"\n              tabindex=\"0\"\n            >\n              <div class=\"cell name\">\n                <img class=\"file-icon\" src={iconFor(entry)} alt=\"\" />\n                <span class=\"ellipsis\" class:name-editing={editing.active && editing.index === index}>{#each highlightSegments(entry.name, query) as seg}{#if seg.hl}<mark class=\"hl\">{seg.text}</mark>{:else}{seg.text}{/if}{/each}</span>\n              </div>\n              <div class=\"cell path\"><span class=\"ellipsis\">{displayPath(entry.dir)}</span></div>\n              <div class=\"cell size\">{formatSize(entry)}</div>\n              <div class=\"cell modified\">{formatModified(entry)}</div>\n            </div>\n          {/each}\n        </div>\n      </div>\n    </div>\n  </section>\n\n  <footer class=\"status-bar\">\n    <div class=\"status-left\">\n      <span class=\"status-state\">\n        <span class=\"state-dot {indexStatus.state === 'Indexing' ? 'indexing' : indexStatus.state === 'Error' ? 'error' : 'ready'}\"></span>\n        {#if indexStatus.state === 'Indexing'}\n          Indexing{#if lastReadyCount > 0} ({Math.min(99, Math.round((scanned / lastReadyCount) * 100))}%){/if}{#if indexingElapsed} Â· {indexingElapsed}{/if}\n          {#if !indexStatus.isCatchup}\n            Â· {scanned.toLocaleString()} scanned\n          {/if}\n        {:else}\n          Index: {indexStatus.state}\n        {/if}\n      </span>\n      <span>{indexStatus.entriesCount.toLocaleString()} entries</span>\n      {#if indexingFinishedAt && indexStatus.state !== 'Indexing'}\n        <span>in {indexingFinishedAt}</span>\n      {/if}\n      {#if dbLatencyMs !== null && dbLastQuery}\n        <span>\"{dbLastQuery}\" {dbLatencyMs}ms Â· {totalResults} results</span>\n      {/if}\n      {#if searchModeLabel === 'spotlight' || searchModeLabel === 'spotlight_timeout'}\n        <span class=\"status-spotlight\">Spotlight fallback{#if searchModeLabel === 'spotlight_timeout'} (partial){/if}</span>\n      {/if}\n      {#if indexStatus.permissionErrors > 0}\n        <span class=\"status-warning\">{indexStatus.permissionErrors.toLocaleString()} permission errors</span>\n      {/if}\n      {#if indexStatus.message}\n        <span class={indexStatus.isCatchup ? 'index-progress' : 'status-error'}>{indexStatus.message}</span>\n      {/if}\n    </div>\n    <div class=\"status-right\">\n      <button class=\"status-btn\" on:click={cycleTheme} title=\"Switch theme\">\n        {theme === 'dark' ? 'â˜€ Light' : 'â—‘ Dark'}\n      </button>\n      <button\n        class=\"status-btn rebuild-btn\"\n        on:click={resetIndex}\n        disabled={indexStatus.state === 'Indexing'}\n        title={indexStatus.state === 'Indexing' ? 'Cannot reset while indexing is in progress.' : 'Reset and rebuild the index.'}\n      >\n        <svg class=\"rebuild-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <path d=\"M23 4v6h-6\"/><path d=\"M20.49 15a9 9 0 1 1-2.12-9.36L23 10\"/>\n        </svg>\n        Rebuild Index\n      </button>\n    </div>\n  </footer>\n\n  {#if editing.active}\n    <div\n      class=\"rename-overlay\"\n      style=\"top:{renameOverlay.top}px; left:{renameOverlay.left}px; width:{renameOverlay.width}px;\"\n      role=\"presentation\"\n      on:mousedown|stopPropagation\n    >\n      <textarea\n        bind:this={renameInputEl}\n        class=\"rename-textarea\"\n        bind:value={editing.draftName}\n        on:input={autoResizeRenameInput}\n        on:click|stopPropagation\n        on:blur={commitRename}\n      />\n    </div>\n  {/if}\n\n  {#if contextMenu.visible}\n    <div class=\"context-menu\" style={`left:${contextMenu.x}px;top:${contextMenu.y}px;`}>\n      <button on:click={() => (closeContextMenu(), openSelected())}>Open</button>\n      <button on:click={async () => { closeContextMenu(); const e = primaryEntry(); if (e) await invoke('quick_look', { path: e.path }); }}>Quick Look</button>\n      <button on:click={() => (closeContextMenu(), openWithFallback())}>Open With... (Reveal in Finder)</button>\n      <button on:click={() => (closeContextMenu(), revealSelected())}>Reveal in Finder</button>\n      <button on:click={() => (closeContextMenu(), copySelectedPaths())}>Copy Path</button>\n      <button on:click={() => (closeContextMenu(), trashSelected())}>Move to Trash</button>\n      {#if selectedIndices.size === 1}\n        <button on:click={() => (closeContextMenu(), startRename())}>Rename</button>\n      {/if}\n    </div>\n  {/if}\n\n  {#if toast}\n    <div class=\"toast\">{toast}</div>\n  {/if}\n</div>\n\n<style>\n  :global(:root) {\n    color-scheme: light dark;\n    --bg-app: transparent;\n    --text-primary: #0d1826;\n    --text-muted: #48596c;\n    --bar-grad-top: rgba(255, 255, 255, 0.48);\n    --bar-grad-bottom: rgba(248, 250, 253, 0.42);\n    --surface-header: rgba(252, 252, 255, 0.40);\n    --surface: rgba(255, 255, 255, 0.22);\n    --border-soft: rgba(0, 0, 0, 0.07);\n    --border-input: rgba(0, 0, 0, 0.13);\n    --focus-ring: #6f96e6;\n    --row-border: rgba(0, 0, 0, 0.032);\n    --row-hover: rgba(0, 0, 0, 0.06);\n    --row-selected: rgba(0, 0, 0, 0.12);\n    --button-bg: rgba(255, 255, 255, 0.62);\n    --button-border: rgba(0, 0, 0, 0.10);\n    --button-text: #2c3e50;\n    --menu-bg: rgba(240, 241, 248, 0.90);\n    --menu-border: rgba(0, 0, 0, 0.06);\n    --menu-hover: rgba(255, 255, 255, 0.62);\n    --menu-text: #1a2a38;\n    --error-text: #b64545;\n    --warning-text: #8f6500;\n    --toast-bg: rgba(18, 22, 32, 0.90);\n    --toast-text: #ffffff;\n  }\n\n  @media (prefers-color-scheme: dark) {\n    :global(:root) {\n      --bg-app: transparent;\n      --text-primary: #e6e6ea;\n      --text-muted: #9494a4;\n      --bar-grad-top: rgba(38, 38, 46, 0.52);\n      --bar-grad-bottom: rgba(30, 30, 38, 0.46);\n      --surface-header: rgba(32, 32, 40, 0.46);\n      --surface: rgba(18, 18, 26, 0.32);\n      --border-soft: rgba(255, 255, 255, 0.065);\n      --border-input: rgba(255, 255, 255, 0.14);\n      --focus-ring: #5b8bd9;\n      --row-border: rgba(255, 255, 255, 0.026);\n      --row-hover: rgba(255, 255, 255, 0.08);\n      --row-selected: rgba(255, 255, 255, 0.14);\n      --button-bg: rgba(255, 255, 255, 0.072);\n      --button-border: rgba(255, 255, 255, 0.11);\n      --button-text: #d6d6e0;\n      --menu-bg: rgba(36, 36, 46, 0.90);\n      --menu-border: rgba(255, 255, 255, 0.066);\n      --menu-hover: rgba(255, 255, 255, 0.062);\n      --menu-text: #e0e0e8;\n      --error-text: #ff9d9d;\n      --warning-text: #e0c670;\n      --toast-bg: rgba(10, 10, 16, 0.93);\n      --toast-text: #f2f2f6;\n    }\n  }\n\n  /* â”€â”€ Theme: Dark â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme=\"dark\"]) {\n    color-scheme: dark;\n    --bg-app: #1E1E21;\n    --text-primary: #E2E8F0;\n    --text-muted: #94A3B8;\n    --bar-grad-top: #1E1E21;\n    --bar-grad-bottom: #1E1E21;\n    --surface-header: #1E1E21;\n    --surface: #1E1E21;\n    --bg-input: #161618;\n    --border-soft: #2A2A2D;\n    --border-input: rgba(255, 255, 255, 0.06);\n    --focus-ring: #4DA8FF;\n    --accent: #4DA8FF;\n    --row-border: rgba(255, 255, 255, 0.02);\n    --row-hover: #282828;\n    --row-selected: rgba(77, 168, 255, 0.10);\n    --button-bg: rgba(255, 255, 255, 0.05);\n    --button-border: #2A2A2D;\n    --button-text: #94A3B8;\n    --menu-bg: #252528;\n    --menu-border: #2A2A2D;\n    --menu-hover: rgba(255, 255, 255, 0.04);\n    --menu-text: #E2E8F0;\n    --error-text: #ff9d9d;\n    --warning-text: #e0c670;\n    --toast-bg: rgba(10, 10, 16, 0.93);\n    --toast-text: #f2f2f6;\n  }\n\n  /* â”€â”€ Theme: Light â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme=\"light\"]) {\n    color-scheme: light;\n    --bg-app: #F5F5F7;\n    --text-primary: #1C1C1E;\n    --text-muted: #6E6E7A;\n    --bar-grad-top: #F5F5F7;\n    --bar-grad-bottom: #F5F5F7;\n    --surface-header: #F5F5F7;\n    --surface: #F5F5F7;\n    --bg-input: #FFFFFF;\n    --border-soft: #D1D1D6;\n    --border-input: rgba(0, 0, 0, 0.10);\n    --focus-ring: #3A8BF5;\n    --accent: #3A8BF5;\n    --row-border: rgba(0, 0, 0, 0.04);\n    --row-hover: rgba(0, 0, 0, 0.04);\n    --row-selected: rgba(58, 139, 245, 0.10);\n    --button-bg: #FFFFFF;\n    --button-border: #D1D1D6;\n    --button-text: #3C3C43;\n    --menu-bg: #FFFFFF;\n    --menu-border: #D1D1D6;\n    --menu-hover: rgba(0, 0, 0, 0.05);\n    --menu-text: #1C1C1E;\n    --error-text: #D93025;\n    --warning-text: #B45309;\n    --toast-bg: rgba(255, 255, 255, 0.95);\n    --toast-text: #1C1C1E;\n  }\n\n  /* â”€â”€ Themed element overrides â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme]) {\n    background: var(--bg-app);\n  }\n\n  /* Search bar: flat, no gradient, no separator */\n  :global([data-theme]) .search-bar {\n    height: 44px;\n    padding: 0 16px;\n    background: var(--bg-app);\n    border-bottom: none;\n  }\n\n  :global([data-theme]) .search-input {\n    backdrop-filter: none;\n    -webkit-backdrop-filter: none;\n    font-family: 'JetBrains Mono', 'SF Mono', monospace;\n    font-size: 12px;\n    height: 34px;\n    border-radius: 8px;\n  }\n\n  /* Table header: flat bg, 16px edge padding */\n  :global([data-theme]) .table-header {\n    background: var(--bg-app);\n  }\n\n  :global([data-theme]) .col-button {\n    padding: 0 8px;\n  }\n\n  :global([data-theme]) .col.name .col-button {\n    padding-left: 16px;\n  }\n\n  /* Row cells: JetBrains Mono, 16px outer edges */\n  :global([data-theme]) .cell {\n    font-family: 'JetBrains Mono', monospace;\n  }\n\n  :global([data-theme]) .cell.name {\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    padding-left: 16px;\n    font-size: 12px;\n    color: var(--text-primary);\n  }\n\n  :global([data-theme]) .cell.path {\n    font-size: 11px;\n  }\n\n  :global([data-theme]) .cell.size {\n    font-size: 11px;\n  }\n\n  :global([data-theme]) .cell.modified {\n    padding-right: 16px;\n    font-size: 11px;\n    white-space: nowrap;\n  }\n\n  :global([data-theme]) .row.selected {\n    box-shadow: inset 3px 0 0 var(--accent);\n  }\n\n  /* Dim path/size/date cells in themed mode */\n  :global([data-theme]) .cell.path,\n  :global([data-theme]) .cell.size,\n  :global([data-theme]) .cell.modified {\n    color: var(--text-muted);\n  }\n\n  :global(:root) {\n    background: transparent;\n  }\n\n  :global(html, body) {\n    margin: 0;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n    background: transparent;\n    color: var(--text-primary);\n    font-family: Inter, 'SF Pro Text', 'Segoe UI', Helvetica, Arial, sans-serif;\n  }\n\n  :global(#app) {\n    width: 100%;\n    height: 100%;\n  }\n\n  .app-shell {\n    display: grid;\n    grid-template-rows: auto auto 1fr auto;\n    height: 100%;\n    min-width: 0;\n  }\n\n  .title-bar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 44px;\n    padding: 0 16px;\n    background: var(--surface-header);\n    cursor: default;\n    flex-shrink: 0;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-left {\n    width: 72px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-center {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-right {\n    width: 72px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-icon {\n    width: 14px;\n    height: 14px;\n    fill: var(--accent);\n    flex-shrink: 0;\n  }\n\n  .title-text {\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--text-primary);\n    letter-spacing: -0.01em;\n  }\n\n  .search-bar {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 8px;\n    background: linear-gradient(180deg, var(--bar-grad-top) 0%, var(--bar-grad-bottom) 100%);\n    border-bottom: 1px solid var(--border-soft);\n    min-width: 0;\n    flex-shrink: 0;\n  }\n\n  .search-input {\n    display: block;\n    box-sizing: border-box;\n    width: 100%;\n    min-width: 0;\n    flex: 1 1 auto;\n    height: 36px;\n    border: 1px solid var(--border-input);\n    border-radius: 14px;\n    padding: 0 10px;\n    font-size: 14px;\n    background: var(--bg-input, var(--surface));\n    color: var(--text-primary);\n    backdrop-filter: blur(12px) saturate(160%);\n    -webkit-backdrop-filter: blur(12px) saturate(160%);\n  }\n\n  .search-input::placeholder {\n    color: var(--text-muted);\n    opacity: 0.85;\n    font-size: 12px;\n  }\n\n  .search-input:focus {\n    outline: none;\n    border-color: var(--focus-ring);\n    box-shadow: 0 0 0 2px rgba(125, 169, 255, 0.25);\n  }\n\n  .table-area {\n    display: grid;\n    grid-template-rows: auto 1fr;\n    min-height: 0;\n    min-width: 0;\n  }\n\n  .table-header-track,\n  .row {\n    display: grid;\n    grid-template-columns: var(--col-name) var(--col-path) var(--col-size) var(--col-modified);\n    align-items: center;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .table-header {\n    height: 32px;\n    border-bottom: 1px solid var(--border-soft);\n    background: var(--surface-header);\n    user-select: none;\n    overflow: hidden;\n    flex-shrink: 0;\n  }\n\n  .table-header-track {\n    height: 100%;\n    transform: translateX(var(--header-offset, 0px));\n    will-change: transform;\n  }\n\n  .table-header .col {\n    position: relative;\n    min-width: 0;\n    height: 100%;\n  }\n\n  .col-button {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: flex-start;\n    gap: 4px;\n    box-sizing: border-box;\n    padding: 0 8px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 11px;\n    font-weight: 600;\n    line-height: 1;\n    color: var(--text-muted);\n    text-align: left;\n    margin: 0;\n    border: none;\n    background: transparent;\n    cursor: pointer;\n  }\n\n  .sort-icon {\n    width: 10px;\n    height: 10px;\n    flex-shrink: 0;\n    color: var(--accent);\n  }\n\n  .col-resizer {\n    position: absolute;\n    top: 0;\n    right: -4px;\n    width: 8px;\n    height: 100%;\n    border: none;\n    padding: 0;\n    background: transparent;\n    cursor: col-resize;\n    z-index: 30;\n  }\n\n  .col-resizer::after {\n    content: '';\n    position: absolute;\n    top: 7px;\n    bottom: 7px;\n    left: 50%;\n    width: 1px;\n    transform: translateX(-50%);\n    background: var(--border-soft);\n    opacity: 0;\n    transition: opacity 0.15s ease;\n  }\n\n  .table-header .col:hover .col-resizer::after,\n  .col-resizer.active::after {\n    opacity: 1;\n  }\n\n  .table-body {\n    overflow: auto;\n    min-height: 0;\n    min-width: 0;\n    background: var(--surface);\n  }\n\n  .spacer {\n    position: relative;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .rows {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .row {\n    height: 30px;\n    border-bottom: 1px solid var(--row-border);\n    cursor: default;\n    -webkit-user-select: none;\n    user-select: none;\n    outline: none;\n  }\n\n  .row:hover {\n    background: var(--row-hover);\n  }\n\n  .row.selected {\n    background: var(--row-selected);\n  }\n\n  .cell {\n    padding: 0 8px;\n    font-size: 12px;\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    min-width: 0;\n  }\n\n  .cell.size {\n    text-align: right;\n    font-variant-numeric: tabular-nums;\n  }\n\n  .ellipsis {\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n\n  .hl {\n    background: none;\n    color: inherit;\n    font-weight: 700;\n  }\n\n  .file-icon {\n    width: 16px;\n    height: 16px;\n    flex: 0 0 auto;\n  }\n\n  .name-editing {\n    opacity: 0.25;\n  }\n\n  .rename-overlay {\n    position: fixed;\n    z-index: 100;\n    min-width: 120px;\n  }\n\n  .rename-textarea {\n    display: block;\n    width: 100%;\n    box-sizing: border-box;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 12px;\n    line-height: 18px;\n    padding: 5px 4px 5px 0;\n    border: 1.5px solid var(--focus-ring);\n    border-radius: 4px;\n    background: var(--bg-input, var(--surface));\n    color: var(--text-primary);\n    outline: none;\n    resize: none;\n    overflow: hidden;\n    box-shadow: 0 2px 14px rgba(0, 0, 0, 0.22), 0 0 0 3px rgba(77, 168, 255, 0.13);\n  }\n\n  .status-bar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 32px;\n    padding: 0 16px;\n    background: var(--surface-header);\n    border-top: 1px solid var(--border-soft);\n    font-family: 'JetBrains Mono', monospace;\n    font-size: 11px;\n    color: var(--text-muted);\n    white-space: nowrap;\n    overflow: hidden;\n    min-width: 0;\n    flex-shrink: 0;\n  }\n\n  .status-left {\n    display: flex;\n    align-items: center;\n    gap: 16px;\n    overflow: hidden;\n    min-width: 0;\n  }\n\n  .status-right {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    flex-shrink: 0;\n  }\n\n  .status-btn {\n    border: 1px solid var(--button-border);\n    border-radius: 5px;\n    background: var(--button-bg);\n    color: var(--button-text);\n    font-size: 11px;\n    height: 22px;\n    padding: 0 8px;\n    cursor: pointer;\n  }\n\n  .status-btn:hover {\n    filter: brightness(1.06);\n  }\n\n  .status-btn:disabled {\n    opacity: 0.55;\n    cursor: not-allowed;\n    filter: none;\n  }\n\n  .status-state {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n  }\n\n  .state-dot {\n    width: 6px;\n    height: 6px;\n    border-radius: 50%;\n    flex-shrink: 0;\n  }\n\n  .state-dot.ready { background: #28C840; }\n  .state-dot.indexing { background: #FEBC2E; }\n  .state-dot.error { background: #FF5F57; }\n\n  .rebuild-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 10px;\n    font-weight: 500;\n    background: var(--button-bg);\n    border: 1px solid var(--button-border);\n    border-radius: 4px;\n    color: var(--button-text);\n    height: 22px;\n    padding: 0 10px;\n    cursor: pointer;\n  }\n\n  .rebuild-btn:hover {\n    filter: brightness(1.1);\n  }\n\n  .rebuild-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    filter: none;\n  }\n\n  .rebuild-icon {\n    width: 11px;\n    height: 11px;\n    color: var(--accent);\n    flex-shrink: 0;\n  }\n\n  .status-error {\n    color: var(--error-text);\n  }\n\n  .status-warning {\n    color: var(--warning-text);\n  }\n\n  .status-spotlight {\n    color: #f59e0b;\n    font-weight: 600;\n  }\n\n  .context-menu {\n    position: fixed;\n    z-index: 200;\n    width: 220px;\n    border: 1px solid var(--menu-border);\n    border-radius: 10px;\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.16), inset 0 0 0 0.5px rgba(255, 255, 255, 0.18);\n    background: var(--menu-bg);\n    backdrop-filter: blur(28px) saturate(180%);\n    -webkit-backdrop-filter: blur(28px) saturate(180%);\n    overflow: hidden;\n  }\n\n  .context-menu button {\n    width: 100%;\n    text-align: left;\n    border: none;\n    background: transparent;\n    padding: 8px 10px;\n    font-size: 12px;\n    color: var(--menu-text);\n  }\n\n  .context-menu button:hover {\n    background: var(--menu-hover);\n  }\n\n  .toast {\n    position: fixed;\n    right: 14px;\n    bottom: 18px;\n    background: var(--toast-bg);\n    color: var(--toast-text);\n    border-radius: 10px;\n    padding: 9px 12px;\n    font-size: 12px;\n    z-index: 250;\n    backdrop-filter: blur(20px) saturate(180%);\n    -webkit-backdrop-filter: blur(20px) saturate(180%);\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);\n  }\n</style>\n","structuredPatch":[{"oldStart":1489,"oldLines":7,"newStart":1489,"newLines":7,"lines":[" ","         <div class=\"col modified\">","           <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('mtime')}>","-            Modified{#if sortBy === 'mtime'}<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d={sortDir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5'}/></svg>{/if}","+            Modified{#if sortBy === 'mtime'}{@html sortIconHtml(sortDir)}{/if}","           </button>","         </div>","       </div>"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"c528aef1-eb51-495e-a665-e20a26ac3baf"}
{"parentUuid":"9683dbd2-d5db-46e6-b74b-d95a7dc1b02f","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01FdhNZR99WDNRQbMLEKSXSe","type":"message","role":"assistant","content":[{"type":"text","text":"ì´ì œ `.sort-icon`ì„ `:global`ë¡œ ë³€ê²½í•˜ê³  `.rebuild-btn` CSSë¥¼ ì •ë¦¬í•©ë‹ˆë‹¤."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":318,"cache_read_input_tokens":101153,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":318},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPRUNvUsDrdxp3auY3N","type":"assistant","uuid":"0a0d38f0-ce33-4b74-a058-31510d0ea032","timestamp":"2026-02-21T14:40:09.587Z"}
{"parentUuid":"0a0d38f0-ce33-4b74-a058-31510d0ea032","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01FdhNZR99WDNRQbMLEKSXSe","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Kx7Bc1wQjEkhGPuhxFeJa2","name":"Read","input":{"file_path":"/Users/al02402336/everything/src/App.svelte","offset":1985,"limit":12},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":318,"cache_read_input_tokens":101153,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":318},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPRUNvUsDrdxp3auY3N","type":"assistant","uuid":"91e0b273-169b-4f96-a39e-0c20a8d3a5b6","timestamp":"2026-02-21T14:40:10.239Z"}
{"parentUuid":"91e0b273-169b-4f96-a39e-0c20a8d3a5b6","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01Kx7Bc1wQjEkhGPuhxFeJa2","toolUseID":"toolu_01Kx7Bc1wQjEkhGPuhxFeJa2","timestamp":"2026-02-21T14:40:10.269Z","uuid":"ee5fae9f-815f-4fc0-ac71-126bbc91c788"}
{"parentUuid":"91e0b273-169b-4f96-a39e-0c20a8d3a5b6","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Kx7Bc1wQjEkhGPuhxFeJa2","type":"tool_result","content":"  1985â†’    border: none;\n  1986â†’    background: transparent;\n  1987â†’    cursor: pointer;\n  1988â†’  }\n  1989â†’\n  1990â†’  .sort-icon {\n  1991â†’    width: 10px;\n  1992â†’    height: 10px;\n  1993â†’    flex-shrink: 0;\n  1994â†’    color: var(--accent);\n  1995â†’  }\n  1996â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"72327f52-0c30-4caa-8276-0bfd59e59edb","timestamp":"2026-02-21T14:40:10.268Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/al02402336/everything/src/App.svelte","content":"    border: none;\n    background: transparent;\n    cursor: pointer;\n  }\n\n  .sort-icon {\n    width: 10px;\n    height: 10px;\n    flex-shrink: 0;\n    color: var(--accent);\n  }\n","numLines":12,"startLine":1985,"totalLines":2282}},"sourceToolAssistantUUID":"91e0b273-169b-4f96-a39e-0c20a8d3a5b6"}
{"parentUuid":"72327f52-0c30-4caa-8276-0bfd59e59edb","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01CmJpkEwcAGvD5jA9CyLTP4","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Vw1NijmnXy2HDzfDsQySAS","name":"Edit","input":{"replace_all":false,"file_path":"/Users/al02402336/everything/src/App.svelte","old_string":"  .sort-icon {\n    width: 10px;\n    height: 10px;\n    flex-shrink: 0;\n    color: var(--accent);\n  }","new_string":"  :global(.sort-icon) {\n    width: 10px;\n    height: 10px;\n    flex-shrink: 0;\n    color: var(--accent);\n  }"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":346,"cache_read_input_tokens":101471,"output_tokens":214,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":346,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYMPRkQ5a5Eyf6rtxikbC","type":"assistant","uuid":"a081b0ed-8e79-422a-8813-f8c8a5df31df","timestamp":"2026-02-21T14:40:13.650Z"}
{"parentUuid":"a081b0ed-8e79-422a-8813-f8c8a5df31df","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01Vw1NijmnXy2HDzfDsQySAS","toolUseID":"toolu_01Vw1NijmnXy2HDzfDsQySAS","timestamp":"2026-02-21T14:40:13.659Z","uuid":"fc58658d-c4ac-4140-83d0-36bc577125ce"}
{"parentUuid":"a081b0ed-8e79-422a-8813-f8c8a5df31df","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Vw1NijmnXy2HDzfDsQySAS","type":"tool_result","content":"The file /Users/al02402336/everything/src/App.svelte has been updated successfully."}]},"uuid":"9d67d6bc-9b24-4bbe-8d2f-05b2c5e5ae82","timestamp":"2026-02-21T14:40:13.658Z","toolUseResult":{"filePath":"/Users/al02402336/everything/src/App.svelte","oldString":"  .sort-icon {\n    width: 10px;\n    height: 10px;\n    flex-shrink: 0;\n    color: var(--accent);\n  }","newString":"  :global(.sort-icon) {\n    width: 10px;\n    height: 10px;\n    flex-shrink: 0;\n    color: var(--accent);\n  }","originalFile":"<script>\n  import { onDestroy, onMount, tick } from 'svelte';\n  import { invoke } from '@tauri-apps/api/core';\n  import { listen } from '@tauri-apps/api/event';\n  import { getCurrentWindow } from '@tauri-apps/api/window';\n  import { startDrag } from '@crabnebula/tauri-plugin-drag';\n\n  const rowHeight = 30;\n  const PAGE_SIZE = 500;\n  let homePrefix = '';\n  const COL_WIDTHS_KEY = 'REDACTED';\n  const THEME_KEY = 'everything-theme';\n  const columnKeys = ['name', 'path', 'size', 'modified'];\n  const minColumnWidth = {\n    name: 180,\n    path: 240,\n    size: 75,\n    modified: 150\n  };\n  const defaultColumnRatios = {\n    name: 0.3,\n    path: 0.45,\n    size: 0.1\n  };\n\n  const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n  let theme = (() => { try { return localStorage.getItem(THEME_KEY) || systemTheme; } catch { return systemTheme; } })();\n  function cycleTheme() {\n    theme = theme === 'dark' ? 'light' : 'dark';\n    try { localStorage.setItem(THEME_KEY, theme); } catch {}\n    invoke('set_native_theme', { theme });\n  }\n\n  function sortIconHtml(dir) {\n    const d = dir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5';\n    return `<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"${d}\"/></svg>`;\n  }\n\n  let query = '';\n  let results = [];\n  let totalResults = 0;\n  let totalResultsKnown = false;\n\n  let dbLatencyMs = null;\n  let dbLastQuery = '';\n  let searchModeLabel = '';\n  let selectedIndices = new Set();\n  let selectionAnchor = -1;\n  let lastSelectedIndex = -1;\n  let editing = {\n    active: false,\n    path: '',\n    index: -1,\n    draftName: ''\n  };\n\n  let renameOverlay = { top: 0, left: 0, width: 0 };\n\n  let indexStatus = {\n    state: 'Indexing',\n    entriesCount: 0,\n    lastUpdated: null,\n    permissionErrors: 0,\n    message: null,\n    isCatchup: false\n  };\n\n  let indexingStartTime = null;\n  let indexingElapsed = '';\n  let indexingFinishedAt = '';\n\n  let sortBy = 'name';\n  let sortDir = 'asc';\n\n  let hasMore = true;\n  let loadingMore = false;\n  let searchGeneration = 0;\n\n  let scanned = 0;\n\n  let searchInputEl;\n  let renameInputEl;\n  let tableAreaEl;\n  let tableContainer;\n  let tableResizeObserver = null;\n  let viewportResizeRaf = null;\n  let scrollTop = 0;\n  let headerScrollLeft = 0;\n  let viewportHeight = 520;\n  let lastTableWidth = 0;\n  let resizingColumn = '';\n  let resizeCleanup = null;\n  let colWidths = {\n    name: 250,\n    path: 350,\n    size: 75,\n    modified: 150\n  };\n\n  let contextMenu = {\n    visible: false,\n    x: 0,\n    y: 0\n  };\n\n  let platform = '';\n  let toast = '';\n  let searchTimer;\n  let lastSearchFiredAt = 0;\n  let toastTimer;\n  let statusRefreshTimer;\n  let elapsedTimer;\n  let statusRefreshInFlight = false;\n  let lastReadyCount = 0;\n\n  const iconCache = new Map();\n  const iconLoading = new Set();\n\n  let highlightCache = new Map();\n  let highlightCacheQuery = '';\n\n  const folderFallbackIcon =\n    \"data:image/svg+xml;utf8,\" +\n    encodeURIComponent(\n      `<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><rect x='1' y='4' width='14' height='10' rx='2' fill='#d9b34f'/><rect x='1' y='2' width='6' height='4' rx='1' fill='#e6ca7a'/></svg>`\n    );\n  const fileFallbackIcon =\n    \"data:image/svg+xml;utf8,\" +\n    encodeURIComponent(\n      `<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><rect x='3' y='1' width='10' height='14' rx='1.5' fill='#b4bec9'/><rect x='5' y='5' width='6' height='1.2' fill='#8d98a5'/><rect x='5' y='8' width='6' height='1.2' fill='#8d98a5'/></svg>`\n    );\n\n  $: totalHeight = results.length * rowHeight;\n  $: startIndex = Math.max(0, Math.floor(scrollTop / rowHeight) - 10);\n  $: visibleCount = Math.ceil(viewportHeight / rowHeight) + 20;\n  $: endIndex = Math.min(results.length, startIndex + visibleCount);\n  $: visibleRows = results.slice(startIndex, endIndex);\n  $: translateY = startIndex * rowHeight;\n  $: tableMinWidth = colWidths.name + colWidths.path + colWidths.size + colWidths.modified;\n  $: tableGridStyle = `--col-name:${colWidths.name}px;--col-path:${colWidths.path}px;--col-size:${colWidths.size}px;--col-modified:${colWidths.modified}px;--table-min-width:${tableMinWidth}px;--header-offset:${-headerScrollLeft}px;`;\n\n  $: {\n    for (const entry of visibleRows) {\n      void ensureIcon(entry);\n    }\n  }\n\n  function showToast(message) {\n    toast = message;\n    clearTimeout(toastTimer);\n    toastTimer = setTimeout(() => {\n      toast = '';\n    }, 3000);\n  }\n\n  function bytesToBase64(bytes) {\n    let binary = '';\n    const chunk = 0x8000;\n    for (let i = 0; i < bytes.length; i += chunk) {\n      const part = bytes.subarray(i, i + chunk);\n      binary += String.fromCharCode(...part);\n    }\n    return btoa(binary);\n  }\n\n  function highlightSegments(name, q) {\n    q = (q || '').trim();\n    if (!q) return [{ text: name, hl: false }];\n\n    // Reset cache when query changes\n    if (q !== highlightCacheQuery) {\n      highlightCache = new Map();\n      highlightCacheQuery = q;\n    }\n\n    // Check cache\n    const cached = highlightCache.get(name);\n    if (cached) return cached;\n\n    if (q.includes('/')) q = q.slice(q.lastIndexOf('/') + 1);\n    q = q.replace(/[*?]/g, '');\n    const terms = q.split(/\\s+/).filter(Boolean);\n    if (terms.length === 0) return [{ text: name, hl: false }];\n\n    const lower = name.toLowerCase();\n    const marks = new Uint8Array(name.length);\n    for (const t of terms) {\n      const tl = t.toLowerCase();\n      let idx = lower.indexOf(tl);\n      while (idx !== -1) {\n        for (let i = idx; i < idx + tl.length; i++) marks[i] = 1;\n        idx = lower.indexOf(tl, idx + 1);\n      }\n    }\n\n    const segs = [];\n    let i = 0;\n    while (i < name.length) {\n      const m = marks[i];\n      let j = i + 1;\n      while (j < name.length && marks[j] === m) j++;\n      segs.push({ text: name.slice(i, j), hl: m === 1 });\n      i = j;\n    }\n\n    highlightCache.set(name, segs);\n    return segs;\n  }\n\n  const perFileIconExts = new Set(['exe', 'lnk', 'ico', 'url', 'scr', 'appx']);\n\n  function iconKey(entry) {\n    if (entry.isDir) return '__folder__';\n    const ext = (entry.ext || '').toLowerCase();\n    if (perFileIconExts.has(ext)) return entry.path;\n    return ext || '__file__';\n  }\n\n  function iconFor(entry) {\n    return iconCache.get(iconKey(entry)) || (entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n  }\n\n  async function ensureIcon(entry) {\n    const key = iconKey(entry);\n    if (iconCache.has(key) || iconLoading.has(key)) {\n      return;\n    }\n\n    iconLoading.add(key);\n    try {\n      const bytes = await invoke('get_file_icon', {\n        path: entry.path,\n        ext: entry.isDir ? 'folder' : entry.ext || '',\n      });\n      if (Array.isArray(bytes) && bytes.length > 0) {\n        const image = `data:image/png;base64,${bytesToBase64(Uint8Array.from(bytes))}`;\n        iconCache.set(key, image);\n      } else {\n        iconCache.set(key, entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n      }\n    } catch {\n      iconCache.set(key, entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n    } finally {\n      iconLoading.delete(key);\n    }\n  }\n\n  function syncColumnWidthsToContainer() {\n    const width = tableContainer?.clientWidth || tableAreaEl?.clientWidth;\n    if (!width || lastTableWidth !== 0) {\n      return;\n    }\n\n    const saved = loadColWidths();\n    if (saved) {\n      const total = columnKeys.reduce((s, k) => s + saved[k], 0);\n      if (Math.abs(total - width) > 2) {\n        const scale = (width - saved.modified) / (total - saved.modified);\n        let scaledName = Math.max(minColumnWidth.name, Math.round(saved.name * scale));\n        let scaledSize = Math.max(minColumnWidth.size, Math.round(saved.size * scale));\n        let rawPath = width - saved.modified - scaledName - scaledSize;\n        if (rawPath < minColumnWidth.path) {\n          const shortfall = minColumnWidth.path - rawPath;\n          const nameReduction = Math.min(shortfall, scaledName - minColumnWidth.name);\n          scaledName -= nameReduction;\n          const remaining = shortfall - nameReduction;\n          if (remaining > 0) {\n            scaledSize -= Math.min(remaining, scaledSize - minColumnWidth.size);\n          }\n          rawPath = width - saved.modified - scaledName - scaledSize;\n        }\n        const scaledPath = Math.max(minColumnWidth.path, rawPath);\n        colWidths = { name: scaledName, path: scaledPath, size: scaledSize, modified: saved.modified };\n      } else {\n        colWidths = saved;\n      }\n    } else {\n      const fixedModified = minColumnWidth.modified;\n      const rest = width - fixedModified;\n      const ratioSum = defaultColumnRatios.name + defaultColumnRatios.path + defaultColumnRatios.size;\n      colWidths = {\n        name: Math.max(minColumnWidth.name, Math.round(rest * defaultColumnRatios.name / ratioSum)),\n        path: Math.max(minColumnWidth.path, Math.round(rest * defaultColumnRatios.path / ratioSum)),\n        size: Math.max(minColumnWidth.size, Math.round(rest * defaultColumnRatios.size / ratioSum)),\n        modified: fixedModified\n      };\n    }\n    lastTableWidth = width;\n  }\n\n  function loadColWidths() {\n    try {\n      const raw = localStorage.getItem(COL_WIDTHS_KEY);\n      if (!raw) return null;\n      const parsed = JSON.parse(raw);\n      for (const key of columnKeys) {\n        if (typeof parsed[key] !== 'number' || parsed[key] < (minColumnWidth[key] || 0)) return null;\n      }\n      return parsed;\n    } catch {\n      return null;\n    }\n  }\n\n  function saveColWidths() {\n    localStorage.setItem(COL_WIDTHS_KEY, JSON.stringify(colWidths));\n  }\n\n  function updateViewportHeight() {\n    viewportHeight = tableContainer?.clientHeight || 520;\n    syncColumnWidthsToContainer();\n  }\n\n  function scheduleViewportHeightUpdate() {\n    if (viewportResizeRaf !== null) {\n      return;\n    }\n    viewportResizeRaf = requestAnimationFrame(() => {\n      viewportResizeRaf = null;\n      updateViewportHeight();\n    });\n  }\n\n  function startColumnResize(event, leftKey) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    const index = columnKeys.indexOf(leftKey);\n    if (index < 0 || index >= columnKeys.length - 1) {\n      return;\n    }\n\n    const startX = event.clientX;\n    const startLeft = colWidths[leftKey];\n    const rightKey = columnKeys[index + 1];\n    const startRight = colWidths[rightKey];\n\n    resizeCleanup?.();\n    resizingColumn = leftKey;\n\n    const onMove = (moveEvent) => {\n      const delta = Math.round(moveEvent.clientX - startX);\n      if (leftKey === 'name') {\n        // Two-column trade: name and path swap space, each respects its minimum\n        const nextLeft = Math.max(\n          minColumnWidth[leftKey],\n          Math.min(startLeft + delta, startLeft + startRight - minColumnWidth[rightKey])\n        );\n        const nextRight = startLeft + startRight - nextLeft;\n        colWidths = { ...colWidths, [leftKey]: nextLeft, [rightKey]: nextRight };\n      } else {\n        // path splitter: path grows unconstrained (allows horizontal scroll on right drag)\n        const nextLeft = Math.max(minColumnWidth[leftKey], startLeft + delta);\n        colWidths = { ...colWidths, [leftKey]: nextLeft };\n      }\n    };\n\n    const onUp = () => {\n      cleanup();\n    };\n\n    const cleanup = () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n      document.body.style.cursor = '';\n      document.body.style.userSelect = '';\n      resizingColumn = '';\n      saveColWidths();\n      if (resizeCleanup === cleanup) {\n        resizeCleanup = null;\n      }\n    };\n\n    resizeCleanup = cleanup;\n    document.body.style.cursor = 'col-resize';\n    document.body.style.userSelect = 'none';\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n  }\n\n  function selectedPaths() {\n    const sorted = [...selectedIndices].sort((a, b) => a - b);\n    return sorted.map((idx) => results[idx]).filter(Boolean).map((entry) => entry.path);\n  }\n\n  function clearSelection() {\n    selectedIndices = new Set();\n    selectionAnchor = -1;\n    lastSelectedIndex = -1;\n  }\n\n  function selectSingle(index) {\n    selectedIndices = new Set([index]);\n    selectionAnchor = index;\n    lastSelectedIndex = index;\n  }\n\n  function selectToggle(index) {\n    const next = new Set(selectedIndices);\n    if (next.has(index)) {\n      next.delete(index);\n    } else {\n      next.add(index);\n    }\n    selectedIndices = next;\n    selectionAnchor = index;\n    lastSelectedIndex = index;\n  }\n\n  function selectRange(index) {\n    const anchor = selectionAnchor >= 0 ? selectionAnchor : index;\n    const [from, to] = [Math.min(anchor, index), Math.max(anchor, index)];\n    const next = new Set();\n    for (let i = from; i <= to; i += 1) {\n      next.add(i);\n    }\n    selectedIndices = next;\n    lastSelectedIndex = index;\n  }\n\n  function primaryEntry() {\n    const idx = lastSelectedIndex >= 0 ? lastSelectedIndex : -1;\n    return idx >= 0 ? results[idx] : null;\n  }\n\n  async function refreshStatus() {\n    if (statusRefreshInFlight) {\n      return;\n    }\n    statusRefreshInFlight = true;\n    try {\n      const status = await invoke('get_index_status');\n      const prevState = indexStatus.state;\n      indexStatus = {\n        state: status.state,\n        entriesCount: status.entriesCount,\n        lastUpdated: status.lastUpdated,\n        permissionErrors: status.permissionErrors ?? 0,\n        message: status.message\n      };\n      if (status.state === 'Indexing' && prevState !== 'Indexing') {\n        startElapsedTimer();\n      } else if (status.state !== 'Indexing' && prevState === 'Indexing') {\n        stopElapsedTimer();\n      }\n      if (typeof status.scanned === 'number') {\n        scanned = status.scanned;\n      }\n      if (status.state === 'Ready' && prevState !== 'Ready') {\n        scheduleSearch();\n      }\n    } catch (err) {\n      showToast(`Failed to get status: ${String(err)}`);\n    } finally {\n      statusRefreshInFlight = false;\n    }\n  }\n\n  function scheduleSearch(preserveScroll = false) {\n    searchGeneration += 1;\n    const scheduledGen = searchGeneration;\n    clearTimeout(searchTimer);\n\n    const now = performance.now();\n    if (now - lastSearchFiredAt >= 200) {\n      // Leading edge: fire immediately if enough time has passed\n      lastSearchFiredAt = now;\n      void runSearch(preserveScroll);\n    } else {\n      // Trailing edge: debounce\n      searchTimer = setTimeout(() => {\n        if (scheduledGen !== searchGeneration) {\n          return;\n        }\n        lastSearchFiredAt = performance.now();\n        void runSearch(preserveScroll);\n      }, 200);\n    }\n  }\n\n  async function runSearch(preserveScroll = false) {\n    searchGeneration += 1;\n    const gen = searchGeneration;\n    const searchQuery = query;\n    const searchSortBy = sortBy;\n    const searchSortDir = sortDir;\n    const startedAt = performance.now();\n    try {\n      const keepPaths = new Set(selectedPaths());\n      const next = await invoke('search', {\n        query: searchQuery,\n        limit: PAGE_SIZE,\n        offset: 0,\n        sortBy: searchSortBy,\n        sortDir: searchSortDir\n      });\n\n      if (gen !== searchGeneration) return;\n\n      dbLatencyMs = Math.round(performance.now() - startedAt);\n      dbLastQuery = searchQuery;\n      const entries = Array.isArray(next.entries) ? next.entries : [];\n      searchModeLabel = next.modeLabel || '';\n      results = entries;\n      if (next.totalCount > 0) {\n        totalResults = next.totalCount;\n        totalResultsKnown = true;\n      } else {\n        totalResults = entries.length;\n        totalResultsKnown = false;\n      }\n      hasMore = totalResultsKnown ? results.length < totalResults : entries.length >= PAGE_SIZE;\n      if (!preserveScroll && tableContainer) tableContainer.scrollTop = 0;\n\n      const restored = new Set();\n      for (let i = 0; i < results.length; i += 1) {\n        if (keepPaths.has(results[i].path)) {\n          restored.add(i);\n        }\n      }\n      selectedIndices = restored;\n\n      updateViewportHeight();\n    } catch (err) {\n      if (gen !== searchGeneration) return;\n      showToast(`Search failed: ${String(err)}`);\n    }\n  }\n\n  async function loadMore() {\n    if (!hasMore || loadingMore) return;\n    const gen = searchGeneration;\n    loadingMore = true;\n    try {\n      const batch = await invoke('search', {\n        query,\n        limit: PAGE_SIZE,\n        offset: results.length,\n        sortBy: sortBy,\n        sortDir: sortDir\n      });\n      if (gen !== searchGeneration) return;\n      const arr = Array.isArray(batch.entries) ? batch.entries : [];\n      if (arr.length > 0) results = [...results, ...arr];\n      hasMore = totalResultsKnown ? results.length < totalResults : arr.length >= PAGE_SIZE;\n    } catch (err) {\n      showToast(`Failed to load more: ${String(err)}`);\n    } finally {\n      loadingMore = false;\n    }\n  }\n\n  function moveSelection(delta, withRange = false) {\n    if (results.length === 0) {\n      return;\n    }\n\n    const current = lastSelectedIndex >= 0 ? lastSelectedIndex : 0;\n    const next = Math.max(0, Math.min(results.length - 1, current + delta));\n\n    if (withRange) {\n      selectRange(next);\n    } else {\n      selectSingle(next);\n    }\n\n    const top = next * rowHeight;\n    const bottom = top + rowHeight;\n    if (top < scrollTop) {\n      tableContainer.scrollTop = top;\n    } else if (bottom > scrollTop + viewportHeight) {\n      tableContainer.scrollTop = bottom - viewportHeight;\n    }\n  }\n\n  function handleHeaderSort(column) {\n    if (sortBy === column) {\n      sortDir = sortDir === 'asc' ? 'desc' : 'asc';\n    } else {\n      sortBy = column;\n      sortDir = 'asc';\n    }\n    if (tableContainer) tableContainer.scrollTop = 0;\n    void runSearch();\n  }\n\n  function handleRowClick(event, index) {\n    contextMenu.visible = false;\n\n    if (event.shiftKey) {\n      selectRange(index);\n      return;\n    }\n\n    if (event.metaKey || event.ctrlKey) {\n      selectToggle(index);\n      return;\n    }\n\n    selectSingle(index);\n  }\n\n  function handleRowContextMenu(event, index) {\n    event.preventDefault();\n\n    if (!selectedIndices.has(index)) {\n      selectSingle(index);\n    }\n\n    if (platform === 'windows' || platform === 'macos') {\n      contextMenu.visible = false;\n      const paths = selectedPaths();\n      if (paths.length > 0) {\n        invoke('show_context_menu', {\n          paths,\n          x: event.clientX,\n          y: event.clientY,\n          singleSelection: selectedIndices.size === 1\n        });\n      }\n      return;\n    }\n\n    contextMenu = {\n      visible: true,\n      x: event.clientX,\n      y: event.clientY\n    };\n  }\n\n  function handleRowA11yKeydown(event, index) {\n    if (event.key === ' ' || event.key === 'Enter') {\n      event.preventDefault();\n      handleRowClick(event, index);\n    }\n  }\n\n  const DRAG_THRESHOLD = 5;\n  let dragCleanup = null;\n  const dragImgCache = new Map();\n\n  function dragPathsForIndex(index) {\n    const entry = results[index];\n    if (!entry) {\n      return [];\n    }\n\n    if (selectedIndices.has(index) && selectedIndices.size > 0) {\n      return selectedPaths();\n    }\n\n    return [entry.path];\n  }\n\n  function getDragIconEl(entry) {\n    const src = iconFor(entry);\n    let img = dragImgCache.get(src);\n    if (!img) {\n      img = new Image();\n      img.src = src;\n      dragImgCache.set(src, img);\n    }\n    return img.complete && img.naturalWidth > 0 ? img : null;\n  }\n\n  function fillRoundRect(ctx, x, y, w, h, r) {\n    ctx.beginPath();\n    ctx.moveTo(x + r, y);\n    ctx.arcTo(x + w, y, x + w, y + h, r);\n    ctx.arcTo(x + w, y + h, x, y + h, r);\n    ctx.arcTo(x, y + h, x, y, r);\n    ctx.arcTo(x, y, x + w, y, r);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  function buildDragPreview(index) {\n    const entry = results[index];\n    if (!entry) return null;\n\n    const count = selectedIndices.has(index) ? selectedIndices.size : 1;\n    const isDark = theme === 'dark';\n\n    const w = 260;\n    const h = 28;\n    const stackGap = count > 1 ? 4 : 0;\n\n    const canvas = document.createElement('canvas');\n    canvas.width = w;\n    canvas.height = h + stackGap;\n    const ctx = canvas.getContext('2d');\n\n    if (count > 1) {\n      ctx.globalAlpha = 0.35;\n      ctx.fillStyle = isDark ? '#5a6070' : '#b0c4de';\n      fillRoundRect(ctx, 3, 0, w - 3, h, 5);\n      ctx.globalAlpha = 1.0;\n    }\n\n    const ry = stackGap;\n    ctx.fillStyle = isDark ? 'rgba(58, 64, 74, 0.94)' : 'rgba(214, 231, 255, 0.94)';\n    fillRoundRect(ctx, 0, ry, w, h, 5);\n\n    ctx.strokeStyle = isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';\n    ctx.lineWidth = 0.5;\n    ctx.beginPath();\n    ctx.moveTo(5, ry);\n    ctx.arcTo(w, ry, w, ry + h, 5);\n    ctx.arcTo(w, ry + h, 0, ry + h, 5);\n    ctx.arcTo(0, ry + h, 0, ry, 5);\n    ctx.arcTo(0, ry, w, ry, 5);\n    ctx.closePath();\n    ctx.stroke();\n\n    const iconEl = getDragIconEl(entry);\n    if (iconEl) {\n      ctx.drawImage(iconEl, 6, ry + 6, 16, 16);\n    } else {\n      ctx.fillStyle = entry.isDir ? '#d9b34f' : '#8d98a5';\n      fillRoundRect(ctx, 6, ry + 6, 16, 16, 2);\n    }\n\n    ctx.fillStyle = isDark ? '#e6e6e8' : '#1a1a1a';\n    ctx.font = '12px -apple-system, \"SF Pro Text\", system-ui, sans-serif';\n    ctx.textBaseline = 'middle';\n\n    let nameMaxW = w - 34;\n    if (count > 1) nameMaxW -= 34;\n\n    let name = entry.name;\n    if (ctx.measureText(name).width > nameMaxW) {\n      while (name.length > 4 && ctx.measureText(name + '\\u2026').width > nameMaxW) {\n        name = name.slice(0, -1);\n      }\n      name += '\\u2026';\n    }\n    ctx.fillText(name, 28, ry + h / 2 + 1);\n\n    if (count > 1) {\n      const badge = String(count);\n      ctx.font = 'bold 10px -apple-system, system-ui, sans-serif';\n      const tw = ctx.measureText(badge).width;\n      const bw = Math.max(20, tw + 10);\n      const bx = w - bw - 6;\n      const by = ry + (h - 18) / 2;\n\n      ctx.fillStyle = isDark ? '#5b8bd9' : '#007aff';\n      fillRoundRect(ctx, bx, by, bw, 18, 9);\n\n      ctx.fillStyle = '#ffffff';\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(badge, bx + bw / 2, by + 9);\n    }\n\n    return canvas.toDataURL('image/png');\n  }\n\n  function handleRowMouseDown(event, index) {\n    if (event.button !== 0) return;\n    if (event.metaKey || event.ctrlKey || event.shiftKey) return;\n    if (editing.active) return;\n\n    const startX = event.clientX;\n    const startY = event.clientY;\n    let dragging = false;\n\n    dragCleanup?.();\n\n    const onMove = (e) => {\n      if (dragging) return;\n      const dx = e.clientX - startX;\n      const dy = e.clientY - startY;\n      if (dx * dx + dy * dy < DRAG_THRESHOLD * DRAG_THRESHOLD) return;\n\n      dragging = true;\n      cleanup();\n\n      if (!selectedIndices.has(index)) {\n        selectSingle(index);\n      }\n\n      const paths = dragPathsForIndex(index);\n      if (paths.length > 0) {\n        const icon = buildDragPreview(index);\n        startDrag({ item: paths, icon }).catch(() => {});\n      }\n    };\n\n    const onUp = () => cleanup();\n\n    const cleanup = () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n      if (dragCleanup === cleanup) dragCleanup = null;\n    };\n\n    dragCleanup = cleanup;\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n  }\n\n  async function handleRowDoubleClick(index) {\n    if (!selectedIndices.has(index) || selectedIndices.size > 1) {\n      selectSingle(index);\n      await tick();\n    }\n    await invoke('open', { paths: [results[index].path] }).catch((err) => {\n      showToast(`Failed to open: ${String(err)}`);\n    });\n  }\n\n  function closeContextMenu() {\n    contextMenu = {\n      ...contextMenu,\n      visible: false\n    };\n  }\n\n  async function openSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('open', { paths });\n    } catch (err) {\n      showToast(`Failed to open: ${String(err)}`);\n    }\n  }\n\n  async function openWithFallback() {\n    const target = primaryEntry();\n    if (!target) {\n      return;\n    }\n\n    try {\n      await invoke('open_with', { path: target.path });\n    } catch (err) {\n      showToast(`Open With failed: ${String(err)}`);\n    }\n  }\n\n  async function revealSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('reveal_in_finder', { paths });\n    } catch (err) {\n      showToast(`Failed to reveal in Finder: ${String(err)}`);\n    }\n  }\n\n  async function copySelectedPaths() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('copy_paths', { paths });\n      showToast(`Copied ${paths.length} path(s)`);\n    } catch (err) {\n      showToast(`Failed to copy path: ${String(err)}`);\n    }\n  }\n\n  async function copyFiles() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('copy_files', { paths });\n      showToast(`Copied ${paths.length} item(s)`);\n    } catch (err) {\n      showToast(`Failed to copy: ${String(err)}`);\n    }\n  }\n\n  async function trashSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    const message =\n      paths.length === 1\n        ? 'Move selected item to Trash?'\n        : `Move ${paths.length} items to Trash?`;\n\n    if (!window.confirm(message)) {\n      return;\n    }\n\n    try {\n      await invoke('move_to_trash', { paths });\n      showToast('Moved to Trash.');\n      clearSelection();\n      await runSearch();\n    } catch (err) {\n      showToast(`Failed to move to Trash: ${String(err)}`);\n    }\n  }\n\n  async function resetIndex() {\n    if (indexStatus.state === 'Indexing') {\n      showToast('Indexing in progress. Please try again after it completes.');\n      return;\n    }\n\n    results = [];\n    totalResults = 0;\n    totalResultsKnown = false;\n    clearSelection();\n    scanned = 0;\n    dbLatencyMs = null;\n    dbLastQuery = '';\n    indexStatus = { ...indexStatus, state: 'Indexing', entriesCount: 0, message: null };\n    indexingStartTime = Date.now();\n    indexingElapsed = '';\n    indexingFinishedAt = '';\n\n    try {\n      await invoke('reset_index');\n    } catch (err) {\n      showToast(`Failed to reset index: ${String(err)}`);\n      await refreshStatus();\n    }\n  }\n\n  function isMultiSelected() {\n    return selectedIndices.size > 1;\n  }\n\n  function autoResizeRenameInput() {\n    if (!renameInputEl) return;\n    renameInputEl.style.height = '0';\n    renameInputEl.style.height = renameInputEl.scrollHeight + 'px';\n  }\n\n  async function startRename() {\n    if (isMultiSelected()) {\n      return;\n    }\n\n    const idx = lastSelectedIndex;\n    if (idx < 0 || !results[idx]) {\n      return;\n    }\n\n    const entry = results[idx];\n\n    // Calculate overlay position mathematically.\n    // Name cell text starts at: padding-left(16) + icon(16) + gap(6) = 38px from cell left.\n    // Textarea has padding-left: 0 and border: 1.5px, so text starts ~2px from overlay left.\n    if (tableContainer) {\n      const rect = tableContainer.getBoundingClientRect();\n      const cellLeft = rect.left - tableContainer.scrollLeft;\n      const textLeft = cellLeft + 38;\n      const cellRight = cellLeft + colWidths.name;\n      const rowTop = rect.top + idx * rowHeight - tableContainer.scrollTop;\n      renameOverlay = {\n        top: rowTop,\n        left: textLeft - 2,\n        width: cellRight - textLeft + 2 - 4\n      };\n    }\n\n    editing = {\n      active: true,\n      path: entry.path,\n      index: idx,\n      draftName: entry.name\n    };\n\n    await tick();\n\n    if (renameInputEl) {\n      autoResizeRenameInput();\n      renameInputEl.focus();\n      const extPos = !entry.isDir ? entry.name.lastIndexOf('.') : -1;\n      const selectionEnd = extPos > 0 ? extPos : entry.name.length;\n      renameInputEl.setSelectionRange(0, selectionEnd);\n    }\n  }\n\n  function cancelRename() {\n    editing = {\n      active: false,\n      path: '',\n      index: -1,\n      draftName: ''\n    };\n  }\n\n  async function commitRename() {\n    if (!editing.active || editing.index < 0 || !results[editing.index]) {\n      return;\n    }\n\n    const current = results[editing.index];\n    const nextName = editing.draftName;\n\n    try {\n      await invoke('rename', {\n        path: current.path,\n        newName: nextName\n      });\n      cancelRename();\n      await runSearch();\n    } catch (err) {\n      showToast(`Failed to rename: ${String(err)}`);\n      await tick();\n      renameInputEl?.focus();\n    }\n  }\n\n  function onGlobalClick() {\n    closeContextMenu();\n  }\n\n  function onTitleBarMouseDown(event) {\n    if (event.button !== 0) {\n      return;\n    }\n\n    const activeElement = document.activeElement;\n    if (activeElement instanceof HTMLElement && isTextInputTarget(activeElement)) {\n      activeElement.blur();\n    }\n  }\n\n  async function focusSearch() {\n    await getCurrentWindow().show();\n    await getCurrentWindow().setFocus();\n    searchInputEl?.focus();\n    searchInputEl?.select();\n  }\n\n  function isTextInputTarget(target) {\n    return (\n      target instanceof HTMLInputElement ||\n      target instanceof HTMLTextAreaElement ||\n      target?.isContentEditable\n    );\n  }\n\n  async function handleKeydown(event) {\n    const isMetaSelectAll = (event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'a';\n    const isMetaCopy = (event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'c';\n    const target = event.target;\n    const isTextInput = isTextInputTarget(target);\n\n    if (isMetaCopy && isTextInput) {\n      return;\n    }\n\n    if (isMetaSelectAll) {\n      if (isTextInput) {\n        event.preventDefault();\n        if (target instanceof HTMLInputElement || target instanceof HTMLTextAreaElement) {\n          target.select();\n        }\n        return;\n      }\n    }\n\n    if (editing.active) {\n      if (event.key === 'Enter') {\n        event.preventDefault();\n        await commitRename();\n        return;\n      }\n\n      if (event.key === 'Escape') {\n        event.preventDefault();\n        const idx = editing.index;\n        cancelRename();\n        selectSingle(idx);\n        await tick();\n        tableContainer?.querySelector('.row.selected')?.focus();\n        return;\n      }\n      return;\n    }\n\n    if (event.key === 'Escape') {\n      event.preventDefault();\n      clearSelection();\n      return;\n    }\n\n    if (event.key === 'ArrowDown') {\n      event.preventDefault();\n      moveSelection(1, event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'ArrowUp') {\n      event.preventDefault();\n      moveSelection(-1, event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'PageDown') {\n      event.preventDefault();\n      moveSelection(Math.floor(viewportHeight / rowHeight), event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'PageUp') {\n      event.preventDefault();\n      moveSelection(-Math.floor(viewportHeight / rowHeight), event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'Enter') {\n      event.preventDefault();\n      if (platform === 'windows') {\n        await openSelected();\n      } else {\n        await startRename();\n      }\n      return;\n    }\n\n    if (event.key === 'F2') {\n      event.preventDefault();\n      await startRename();\n      return;\n    }\n\n    if (event.key === ' ' && !isTextInput) {\n      event.preventDefault();\n      const entry = primaryEntry();\n      if (entry) {\n        await invoke('quick_look', { path: entry.path });\n      }\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'f') {\n      event.preventDefault();\n      clearSelection();\n      searchInputEl?.focus();\n      searchInputEl?.select();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'o') {\n      event.preventDefault();\n      await openSelected();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key === 'Enter') {\n      event.preventDefault();\n      await revealSelected();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'c') {\n      event.preventDefault();\n      await copySelectedPaths();\n      return;\n    }\n\n    if (isMetaSelectAll) {\n      event.preventDefault();\n      selectedIndices = new Set(Array.from({ length: results.length }, (_, i) => i));\n      return;\n    }\n\n    if (event.key === 'Delete' || ((event.metaKey || event.ctrlKey) && event.key === 'Backspace')) {\n      if (!isTextInput) {\n        event.preventDefault();\n        await trashSelected();\n      }\n      return;\n    }\n  }\n\n  function formatSize(entry) {\n    if (entry.isDir || entry.size == null) return '';\n    const bytes = entry.size;\n    if (bytes < 1024) return `${bytes} B`;\n    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n    if (bytes < 1024 * 1024 * 1024) return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n    return `${(bytes / (1024 * 1024 * 1024)).toFixed(1)} GB`;\n  }\n\n  function formatModified(entry) {\n    if (!entry.mtime) {\n      return '';\n    }\n\n    const d = new Date(entry.mtime * 1000);\n    const pad = (n) => String(n).padStart(2, '0');\n    return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;\n  }\n\n  function formatLastUpdated(timestamp) {\n    if (!timestamp) {\n      return '-';\n    }\n\n    return new Date(timestamp * 1000).toLocaleString();\n  }\n\n  function formatElapsed(ms) {\n    const totalSec = Math.floor(ms / 1000);\n    const min = Math.floor(totalSec / 60);\n    const sec = totalSec % 60;\n    return min > 0 ? `${min}m ${sec}s` : `${sec}s`;\n  }\n\n  function updateElapsed() {\n    if (indexingStartTime && indexStatus.state === 'Indexing') {\n      indexingElapsed = formatElapsed(Date.now() - indexingStartTime);\n    }\n  }\n\n  function startElapsedTimer() {\n    clearInterval(elapsedTimer);\n    indexingStartTime = Date.now();\n    indexingElapsed = '0s';\n    indexingFinishedAt = '';\n    elapsedTimer = setInterval(updateElapsed, 1000);\n  }\n\n  function stopElapsedTimer() {\n    clearInterval(elapsedTimer);\n    if (indexingStartTime) {\n      const elapsed = Date.now() - indexingStartTime;\n      indexingFinishedAt = `${formatElapsed(elapsed)}`;\n    }\n    indexingStartTime = null;\n    indexingElapsed = '';\n  }\n\n  function displayPath(path) {\n    if (!path) {\n      return path;\n    }\n\n    if (!homePrefix) {\n      return path;\n    }\n\n    if (path === homePrefix) {\n      return '~';\n    }\n\n    if (path.startsWith(`${homePrefix}/`)) {\n      return `~${path.slice(homePrefix.length)}`;\n    }\n\n    return path;\n  }\n\n  let unlistenFns = [];\n\n  onMount(async () => {\n    const t0 = performance.now();\n    const ms = () => Math.round(performance.now() - t0);\n    const DEBUG_STARTUP = false;\n    const flog = DEBUG_STARTUP ? (msg) => invoke('frontend_log', { msg }).catch(() => {}) : () => {};\n\n    flog(`[startup/fe] onMount entered`);\n\n    updateViewportHeight();\n    flog(`[startup/fe] +${ms()}ms updateViewportHeight done`);\n\n    invoke('set_native_theme', { theme });\n\n    platform = await invoke('get_platform');\n    flog(`[startup/fe] +${ms()}ms get_platform done`);\n\n    const unlistenProgress = await listen('index_progress', (event) => {\n      scanned = event.payload.scanned;\n      if (indexStatus.state !== 'Indexing') {\n        indexStatus = {\n          ...indexStatus,\n          state: 'Indexing'\n        };\n      }\n    });\n    flog(`[startup/fe] +${ms()}ms listen(index_progress) registered`);\n\n    const unlistenState = await listen('index_state', (event) => {\n      flog(`[startup/fe] index_state event received: ${event.payload.state} at +${ms()}ms`);\n      const prevState = indexStatus.state;\n      indexStatus = {\n        ...indexStatus,\n        state: event.payload.state,\n        message: event.payload.message ?? null,\n        isCatchup: event.payload.isCatchup ?? false\n      };\n\n      if (event.payload.state === 'Indexing' && prevState !== 'Indexing') {\n        if (prevState === 'Ready') {\n          lastReadyCount = indexStatus.entriesCount;\n        }\n        startElapsedTimer();\n      } else if (event.payload.state !== 'Indexing' && prevState === 'Indexing') {\n        stopElapsedTimer();\n      }\n\n      if (event.payload.state === 'Ready') {\n        scheduleSearch();\n      }\n    });\n    flog(`[startup/fe] +${ms()}ms listen(index_state) registered`);\n\n    const unlistenUpdated = await listen('index_updated', (event) => {\n      indexStatus = {\n        ...indexStatus,\n        entriesCount: event.payload.entriesCount,\n        lastUpdated: event.payload.lastUpdated,\n        permissionErrors: event.payload.permissionErrors ?? indexStatus.permissionErrors\n      };\n\n      scheduleSearch(true);\n    });\n\n    const unlistenFocus = await listen('focus_search', () => {\n      void focusSearch();\n    });\n\n    const unlistenCtxMenuAction = await listen('context_menu_action', (event) => {\n      switch (event.payload) {\n        case 'open': void openSelected(); break;\n        case 'quick_look': {\n          const e = primaryEntry();\n          if (e) void invoke('quick_look', { path: e.path });\n          break;\n        }\n        case 'open_with': void openWithFallback(); break;\n        case 'reveal': void revealSelected(); break;\n        case 'copy_files': void copyFiles(); break;\n        case 'copy_path': void copySelectedPaths(); break;\n        case 'trash': void trashSelected(); break;\n        case 'rename': void startRename(); break;\n      }\n    });\n\n    unlistenFns = [unlistenProgress, unlistenState, unlistenUpdated, unlistenFocus, unlistenCtxMenuAction];\n    flog(`[startup/fe] +${ms()}ms all listeners registered`);\n\n    // Fetch backend state IMMEDIATELY after listeners are registered.\n    // Events emitted before listener registration are lost, so this\n    // is the only reliable way to get the current state.\n    await refreshStatus();\n    flog(`[startup/fe] +${ms()}ms refreshStatus done (state=${indexStatus.state})`);\n\n    // Show Svelte UI: remove skeleton, focus search input.\n    await tick();\n    document.getElementById('skeleton')?.remove();\n    await focusSearch();\n    flog(`[startup/fe] +${ms()}ms WINDOW VISIBLE â€” skeleton removed`);\n\n    try {\n      homePrefix = await invoke('get_home_dir');\n    } catch {\n      homePrefix = '';\n    }\n    flog(`[startup/fe] +${ms()}ms get_home_dir done`);\n\n    if (!localStorage.getItem('everything-fda-notice-v1')) {\n      showToast('macOS Full Disk Access permission may be required for full disk search.');\n      localStorage.setItem('everything-fda-notice-v1', '1');\n    }\n    flog(`[startup/fe] +${ms()}ms calling runSearch...`);\n    await runSearch();\n    flog(`[startup/fe] +${ms()}ms runSearch done`);\n\n    if (typeof ResizeObserver !== 'undefined') {\n      tableResizeObserver = new ResizeObserver(() => {\n        scheduleViewportHeightUpdate();\n      });\n      if (tableContainer) {\n        tableResizeObserver.observe(tableContainer);\n      } else if (tableAreaEl) {\n        tableResizeObserver.observe(tableAreaEl);\n      }\n    }\n\n    window.addEventListener('resize', scheduleViewportHeightUpdate);\n    window.addEventListener('click', onGlobalClick);\n    statusRefreshTimer = setInterval(() => {\n      if (indexStatus.state === 'Indexing') {\n        void refreshStatus();\n      }\n    }, 1000);\n    console.log(`[startup/fe] +${ms()}ms onMount complete`);\n  });\n\n  onDestroy(async () => {\n    clearTimeout(searchTimer);\n    clearTimeout(toastTimer);\n    clearInterval(statusRefreshTimer);\n    clearInterval(elapsedTimer);\n    resizeCleanup?.();\n\n    for (const unlisten of unlistenFns) {\n      unlisten();\n    }\n\n    tableResizeObserver?.disconnect();\n    tableResizeObserver = null;\n    if (viewportResizeRaf !== null) {\n      cancelAnimationFrame(viewportResizeRaf);\n      viewportResizeRaf = null;\n    }\n    window.removeEventListener('resize', scheduleViewportHeightUpdate);\n    window.removeEventListener('click', onGlobalClick);\n  });\n</script>\n\n<svelte:window on:keydown={handleKeydown} />\n\n<div class=\"app-shell\" data-theme={theme}>\n  <div class=\"title-bar\" role=\"presentation\" data-tauri-drag-region on:mousedown={onTitleBarMouseDown}>\n    <div class=\"title-left\"></div>\n    <div class=\"title-center\">\n      <svg class=\"title-icon\" viewBox=\"0 0 215 205\" fill-rule=\"evenodd\" aria-hidden=\"true\">\n        <path d=\"M85 0c46.9 0 85 38.1 85 85 0 20.1-7.2 38.5-19.2 52.7l40.7 40.8c5.8 5.8 5.8 15.2 0 21-5.8 5.8-15.2 5.8-21 0l-40.7-40.7c-13.6 9.7-30.4 15.2-44.8 15.2-46.9 0-85-42.1-85-89 0-46.9 38.1-85 85-85z m0 32c-29.3 0-53 23.7-53 53 0 29.3 23.7 53 53 53 29.3 0 53-23.7 53-53 0-29.3-23.7-53-53-53z\"/>\n      </svg>\n      <span class=\"title-text\">Everything</span>\n    </div>\n    <div class=\"title-right\"></div>\n  </div>\n\n  <header class=\"search-bar\">\n    <input\n      bind:this={searchInputEl}\n      class=\"search-input\"\n      type=\"text\"\n      bind:value={query}\n      on:input={scheduleSearch}\n      on:focus={clearSelection}\n      placeholder=\"Search file/folder names\"\n      autocomplete=\"off\"\n      spellcheck=\"false\"\n    />\n  </header>\n\n  <section class=\"table-area\" bind:this={tableAreaEl} style={tableGridStyle}>\n    <div class=\"table-header\">\n      <div class=\"table-header-track\">\n        <div class=\"col name\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('name')}>\n            Name{#if sortBy === 'name'}{@html sortIconHtml(sortDir)}{/if}\n          </button>\n          <button\n            type=\"button\"\n            class=\"col-resizer\"\n            class:active={resizingColumn === 'name'}\n            on:mousedown={(event) => startColumnResize(event, 'name')}\n            aria-label=\"Resize Name column\"\n          />\n        </div>\n\n        <div class=\"col path\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('dir')}>\n            Path{#if sortBy === 'dir'}{@html sortIconHtml(sortDir)}{/if}\n          </button>\n          <button\n            type=\"button\"\n            class=\"col-resizer\"\n            class:active={resizingColumn === 'path'}\n            on:mousedown={(event) => startColumnResize(event, 'path')}\n            aria-label=\"Resize Path column\"\n          />\n        </div>\n\n        <div class=\"col size\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('size')}>\n            Size{#if sortBy === 'size'}{@html sortIconHtml(sortDir)}{/if}\n          </button>\n        </div>\n\n        <div class=\"col modified\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('mtime')}>\n            Modified{#if sortBy === 'mtime'}{@html sortIconHtml(sortDir)}{/if}\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <div\n      class=\"table-body\"\n      bind:this={tableContainer}\n      on:scroll={() => {\n        scrollTop = tableContainer.scrollTop;\n        headerScrollLeft = tableContainer.scrollLeft;\n        if (editing.active) void commitRename();\n        const scrollBottom = scrollTop + tableContainer.clientHeight;\n        if (scrollBottom >= totalHeight - rowHeight * 10) {\n          void loadMore();\n        }\n      }}\n    >\n      <div class=\"spacer\" style={`height:${totalHeight}px`}>\n        <div class=\"rows\" style={`transform: translateY(${translateY}px);`}>\n          {#each visibleRows as entry, localIndex}\n            {@const index = startIndex + localIndex}\n            <div\n              class=\"row {selectedIndices.has(index) ? 'selected' : ''}\"\n              on:mousedown={(event) => handleRowMouseDown(event, index)}\n              on:click={(event) => handleRowClick(event, index)}\n              on:keydown={(event) => handleRowA11yKeydown(event, index)}\n              on:dblclick={() => handleRowDoubleClick(index)}\n              on:contextmenu={(event) => handleRowContextMenu(event, index)}\n              role=\"row\"\n              tabindex=\"0\"\n            >\n              <div class=\"cell name\">\n                <img class=\"file-icon\" src={iconFor(entry)} alt=\"\" />\n                <span class=\"ellipsis\" class:name-editing={editing.active && editing.index === index}>{#each highlightSegments(entry.name, query) as seg}{#if seg.hl}<mark class=\"hl\">{seg.text}</mark>{:else}{seg.text}{/if}{/each}</span>\n              </div>\n              <div class=\"cell path\"><span class=\"ellipsis\">{displayPath(entry.dir)}</span></div>\n              <div class=\"cell size\">{formatSize(entry)}</div>\n              <div class=\"cell modified\">{formatModified(entry)}</div>\n            </div>\n          {/each}\n        </div>\n      </div>\n    </div>\n  </section>\n\n  <footer class=\"status-bar\">\n    <div class=\"status-left\">\n      <span class=\"status-state\">\n        <span class=\"state-dot {indexStatus.state === 'Indexing' ? 'indexing' : indexStatus.state === 'Error' ? 'error' : 'ready'}\"></span>\n        {#if indexStatus.state === 'Indexing'}\n          Indexing{#if lastReadyCount > 0} ({Math.min(99, Math.round((scanned / lastReadyCount) * 100))}%){/if}{#if indexingElapsed} Â· {indexingElapsed}{/if}\n          {#if !indexStatus.isCatchup}\n            Â· {scanned.toLocaleString()} scanned\n          {/if}\n        {:else}\n          Index: {indexStatus.state}\n        {/if}\n      </span>\n      <span>{indexStatus.entriesCount.toLocaleString()} entries</span>\n      {#if indexingFinishedAt && indexStatus.state !== 'Indexing'}\n        <span>in {indexingFinishedAt}</span>\n      {/if}\n      {#if dbLatencyMs !== null && dbLastQuery}\n        <span>\"{dbLastQuery}\" {dbLatencyMs}ms Â· {totalResults} results</span>\n      {/if}\n      {#if searchModeLabel === 'spotlight' || searchModeLabel === 'spotlight_timeout'}\n        <span class=\"status-spotlight\">Spotlight fallback{#if searchModeLabel === 'spotlight_timeout'} (partial){/if}</span>\n      {/if}\n      {#if indexStatus.permissionErrors > 0}\n        <span class=\"status-warning\">{indexStatus.permissionErrors.toLocaleString()} permission errors</span>\n      {/if}\n      {#if indexStatus.message}\n        <span class={indexStatus.isCatchup ? 'index-progress' : 'status-error'}>{indexStatus.message}</span>\n      {/if}\n    </div>\n    <div class=\"status-right\">\n      <button class=\"status-btn\" on:click={cycleTheme} title=\"Switch theme\">\n        {theme === 'dark' ? 'â˜€ Light' : 'â—‘ Dark'}\n      </button>\n      <button\n        class=\"status-btn rebuild-btn\"\n        on:click={resetIndex}\n        disabled={indexStatus.state === 'Indexing'}\n        title={indexStatus.state === 'Indexing' ? 'Cannot reset while indexing is in progress.' : 'Reset and rebuild the index.'}\n      >\n        <svg class=\"rebuild-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <path d=\"M23 4v6h-6\"/><path d=\"M20.49 15a9 9 0 1 1-2.12-9.36L23 10\"/>\n        </svg>\n        Rebuild Index\n      </button>\n    </div>\n  </footer>\n\n  {#if editing.active}\n    <div\n      class=\"rename-overlay\"\n      style=\"top:{renameOverlay.top}px; left:{renameOverlay.left}px; width:{renameOverlay.width}px;\"\n      role=\"presentation\"\n      on:mousedown|stopPropagation\n    >\n      <textarea\n        bind:this={renameInputEl}\n        class=\"rename-textarea\"\n        bind:value={editing.draftName}\n        on:input={autoResizeRenameInput}\n        on:click|stopPropagation\n        on:blur={commitRename}\n      />\n    </div>\n  {/if}\n\n  {#if contextMenu.visible}\n    <div class=\"context-menu\" style={`left:${contextMenu.x}px;top:${contextMenu.y}px;`}>\n      <button on:click={() => (closeContextMenu(), openSelected())}>Open</button>\n      <button on:click={async () => { closeContextMenu(); const e = primaryEntry(); if (e) await invoke('quick_look', { path: e.path }); }}>Quick Look</button>\n      <button on:click={() => (closeContextMenu(), openWithFallback())}>Open With... (Reveal in Finder)</button>\n      <button on:click={() => (closeContextMenu(), revealSelected())}>Reveal in Finder</button>\n      <button on:click={() => (closeContextMenu(), copySelectedPaths())}>Copy Path</button>\n      <button on:click={() => (closeContextMenu(), trashSelected())}>Move to Trash</button>\n      {#if selectedIndices.size === 1}\n        <button on:click={() => (closeContextMenu(), startRename())}>Rename</button>\n      {/if}\n    </div>\n  {/if}\n\n  {#if toast}\n    <div class=\"toast\">{toast}</div>\n  {/if}\n</div>\n\n<style>\n  :global(:root) {\n    color-scheme: light dark;\n    --bg-app: transparent;\n    --text-primary: #0d1826;\n    --text-muted: #48596c;\n    --bar-grad-top: rgba(255, 255, 255, 0.48);\n    --bar-grad-bottom: rgba(248, 250, 253, 0.42);\n    --surface-header: rgba(252, 252, 255, 0.40);\n    --surface: rgba(255, 255, 255, 0.22);\n    --border-soft: rgba(0, 0, 0, 0.07);\n    --border-input: rgba(0, 0, 0, 0.13);\n    --focus-ring: #6f96e6;\n    --row-border: rgba(0, 0, 0, 0.032);\n    --row-hover: rgba(0, 0, 0, 0.06);\n    --row-selected: rgba(0, 0, 0, 0.12);\n    --button-bg: rgba(255, 255, 255, 0.62);\n    --button-border: rgba(0, 0, 0, 0.10);\n    --button-text: #2c3e50;\n    --menu-bg: rgba(240, 241, 248, 0.90);\n    --menu-border: rgba(0, 0, 0, 0.06);\n    --menu-hover: rgba(255, 255, 255, 0.62);\n    --menu-text: #1a2a38;\n    --error-text: #b64545;\n    --warning-text: #8f6500;\n    --toast-bg: rgba(18, 22, 32, 0.90);\n    --toast-text: #ffffff;\n  }\n\n  @media (prefers-color-scheme: dark) {\n    :global(:root) {\n      --bg-app: transparent;\n      --text-primary: #e6e6ea;\n      --text-muted: #9494a4;\n      --bar-grad-top: rgba(38, 38, 46, 0.52);\n      --bar-grad-bottom: rgba(30, 30, 38, 0.46);\n      --surface-header: rgba(32, 32, 40, 0.46);\n      --surface: rgba(18, 18, 26, 0.32);\n      --border-soft: rgba(255, 255, 255, 0.065);\n      --border-input: rgba(255, 255, 255, 0.14);\n      --focus-ring: #5b8bd9;\n      --row-border: rgba(255, 255, 255, 0.026);\n      --row-hover: rgba(255, 255, 255, 0.08);\n      --row-selected: rgba(255, 255, 255, 0.14);\n      --button-bg: rgba(255, 255, 255, 0.072);\n      --button-border: rgba(255, 255, 255, 0.11);\n      --button-text: #d6d6e0;\n      --menu-bg: rgba(36, 36, 46, 0.90);\n      --menu-border: rgba(255, 255, 255, 0.066);\n      --menu-hover: rgba(255, 255, 255, 0.062);\n      --menu-text: #e0e0e8;\n      --error-text: #ff9d9d;\n      --warning-text: #e0c670;\n      --toast-bg: rgba(10, 10, 16, 0.93);\n      --toast-text: #f2f2f6;\n    }\n  }\n\n  /* â”€â”€ Theme: Dark â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme=\"dark\"]) {\n    color-scheme: dark;\n    --bg-app: #1E1E21;\n    --text-primary: #E2E8F0;\n    --text-muted: #94A3B8;\n    --bar-grad-top: #1E1E21;\n    --bar-grad-bottom: #1E1E21;\n    --surface-header: #1E1E21;\n    --surface: #1E1E21;\n    --bg-input: #161618;\n    --border-soft: #2A2A2D;\n    --border-input: rgba(255, 255, 255, 0.06);\n    --focus-ring: #4DA8FF;\n    --accent: #4DA8FF;\n    --row-border: rgba(255, 255, 255, 0.02);\n    --row-hover: #282828;\n    --row-selected: rgba(77, 168, 255, 0.10);\n    --button-bg: rgba(255, 255, 255, 0.05);\n    --button-border: #2A2A2D;\n    --button-text: #94A3B8;\n    --menu-bg: #252528;\n    --menu-border: #2A2A2D;\n    --menu-hover: rgba(255, 255, 255, 0.04);\n    --menu-text: #E2E8F0;\n    --error-text: #ff9d9d;\n    --warning-text: #e0c670;\n    --toast-bg: rgba(10, 10, 16, 0.93);\n    --toast-text: #f2f2f6;\n  }\n\n  /* â”€â”€ Theme: Light â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme=\"light\"]) {\n    color-scheme: light;\n    --bg-app: #F5F5F7;\n    --text-primary: #1C1C1E;\n    --text-muted: #6E6E7A;\n    --bar-grad-top: #F5F5F7;\n    --bar-grad-bottom: #F5F5F7;\n    --surface-header: #F5F5F7;\n    --surface: #F5F5F7;\n    --bg-input: #FFFFFF;\n    --border-soft: #D1D1D6;\n    --border-input: rgba(0, 0, 0, 0.10);\n    --focus-ring: #3A8BF5;\n    --accent: #3A8BF5;\n    --row-border: rgba(0, 0, 0, 0.04);\n    --row-hover: rgba(0, 0, 0, 0.04);\n    --row-selected: rgba(58, 139, 245, 0.10);\n    --button-bg: #FFFFFF;\n    --button-border: #D1D1D6;\n    --button-text: #3C3C43;\n    --menu-bg: #FFFFFF;\n    --menu-border: #D1D1D6;\n    --menu-hover: rgba(0, 0, 0, 0.05);\n    --menu-text: #1C1C1E;\n    --error-text: #D93025;\n    --warning-text: #B45309;\n    --toast-bg: rgba(255, 255, 255, 0.95);\n    --toast-text: #1C1C1E;\n  }\n\n  /* â”€â”€ Themed element overrides â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme]) {\n    background: var(--bg-app);\n  }\n\n  /* Search bar: flat, no gradient, no separator */\n  :global([data-theme]) .search-bar {\n    height: 44px;\n    padding: 0 16px;\n    background: var(--bg-app);\n    border-bottom: none;\n  }\n\n  :global([data-theme]) .search-input {\n    backdrop-filter: none;\n    -webkit-backdrop-filter: none;\n    font-family: 'JetBrains Mono', 'SF Mono', monospace;\n    font-size: 12px;\n    height: 34px;\n    border-radius: 8px;\n  }\n\n  /* Table header: flat bg, 16px edge padding */\n  :global([data-theme]) .table-header {\n    background: var(--bg-app);\n  }\n\n  :global([data-theme]) .col-button {\n    padding: 0 8px;\n  }\n\n  :global([data-theme]) .col.name .col-button {\n    padding-left: 16px;\n  }\n\n  /* Row cells: JetBrains Mono, 16px outer edges */\n  :global([data-theme]) .cell {\n    font-family: 'JetBrains Mono', monospace;\n  }\n\n  :global([data-theme]) .cell.name {\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    padding-left: 16px;\n    font-size: 12px;\n    color: var(--text-primary);\n  }\n\n  :global([data-theme]) .cell.path {\n    font-size: 11px;\n  }\n\n  :global([data-theme]) .cell.size {\n    font-size: 11px;\n  }\n\n  :global([data-theme]) .cell.modified {\n    padding-right: 16px;\n    font-size: 11px;\n    white-space: nowrap;\n  }\n\n  :global([data-theme]) .row.selected {\n    box-shadow: inset 3px 0 0 var(--accent);\n  }\n\n  /* Dim path/size/date cells in themed mode */\n  :global([data-theme]) .cell.path,\n  :global([data-theme]) .cell.size,\n  :global([data-theme]) .cell.modified {\n    color: var(--text-muted);\n  }\n\n  :global(:root) {\n    background: transparent;\n  }\n\n  :global(html, body) {\n    margin: 0;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n    background: transparent;\n    color: var(--text-primary);\n    font-family: Inter, 'SF Pro Text', 'Segoe UI', Helvetica, Arial, sans-serif;\n  }\n\n  :global(#app) {\n    width: 100%;\n    height: 100%;\n  }\n\n  .app-shell {\n    display: grid;\n    grid-template-rows: auto auto 1fr auto;\n    height: 100%;\n    min-width: 0;\n  }\n\n  .title-bar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 44px;\n    padding: 0 16px;\n    background: var(--surface-header);\n    cursor: default;\n    flex-shrink: 0;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-left {\n    width: 72px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-center {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-right {\n    width: 72px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-icon {\n    width: 14px;\n    height: 14px;\n    fill: var(--accent);\n    flex-shrink: 0;\n  }\n\n  .title-text {\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--text-primary);\n    letter-spacing: -0.01em;\n  }\n\n  .search-bar {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 8px;\n    background: linear-gradient(180deg, var(--bar-grad-top) 0%, var(--bar-grad-bottom) 100%);\n    border-bottom: 1px solid var(--border-soft);\n    min-width: 0;\n    flex-shrink: 0;\n  }\n\n  .search-input {\n    display: block;\n    box-sizing: border-box;\n    width: 100%;\n    min-width: 0;\n    flex: 1 1 auto;\n    height: 36px;\n    border: 1px solid var(--border-input);\n    border-radius: 14px;\n    padding: 0 10px;\n    font-size: 14px;\n    background: var(--bg-input, var(--surface));\n    color: var(--text-primary);\n    backdrop-filter: blur(12px) saturate(160%);\n    -webkit-backdrop-filter: blur(12px) saturate(160%);\n  }\n\n  .search-input::placeholder {\n    color: var(--text-muted);\n    opacity: 0.85;\n    font-size: 12px;\n  }\n\n  .search-input:focus {\n    outline: none;\n    border-color: var(--focus-ring);\n    box-shadow: 0 0 0 2px rgba(125, 169, 255, 0.25);\n  }\n\n  .table-area {\n    display: grid;\n    grid-template-rows: auto 1fr;\n    min-height: 0;\n    min-width: 0;\n  }\n\n  .table-header-track,\n  .row {\n    display: grid;\n    grid-template-columns: var(--col-name) var(--col-path) var(--col-size) var(--col-modified);\n    align-items: center;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .table-header {\n    height: 32px;\n    border-bottom: 1px solid var(--border-soft);\n    background: var(--surface-header);\n    user-select: none;\n    overflow: hidden;\n    flex-shrink: 0;\n  }\n\n  .table-header-track {\n    height: 100%;\n    transform: translateX(var(--header-offset, 0px));\n    will-change: transform;\n  }\n\n  .table-header .col {\n    position: relative;\n    min-width: 0;\n    height: 100%;\n  }\n\n  .col-button {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: flex-start;\n    gap: 4px;\n    box-sizing: border-box;\n    padding: 0 8px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 11px;\n    font-weight: 600;\n    line-height: 1;\n    color: var(--text-muted);\n    text-align: left;\n    margin: 0;\n    border: none;\n    background: transparent;\n    cursor: pointer;\n  }\n\n  .sort-icon {\n    width: 10px;\n    height: 10px;\n    flex-shrink: 0;\n    color: var(--accent);\n  }\n\n  .col-resizer {\n    position: absolute;\n    top: 0;\n    right: -4px;\n    width: 8px;\n    height: 100%;\n    border: none;\n    padding: 0;\n    background: transparent;\n    cursor: col-resize;\n    z-index: 30;\n  }\n\n  .col-resizer::after {\n    content: '';\n    position: absolute;\n    top: 7px;\n    bottom: 7px;\n    left: 50%;\n    width: 1px;\n    transform: translateX(-50%);\n    background: var(--border-soft);\n    opacity: 0;\n    transition: opacity 0.15s ease;\n  }\n\n  .table-header .col:hover .col-resizer::after,\n  .col-resizer.active::after {\n    opacity: 1;\n  }\n\n  .table-body {\n    overflow: auto;\n    min-height: 0;\n    min-width: 0;\n    background: var(--surface);\n  }\n\n  .spacer {\n    position: relative;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .rows {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .row {\n    height: 30px;\n    border-bottom: 1px solid var(--row-border);\n    cursor: default;\n    -webkit-user-select: none;\n    user-select: none;\n    outline: none;\n  }\n\n  .row:hover {\n    background: var(--row-hover);\n  }\n\n  .row.selected {\n    background: var(--row-selected);\n  }\n\n  .cell {\n    padding: 0 8px;\n    font-size: 12px;\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    min-width: 0;\n  }\n\n  .cell.size {\n    text-align: right;\n    font-variant-numeric: tabular-nums;\n  }\n\n  .ellipsis {\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n\n  .hl {\n    background: none;\n    color: inherit;\n    font-weight: 700;\n  }\n\n  .file-icon {\n    width: 16px;\n    height: 16px;\n    flex: 0 0 auto;\n  }\n\n  .name-editing {\n    opacity: 0.25;\n  }\n\n  .rename-overlay {\n    position: fixed;\n    z-index: 100;\n    min-width: 120px;\n  }\n\n  .rename-textarea {\n    display: block;\n    width: 100%;\n    box-sizing: border-box;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 12px;\n    line-height: 18px;\n    padding: 5px 4px 5px 0;\n    border: 1.5px solid var(--focus-ring);\n    border-radius: 4px;\n    background: var(--bg-input, var(--surface));\n    color: var(--text-primary);\n    outline: none;\n    resize: none;\n    overflow: hidden;\n    box-shadow: 0 2px 14px rgba(0, 0, 0, 0.22), 0 0 0 3px rgba(77, 168, 255, 0.13);\n  }\n\n  .status-bar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 32px;\n    padding: 0 16px;\n    background: var(--surface-header);\n    border-top: 1px solid var(--border-soft);\n    font-family: 'JetBrains Mono', monospace;\n    font-size: 11px;\n    color: var(--text-muted);\n    white-space: nowrap;\n    overflow: hidden;\n    min-width: 0;\n    flex-shrink: 0;\n  }\n\n  .status-left {\n    display: flex;\n    align-items: center;\n    gap: 16px;\n    overflow: hidden;\n    min-width: 0;\n  }\n\n  .status-right {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    flex-shrink: 0;\n  }\n\n  .status-btn {\n    border: 1px solid var(--button-border);\n    border-radius: 5px;\n    background: var(--button-bg);\n    color: var(--button-text);\n    font-size: 11px;\n    height: 22px;\n    padding: 0 8px;\n    cursor: pointer;\n  }\n\n  .status-btn:hover {\n    filter: brightness(1.06);\n  }\n\n  .status-btn:disabled {\n    opacity: 0.55;\n    cursor: not-allowed;\n    filter: none;\n  }\n\n  .status-state {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n  }\n\n  .state-dot {\n    width: 6px;\n    height: 6px;\n    border-radius: 50%;\n    flex-shrink: 0;\n  }\n\n  .state-dot.ready { background: #28C840; }\n  .state-dot.indexing { background: #FEBC2E; }\n  .state-dot.error { background: #FF5F57; }\n\n  .rebuild-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 10px;\n    font-weight: 500;\n    background: var(--button-bg);\n    border: 1px solid var(--button-border);\n    border-radius: 4px;\n    color: var(--button-text);\n    height: 22px;\n    padding: 0 10px;\n    cursor: pointer;\n  }\n\n  .rebuild-btn:hover {\n    filter: brightness(1.1);\n  }\n\n  .rebuild-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    filter: none;\n  }\n\n  .rebuild-icon {\n    width: 11px;\n    height: 11px;\n    color: var(--accent);\n    flex-shrink: 0;\n  }\n\n  .status-error {\n    color: var(--error-text);\n  }\n\n  .status-warning {\n    color: var(--warning-text);\n  }\n\n  .status-spotlight {\n    color: #f59e0b;\n    font-weight: 600;\n  }\n\n  .context-menu {\n    position: fixed;\n    z-index: 200;\n    width: 220px;\n    border: 1px solid var(--menu-border);\n    border-radius: 10px;\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.16), inset 0 0 0 0.5px rgba(255, 255, 255, 0.18);\n    background: var(--menu-bg);\n    backdrop-filter: blur(28px) saturate(180%);\n    -webkit-backdrop-filter: blur(28px) saturate(180%);\n    overflow: hidden;\n  }\n\n  .context-menu button {\n    width: 100%;\n    text-align: left;\n    border: none;\n    background: transparent;\n    padding: 8px 10px;\n    font-size: 12px;\n    color: var(--menu-text);\n  }\n\n  .context-menu button:hover {\n    background: var(--menu-hover);\n  }\n\n  .toast {\n    position: fixed;\n    right: 14px;\n    bottom: 18px;\n    background: var(--toast-bg);\n    color: var(--toast-text);\n    border-radius: 10px;\n    padding: 9px 12px;\n    font-size: 12px;\n    z-index: 250;\n    backdrop-filter: blur(20px) saturate(180%);\n    -webkit-backdrop-filter: blur(20px) saturate(180%);\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);\n  }\n</style>\n","structuredPatch":[{"oldStart":1987,"oldLines":7,"newStart":1987,"newLines":7,"lines":["     cursor: pointer;","   }"," ","-  .sort-icon {","+  :global(.sort-icon) {","     width: 10px;","     height: 10px;","     flex-shrink: 0;"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"a081b0ed-8e79-422a-8813-f8c8a5df31df"}
{"parentUuid":"9d67d6bc-9b24-4bbe-8d2f-05b2c5e5ae82","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01JTaAiB95d88cZaegqeSQsA","type":"message","role":"assistant","content":[{"type":"text","text":"ì´ì œ `.rebuild-btn` CSSì—ì„œ `.status-btn`ê³¼ ì¤‘ë³µëœ í”„ë¡œí¼í‹°ë¥¼ ì œê±°í•©ë‹ˆë‹¤."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":248,"cache_read_input_tokens":101817,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":248},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPRyxuWkkRXWTLbBbf3","type":"assistant","uuid":"3041603b-8b7b-4b9e-8b2b-981914f230d7","timestamp":"2026-02-21T14:40:16.916Z"}
{"parentUuid":"3041603b-8b7b-4b9e-8b2b-981914f230d7","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01JTaAiB95d88cZaegqeSQsA","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_017TsgHyKvZiD8fPi575JT1Y","name":"Read","input":{"file_path":"/Users/al02402336/everything/src/App.svelte","offset":2190,"limit":40},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":248,"cache_read_input_tokens":101817,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":248},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPRyxuWkkRXWTLbBbf3","type":"assistant","uuid":"07b4213d-2fb7-44e0-8a48-657fcb7adc43","timestamp":"2026-02-21T14:40:17.577Z"}
{"parentUuid":"07b4213d-2fb7-44e0-8a48-657fcb7adc43","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_017TsgHyKvZiD8fPi575JT1Y","toolUseID":"toolu_017TsgHyKvZiD8fPi575JT1Y","timestamp":"2026-02-21T14:40:17.592Z","uuid":"e30c601e-0ff8-43fe-9e0f-daddf4c6da9b"}
{"parentUuid":"07b4213d-2fb7-44e0-8a48-657fcb7adc43","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_017TsgHyKvZiD8fPi575JT1Y","type":"tool_result","content":"  2190â†’  .state-dot.ready { background: #28C840; }\n  2191â†’  .state-dot.indexing { background: #FEBC2E; }\n  2192â†’  .state-dot.error { background: #FF5F57; }\n  2193â†’\n  2194â†’  .rebuild-btn {\n  2195â†’    display: flex;\n  2196â†’    align-items: center;\n  2197â†’    gap: 6px;\n  2198â†’    font-family: Inter, 'SF Pro Text', sans-serif;\n  2199â†’    font-size: 10px;\n  2200â†’    font-weight: 500;\n  2201â†’    background: var(--button-bg);\n  2202â†’    border: 1px solid var(--button-border);\n  2203â†’    border-radius: 4px;\n  2204â†’    color: var(--button-text);\n  2205â†’    height: 22px;\n  2206â†’    padding: 0 10px;\n  2207â†’    cursor: pointer;\n  2208â†’  }\n  2209â†’\n  2210â†’  .rebuild-btn:hover {\n  2211â†’    filter: brightness(1.1);\n  2212â†’  }\n  2213â†’\n  2214â†’  .rebuild-btn:disabled {\n  2215â†’    opacity: 0.5;\n  2216â†’    cursor: not-allowed;\n  2217â†’    filter: none;\n  2218â†’  }\n  2219â†’\n  2220â†’  .rebuild-icon {\n  2221â†’    width: 11px;\n  2222â†’    height: 11px;\n  2223â†’    color: var(--accent);\n  2224â†’    flex-shrink: 0;\n  2225â†’  }\n  2226â†’\n  2227â†’  .status-error {\n  2228â†’    color: var(--error-text);\n  2229â†’  }\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"61f07699-9b50-4f90-a049-e0fffecd9217","timestamp":"2026-02-21T14:40:17.591Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/al02402336/everything/src/App.svelte","content":"  .state-dot.ready { background: #28C840; }\n  .state-dot.indexing { background: #FEBC2E; }\n  .state-dot.error { background: #FF5F57; }\n\n  .rebuild-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 10px;\n    font-weight: 500;\n    background: var(--button-bg);\n    border: 1px solid var(--button-border);\n    border-radius: 4px;\n    color: var(--button-text);\n    height: 22px;\n    padding: 0 10px;\n    cursor: pointer;\n  }\n\n  .rebuild-btn:hover {\n    filter: brightness(1.1);\n  }\n\n  .rebuild-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    filter: none;\n  }\n\n  .rebuild-icon {\n    width: 11px;\n    height: 11px;\n    color: var(--accent);\n    flex-shrink: 0;\n  }\n\n  .status-error {\n    color: var(--error-text);\n  }","numLines":40,"startLine":2190,"totalLines":2282}},"sourceToolAssistantUUID":"07b4213d-2fb7-44e0-8a48-657fcb7adc43"}
{"parentUuid":"61f07699-9b50-4f90-a049-e0fffecd9217","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01CLWkNqAXieTMBVz1JfQeUE","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015fnKypZJH8ZedtApcRNW2q","name":"Edit","input":{"replace_all":false,"file_path":"/Users/al02402336/everything/src/App.svelte","old_string":"  .rebuild-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 10px;\n    font-weight: 500;\n    background: var(--button-bg);\n    border: 1px solid var(--button-border);\n    border-radius: 4px;\n    color: var(--button-text);\n    height: 22px;\n    padding: 0 10px;\n    cursor: pointer;\n  }\n\n  .rebuild-btn:hover {\n    filter: brightness(1.1);\n  }\n\n  .rebuild-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    filter: none;\n  }","new_string":"  .rebuild-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 10px;\n    font-weight: 500;\n    border-radius: 4px;\n    padding: 0 10px;\n  }\n\n  .rebuild-btn:hover {\n    filter: brightness(1.1);\n  }\n\n  .rebuild-btn:disabled {\n    opacity: 0.5;\n  }"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":715,"cache_read_input_tokens":102065,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":715},"output_tokens":24,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPSGnSPKAvMPmt4fpGY","type":"assistant","uuid":"457a04d0-0254-4ec0-a41b-0257d8febff6","timestamp":"2026-02-21T14:40:22.683Z"}
{"parentUuid":"457a04d0-0254-4ec0-a41b-0257d8febff6","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_015fnKypZJH8ZedtApcRNW2q","toolUseID":"toolu_015fnKypZJH8ZedtApcRNW2q","timestamp":"2026-02-21T14:40:22.691Z","uuid":"eb0372c4-82f8-4e6d-80b3-f2a1fbd4dc9d"}
{"parentUuid":"457a04d0-0254-4ec0-a41b-0257d8febff6","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015fnKypZJH8ZedtApcRNW2q","type":"tool_result","content":"The file /Users/al02402336/everything/src/App.svelte has been updated successfully."}]},"uuid":"ffbdeafc-b9b5-4f1a-8a0e-171cc169195e","timestamp":"2026-02-21T14:40:22.690Z","toolUseResult":{"filePath":"/Users/al02402336/everything/src/App.svelte","oldString":"  .rebuild-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 10px;\n    font-weight: 500;\n    background: var(--button-bg);\n    border: 1px solid var(--button-border);\n    border-radius: 4px;\n    color: var(--button-text);\n    height: 22px;\n    padding: 0 10px;\n    cursor: pointer;\n  }\n\n  .rebuild-btn:hover {\n    filter: brightness(1.1);\n  }\n\n  .rebuild-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    filter: none;\n  }","newString":"  .rebuild-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 10px;\n    font-weight: 500;\n    border-radius: 4px;\n    padding: 0 10px;\n  }\n\n  .rebuild-btn:hover {\n    filter: brightness(1.1);\n  }\n\n  .rebuild-btn:disabled {\n    opacity: 0.5;\n  }","originalFile":"<script>\n  import { onDestroy, onMount, tick } from 'svelte';\n  import { invoke } from '@tauri-apps/api/core';\n  import { listen } from '@tauri-apps/api/event';\n  import { getCurrentWindow } from '@tauri-apps/api/window';\n  import { startDrag } from '@crabnebula/tauri-plugin-drag';\n\n  const rowHeight = 30;\n  const PAGE_SIZE = 500;\n  let homePrefix = '';\n  const COL_WIDTHS_KEY = 'REDACTED';\n  const THEME_KEY = 'everything-theme';\n  const columnKeys = ['name', 'path', 'size', 'modified'];\n  const minColumnWidth = {\n    name: 180,\n    path: 240,\n    size: 75,\n    modified: 150\n  };\n  const defaultColumnRatios = {\n    name: 0.3,\n    path: 0.45,\n    size: 0.1\n  };\n\n  const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n  let theme = (() => { try { return localStorage.getItem(THEME_KEY) || systemTheme; } catch { return systemTheme; } })();\n  function cycleTheme() {\n    theme = theme === 'dark' ? 'light' : 'dark';\n    try { localStorage.setItem(THEME_KEY, theme); } catch {}\n    invoke('set_native_theme', { theme });\n  }\n\n  function sortIconHtml(dir) {\n    const d = dir === 'asc' ? 'M2.5 6.5 L5 4 L7.5 6.5' : 'M2.5 3.5 L5 6 L7.5 3.5';\n    return `<svg class=\"sort-icon\" viewBox=\"0 0 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"${d}\"/></svg>`;\n  }\n\n  let query = '';\n  let results = [];\n  let totalResults = 0;\n  let totalResultsKnown = false;\n\n  let dbLatencyMs = null;\n  let dbLastQuery = '';\n  let searchModeLabel = '';\n  let selectedIndices = new Set();\n  let selectionAnchor = -1;\n  let lastSelectedIndex = -1;\n  let editing = {\n    active: false,\n    path: '',\n    index: -1,\n    draftName: ''\n  };\n\n  let renameOverlay = { top: 0, left: 0, width: 0 };\n\n  let indexStatus = {\n    state: 'Indexing',\n    entriesCount: 0,\n    lastUpdated: null,\n    permissionErrors: 0,\n    message: null,\n    isCatchup: false\n  };\n\n  let indexingStartTime = null;\n  let indexingElapsed = '';\n  let indexingFinishedAt = '';\n\n  let sortBy = 'name';\n  let sortDir = 'asc';\n\n  let hasMore = true;\n  let loadingMore = false;\n  let searchGeneration = 0;\n\n  let scanned = 0;\n\n  let searchInputEl;\n  let renameInputEl;\n  let tableAreaEl;\n  let tableContainer;\n  let tableResizeObserver = null;\n  let viewportResizeRaf = null;\n  let scrollTop = 0;\n  let headerScrollLeft = 0;\n  let viewportHeight = 520;\n  let lastTableWidth = 0;\n  let resizingColumn = '';\n  let resizeCleanup = null;\n  let colWidths = {\n    name: 250,\n    path: 350,\n    size: 75,\n    modified: 150\n  };\n\n  let contextMenu = {\n    visible: false,\n    x: 0,\n    y: 0\n  };\n\n  let platform = '';\n  let toast = '';\n  let searchTimer;\n  let lastSearchFiredAt = 0;\n  let toastTimer;\n  let statusRefreshTimer;\n  let elapsedTimer;\n  let statusRefreshInFlight = false;\n  let lastReadyCount = 0;\n\n  const iconCache = new Map();\n  const iconLoading = new Set();\n\n  let highlightCache = new Map();\n  let highlightCacheQuery = '';\n\n  const folderFallbackIcon =\n    \"data:image/svg+xml;utf8,\" +\n    encodeURIComponent(\n      `<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><rect x='1' y='4' width='14' height='10' rx='2' fill='#d9b34f'/><rect x='1' y='2' width='6' height='4' rx='1' fill='#e6ca7a'/></svg>`\n    );\n  const fileFallbackIcon =\n    \"data:image/svg+xml;utf8,\" +\n    encodeURIComponent(\n      `<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><rect x='3' y='1' width='10' height='14' rx='1.5' fill='#b4bec9'/><rect x='5' y='5' width='6' height='1.2' fill='#8d98a5'/><rect x='5' y='8' width='6' height='1.2' fill='#8d98a5'/></svg>`\n    );\n\n  $: totalHeight = results.length * rowHeight;\n  $: startIndex = Math.max(0, Math.floor(scrollTop / rowHeight) - 10);\n  $: visibleCount = Math.ceil(viewportHeight / rowHeight) + 20;\n  $: endIndex = Math.min(results.length, startIndex + visibleCount);\n  $: visibleRows = results.slice(startIndex, endIndex);\n  $: translateY = startIndex * rowHeight;\n  $: tableMinWidth = colWidths.name + colWidths.path + colWidths.size + colWidths.modified;\n  $: tableGridStyle = `--col-name:${colWidths.name}px;--col-path:${colWidths.path}px;--col-size:${colWidths.size}px;--col-modified:${colWidths.modified}px;--table-min-width:${tableMinWidth}px;--header-offset:${-headerScrollLeft}px;`;\n\n  $: {\n    for (const entry of visibleRows) {\n      void ensureIcon(entry);\n    }\n  }\n\n  function showToast(message) {\n    toast = message;\n    clearTimeout(toastTimer);\n    toastTimer = setTimeout(() => {\n      toast = '';\n    }, 3000);\n  }\n\n  function bytesToBase64(bytes) {\n    let binary = '';\n    const chunk = 0x8000;\n    for (let i = 0; i < bytes.length; i += chunk) {\n      const part = bytes.subarray(i, i + chunk);\n      binary += String.fromCharCode(...part);\n    }\n    return btoa(binary);\n  }\n\n  function highlightSegments(name, q) {\n    q = (q || '').trim();\n    if (!q) return [{ text: name, hl: false }];\n\n    // Reset cache when query changes\n    if (q !== highlightCacheQuery) {\n      highlightCache = new Map();\n      highlightCacheQuery = q;\n    }\n\n    // Check cache\n    const cached = highlightCache.get(name);\n    if (cached) return cached;\n\n    if (q.includes('/')) q = q.slice(q.lastIndexOf('/') + 1);\n    q = q.replace(/[*?]/g, '');\n    const terms = q.split(/\\s+/).filter(Boolean);\n    if (terms.length === 0) return [{ text: name, hl: false }];\n\n    const lower = name.toLowerCase();\n    const marks = new Uint8Array(name.length);\n    for (const t of terms) {\n      const tl = t.toLowerCase();\n      let idx = lower.indexOf(tl);\n      while (idx !== -1) {\n        for (let i = idx; i < idx + tl.length; i++) marks[i] = 1;\n        idx = lower.indexOf(tl, idx + 1);\n      }\n    }\n\n    const segs = [];\n    let i = 0;\n    while (i < name.length) {\n      const m = marks[i];\n      let j = i + 1;\n      while (j < name.length && marks[j] === m) j++;\n      segs.push({ text: name.slice(i, j), hl: m === 1 });\n      i = j;\n    }\n\n    highlightCache.set(name, segs);\n    return segs;\n  }\n\n  const perFileIconExts = new Set(['exe', 'lnk', 'ico', 'url', 'scr', 'appx']);\n\n  function iconKey(entry) {\n    if (entry.isDir) return '__folder__';\n    const ext = (entry.ext || '').toLowerCase();\n    if (perFileIconExts.has(ext)) return entry.path;\n    return ext || '__file__';\n  }\n\n  function iconFor(entry) {\n    return iconCache.get(iconKey(entry)) || (entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n  }\n\n  async function ensureIcon(entry) {\n    const key = iconKey(entry);\n    if (iconCache.has(key) || iconLoading.has(key)) {\n      return;\n    }\n\n    iconLoading.add(key);\n    try {\n      const bytes = await invoke('get_file_icon', {\n        path: entry.path,\n        ext: entry.isDir ? 'folder' : entry.ext || '',\n      });\n      if (Array.isArray(bytes) && bytes.length > 0) {\n        const image = `data:image/png;base64,${bytesToBase64(Uint8Array.from(bytes))}`;\n        iconCache.set(key, image);\n      } else {\n        iconCache.set(key, entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n      }\n    } catch {\n      iconCache.set(key, entry.isDir ? folderFallbackIcon : fileFallbackIcon);\n    } finally {\n      iconLoading.delete(key);\n    }\n  }\n\n  function syncColumnWidthsToContainer() {\n    const width = tableContainer?.clientWidth || tableAreaEl?.clientWidth;\n    if (!width || lastTableWidth !== 0) {\n      return;\n    }\n\n    const saved = loadColWidths();\n    if (saved) {\n      const total = columnKeys.reduce((s, k) => s + saved[k], 0);\n      if (Math.abs(total - width) > 2) {\n        const scale = (width - saved.modified) / (total - saved.modified);\n        let scaledName = Math.max(minColumnWidth.name, Math.round(saved.name * scale));\n        let scaledSize = Math.max(minColumnWidth.size, Math.round(saved.size * scale));\n        let rawPath = width - saved.modified - scaledName - scaledSize;\n        if (rawPath < minColumnWidth.path) {\n          const shortfall = minColumnWidth.path - rawPath;\n          const nameReduction = Math.min(shortfall, scaledName - minColumnWidth.name);\n          scaledName -= nameReduction;\n          const remaining = shortfall - nameReduction;\n          if (remaining > 0) {\n            scaledSize -= Math.min(remaining, scaledSize - minColumnWidth.size);\n          }\n          rawPath = width - saved.modified - scaledName - scaledSize;\n        }\n        const scaledPath = Math.max(minColumnWidth.path, rawPath);\n        colWidths = { name: scaledName, path: scaledPath, size: scaledSize, modified: saved.modified };\n      } else {\n        colWidths = saved;\n      }\n    } else {\n      const fixedModified = minColumnWidth.modified;\n      const rest = width - fixedModified;\n      const ratioSum = defaultColumnRatios.name + defaultColumnRatios.path + defaultColumnRatios.size;\n      colWidths = {\n        name: Math.max(minColumnWidth.name, Math.round(rest * defaultColumnRatios.name / ratioSum)),\n        path: Math.max(minColumnWidth.path, Math.round(rest * defaultColumnRatios.path / ratioSum)),\n        size: Math.max(minColumnWidth.size, Math.round(rest * defaultColumnRatios.size / ratioSum)),\n        modified: fixedModified\n      };\n    }\n    lastTableWidth = width;\n  }\n\n  function loadColWidths() {\n    try {\n      const raw = localStorage.getItem(COL_WIDTHS_KEY);\n      if (!raw) return null;\n      const parsed = JSON.parse(raw);\n      for (const key of columnKeys) {\n        if (typeof parsed[key] !== 'number' || parsed[key] < (minColumnWidth[key] || 0)) return null;\n      }\n      return parsed;\n    } catch {\n      return null;\n    }\n  }\n\n  function saveColWidths() {\n    localStorage.setItem(COL_WIDTHS_KEY, JSON.stringify(colWidths));\n  }\n\n  function updateViewportHeight() {\n    viewportHeight = tableContainer?.clientHeight || 520;\n    syncColumnWidthsToContainer();\n  }\n\n  function scheduleViewportHeightUpdate() {\n    if (viewportResizeRaf !== null) {\n      return;\n    }\n    viewportResizeRaf = requestAnimationFrame(() => {\n      viewportResizeRaf = null;\n      updateViewportHeight();\n    });\n  }\n\n  function startColumnResize(event, leftKey) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    const index = columnKeys.indexOf(leftKey);\n    if (index < 0 || index >= columnKeys.length - 1) {\n      return;\n    }\n\n    const startX = event.clientX;\n    const startLeft = colWidths[leftKey];\n    const rightKey = columnKeys[index + 1];\n    const startRight = colWidths[rightKey];\n\n    resizeCleanup?.();\n    resizingColumn = leftKey;\n\n    const onMove = (moveEvent) => {\n      const delta = Math.round(moveEvent.clientX - startX);\n      if (leftKey === 'name') {\n        // Two-column trade: name and path swap space, each respects its minimum\n        const nextLeft = Math.max(\n          minColumnWidth[leftKey],\n          Math.min(startLeft + delta, startLeft + startRight - minColumnWidth[rightKey])\n        );\n        const nextRight = startLeft + startRight - nextLeft;\n        colWidths = { ...colWidths, [leftKey]: nextLeft, [rightKey]: nextRight };\n      } else {\n        // path splitter: path grows unconstrained (allows horizontal scroll on right drag)\n        const nextLeft = Math.max(minColumnWidth[leftKey], startLeft + delta);\n        colWidths = { ...colWidths, [leftKey]: nextLeft };\n      }\n    };\n\n    const onUp = () => {\n      cleanup();\n    };\n\n    const cleanup = () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n      document.body.style.cursor = '';\n      document.body.style.userSelect = '';\n      resizingColumn = '';\n      saveColWidths();\n      if (resizeCleanup === cleanup) {\n        resizeCleanup = null;\n      }\n    };\n\n    resizeCleanup = cleanup;\n    document.body.style.cursor = 'col-resize';\n    document.body.style.userSelect = 'none';\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n  }\n\n  function selectedPaths() {\n    const sorted = [...selectedIndices].sort((a, b) => a - b);\n    return sorted.map((idx) => results[idx]).filter(Boolean).map((entry) => entry.path);\n  }\n\n  function clearSelection() {\n    selectedIndices = new Set();\n    selectionAnchor = -1;\n    lastSelectedIndex = -1;\n  }\n\n  function selectSingle(index) {\n    selectedIndices = new Set([index]);\n    selectionAnchor = index;\n    lastSelectedIndex = index;\n  }\n\n  function selectToggle(index) {\n    const next = new Set(selectedIndices);\n    if (next.has(index)) {\n      next.delete(index);\n    } else {\n      next.add(index);\n    }\n    selectedIndices = next;\n    selectionAnchor = index;\n    lastSelectedIndex = index;\n  }\n\n  function selectRange(index) {\n    const anchor = selectionAnchor >= 0 ? selectionAnchor : index;\n    const [from, to] = [Math.min(anchor, index), Math.max(anchor, index)];\n    const next = new Set();\n    for (let i = from; i <= to; i += 1) {\n      next.add(i);\n    }\n    selectedIndices = next;\n    lastSelectedIndex = index;\n  }\n\n  function primaryEntry() {\n    const idx = lastSelectedIndex >= 0 ? lastSelectedIndex : -1;\n    return idx >= 0 ? results[idx] : null;\n  }\n\n  async function refreshStatus() {\n    if (statusRefreshInFlight) {\n      return;\n    }\n    statusRefreshInFlight = true;\n    try {\n      const status = await invoke('get_index_status');\n      const prevState = indexStatus.state;\n      indexStatus = {\n        state: status.state,\n        entriesCount: status.entriesCount,\n        lastUpdated: status.lastUpdated,\n        permissionErrors: status.permissionErrors ?? 0,\n        message: status.message\n      };\n      if (status.state === 'Indexing' && prevState !== 'Indexing') {\n        startElapsedTimer();\n      } else if (status.state !== 'Indexing' && prevState === 'Indexing') {\n        stopElapsedTimer();\n      }\n      if (typeof status.scanned === 'number') {\n        scanned = status.scanned;\n      }\n      if (status.state === 'Ready' && prevState !== 'Ready') {\n        scheduleSearch();\n      }\n    } catch (err) {\n      showToast(`Failed to get status: ${String(err)}`);\n    } finally {\n      statusRefreshInFlight = false;\n    }\n  }\n\n  function scheduleSearch(preserveScroll = false) {\n    searchGeneration += 1;\n    const scheduledGen = searchGeneration;\n    clearTimeout(searchTimer);\n\n    const now = performance.now();\n    if (now - lastSearchFiredAt >= 200) {\n      // Leading edge: fire immediately if enough time has passed\n      lastSearchFiredAt = now;\n      void runSearch(preserveScroll);\n    } else {\n      // Trailing edge: debounce\n      searchTimer = setTimeout(() => {\n        if (scheduledGen !== searchGeneration) {\n          return;\n        }\n        lastSearchFiredAt = performance.now();\n        void runSearch(preserveScroll);\n      }, 200);\n    }\n  }\n\n  async function runSearch(preserveScroll = false) {\n    searchGeneration += 1;\n    const gen = searchGeneration;\n    const searchQuery = query;\n    const searchSortBy = sortBy;\n    const searchSortDir = sortDir;\n    const startedAt = performance.now();\n    try {\n      const keepPaths = new Set(selectedPaths());\n      const next = await invoke('search', {\n        query: searchQuery,\n        limit: PAGE_SIZE,\n        offset: 0,\n        sortBy: searchSortBy,\n        sortDir: searchSortDir\n      });\n\n      if (gen !== searchGeneration) return;\n\n      dbLatencyMs = Math.round(performance.now() - startedAt);\n      dbLastQuery = searchQuery;\n      const entries = Array.isArray(next.entries) ? next.entries : [];\n      searchModeLabel = next.modeLabel || '';\n      results = entries;\n      if (next.totalCount > 0) {\n        totalResults = next.totalCount;\n        totalResultsKnown = true;\n      } else {\n        totalResults = entries.length;\n        totalResultsKnown = false;\n      }\n      hasMore = totalResultsKnown ? results.length < totalResults : entries.length >= PAGE_SIZE;\n      if (!preserveScroll && tableContainer) tableContainer.scrollTop = 0;\n\n      const restored = new Set();\n      for (let i = 0; i < results.length; i += 1) {\n        if (keepPaths.has(results[i].path)) {\n          restored.add(i);\n        }\n      }\n      selectedIndices = restored;\n\n      updateViewportHeight();\n    } catch (err) {\n      if (gen !== searchGeneration) return;\n      showToast(`Search failed: ${String(err)}`);\n    }\n  }\n\n  async function loadMore() {\n    if (!hasMore || loadingMore) return;\n    const gen = searchGeneration;\n    loadingMore = true;\n    try {\n      const batch = await invoke('search', {\n        query,\n        limit: PAGE_SIZE,\n        offset: results.length,\n        sortBy: sortBy,\n        sortDir: sortDir\n      });\n      if (gen !== searchGeneration) return;\n      const arr = Array.isArray(batch.entries) ? batch.entries : [];\n      if (arr.length > 0) results = [...results, ...arr];\n      hasMore = totalResultsKnown ? results.length < totalResults : arr.length >= PAGE_SIZE;\n    } catch (err) {\n      showToast(`Failed to load more: ${String(err)}`);\n    } finally {\n      loadingMore = false;\n    }\n  }\n\n  function moveSelection(delta, withRange = false) {\n    if (results.length === 0) {\n      return;\n    }\n\n    const current = lastSelectedIndex >= 0 ? lastSelectedIndex : 0;\n    const next = Math.max(0, Math.min(results.length - 1, current + delta));\n\n    if (withRange) {\n      selectRange(next);\n    } else {\n      selectSingle(next);\n    }\n\n    const top = next * rowHeight;\n    const bottom = top + rowHeight;\n    if (top < scrollTop) {\n      tableContainer.scrollTop = top;\n    } else if (bottom > scrollTop + viewportHeight) {\n      tableContainer.scrollTop = bottom - viewportHeight;\n    }\n  }\n\n  function handleHeaderSort(column) {\n    if (sortBy === column) {\n      sortDir = sortDir === 'asc' ? 'desc' : 'asc';\n    } else {\n      sortBy = column;\n      sortDir = 'asc';\n    }\n    if (tableContainer) tableContainer.scrollTop = 0;\n    void runSearch();\n  }\n\n  function handleRowClick(event, index) {\n    contextMenu.visible = false;\n\n    if (event.shiftKey) {\n      selectRange(index);\n      return;\n    }\n\n    if (event.metaKey || event.ctrlKey) {\n      selectToggle(index);\n      return;\n    }\n\n    selectSingle(index);\n  }\n\n  function handleRowContextMenu(event, index) {\n    event.preventDefault();\n\n    if (!selectedIndices.has(index)) {\n      selectSingle(index);\n    }\n\n    if (platform === 'windows' || platform === 'macos') {\n      contextMenu.visible = false;\n      const paths = selectedPaths();\n      if (paths.length > 0) {\n        invoke('show_context_menu', {\n          paths,\n          x: event.clientX,\n          y: event.clientY,\n          singleSelection: selectedIndices.size === 1\n        });\n      }\n      return;\n    }\n\n    contextMenu = {\n      visible: true,\n      x: event.clientX,\n      y: event.clientY\n    };\n  }\n\n  function handleRowA11yKeydown(event, index) {\n    if (event.key === ' ' || event.key === 'Enter') {\n      event.preventDefault();\n      handleRowClick(event, index);\n    }\n  }\n\n  const DRAG_THRESHOLD = 5;\n  let dragCleanup = null;\n  const dragImgCache = new Map();\n\n  function dragPathsForIndex(index) {\n    const entry = results[index];\n    if (!entry) {\n      return [];\n    }\n\n    if (selectedIndices.has(index) && selectedIndices.size > 0) {\n      return selectedPaths();\n    }\n\n    return [entry.path];\n  }\n\n  function getDragIconEl(entry) {\n    const src = iconFor(entry);\n    let img = dragImgCache.get(src);\n    if (!img) {\n      img = new Image();\n      img.src = src;\n      dragImgCache.set(src, img);\n    }\n    return img.complete && img.naturalWidth > 0 ? img : null;\n  }\n\n  function fillRoundRect(ctx, x, y, w, h, r) {\n    ctx.beginPath();\n    ctx.moveTo(x + r, y);\n    ctx.arcTo(x + w, y, x + w, y + h, r);\n    ctx.arcTo(x + w, y + h, x, y + h, r);\n    ctx.arcTo(x, y + h, x, y, r);\n    ctx.arcTo(x, y, x + w, y, r);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  function buildDragPreview(index) {\n    const entry = results[index];\n    if (!entry) return null;\n\n    const count = selectedIndices.has(index) ? selectedIndices.size : 1;\n    const isDark = theme === 'dark';\n\n    const w = 260;\n    const h = 28;\n    const stackGap = count > 1 ? 4 : 0;\n\n    const canvas = document.createElement('canvas');\n    canvas.width = w;\n    canvas.height = h + stackGap;\n    const ctx = canvas.getContext('2d');\n\n    if (count > 1) {\n      ctx.globalAlpha = 0.35;\n      ctx.fillStyle = isDark ? '#5a6070' : '#b0c4de';\n      fillRoundRect(ctx, 3, 0, w - 3, h, 5);\n      ctx.globalAlpha = 1.0;\n    }\n\n    const ry = stackGap;\n    ctx.fillStyle = isDark ? 'rgba(58, 64, 74, 0.94)' : 'rgba(214, 231, 255, 0.94)';\n    fillRoundRect(ctx, 0, ry, w, h, 5);\n\n    ctx.strokeStyle = isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';\n    ctx.lineWidth = 0.5;\n    ctx.beginPath();\n    ctx.moveTo(5, ry);\n    ctx.arcTo(w, ry, w, ry + h, 5);\n    ctx.arcTo(w, ry + h, 0, ry + h, 5);\n    ctx.arcTo(0, ry + h, 0, ry, 5);\n    ctx.arcTo(0, ry, w, ry, 5);\n    ctx.closePath();\n    ctx.stroke();\n\n    const iconEl = getDragIconEl(entry);\n    if (iconEl) {\n      ctx.drawImage(iconEl, 6, ry + 6, 16, 16);\n    } else {\n      ctx.fillStyle = entry.isDir ? '#d9b34f' : '#8d98a5';\n      fillRoundRect(ctx, 6, ry + 6, 16, 16, 2);\n    }\n\n    ctx.fillStyle = isDark ? '#e6e6e8' : '#1a1a1a';\n    ctx.font = '12px -apple-system, \"SF Pro Text\", system-ui, sans-serif';\n    ctx.textBaseline = 'middle';\n\n    let nameMaxW = w - 34;\n    if (count > 1) nameMaxW -= 34;\n\n    let name = entry.name;\n    if (ctx.measureText(name).width > nameMaxW) {\n      while (name.length > 4 && ctx.measureText(name + '\\u2026').width > nameMaxW) {\n        name = name.slice(0, -1);\n      }\n      name += '\\u2026';\n    }\n    ctx.fillText(name, 28, ry + h / 2 + 1);\n\n    if (count > 1) {\n      const badge = String(count);\n      ctx.font = 'bold 10px -apple-system, system-ui, sans-serif';\n      const tw = ctx.measureText(badge).width;\n      const bw = Math.max(20, tw + 10);\n      const bx = w - bw - 6;\n      const by = ry + (h - 18) / 2;\n\n      ctx.fillStyle = isDark ? '#5b8bd9' : '#007aff';\n      fillRoundRect(ctx, bx, by, bw, 18, 9);\n\n      ctx.fillStyle = '#ffffff';\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(badge, bx + bw / 2, by + 9);\n    }\n\n    return canvas.toDataURL('image/png');\n  }\n\n  function handleRowMouseDown(event, index) {\n    if (event.button !== 0) return;\n    if (event.metaKey || event.ctrlKey || event.shiftKey) return;\n    if (editing.active) return;\n\n    const startX = event.clientX;\n    const startY = event.clientY;\n    let dragging = false;\n\n    dragCleanup?.();\n\n    const onMove = (e) => {\n      if (dragging) return;\n      const dx = e.clientX - startX;\n      const dy = e.clientY - startY;\n      if (dx * dx + dy * dy < DRAG_THRESHOLD * DRAG_THRESHOLD) return;\n\n      dragging = true;\n      cleanup();\n\n      if (!selectedIndices.has(index)) {\n        selectSingle(index);\n      }\n\n      const paths = dragPathsForIndex(index);\n      if (paths.length > 0) {\n        const icon = buildDragPreview(index);\n        startDrag({ item: paths, icon }).catch(() => {});\n      }\n    };\n\n    const onUp = () => cleanup();\n\n    const cleanup = () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n      if (dragCleanup === cleanup) dragCleanup = null;\n    };\n\n    dragCleanup = cleanup;\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n  }\n\n  async function handleRowDoubleClick(index) {\n    if (!selectedIndices.has(index) || selectedIndices.size > 1) {\n      selectSingle(index);\n      await tick();\n    }\n    await invoke('open', { paths: [results[index].path] }).catch((err) => {\n      showToast(`Failed to open: ${String(err)}`);\n    });\n  }\n\n  function closeContextMenu() {\n    contextMenu = {\n      ...contextMenu,\n      visible: false\n    };\n  }\n\n  async function openSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('open', { paths });\n    } catch (err) {\n      showToast(`Failed to open: ${String(err)}`);\n    }\n  }\n\n  async function openWithFallback() {\n    const target = primaryEntry();\n    if (!target) {\n      return;\n    }\n\n    try {\n      await invoke('open_with', { path: target.path });\n    } catch (err) {\n      showToast(`Open With failed: ${String(err)}`);\n    }\n  }\n\n  async function revealSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('reveal_in_finder', { paths });\n    } catch (err) {\n      showToast(`Failed to reveal in Finder: ${String(err)}`);\n    }\n  }\n\n  async function copySelectedPaths() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('copy_paths', { paths });\n      showToast(`Copied ${paths.length} path(s)`);\n    } catch (err) {\n      showToast(`Failed to copy path: ${String(err)}`);\n    }\n  }\n\n  async function copyFiles() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    try {\n      await invoke('copy_files', { paths });\n      showToast(`Copied ${paths.length} item(s)`);\n    } catch (err) {\n      showToast(`Failed to copy: ${String(err)}`);\n    }\n  }\n\n  async function trashSelected() {\n    const paths = selectedPaths();\n    if (paths.length === 0) {\n      return;\n    }\n\n    const message =\n      paths.length === 1\n        ? 'Move selected item to Trash?'\n        : `Move ${paths.length} items to Trash?`;\n\n    if (!window.confirm(message)) {\n      return;\n    }\n\n    try {\n      await invoke('move_to_trash', { paths });\n      showToast('Moved to Trash.');\n      clearSelection();\n      await runSearch();\n    } catch (err) {\n      showToast(`Failed to move to Trash: ${String(err)}`);\n    }\n  }\n\n  async function resetIndex() {\n    if (indexStatus.state === 'Indexing') {\n      showToast('Indexing in progress. Please try again after it completes.');\n      return;\n    }\n\n    results = [];\n    totalResults = 0;\n    totalResultsKnown = false;\n    clearSelection();\n    scanned = 0;\n    dbLatencyMs = null;\n    dbLastQuery = '';\n    indexStatus = { ...indexStatus, state: 'Indexing', entriesCount: 0, message: null };\n    indexingStartTime = Date.now();\n    indexingElapsed = '';\n    indexingFinishedAt = '';\n\n    try {\n      await invoke('reset_index');\n    } catch (err) {\n      showToast(`Failed to reset index: ${String(err)}`);\n      await refreshStatus();\n    }\n  }\n\n  function isMultiSelected() {\n    return selectedIndices.size > 1;\n  }\n\n  function autoResizeRenameInput() {\n    if (!renameInputEl) return;\n    renameInputEl.style.height = '0';\n    renameInputEl.style.height = renameInputEl.scrollHeight + 'px';\n  }\n\n  async function startRename() {\n    if (isMultiSelected()) {\n      return;\n    }\n\n    const idx = lastSelectedIndex;\n    if (idx < 0 || !results[idx]) {\n      return;\n    }\n\n    const entry = results[idx];\n\n    // Calculate overlay position mathematically.\n    // Name cell text starts at: padding-left(16) + icon(16) + gap(6) = 38px from cell left.\n    // Textarea has padding-left: 0 and border: 1.5px, so text starts ~2px from overlay left.\n    if (tableContainer) {\n      const rect = tableContainer.getBoundingClientRect();\n      const cellLeft = rect.left - tableContainer.scrollLeft;\n      const textLeft = cellLeft + 38;\n      const cellRight = cellLeft + colWidths.name;\n      const rowTop = rect.top + idx * rowHeight - tableContainer.scrollTop;\n      renameOverlay = {\n        top: rowTop,\n        left: textLeft - 2,\n        width: cellRight - textLeft + 2 - 4\n      };\n    }\n\n    editing = {\n      active: true,\n      path: entry.path,\n      index: idx,\n      draftName: entry.name\n    };\n\n    await tick();\n\n    if (renameInputEl) {\n      autoResizeRenameInput();\n      renameInputEl.focus();\n      const extPos = !entry.isDir ? entry.name.lastIndexOf('.') : -1;\n      const selectionEnd = extPos > 0 ? extPos : entry.name.length;\n      renameInputEl.setSelectionRange(0, selectionEnd);\n    }\n  }\n\n  function cancelRename() {\n    editing = {\n      active: false,\n      path: '',\n      index: -1,\n      draftName: ''\n    };\n  }\n\n  async function commitRename() {\n    if (!editing.active || editing.index < 0 || !results[editing.index]) {\n      return;\n    }\n\n    const current = results[editing.index];\n    const nextName = editing.draftName;\n\n    try {\n      await invoke('rename', {\n        path: current.path,\n        newName: nextName\n      });\n      cancelRename();\n      await runSearch();\n    } catch (err) {\n      showToast(`Failed to rename: ${String(err)}`);\n      await tick();\n      renameInputEl?.focus();\n    }\n  }\n\n  function onGlobalClick() {\n    closeContextMenu();\n  }\n\n  function onTitleBarMouseDown(event) {\n    if (event.button !== 0) {\n      return;\n    }\n\n    const activeElement = document.activeElement;\n    if (activeElement instanceof HTMLElement && isTextInputTarget(activeElement)) {\n      activeElement.blur();\n    }\n  }\n\n  async function focusSearch() {\n    await getCurrentWindow().show();\n    await getCurrentWindow().setFocus();\n    searchInputEl?.focus();\n    searchInputEl?.select();\n  }\n\n  function isTextInputTarget(target) {\n    return (\n      target instanceof HTMLInputElement ||\n      target instanceof HTMLTextAreaElement ||\n      target?.isContentEditable\n    );\n  }\n\n  async function handleKeydown(event) {\n    const isMetaSelectAll = (event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'a';\n    const isMetaCopy = (event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'c';\n    const target = event.target;\n    const isTextInput = isTextInputTarget(target);\n\n    if (isMetaCopy && isTextInput) {\n      return;\n    }\n\n    if (isMetaSelectAll) {\n      if (isTextInput) {\n        event.preventDefault();\n        if (target instanceof HTMLInputElement || target instanceof HTMLTextAreaElement) {\n          target.select();\n        }\n        return;\n      }\n    }\n\n    if (editing.active) {\n      if (event.key === 'Enter') {\n        event.preventDefault();\n        await commitRename();\n        return;\n      }\n\n      if (event.key === 'Escape') {\n        event.preventDefault();\n        const idx = editing.index;\n        cancelRename();\n        selectSingle(idx);\n        await tick();\n        tableContainer?.querySelector('.row.selected')?.focus();\n        return;\n      }\n      return;\n    }\n\n    if (event.key === 'Escape') {\n      event.preventDefault();\n      clearSelection();\n      return;\n    }\n\n    if (event.key === 'ArrowDown') {\n      event.preventDefault();\n      moveSelection(1, event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'ArrowUp') {\n      event.preventDefault();\n      moveSelection(-1, event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'PageDown') {\n      event.preventDefault();\n      moveSelection(Math.floor(viewportHeight / rowHeight), event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'PageUp') {\n      event.preventDefault();\n      moveSelection(-Math.floor(viewportHeight / rowHeight), event.shiftKey);\n      return;\n    }\n\n    if (event.key === 'Enter') {\n      event.preventDefault();\n      if (platform === 'windows') {\n        await openSelected();\n      } else {\n        await startRename();\n      }\n      return;\n    }\n\n    if (event.key === 'F2') {\n      event.preventDefault();\n      await startRename();\n      return;\n    }\n\n    if (event.key === ' ' && !isTextInput) {\n      event.preventDefault();\n      const entry = primaryEntry();\n      if (entry) {\n        await invoke('quick_look', { path: entry.path });\n      }\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'f') {\n      event.preventDefault();\n      clearSelection();\n      searchInputEl?.focus();\n      searchInputEl?.select();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'o') {\n      event.preventDefault();\n      await openSelected();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key === 'Enter') {\n      event.preventDefault();\n      await revealSelected();\n      return;\n    }\n\n    if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'c') {\n      event.preventDefault();\n      await copySelectedPaths();\n      return;\n    }\n\n    if (isMetaSelectAll) {\n      event.preventDefault();\n      selectedIndices = new Set(Array.from({ length: results.length }, (_, i) => i));\n      return;\n    }\n\n    if (event.key === 'Delete' || ((event.metaKey || event.ctrlKey) && event.key === 'Backspace')) {\n      if (!isTextInput) {\n        event.preventDefault();\n        await trashSelected();\n      }\n      return;\n    }\n  }\n\n  function formatSize(entry) {\n    if (entry.isDir || entry.size == null) return '';\n    const bytes = entry.size;\n    if (bytes < 1024) return `${bytes} B`;\n    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n    if (bytes < 1024 * 1024 * 1024) return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n    return `${(bytes / (1024 * 1024 * 1024)).toFixed(1)} GB`;\n  }\n\n  function formatModified(entry) {\n    if (!entry.mtime) {\n      return '';\n    }\n\n    const d = new Date(entry.mtime * 1000);\n    const pad = (n) => String(n).padStart(2, '0');\n    return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;\n  }\n\n  function formatLastUpdated(timestamp) {\n    if (!timestamp) {\n      return '-';\n    }\n\n    return new Date(timestamp * 1000).toLocaleString();\n  }\n\n  function formatElapsed(ms) {\n    const totalSec = Math.floor(ms / 1000);\n    const min = Math.floor(totalSec / 60);\n    const sec = totalSec % 60;\n    return min > 0 ? `${min}m ${sec}s` : `${sec}s`;\n  }\n\n  function updateElapsed() {\n    if (indexingStartTime && indexStatus.state === 'Indexing') {\n      indexingElapsed = formatElapsed(Date.now() - indexingStartTime);\n    }\n  }\n\n  function startElapsedTimer() {\n    clearInterval(elapsedTimer);\n    indexingStartTime = Date.now();\n    indexingElapsed = '0s';\n    indexingFinishedAt = '';\n    elapsedTimer = setInterval(updateElapsed, 1000);\n  }\n\n  function stopElapsedTimer() {\n    clearInterval(elapsedTimer);\n    if (indexingStartTime) {\n      const elapsed = Date.now() - indexingStartTime;\n      indexingFinishedAt = `${formatElapsed(elapsed)}`;\n    }\n    indexingStartTime = null;\n    indexingElapsed = '';\n  }\n\n  function displayPath(path) {\n    if (!path) {\n      return path;\n    }\n\n    if (!homePrefix) {\n      return path;\n    }\n\n    if (path === homePrefix) {\n      return '~';\n    }\n\n    if (path.startsWith(`${homePrefix}/`)) {\n      return `~${path.slice(homePrefix.length)}`;\n    }\n\n    return path;\n  }\n\n  let unlistenFns = [];\n\n  onMount(async () => {\n    const t0 = performance.now();\n    const ms = () => Math.round(performance.now() - t0);\n    const DEBUG_STARTUP = false;\n    const flog = DEBUG_STARTUP ? (msg) => invoke('frontend_log', { msg }).catch(() => {}) : () => {};\n\n    flog(`[startup/fe] onMount entered`);\n\n    updateViewportHeight();\n    flog(`[startup/fe] +${ms()}ms updateViewportHeight done`);\n\n    invoke('set_native_theme', { theme });\n\n    platform = await invoke('get_platform');\n    flog(`[startup/fe] +${ms()}ms get_platform done`);\n\n    const unlistenProgress = await listen('index_progress', (event) => {\n      scanned = event.payload.scanned;\n      if (indexStatus.state !== 'Indexing') {\n        indexStatus = {\n          ...indexStatus,\n          state: 'Indexing'\n        };\n      }\n    });\n    flog(`[startup/fe] +${ms()}ms listen(index_progress) registered`);\n\n    const unlistenState = await listen('index_state', (event) => {\n      flog(`[startup/fe] index_state event received: ${event.payload.state} at +${ms()}ms`);\n      const prevState = indexStatus.state;\n      indexStatus = {\n        ...indexStatus,\n        state: event.payload.state,\n        message: event.payload.message ?? null,\n        isCatchup: event.payload.isCatchup ?? false\n      };\n\n      if (event.payload.state === 'Indexing' && prevState !== 'Indexing') {\n        if (prevState === 'Ready') {\n          lastReadyCount = indexStatus.entriesCount;\n        }\n        startElapsedTimer();\n      } else if (event.payload.state !== 'Indexing' && prevState === 'Indexing') {\n        stopElapsedTimer();\n      }\n\n      if (event.payload.state === 'Ready') {\n        scheduleSearch();\n      }\n    });\n    flog(`[startup/fe] +${ms()}ms listen(index_state) registered`);\n\n    const unlistenUpdated = await listen('index_updated', (event) => {\n      indexStatus = {\n        ...indexStatus,\n        entriesCount: event.payload.entriesCount,\n        lastUpdated: event.payload.lastUpdated,\n        permissionErrors: event.payload.permissionErrors ?? indexStatus.permissionErrors\n      };\n\n      scheduleSearch(true);\n    });\n\n    const unlistenFocus = await listen('focus_search', () => {\n      void focusSearch();\n    });\n\n    const unlistenCtxMenuAction = await listen('context_menu_action', (event) => {\n      switch (event.payload) {\n        case 'open': void openSelected(); break;\n        case 'quick_look': {\n          const e = primaryEntry();\n          if (e) void invoke('quick_look', { path: e.path });\n          break;\n        }\n        case 'open_with': void openWithFallback(); break;\n        case 'reveal': void revealSelected(); break;\n        case 'copy_files': void copyFiles(); break;\n        case 'copy_path': void copySelectedPaths(); break;\n        case 'trash': void trashSelected(); break;\n        case 'rename': void startRename(); break;\n      }\n    });\n\n    unlistenFns = [unlistenProgress, unlistenState, unlistenUpdated, unlistenFocus, unlistenCtxMenuAction];\n    flog(`[startup/fe] +${ms()}ms all listeners registered`);\n\n    // Fetch backend state IMMEDIATELY after listeners are registered.\n    // Events emitted before listener registration are lost, so this\n    // is the only reliable way to get the current state.\n    await refreshStatus();\n    flog(`[startup/fe] +${ms()}ms refreshStatus done (state=${indexStatus.state})`);\n\n    // Show Svelte UI: remove skeleton, focus search input.\n    await tick();\n    document.getElementById('skeleton')?.remove();\n    await focusSearch();\n    flog(`[startup/fe] +${ms()}ms WINDOW VISIBLE â€” skeleton removed`);\n\n    try {\n      homePrefix = await invoke('get_home_dir');\n    } catch {\n      homePrefix = '';\n    }\n    flog(`[startup/fe] +${ms()}ms get_home_dir done`);\n\n    if (!localStorage.getItem('everything-fda-notice-v1')) {\n      showToast('macOS Full Disk Access permission may be required for full disk search.');\n      localStorage.setItem('everything-fda-notice-v1', '1');\n    }\n    flog(`[startup/fe] +${ms()}ms calling runSearch...`);\n    await runSearch();\n    flog(`[startup/fe] +${ms()}ms runSearch done`);\n\n    if (typeof ResizeObserver !== 'undefined') {\n      tableResizeObserver = new ResizeObserver(() => {\n        scheduleViewportHeightUpdate();\n      });\n      if (tableContainer) {\n        tableResizeObserver.observe(tableContainer);\n      } else if (tableAreaEl) {\n        tableResizeObserver.observe(tableAreaEl);\n      }\n    }\n\n    window.addEventListener('resize', scheduleViewportHeightUpdate);\n    window.addEventListener('click', onGlobalClick);\n    statusRefreshTimer = setInterval(() => {\n      if (indexStatus.state === 'Indexing') {\n        void refreshStatus();\n      }\n    }, 1000);\n    console.log(`[startup/fe] +${ms()}ms onMount complete`);\n  });\n\n  onDestroy(async () => {\n    clearTimeout(searchTimer);\n    clearTimeout(toastTimer);\n    clearInterval(statusRefreshTimer);\n    clearInterval(elapsedTimer);\n    resizeCleanup?.();\n\n    for (const unlisten of unlistenFns) {\n      unlisten();\n    }\n\n    tableResizeObserver?.disconnect();\n    tableResizeObserver = null;\n    if (viewportResizeRaf !== null) {\n      cancelAnimationFrame(viewportResizeRaf);\n      viewportResizeRaf = null;\n    }\n    window.removeEventListener('resize', scheduleViewportHeightUpdate);\n    window.removeEventListener('click', onGlobalClick);\n  });\n</script>\n\n<svelte:window on:keydown={handleKeydown} />\n\n<div class=\"app-shell\" data-theme={theme}>\n  <div class=\"title-bar\" role=\"presentation\" data-tauri-drag-region on:mousedown={onTitleBarMouseDown}>\n    <div class=\"title-left\"></div>\n    <div class=\"title-center\">\n      <svg class=\"title-icon\" viewBox=\"0 0 215 205\" fill-rule=\"evenodd\" aria-hidden=\"true\">\n        <path d=\"M85 0c46.9 0 85 38.1 85 85 0 20.1-7.2 38.5-19.2 52.7l40.7 40.8c5.8 5.8 5.8 15.2 0 21-5.8 5.8-15.2 5.8-21 0l-40.7-40.7c-13.6 9.7-30.4 15.2-44.8 15.2-46.9 0-85-42.1-85-89 0-46.9 38.1-85 85-85z m0 32c-29.3 0-53 23.7-53 53 0 29.3 23.7 53 53 53 29.3 0 53-23.7 53-53 0-29.3-23.7-53-53-53z\"/>\n      </svg>\n      <span class=\"title-text\">Everything</span>\n    </div>\n    <div class=\"title-right\"></div>\n  </div>\n\n  <header class=\"search-bar\">\n    <input\n      bind:this={searchInputEl}\n      class=\"search-input\"\n      type=\"text\"\n      bind:value={query}\n      on:input={scheduleSearch}\n      on:focus={clearSelection}\n      placeholder=\"Search file/folder names\"\n      autocomplete=\"off\"\n      spellcheck=\"false\"\n    />\n  </header>\n\n  <section class=\"table-area\" bind:this={tableAreaEl} style={tableGridStyle}>\n    <div class=\"table-header\">\n      <div class=\"table-header-track\">\n        <div class=\"col name\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('name')}>\n            Name{#if sortBy === 'name'}{@html sortIconHtml(sortDir)}{/if}\n          </button>\n          <button\n            type=\"button\"\n            class=\"col-resizer\"\n            class:active={resizingColumn === 'name'}\n            on:mousedown={(event) => startColumnResize(event, 'name')}\n            aria-label=\"Resize Name column\"\n          />\n        </div>\n\n        <div class=\"col path\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('dir')}>\n            Path{#if sortBy === 'dir'}{@html sortIconHtml(sortDir)}{/if}\n          </button>\n          <button\n            type=\"button\"\n            class=\"col-resizer\"\n            class:active={resizingColumn === 'path'}\n            on:mousedown={(event) => startColumnResize(event, 'path')}\n            aria-label=\"Resize Path column\"\n          />\n        </div>\n\n        <div class=\"col size\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('size')}>\n            Size{#if sortBy === 'size'}{@html sortIconHtml(sortDir)}{/if}\n          </button>\n        </div>\n\n        <div class=\"col modified\">\n          <button type=\"button\" class=\"col-button\" on:click={() => handleHeaderSort('mtime')}>\n            Modified{#if sortBy === 'mtime'}{@html sortIconHtml(sortDir)}{/if}\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <div\n      class=\"table-body\"\n      bind:this={tableContainer}\n      on:scroll={() => {\n        scrollTop = tableContainer.scrollTop;\n        headerScrollLeft = tableContainer.scrollLeft;\n        if (editing.active) void commitRename();\n        const scrollBottom = scrollTop + tableContainer.clientHeight;\n        if (scrollBottom >= totalHeight - rowHeight * 10) {\n          void loadMore();\n        }\n      }}\n    >\n      <div class=\"spacer\" style={`height:${totalHeight}px`}>\n        <div class=\"rows\" style={`transform: translateY(${translateY}px);`}>\n          {#each visibleRows as entry, localIndex}\n            {@const index = startIndex + localIndex}\n            <div\n              class=\"row {selectedIndices.has(index) ? 'selected' : ''}\"\n              on:mousedown={(event) => handleRowMouseDown(event, index)}\n              on:click={(event) => handleRowClick(event, index)}\n              on:keydown={(event) => handleRowA11yKeydown(event, index)}\n              on:dblclick={() => handleRowDoubleClick(index)}\n              on:contextmenu={(event) => handleRowContextMenu(event, index)}\n              role=\"row\"\n              tabindex=\"0\"\n            >\n              <div class=\"cell name\">\n                <img class=\"file-icon\" src={iconFor(entry)} alt=\"\" />\n                <span class=\"ellipsis\" class:name-editing={editing.active && editing.index === index}>{#each highlightSegments(entry.name, query) as seg}{#if seg.hl}<mark class=\"hl\">{seg.text}</mark>{:else}{seg.text}{/if}{/each}</span>\n              </div>\n              <div class=\"cell path\"><span class=\"ellipsis\">{displayPath(entry.dir)}</span></div>\n              <div class=\"cell size\">{formatSize(entry)}</div>\n              <div class=\"cell modified\">{formatModified(entry)}</div>\n            </div>\n          {/each}\n        </div>\n      </div>\n    </div>\n  </section>\n\n  <footer class=\"status-bar\">\n    <div class=\"status-left\">\n      <span class=\"status-state\">\n        <span class=\"state-dot {indexStatus.state === 'Indexing' ? 'indexing' : indexStatus.state === 'Error' ? 'error' : 'ready'}\"></span>\n        {#if indexStatus.state === 'Indexing'}\n          Indexing{#if lastReadyCount > 0} ({Math.min(99, Math.round((scanned / lastReadyCount) * 100))}%){/if}{#if indexingElapsed} Â· {indexingElapsed}{/if}\n          {#if !indexStatus.isCatchup}\n            Â· {scanned.toLocaleString()} scanned\n          {/if}\n        {:else}\n          Index: {indexStatus.state}\n        {/if}\n      </span>\n      <span>{indexStatus.entriesCount.toLocaleString()} entries</span>\n      {#if indexingFinishedAt && indexStatus.state !== 'Indexing'}\n        <span>in {indexingFinishedAt}</span>\n      {/if}\n      {#if dbLatencyMs !== null && dbLastQuery}\n        <span>\"{dbLastQuery}\" {dbLatencyMs}ms Â· {totalResults} results</span>\n      {/if}\n      {#if searchModeLabel === 'spotlight' || searchModeLabel === 'spotlight_timeout'}\n        <span class=\"status-spotlight\">Spotlight fallback{#if searchModeLabel === 'spotlight_timeout'} (partial){/if}</span>\n      {/if}\n      {#if indexStatus.permissionErrors > 0}\n        <span class=\"status-warning\">{indexStatus.permissionErrors.toLocaleString()} permission errors</span>\n      {/if}\n      {#if indexStatus.message}\n        <span class={indexStatus.isCatchup ? 'index-progress' : 'status-error'}>{indexStatus.message}</span>\n      {/if}\n    </div>\n    <div class=\"status-right\">\n      <button class=\"status-btn\" on:click={cycleTheme} title=\"Switch theme\">\n        {theme === 'dark' ? 'â˜€ Light' : 'â—‘ Dark'}\n      </button>\n      <button\n        class=\"status-btn rebuild-btn\"\n        on:click={resetIndex}\n        disabled={indexStatus.state === 'Indexing'}\n        title={indexStatus.state === 'Indexing' ? 'Cannot reset while indexing is in progress.' : 'Reset and rebuild the index.'}\n      >\n        <svg class=\"rebuild-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <path d=\"M23 4v6h-6\"/><path d=\"M20.49 15a9 9 0 1 1-2.12-9.36L23 10\"/>\n        </svg>\n        Rebuild Index\n      </button>\n    </div>\n  </footer>\n\n  {#if editing.active}\n    <div\n      class=\"rename-overlay\"\n      style=\"top:{renameOverlay.top}px; left:{renameOverlay.left}px; width:{renameOverlay.width}px;\"\n      role=\"presentation\"\n      on:mousedown|stopPropagation\n    >\n      <textarea\n        bind:this={renameInputEl}\n        class=\"rename-textarea\"\n        bind:value={editing.draftName}\n        on:input={autoResizeRenameInput}\n        on:click|stopPropagation\n        on:blur={commitRename}\n      />\n    </div>\n  {/if}\n\n  {#if contextMenu.visible}\n    <div class=\"context-menu\" style={`left:${contextMenu.x}px;top:${contextMenu.y}px;`}>\n      <button on:click={() => (closeContextMenu(), openSelected())}>Open</button>\n      <button on:click={async () => { closeContextMenu(); const e = primaryEntry(); if (e) await invoke('quick_look', { path: e.path }); }}>Quick Look</button>\n      <button on:click={() => (closeContextMenu(), openWithFallback())}>Open With... (Reveal in Finder)</button>\n      <button on:click={() => (closeContextMenu(), revealSelected())}>Reveal in Finder</button>\n      <button on:click={() => (closeContextMenu(), copySelectedPaths())}>Copy Path</button>\n      <button on:click={() => (closeContextMenu(), trashSelected())}>Move to Trash</button>\n      {#if selectedIndices.size === 1}\n        <button on:click={() => (closeContextMenu(), startRename())}>Rename</button>\n      {/if}\n    </div>\n  {/if}\n\n  {#if toast}\n    <div class=\"toast\">{toast}</div>\n  {/if}\n</div>\n\n<style>\n  :global(:root) {\n    color-scheme: light dark;\n    --bg-app: transparent;\n    --text-primary: #0d1826;\n    --text-muted: #48596c;\n    --bar-grad-top: rgba(255, 255, 255, 0.48);\n    --bar-grad-bottom: rgba(248, 250, 253, 0.42);\n    --surface-header: rgba(252, 252, 255, 0.40);\n    --surface: rgba(255, 255, 255, 0.22);\n    --border-soft: rgba(0, 0, 0, 0.07);\n    --border-input: rgba(0, 0, 0, 0.13);\n    --focus-ring: #6f96e6;\n    --row-border: rgba(0, 0, 0, 0.032);\n    --row-hover: rgba(0, 0, 0, 0.06);\n    --row-selected: rgba(0, 0, 0, 0.12);\n    --button-bg: rgba(255, 255, 255, 0.62);\n    --button-border: rgba(0, 0, 0, 0.10);\n    --button-text: #2c3e50;\n    --menu-bg: rgba(240, 241, 248, 0.90);\n    --menu-border: rgba(0, 0, 0, 0.06);\n    --menu-hover: rgba(255, 255, 255, 0.62);\n    --menu-text: #1a2a38;\n    --error-text: #b64545;\n    --warning-text: #8f6500;\n    --toast-bg: rgba(18, 22, 32, 0.90);\n    --toast-text: #ffffff;\n  }\n\n  @media (prefers-color-scheme: dark) {\n    :global(:root) {\n      --bg-app: transparent;\n      --text-primary: #e6e6ea;\n      --text-muted: #9494a4;\n      --bar-grad-top: rgba(38, 38, 46, 0.52);\n      --bar-grad-bottom: rgba(30, 30, 38, 0.46);\n      --surface-header: rgba(32, 32, 40, 0.46);\n      --surface: rgba(18, 18, 26, 0.32);\n      --border-soft: rgba(255, 255, 255, 0.065);\n      --border-input: rgba(255, 255, 255, 0.14);\n      --focus-ring: #5b8bd9;\n      --row-border: rgba(255, 255, 255, 0.026);\n      --row-hover: rgba(255, 255, 255, 0.08);\n      --row-selected: rgba(255, 255, 255, 0.14);\n      --button-bg: rgba(255, 255, 255, 0.072);\n      --button-border: rgba(255, 255, 255, 0.11);\n      --button-text: #d6d6e0;\n      --menu-bg: rgba(36, 36, 46, 0.90);\n      --menu-border: rgba(255, 255, 255, 0.066);\n      --menu-hover: rgba(255, 255, 255, 0.062);\n      --menu-text: #e0e0e8;\n      --error-text: #ff9d9d;\n      --warning-text: #e0c670;\n      --toast-bg: rgba(10, 10, 16, 0.93);\n      --toast-text: #f2f2f6;\n    }\n  }\n\n  /* â”€â”€ Theme: Dark â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme=\"dark\"]) {\n    color-scheme: dark;\n    --bg-app: #1E1E21;\n    --text-primary: #E2E8F0;\n    --text-muted: #94A3B8;\n    --bar-grad-top: #1E1E21;\n    --bar-grad-bottom: #1E1E21;\n    --surface-header: #1E1E21;\n    --surface: #1E1E21;\n    --bg-input: #161618;\n    --border-soft: #2A2A2D;\n    --border-input: rgba(255, 255, 255, 0.06);\n    --focus-ring: #4DA8FF;\n    --accent: #4DA8FF;\n    --row-border: rgba(255, 255, 255, 0.02);\n    --row-hover: #282828;\n    --row-selected: rgba(77, 168, 255, 0.10);\n    --button-bg: rgba(255, 255, 255, 0.05);\n    --button-border: #2A2A2D;\n    --button-text: #94A3B8;\n    --menu-bg: #252528;\n    --menu-border: #2A2A2D;\n    --menu-hover: rgba(255, 255, 255, 0.04);\n    --menu-text: #E2E8F0;\n    --error-text: #ff9d9d;\n    --warning-text: #e0c670;\n    --toast-bg: rgba(10, 10, 16, 0.93);\n    --toast-text: #f2f2f6;\n  }\n\n  /* â”€â”€ Theme: Light â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme=\"light\"]) {\n    color-scheme: light;\n    --bg-app: #F5F5F7;\n    --text-primary: #1C1C1E;\n    --text-muted: #6E6E7A;\n    --bar-grad-top: #F5F5F7;\n    --bar-grad-bottom: #F5F5F7;\n    --surface-header: #F5F5F7;\n    --surface: #F5F5F7;\n    --bg-input: #FFFFFF;\n    --border-soft: #D1D1D6;\n    --border-input: rgba(0, 0, 0, 0.10);\n    --focus-ring: #3A8BF5;\n    --accent: #3A8BF5;\n    --row-border: rgba(0, 0, 0, 0.04);\n    --row-hover: rgba(0, 0, 0, 0.04);\n    --row-selected: rgba(58, 139, 245, 0.10);\n    --button-bg: #FFFFFF;\n    --button-border: #D1D1D6;\n    --button-text: #3C3C43;\n    --menu-bg: #FFFFFF;\n    --menu-border: #D1D1D6;\n    --menu-hover: rgba(0, 0, 0, 0.05);\n    --menu-text: #1C1C1E;\n    --error-text: #D93025;\n    --warning-text: #B45309;\n    --toast-bg: rgba(255, 255, 255, 0.95);\n    --toast-text: #1C1C1E;\n  }\n\n  /* â”€â”€ Themed element overrides â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  :global([data-theme]) {\n    background: var(--bg-app);\n  }\n\n  /* Search bar: flat, no gradient, no separator */\n  :global([data-theme]) .search-bar {\n    height: 44px;\n    padding: 0 16px;\n    background: var(--bg-app);\n    border-bottom: none;\n  }\n\n  :global([data-theme]) .search-input {\n    backdrop-filter: none;\n    -webkit-backdrop-filter: none;\n    font-family: 'JetBrains Mono', 'SF Mono', monospace;\n    font-size: 12px;\n    height: 34px;\n    border-radius: 8px;\n  }\n\n  /* Table header: flat bg, 16px edge padding */\n  :global([data-theme]) .table-header {\n    background: var(--bg-app);\n  }\n\n  :global([data-theme]) .col-button {\n    padding: 0 8px;\n  }\n\n  :global([data-theme]) .col.name .col-button {\n    padding-left: 16px;\n  }\n\n  /* Row cells: JetBrains Mono, 16px outer edges */\n  :global([data-theme]) .cell {\n    font-family: 'JetBrains Mono', monospace;\n  }\n\n  :global([data-theme]) .cell.name {\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    padding-left: 16px;\n    font-size: 12px;\n    color: var(--text-primary);\n  }\n\n  :global([data-theme]) .cell.path {\n    font-size: 11px;\n  }\n\n  :global([data-theme]) .cell.size {\n    font-size: 11px;\n  }\n\n  :global([data-theme]) .cell.modified {\n    padding-right: 16px;\n    font-size: 11px;\n    white-space: nowrap;\n  }\n\n  :global([data-theme]) .row.selected {\n    box-shadow: inset 3px 0 0 var(--accent);\n  }\n\n  /* Dim path/size/date cells in themed mode */\n  :global([data-theme]) .cell.path,\n  :global([data-theme]) .cell.size,\n  :global([data-theme]) .cell.modified {\n    color: var(--text-muted);\n  }\n\n  :global(:root) {\n    background: transparent;\n  }\n\n  :global(html, body) {\n    margin: 0;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n    background: transparent;\n    color: var(--text-primary);\n    font-family: Inter, 'SF Pro Text', 'Segoe UI', Helvetica, Arial, sans-serif;\n  }\n\n  :global(#app) {\n    width: 100%;\n    height: 100%;\n  }\n\n  .app-shell {\n    display: grid;\n    grid-template-rows: auto auto 1fr auto;\n    height: 100%;\n    min-width: 0;\n  }\n\n  .title-bar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 44px;\n    padding: 0 16px;\n    background: var(--surface-header);\n    cursor: default;\n    flex-shrink: 0;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-left {\n    width: 72px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-center {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-right {\n    width: 72px;\n    pointer-events: none;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .title-icon {\n    width: 14px;\n    height: 14px;\n    fill: var(--accent);\n    flex-shrink: 0;\n  }\n\n  .title-text {\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--text-primary);\n    letter-spacing: -0.01em;\n  }\n\n  .search-bar {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 8px;\n    background: linear-gradient(180deg, var(--bar-grad-top) 0%, var(--bar-grad-bottom) 100%);\n    border-bottom: 1px solid var(--border-soft);\n    min-width: 0;\n    flex-shrink: 0;\n  }\n\n  .search-input {\n    display: block;\n    box-sizing: border-box;\n    width: 100%;\n    min-width: 0;\n    flex: 1 1 auto;\n    height: 36px;\n    border: 1px solid var(--border-input);\n    border-radius: 14px;\n    padding: 0 10px;\n    font-size: 14px;\n    background: var(--bg-input, var(--surface));\n    color: var(--text-primary);\n    backdrop-filter: blur(12px) saturate(160%);\n    -webkit-backdrop-filter: blur(12px) saturate(160%);\n  }\n\n  .search-input::placeholder {\n    color: var(--text-muted);\n    opacity: 0.85;\n    font-size: 12px;\n  }\n\n  .search-input:focus {\n    outline: none;\n    border-color: var(--focus-ring);\n    box-shadow: 0 0 0 2px rgba(125, 169, 255, 0.25);\n  }\n\n  .table-area {\n    display: grid;\n    grid-template-rows: auto 1fr;\n    min-height: 0;\n    min-width: 0;\n  }\n\n  .table-header-track,\n  .row {\n    display: grid;\n    grid-template-columns: var(--col-name) var(--col-path) var(--col-size) var(--col-modified);\n    align-items: center;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .table-header {\n    height: 32px;\n    border-bottom: 1px solid var(--border-soft);\n    background: var(--surface-header);\n    user-select: none;\n    overflow: hidden;\n    flex-shrink: 0;\n  }\n\n  .table-header-track {\n    height: 100%;\n    transform: translateX(var(--header-offset, 0px));\n    will-change: transform;\n  }\n\n  .table-header .col {\n    position: relative;\n    min-width: 0;\n    height: 100%;\n  }\n\n  .col-button {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: flex-start;\n    gap: 4px;\n    box-sizing: border-box;\n    padding: 0 8px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 11px;\n    font-weight: 600;\n    line-height: 1;\n    color: var(--text-muted);\n    text-align: left;\n    margin: 0;\n    border: none;\n    background: transparent;\n    cursor: pointer;\n  }\n\n  :global(.sort-icon) {\n    width: 10px;\n    height: 10px;\n    flex-shrink: 0;\n    color: var(--accent);\n  }\n\n  .col-resizer {\n    position: absolute;\n    top: 0;\n    right: -4px;\n    width: 8px;\n    height: 100%;\n    border: none;\n    padding: 0;\n    background: transparent;\n    cursor: col-resize;\n    z-index: 30;\n  }\n\n  .col-resizer::after {\n    content: '';\n    position: absolute;\n    top: 7px;\n    bottom: 7px;\n    left: 50%;\n    width: 1px;\n    transform: translateX(-50%);\n    background: var(--border-soft);\n    opacity: 0;\n    transition: opacity 0.15s ease;\n  }\n\n  .table-header .col:hover .col-resizer::after,\n  .col-resizer.active::after {\n    opacity: 1;\n  }\n\n  .table-body {\n    overflow: auto;\n    min-height: 0;\n    min-width: 0;\n    background: var(--surface);\n  }\n\n  .spacer {\n    position: relative;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .rows {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: max(var(--table-min-width, 0px), 100%);\n  }\n\n  .row {\n    height: 30px;\n    border-bottom: 1px solid var(--row-border);\n    cursor: default;\n    -webkit-user-select: none;\n    user-select: none;\n    outline: none;\n  }\n\n  .row:hover {\n    background: var(--row-hover);\n  }\n\n  .row.selected {\n    background: var(--row-selected);\n  }\n\n  .cell {\n    padding: 0 8px;\n    font-size: 12px;\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    min-width: 0;\n  }\n\n  .cell.size {\n    text-align: right;\n    font-variant-numeric: tabular-nums;\n  }\n\n  .ellipsis {\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n\n  .hl {\n    background: none;\n    color: inherit;\n    font-weight: 700;\n  }\n\n  .file-icon {\n    width: 16px;\n    height: 16px;\n    flex: 0 0 auto;\n  }\n\n  .name-editing {\n    opacity: 0.25;\n  }\n\n  .rename-overlay {\n    position: fixed;\n    z-index: 100;\n    min-width: 120px;\n  }\n\n  .rename-textarea {\n    display: block;\n    width: 100%;\n    box-sizing: border-box;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 12px;\n    line-height: 18px;\n    padding: 5px 4px 5px 0;\n    border: 1.5px solid var(--focus-ring);\n    border-radius: 4px;\n    background: var(--bg-input, var(--surface));\n    color: var(--text-primary);\n    outline: none;\n    resize: none;\n    overflow: hidden;\n    box-shadow: 0 2px 14px rgba(0, 0, 0, 0.22), 0 0 0 3px rgba(77, 168, 255, 0.13);\n  }\n\n  .status-bar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 32px;\n    padding: 0 16px;\n    background: var(--surface-header);\n    border-top: 1px solid var(--border-soft);\n    font-family: 'JetBrains Mono', monospace;\n    font-size: 11px;\n    color: var(--text-muted);\n    white-space: nowrap;\n    overflow: hidden;\n    min-width: 0;\n    flex-shrink: 0;\n  }\n\n  .status-left {\n    display: flex;\n    align-items: center;\n    gap: 16px;\n    overflow: hidden;\n    min-width: 0;\n  }\n\n  .status-right {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    flex-shrink: 0;\n  }\n\n  .status-btn {\n    border: 1px solid var(--button-border);\n    border-radius: 5px;\n    background: var(--button-bg);\n    color: var(--button-text);\n    font-size: 11px;\n    height: 22px;\n    padding: 0 8px;\n    cursor: pointer;\n  }\n\n  .status-btn:hover {\n    filter: brightness(1.06);\n  }\n\n  .status-btn:disabled {\n    opacity: 0.55;\n    cursor: not-allowed;\n    filter: none;\n  }\n\n  .status-state {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n  }\n\n  .state-dot {\n    width: 6px;\n    height: 6px;\n    border-radius: 50%;\n    flex-shrink: 0;\n  }\n\n  .state-dot.ready { background: #28C840; }\n  .state-dot.indexing { background: #FEBC2E; }\n  .state-dot.error { background: #FF5F57; }\n\n  .rebuild-btn {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 10px;\n    font-weight: 500;\n    background: var(--button-bg);\n    border: 1px solid var(--button-border);\n    border-radius: 4px;\n    color: var(--button-text);\n    height: 22px;\n    padding: 0 10px;\n    cursor: pointer;\n  }\n\n  .rebuild-btn:hover {\n    filter: brightness(1.1);\n  }\n\n  .rebuild-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    filter: none;\n  }\n\n  .rebuild-icon {\n    width: 11px;\n    height: 11px;\n    color: var(--accent);\n    flex-shrink: 0;\n  }\n\n  .status-error {\n    color: var(--error-text);\n  }\n\n  .status-warning {\n    color: var(--warning-text);\n  }\n\n  .status-spotlight {\n    color: #f59e0b;\n    font-weight: 600;\n  }\n\n  .context-menu {\n    position: fixed;\n    z-index: 200;\n    width: 220px;\n    border: 1px solid var(--menu-border);\n    border-radius: 10px;\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.16), inset 0 0 0 0.5px rgba(255, 255, 255, 0.18);\n    background: var(--menu-bg);\n    backdrop-filter: blur(28px) saturate(180%);\n    -webkit-backdrop-filter: blur(28px) saturate(180%);\n    overflow: hidden;\n  }\n\n  .context-menu button {\n    width: 100%;\n    text-align: left;\n    border: none;\n    background: transparent;\n    padding: 8px 10px;\n    font-size: 12px;\n    color: var(--menu-text);\n  }\n\n  .context-menu button:hover {\n    background: var(--menu-hover);\n  }\n\n  .toast {\n    position: fixed;\n    right: 14px;\n    bottom: 18px;\n    background: var(--toast-bg);\n    color: var(--toast-text);\n    border-radius: 10px;\n    padding: 9px 12px;\n    font-size: 12px;\n    z-index: 250;\n    backdrop-filter: blur(20px) saturate(180%);\n    -webkit-backdrop-filter: blur(20px) saturate(180%);\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);\n  }\n</style>\n","structuredPatch":[{"oldStart":2198,"oldLines":13,"newStart":2198,"newLines":8,"lines":["     font-family: Inter, 'SF Pro Text', sans-serif;","     font-size: 10px;","     font-weight: 500;","-    background: var(--button-bg);","-    border: 1px solid var(--button-border);","     border-radius: 4px;","-    color: var(--button-text);","-    height: 22px;","     padding: 0 10px;","-    cursor: pointer;","   }"," ","   .rebuild-btn:hover {"]},{"oldStart":2213,"oldLines":8,"newStart":2208,"newLines":6,"lines":[" ","   .rebuild-btn:disabled {","     opacity: 0.5;","-    cursor: not-allowed;","-    filter: none;","   }"," ","   .rebuild-icon {"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"457a04d0-0254-4ec0-a41b-0257d8febff6"}
{"parentUuid":"ffbdeafc-b9b5-4f1a-8a0e-171cc169195e","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01QMS3aJZur8ubZndAJgtUtX","type":"message","role":"assistant","content":[{"type":"text","text":"ëª¨ë“  ìˆ˜ì •ì´ ì™„ë£Œë˜ì—ˆëŠ”ì§€ ìµœì¢… í™•ì¸í•©ë‹ˆë‹¤."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":621,"cache_read_input_tokens":102780,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":621},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPSeUfK73L47ASramsn","type":"assistant","uuid":"739c56b3-cac7-46c5-bc33-c19e7fbbed99","timestamp":"2026-02-21T14:40:24.885Z"}
{"parentUuid":"739c56b3-cac7-46c5-bc33-c19e7fbbed99","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01QMS3aJZur8ubZndAJgtUtX","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_013agj6Ukj9P56wLz4K39coW","name":"Bash","input":{"command":"npm run lint 2>&1 | tail -20","description":"Run lint to verify no errors","timeout":60000},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":621,"cache_read_input_tokens":102780,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":621},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPSeUfK73L47ASramsn","type":"assistant","uuid":"687acc2d-812d-4ab3-918f-fd06186eeeaa","timestamp":"2026-02-21T14:40:25.849Z"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-02-21T14:40:28.898Z","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","content":"{\"task_id\":\"bcfb5b2\",\"tool_use_id\":\"toolu_013agj6Ukj9P56wLz4K39coW\",\"description\":\"Run lint to verify no errors\",\"task_type\":\"local_bash\"}"}
{"parentUuid":"687acc2d-812d-4ab3-918f-fd06186eeeaa","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"bash_progress","output":"","fullOutput":"","elapsedTimeSeconds":3,"totalLines":0,"totalBytes":0,"taskId":"bcfb5b2","timeoutMs":60000},"toolUseID":"bash-progress-0","parentToolUseID":"toolu_013agj6Ukj9P56wLz4K39coW","uuid":"d291854e-0f03-4874-bd59-f207550e8a98","timestamp":"2026-02-21T14:40:28.898Z"}
{"parentUuid":"d291854e-0f03-4874-bd59-f207550e8a98","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"bash_progress","output":"","fullOutput":"","elapsedTimeSeconds":4,"totalLines":0,"totalBytes":0,"taskId":"bcfb5b2","timeoutMs":60000},"toolUseID":"bash-progress-1","parentToolUseID":"toolu_013agj6Ukj9P56wLz4K39coW","uuid":"e1dbe348-6829-4e8d-ab66-8544bc380910","timestamp":"2026-02-21T14:40:29.899Z"}
{"parentUuid":"687acc2d-812d-4ab3-918f-fd06186eeeaa","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_013agj6Ukj9P56wLz4K39coW","type":"tool_result","content":"dist/assets/jetbrains-mono-latin-500-normal-BWZEU5yA.woff2      21.83 kB\ndist/assets/inter-latin-400-normal-C38fXH4l.woff2               23.66 kB\ndist/assets/inter-latin-500-normal-Cerq10X2.woff2               24.27 kB\ndist/assets/inter-latin-600-normal-LgqL8muc.woff2               24.45 kB\ndist/assets/jetbrains-mono-latin-400-normal-6-qcROiO.woff       27.50 kB\ndist/assets/jetbrains-mono-latin-500-normal-CJOVTJB7.woff       28.21 kB\ndist/assets/inter-latin-400-normal-CyCys3Eg.woff                30.70 kB\ndist/assets/inter-latin-600-normal-CiBQ2DWP.woff                31.26 kB\ndist/assets/inter-latin-500-normal-BL9OpVg8.woff                31.28 kB\ndist/assets/inter-latin-ext-400-normal-C1nco2VV.woff2           35.00 kB\ndist/assets/inter-latin-ext-500-normal-CV4jyFjo.woff2           36.02 kB\ndist/assets/inter-latin-ext-600-normal-D2bJ5OIk.woff2           36.26 kB\ndist/assets/inter-latin-ext-400-normal-77YHD8bZ.woff            47.56 kB\ndist/assets/inter-latin-ext-500-normal-BxGbmqWO.woff            48.49 kB\ndist/assets/inter-latin-ext-600-normal-CIVaiw4L.woff            48.67 kB\ndist/assets/index-CNSOtBqO.css                                  42.19 kB â”‚ gzip: 17.71 kB\ndist/assets/index-C-uKS9_4.js                                   57.90 kB â”‚ gzip: 19.29 kB\nâœ“ built in 445ms\n    Checking everything v0.2.0 (/Users/al02402336/everything/src-tauri)\n    Finished `dev` profile [unoptimized + debuginfo] target(s) in 2.71s","is_error":false}]},"uuid":"b1770e05-493b-4c1d-a964-abc5da3435ec","timestamp":"2026-02-21T14:40:30.556Z","toolUseResult":{"stdout":"dist/assets/jetbrains-mono-latin-500-normal-BWZEU5yA.woff2      21.83 kB\ndist/assets/inter-latin-400-normal-C38fXH4l.woff2               23.66 kB\ndist/assets/inter-latin-500-normal-Cerq10X2.woff2               24.27 kB\ndist/assets/inter-latin-600-normal-LgqL8muc.woff2               24.45 kB\ndist/assets/jetbrains-mono-latin-400-normal-6-qcROiO.woff       27.50 kB\ndist/assets/jetbrains-mono-latin-500-normal-CJOVTJB7.woff       28.21 kB\ndist/assets/inter-latin-400-normal-CyCys3Eg.woff                30.70 kB\ndist/assets/inter-latin-600-normal-CiBQ2DWP.woff                31.26 kB\ndist/assets/inter-latin-500-normal-BL9OpVg8.woff                31.28 kB\ndist/assets/inter-latin-ext-400-normal-C1nco2VV.woff2           35.00 kB\ndist/assets/inter-latin-ext-500-normal-CV4jyFjo.woff2           36.02 kB\ndist/assets/inter-latin-ext-600-normal-D2bJ5OIk.woff2           36.26 kB\ndist/assets/inter-latin-ext-400-normal-77YHD8bZ.woff            47.56 kB\ndist/assets/inter-latin-ext-500-normal-BxGbmqWO.woff            48.49 kB\ndist/assets/inter-latin-ext-600-normal-CIVaiw4L.woff            48.67 kB\ndist/assets/index-CNSOtBqO.css                                  42.19 kB â”‚ gzip: 17.71 kB\ndist/assets/index-C-uKS9_4.js                                   57.90 kB â”‚ gzip: 19.29 kB\nâœ“ built in 445ms\n    Checking everything v0.2.0 (/Users/al02402336/everything/src-tauri)\n    Finished `dev` profile [unoptimized + debuginfo] target(s) in 2.71s","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"687acc2d-812d-4ab3-918f-fd06186eeeaa"}
{"parentUuid":"b1770e05-493b-4c1d-a964-abc5da3435ec","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01UyrULFPPNZxSwn6fSznAAW","type":"message","role":"assistant","content":[{"type":"text","text":"ë¹Œë“œ clean. ê²½ê³  ì—†ìŒ."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":758,"cache_read_input_tokens":103401,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":758},"output_tokens":4,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPTDv5AfUv99DKdtjru","type":"assistant","uuid":"5d976dc5-844f-4d85-b673-3c09639d4945","timestamp":"2026-02-21T14:40:32.674Z"}
{"parentUuid":"5d976dc5-844f-4d85-b673-3c09639d4945","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01UyrULFPPNZxSwn6fSznAAW","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_017ZRRMKBZYyUv4LzVrXjViy","name":"TaskUpdate","input":{"taskId":"1","status":"completed"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":758,"cache_read_input_tokens":103401,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":758},"output_tokens":4,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPTDv5AfUv99DKdtjru","type":"assistant","uuid":"90d4343f-a1bc-4e11-b2d7-38716cea518a","timestamp":"2026-02-21T14:40:33.005Z"}
{"parentUuid":"90d4343f-a1bc-4e11-b2d7-38716cea518a","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_017ZRRMKBZYyUv4LzVrXjViy","type":"tool_result","content":"Updated task #1 status"}]},"uuid":"7d14df39-6b14-48b1-bfb5-308381d132cc","timestamp":"2026-02-21T14:40:33.009Z","toolUseResult":{"success":true,"taskId":"1","updatedFields":["status"],"statusChange":{"from":"in_progress","to":"completed"}},"sourceToolAssistantUUID":"90d4343f-a1bc-4e11-b2d7-38716cea518a"}
{"parentUuid":"7d14df39-6b14-48b1-bfb5-308381d132cc","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01QJfrFp3oDUw8d8vLCdyuoL","type":"message","role":"assistant","content":[{"type":"text","text":"5ê°€ì§€ ì´ìŠˆ ëª¨ë‘ ìˆ˜ì • ì™„ë£Œí–ˆìŠµë‹ˆë‹¤:\n\n| ì´ìŠˆ | ìˆ˜ì • ë‚´ìš© |\n|---|---|\n| **ìŠ¤í¬ë¡¤ ì‹œ rename ë¬´ìŒ ì‚­ì œ** | `cancelRename()` â†’ `void commitRename()` â€” ìŠ¤í¬ë¡¤í•˜ë©´ ì»¤ë°‹ |\n| **drag preview í…Œë§ˆ ë¶ˆì¼ì¹˜** | `window.matchMedia(...)` â†’ `theme === 'dark'` â€” theme ìƒíƒœ ì§ì ‘ ì‚¬ìš© |\n| **ë¯¸ì •ì˜ `.theme-btn` í´ëž˜ìŠ¤** | ë²„íŠ¼ì—ì„œ `theme-btn` í´ëž˜ìŠ¤ ì œê±° |\n| **`.rebuild-btn` CSS ì¤‘ë³µ** | `.status-btn`ê³¼ ë™ì¼í•œ `background`, `border`, `color`, `height`, `cursor` 6ê°œ í”„ë¡œí¼í‹° ì œê±°, `:disabled` ì—ì„œ ì¤‘ë³µ ê·œì¹™ ì œê±° |\n| **sort icon SVG 4ì¤‘ ë³µì‚¬** | `sortIconHtml(dir)` í—¬í¼ í•¨ìˆ˜ ì¶”ê°€, `{@html}` í˜¸ì¶œë¡œ êµì²´, `.sort-icon` â†’ `:global(.sort-icon)` |"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":102,"cache_read_input_tokens":104159,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":102},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPTS2bEtLg5q2LGtFDy","type":"assistant","uuid":"9ee1bc06-b4d1-46f0-9a8e-aa7ff23f788a","timestamp":"2026-02-21T14:40:41.798Z"}
{"parentUuid":"9ee1bc06-b4d1-46f0-9a8e-aa7ff23f788a","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"729a6728-1eac-437f-a8ad-acdf40e7e5b6","toolUseID":"729a6728-1eac-437f-a8ad-acdf40e7e5b6","timestamp":"2026-02-21T14:40:41.849Z","uuid":"3ec63049-e0f7-404e-a5de-1190546fa3cc"}
{"type":"queue-operation","operation":"remove","timestamp":"2026-02-21T14:40:43.635Z","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8"}
{"parentUuid":"3ec63049-e0f7-404e-a5de-1190546fa3cc","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"system","subtype":"stop_hook_summary","hookCount":1,"hookInfos":[{"command":"entire hooks claude-code stop","durationMs":1766}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-21T14:40:43.616Z","uuid":"b3f90500-f187-4d8d-9ff3-98c76c9c0451","toolUseID":"729a6728-1eac-437f-a8ad-acdf40e7e5b6"}
{"parentUuid":"b3f90500-f187-4d8d-9ff3-98c76c9c0451","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"system","subtype":"turn_duration","durationMs":250485,"timestamp":"2026-02-21T14:40:43.617Z","uuid":"c4325764-3c3c-4eea-850b-3d474288ea96","isMeta":false}
{"type":"file-history-snapshot","messageId":"bd5ba824-e5d8-4205-abfb-4b9d5affe05c","snapshot":{"messageId":"bd5ba824-e5d8-4205-abfb-4b9d5affe05c","trackedFileBackups":{"src/App.svelte":{"backupFileName":"f2ffc3f5647f6015@v2","version":2,"backupTime":"2026-02-21T14:44:27.392Z"}},"timestamp":"2026-02-21T14:44:27.391Z"},"isSnapshotUpdate":false}
{"parentUuid":"c4325764-3c3c-4eea-850b-3d474288ea96","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":"renameì´ ìž…ë ¥ì°½ì´ ëœ¨ëŠ”ë° ê¸°ì¡´ nameê³¼ ìœ„ì¹˜ê°€ ì•ˆë§žì•„."},"uuid":"bd5ba824-e5d8-4205-abfb-4b9d5affe05c","timestamp":"2026-02-21T14:44:25.129Z","permissionMode":"bypassPermissions"}
{"parentUuid":"bd5ba824-e5d8-4205-abfb-4b9d5affe05c","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01PjxNPzpUvbdPWzruEXzt7T","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user is saying that the rename input overlay position doesn't align with the original name text. Let me look at the rename overlay position calculation code and the CSS to understand the issue.\n\nLet me read the relevant parts of the code.","signature":"EpsDCkYICxgCKkDSska1W3ZPJSLXgbVui2TVWX8pInzI2eOvaXst20k5056ZNGOOKF4ztJb5cdBvMcWWOIOJ7PiICJMiiJplC0DaEgxQYPaR9yMU9P0ONdcaDG+piwDc/1HkN0xfjiIwxgnXha4ybNEkT6THkKYyeFQ92AgMmqDf4EDr9d1K920ftIbbb9X0O+o63niKi4GEKoICL+n8l1PNi9nfpS8VtlwW/xyE/29SOmkYtYE/hAKzWPFc5oU4pV/mYl2OuSqmtg2d+2cLaKQGOhoXUw7NVnfDZXF+/pzwlmeZ893uwwiV7HEH2Aum7WZt4lCaZk2lGKv7C+1qMK9d1SD3WFgup/W1WRlD3RA/r6V+3wWoefvZczqNLHLb1mcwcqgDUCWP4aHt1oS8ch6pWVZ9ItveoCnvkCFmRH91up838xGFF2b1D5LOkVhsenguUrm2n0ZzS2/u4Qe6+CdKo8rmTWCMghK1r7LWlCc/RHWTFEW+wFrXEM6U2ucUqzCnJtPSA2hcG26y3qtkcAetR7ugufQNgNugkB6HGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":415,"cache_read_input_tokens":104574,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":415},"output_tokens":0,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPkgqoJQRvbDtr9j6Ep","type":"assistant","uuid":"9b38bce2-fc39-45cb-9882-80377ae247d2","timestamp":"2026-02-21T14:44:30.495Z"}
{"parentUuid":"9b38bce2-fc39-45cb-9882-80377ae247d2","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_01PjxNPzpUvbdPWzruEXzt7T","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01PqEYJzkK1MonBeL8o1sSVZ","name":"Read","input":{"file_path":"/Users/al02402336/everything/src/App.svelte","offset":953,"limit":40},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":415,"cache_read_input_tokens":104574,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":415},"output_tokens":0,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPkgqoJQRvbDtr9j6Ep","type":"assistant","uuid":"6e80a84c-89db-495d-904c-c156246e9c46","timestamp":"2026-02-21T14:44:31.188Z"}
{"parentUuid":"6e80a84c-89db-495d-904c-c156246e9c46","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01PqEYJzkK1MonBeL8o1sSVZ","toolUseID":"toolu_01PqEYJzkK1MonBeL8o1sSVZ","timestamp":"2026-02-21T14:44:31.200Z","uuid":"3dfe713a-1ecb-4e19-a356-267cf36ece82"}
{"parentUuid":"6e80a84c-89db-495d-904c-c156246e9c46","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01PqEYJzkK1MonBeL8o1sSVZ","type":"tool_result","content":"   953â†’    const idx = lastSelectedIndex;\n   954â†’    if (idx < 0 || !results[idx]) {\n   955â†’      return;\n   956â†’    }\n   957â†’\n   958â†’    const entry = results[idx];\n   959â†’\n   960â†’    // Calculate overlay position mathematically.\n   961â†’    // Name cell text starts at: padding-left(16) + icon(16) + gap(6) = 38px from cell left.\n   962â†’    // Textarea has padding-left: 0 and border: 1.5px, so text starts ~2px from overlay left.\n   963â†’    if (tableContainer) {\n   964â†’      const rect = tableContainer.getBoundingClientRect();\n   965â†’      const cellLeft = rect.left - tableContainer.scrollLeft;\n   966â†’      const textLeft = cellLeft + 38;\n   967â†’      const cellRight = cellLeft + colWidths.name;\n   968â†’      const rowTop = rect.top + idx * rowHeight - tableContainer.scrollTop;\n   969â†’      renameOverlay = {\n   970â†’        top: rowTop,\n   971â†’        left: textLeft - 2,\n   972â†’        width: cellRight - textLeft + 2 - 4\n   973â†’      };\n   974â†’    }\n   975â†’\n   976â†’    editing = {\n   977â†’      active: true,\n   978â†’      path: entry.path,\n   979â†’      index: idx,\n   980â†’      draftName: entry.name\n   981â†’    };\n   982â†’\n   983â†’    await tick();\n   984â†’\n   985â†’    if (renameInputEl) {\n   986â†’      autoResizeRenameInput();\n   987â†’      renameInputEl.focus();\n   988â†’      const extPos = !entry.isDir ? entry.name.lastIndexOf('.') : -1;\n   989â†’      const selectionEnd = extPos > 0 ? extPos : entry.name.length;\n   990â†’      renameInputEl.setSelectionRange(0, selectionEnd);\n   991â†’    }\n   992â†’  }\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"64a0de9b-0ad5-4439-ab98-5aa15795cd07","timestamp":"2026-02-21T14:44:31.199Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/al02402336/everything/src/App.svelte","content":"    const idx = lastSelectedIndex;\n    if (idx < 0 || !results[idx]) {\n      return;\n    }\n\n    const entry = results[idx];\n\n    // Calculate overlay position mathematically.\n    // Name cell text starts at: padding-left(16) + icon(16) + gap(6) = 38px from cell left.\n    // Textarea has padding-left: 0 and border: 1.5px, so text starts ~2px from overlay left.\n    if (tableContainer) {\n      const rect = tableContainer.getBoundingClientRect();\n      const cellLeft = rect.left - tableContainer.scrollLeft;\n      const textLeft = cellLeft + 38;\n      const cellRight = cellLeft + colWidths.name;\n      const rowTop = rect.top + idx * rowHeight - tableContainer.scrollTop;\n      renameOverlay = {\n        top: rowTop,\n        left: textLeft - 2,\n        width: cellRight - textLeft + 2 - 4\n      };\n    }\n\n    editing = {\n      active: true,\n      path: entry.path,\n      index: idx,\n      draftName: entry.name\n    };\n\n    await tick();\n\n    if (renameInputEl) {\n      autoResizeRenameInput();\n      renameInputEl.focus();\n      const extPos = !entry.isDir ? entry.name.lastIndexOf('.') : -1;\n      const selectionEnd = extPos > 0 ? extPos : entry.name.length;\n      renameInputEl.setSelectionRange(0, selectionEnd);\n    }\n  }","numLines":40,"startLine":953,"totalLines":2275}},"sourceToolAssistantUUID":"6e80a84c-89db-495d-904c-c156246e9c46"}
{"parentUuid":"64a0de9b-0ad5-4439-ab98-5aa15795cd07","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","message":{"model":"claude-sonnet-4-6","id":"msg_015RHMbLXNsd79FfAgHxp2dm","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Dk3xgiZxHh7w377Yw3NWz5","name":"Read","input":{"file_path":"/Users/al02402336/everything/src/App.svelte","offset":2095,"limit":30},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":774,"cache_read_input_tokens":104989,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":774},"output_tokens":18,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMPkyBJvcEQTw5Dnus2N","type":"assistant","uuid":"7d98dfbe-4c65-4a44-88a1-5388e2dea0b9","timestamp":"2026-02-21T14:44:33.528Z"}
{"parentUuid":"7d98dfbe-4c65-4a44-88a1-5388e2dea0b9","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01Dk3xgiZxHh7w377Yw3NWz5","toolUseID":"toolu_01Dk3xgiZxHh7w377Yw3NWz5","timestamp":"2026-02-21T14:44:33.536Z","uuid":"e14a7232-5b24-4674-88b9-8259dddf10f7"}
{"parentUuid":"7d98dfbe-4c65-4a44-88a1-5388e2dea0b9","isSidechain":false,"userType":"external","cwd":"/Users/al02402336/everything","sessionId":"d33dc671-019d-4fe5-83bc-df3cb3db3fd8","version":"2.1.49","gitBranch":"main","slug":"snazzy-prancing-wirth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Dk3xgiZxHh7w377Yw3NWz5","type":"tool_result","content":"  2095â†’\n  2096â†’  .name-editing {\n  2097â†’    opacity: 0.25;\n  2098â†’  }\n  2099â†’\n  2100â†’  .rename-overlay {\n  2101â†’    position: fixed;\n  2102â†’    z-index: 100;\n  2103â†’    min-width: 120px;\n  2104â†’  }\n  2105â†’\n  2106â†’  .rename-textarea {\n  2107â†’    display: block;\n  2108â†’    width: 100%;\n  2109â†’    box-sizing: border-box;\n  2110â†’    font-family: Inter, 'SF Pro Text', sans-serif;\n  2111â†’    font-size: 12px;\n  2112â†’    line-height: 18px;\n  2113â†’    padding: 5px 4px 5px 0;\n  2114â†’    border: 1.5px solid var(--focus-ring);\n  2115â†’    border-radius: 4px;\n  2116â†’    background: var(--bg-input, var(--surface));\n  2117â†’    color: var(--text-primary);\n  2118â†’    outline: none;\n  2119â†’    resize: none;\n  2120â†’    overflow: hidden;\n  2121â†’    box-shadow: 0 2px 14px rgba(0, 0, 0, 0.22), 0 0 0 3px rgba(77, 168, 255, 0.13);\n  2122â†’  }\n  2123â†’\n  2124â†’  .status-bar {\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"d98f6b6b-4227-441a-a841-7287192d17e8","timestamp":"2026-02-21T14:44:33.535Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/al02402336/everything/src/App.svelte","content":"\n  .name-editing {\n    opacity: 0.25;\n  }\n\n  .rename-overlay {\n    position: fixed;\n    z-index: 100;\n    min-width: 120px;\n  }\n\n  .rename-textarea {\n    display: block;\n    width: 100%;\n    box-sizing: border-box;\n    font-family: Inter, 'SF Pro Text', sans-serif;\n    font-size: 12px;\n    line-height: 18px;\n    padding: 5px 4px 5px 0;\n    border: 1.5px solid var(--focus-ring);\n    border-radius: 4px;\n    background: var(--bg-input, var(--surface));\n    color: var(--text-primary);\n    outline: none;\n    resize: none;\n    overflow: hidden;\n    box-shadow: 0 2px 14px rgba(0, 0, 0, 0.22), 0 0 0 3px rgba(77, 168, 255, 0.13);\n  }\n\n  .status-bar {","numLines":30,"startLine":2095,"totalLines":2275}},"sourceToolAssistantUUID":"7d98dfbe-4c65-4a44-88a1-5388e2dea0b9"}
